(self.webpackChunkceph_dashboard=self.webpackChunkceph_dashboard||[]).push([[5598],{25598:(at,Ce,p)=>{p.r(Ce),p.d(Ce,{BlockModule:()=>wt,RoutedBlockModule:()=>fc});var c=p(91974),_=p(53648),v=p(76218),A=p(77317),Ee=p(13421),O=p(54372),re=p(1811),Z=p(6955),ee=p(93887),Te=p(29841),C=p.n(Te),z=p(95631),se=p(84857),De=p(36618),G=p(80697),e=p(87536);let Q=class ot{constructor(r){this.http=r}listTargets(){return this.http.get("api/iscsi/target")}getTarget(r){return this.http.get(`api/iscsi/target/${r}`)}updateTarget(r,t){return this.http.put(`api/iscsi/target/${r}`,t,{observe:"response"})}status(){return this.http.get("ui-api/iscsi/status")}settings(){return this.http.get("ui-api/iscsi/settings")}version(){return this.http.get("ui-api/iscsi/version")}portals(){return this.http.get("ui-api/iscsi/portals")}createTarget(r){return this.http.post("api/iscsi/target",r,{observe:"response"})}deleteTarget(r){return this.http.delete(`api/iscsi/target/${r}`,{observe:"response"})}getDiscovery(){return this.http.get("api/iscsi/discoveryauth")}updateDiscovery(r){return this.http.put("api/iscsi/discoveryauth",r)}overview(){return this.http.get("ui-api/iscsi/overview")}static{this.\u0275fac=function(t){return new(t||ot)(e.\u0275\u0275inject(De.HttpClient))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:ot,factory:ot.\u0275fac,providedIn:"root"})}};Q=(0,se.__decorate)([G.G,(0,se.__metadata)("design:paramtypes",[De.HttpClient])],Q);var U=p(75180),Fe=p(66668),te=p(31345),T=p(46045),Ge=p(74902),k=p(58384),I=p(3687),W=p(48856),h=p(85481),K=p(77867),y=p(50813),q=p(69081),F=p(59781),x=p(90476),g=p(10142),S=p(78708),N=p(37966),m=p(3600);function X(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"option",8),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=r.$implicit;e.\u0275\u0275property("ngValue",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t)}}function Ve(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"select",7),e.\u0275\u0275element(1,"option",8),e.\u0275\u0275template(2,X,2,2,"option",9),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("id",t.setting),e.\u0275\u0275propertyInterpolate("name",t.setting),e.\u0275\u0275property("formControlName",t.setting),e.\u0275\u0275advance(),e.\u0275\u0275property("ngValue",null),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",t.limits.values)}}function pn(i,r){if(1&i&&e.\u0275\u0275element(0,"input",12),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("formControlName",t.setting)}}function un(i,r){if(1&i&&e.\u0275\u0275element(0,"input",13),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("formControlName",t.setting)}}function gn(i,r){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"br"),e.\u0275\u0275elementStart(2,"div",14),e.\u0275\u0275element(3,"input",15),e.\u0275\u0275elementStart(4,"label",16),e.\u0275\u0275text(5,"Yes"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",14),e.\u0275\u0275element(7,"input",15),e.\u0275\u0275elementStart(8,"label",16),e.\u0275\u0275text(9,"No"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(3),e.\u0275\u0275property("id",t.setting+"True")("value",!0)("formControlName",t.setting),e.\u0275\u0275advance(),e.\u0275\u0275property("for",t.setting+"True"),e.\u0275\u0275advance(3),e.\u0275\u0275property("id",t.setting+"False")("value",!1)("formControlName",t.setting),e.\u0275\u0275advance(),e.\u0275\u0275property("for",t.setting+"False")}}function Sn(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275template(1,pn,1,1,"input",10)(2,un,1,1,"input",11)(3,gn,10,8,"ng-container",5),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","int"===t.limits.type),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","str"===t.limits.type),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","bool"===t.limits.type)}}function fn(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span",17),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18n(2,0),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275i18nExp(t.limits.min),e.\u0275\u0275i18nApply(2)}}function Cn(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span",17),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18n(2,1),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275i18nExp(t.limits.max),e.\u0275\u0275i18nApply(2)}}let Tt=(()=>{class i{ngOnInit(){const t=[];"min"in this.limits&&t.push(_.Validators.min(Number(this.limits.min))),"max"in this.limits&&t.push(_.Validators.max(Number(this.limits.max))),this.settingsForm.get(this.setting).setValidators(t)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-iscsi-setting"]],inputs:{settingsForm:"settingsForm",formDir:"formDir",setting:"setting",limits:"limits"},decls:7,vars:7,consts:()=>{let t,n;return t="Must be greater than or equal to " + "\ufffd0\ufffd" + ".",n="Must be less than or equal to " + "\ufffd0\ufffd" + ".",[t,n,[1,"form-group",3,"formGroup"],[1,"col-form-label",3,"for"],["class","form-control",3,"id","name","formControlName",4,"ngIf"],[4,"ngIf"],["class","invalid-feedback",4,"ngIf"],[1,"form-control",3,"id","name","formControlName"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","number","class","form-control",3,"formControlName",4,"ngIf"],["type","text","class","form-control",3,"formControlName",4,"ngIf"],["type","number",1,"form-control",3,"formControlName"],["type","text",1,"form-control",3,"formControlName"],[1,"custom-control","custom-radio","custom-control-inline"],["type","radio",1,"custom-control-input",3,"id","value","formControlName"],[1,"custom-control-label",3,"for"],[1,"invalid-feedback"]]},template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"div",2)(1,"label",3),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,Ve,3,5,"select",4)(4,Sn,4,3,"span",5)(5,fn,3,1,"span",6)(6,Cn,3,1,"span",6),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275property("formGroup",o.settingsForm),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("for",o.setting),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(o.setting),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","enum"===o.limits.type),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","enum"!==o.limits.type),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.settingsForm.showError(o.setting,o.formDir,"min")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.settingsForm.showError(o.setting,o.formDir,"max")))},dependencies:[c.NgForOf,c.NgIf,_.NgSelectOption,_.\u0275NgSelectMultipleOption,_.DefaultValueAccessor,_.NumberValueAccessor,_.SelectControlValueAccessor,_.RadioControlValueAccessor,_.NgControlStatus,_.NgControlStatusGroup,_.FormGroupDirective,_.FormControlName,x.S,g.a,S.C,N.E,m.Option]})}}return i})();var Ye=p(82680);function En(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",30),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd())}function Tn(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span")(1,"legend",16),e.\u0275\u0275i18n(2,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",17)(4,"div",18)(5,"label",25),e.\u0275\u0275i18n(6,6),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(7,"input",26),e.\u0275\u0275template(8,En,2,0,"span",27),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(9,"div",17)(10,"div",18)(11,"label",28),e.\u0275\u0275i18n(12,7),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(13,"input",29),e.\u0275\u0275elementEnd()()()),2&i){const t=e.\u0275\u0275nextContext(),n=e.\u0275\u0275reference(9);e.\u0275\u0275advance(8),e.\u0275\u0275property("ngIf",t.settingsForm.showError("lun",n,"required"))}}function Fn(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"option",31),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"iscsiBackstore"),e.\u0275\u0275elementEnd()),2&i){const t=r.$implicit;e.\u0275\u0275property("value",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,2,t))}}function Mn(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"div",17)(1,"div",18),e.\u0275\u0275element(2,"cd-iscsi-setting",33),e.\u0275\u0275elementEnd()()),2&i){const t=r.$implicit,n=e.\u0275\u0275nextContext(2).$implicit,o=e.\u0275\u0275nextContext(),a=e.\u0275\u0275reference(9);e.\u0275\u0275advance(2),e.\u0275\u0275property("settingsForm",o.settingsForm)("formDir",a)("setting",t.key)("limits",o.getDiskControlLimits(n,t.key))}}function hn(i,r){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Mn,3,4,"div",32),e.\u0275\u0275pipe(2,"keyvalue"),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(2,1,n.disk_default_controls[t]))}}function On(i,r){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,hn,3,3,"ng-container",15),e.\u0275\u0275elementContainerEnd()),2&i){const t=r.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.settingsForm.value.backstore===t)}}let Rn=(()=>{class i{constructor(t,n,o){this.activeModal=t,this.iscsiService=n,this.actionLabels=o}ngOnInit(){const t={backstore:new _.UntypedFormControl(this.imagesSettings[this.image].backstore),lun:new _.UntypedFormControl(this.imagesSettings[this.image].lun),wwn:new _.UntypedFormControl(this.imagesSettings[this.image].wwn)};C().forEach(this.backstores,n=>{const o=this.imagesSettings[this.image][n]||{};C().forIn(this.disk_default_controls[n],(a,s)=>{t[s]=new _.UntypedFormControl(o[s])})}),this.settingsForm=new k.$(t)}getDiskControlLimits(t,n){return this.disk_controls_limits?this.disk_controls_limits[t][n]:{type:"int"}}save(){const t=this.settingsForm.controls.backstore.value,n=this.settingsForm.controls.lun.value,o=this.settingsForm.controls.wwn.value,a={};C().forIn(this.settingsForm.controls,(s,l)=>{""!==s.value&&null!==s.value&&l in this.disk_default_controls[this.settingsForm.value.backstore]&&(a[l]=s.value,C().forEach(this.backstores,d=>{d!==t&&l in(this.imagesSettings[this.image][d]||{})&&(this.imagesSettings[this.image][d][l]=s.value)}))}),this.imagesSettings[this.image].backstore=t,this.imagesSettings[this.image].lun=n,this.imagesSettings[this.image].wwn=o,this.imagesSettings[this.image][t]=a,this.imagesSettings={...this.imagesSettings},this.control.updateValueAndValidity({emitEvent:!1}),this.activeModal.close()}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(A.NgbActiveModal),e.\u0275\u0275directiveInject(Q),e.\u0275\u0275directiveInject(O.Ss))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-iscsi-target-image-settings-modal"]],decls:25,vars:8,consts:()=>{let t,n,o,a,s,l,d,u;return t="Configure",n="Changing these parameters from their default values is usually not necessary.",o="Settings",a="Backstore",s="Identifier",l="lun",d="wwn",u="This field is required.",[["formDir","ngForm"],t,n,o,a,s,l,d,u,[3,"modalRef"],[1,"modal-title"],[1,"modal-content"],["name","settingsForm","novalidate","",1,"form",3,"formGroup"],[1,"modal-body"],[1,"alert-warning"],[4,"ngIf"],[1,"cd-header"],[1,"form-group","row"],[1,"col-sm-12"],[1,"col-form-label"],["id","backstore","name","backstore","formControlName","backstore",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"modal-footer"],[3,"submitActionEvent","form","submitText"],["for","lun",1,"col-form-label","required"],["type","number","id","lun","name","lun","formControlName","lun",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","wwn",1,"col-form-label"],["type","text","id","wwn","name","wwn","formControlName","wwn",1,"form-control"],[1,"invalid-feedback"],[3,"value"],["class","form-group row",4,"ngFor","ngForOf"],[3,"settingsForm","formDir","setting","limits"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-modal",9),e.\u0275\u0275elementContainerStart(1,10)(2),e.\u0275\u0275i18n(3,1),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275text(4,"\xa0 "),e.\u0275\u0275elementStart(5,"small"),e.\u0275\u0275text(6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(7,11),e.\u0275\u0275elementStart(8,"form",12,0)(10,"div",13)(11,"p",14),e.\u0275\u0275i18n(12,2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(13,Tn,14,1,"span",15),e.\u0275\u0275elementStart(14,"legend",16),e.\u0275\u0275i18n(15,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div",17)(17,"div",18)(18,"label",19),e.\u0275\u0275i18n(19,4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"select",20),e.\u0275\u0275template(21,Fn,3,4,"option",21),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(22,On,2,1,"ng-container",22),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(23,"div",23)(24,"cd-form-button-panel",24),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.save())}),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()}2&n&&(e.\u0275\u0275property("modalRef",o.activeModal),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(o.image),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",o.settingsForm),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",o.api_version>=1),e.\u0275\u0275advance(8),e.\u0275\u0275property("ngForOf",o.backstores),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",o.backstores),e.\u0275\u0275advance(2),e.\u0275\u0275property("form",o.settingsForm)("submitText",o.actionLabels.UPDATE))},dependencies:[c.NgForOf,c.NgIf,_.\u0275NgNoValidate,_.NgSelectOption,_.\u0275NgSelectMultipleOption,_.DefaultValueAccessor,_.NumberValueAccessor,_.SelectControlValueAccessor,_.NgControlStatus,_.NgControlStatusGroup,_.FormGroupDirective,_.FormControlName,q.z,F.e,x.S,g.a,S.C,N.E,m.Option,Tt,c.KeyValuePipe,Ye.k]})}}return i})();function In(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"div",12)(1,"div",13),e.\u0275\u0275element(2,"cd-iscsi-setting",14),e.\u0275\u0275elementEnd()()),2&i){const t=r.$implicit,n=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(5);e.\u0275\u0275advance(2),e.\u0275\u0275property("settingsForm",n.settingsForm)("formDir",o)("setting",t.key)("limits",n.getTargetControlLimits(t.key))}}let Nn=(()=>{class i{constructor(t,n,o){this.activeModal=t,this.iscsiService=n,this.actionLabels=o}ngOnInit(){const t={};C().forIn(this.target_default_controls,(n,o)=>{t[o]=new _.UntypedFormControl(this.target_controls.value[o])}),this.settingsForm=new k.$(t)}save(){const t={};C().forIn(this.settingsForm.controls,(n,o)=>{""===n.value||null===n.value||(t[o]=n.value)}),this.target_controls.setValue(t),this.activeModal.close()}getTargetControlLimits(t){return this.target_controls_limits?this.target_controls_limits[t]:["Yes","No"].includes(this.target_default_controls[t])?{type:"bool"}:{type:"int"}}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(A.NgbActiveModal),e.\u0275\u0275directiveInject(Q),e.\u0275\u0275directiveInject(O.Ss))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-iscsi-target-iqn-settings-modal"]],decls:13,vars:7,consts:()=>{let t,n;return t="Advanced Settings",n="Changing these parameters from their default values is usually not necessary.",[["formDir","ngForm"],t,n,[3,"modalRef"],[1,"modal-title"],[1,"modal-content"],["name","settingsForm","novalidate","",3,"formGroup"],[1,"modal-body"],[1,"alert-warning"],["class","form-group row",4,"ngFor","ngForOf"],[1,"modal-footer"],[3,"submitActionEvent","form","submitText"],[1,"form-group","row"],[1,"col-sm-12"],[3,"settingsForm","formDir","setting","limits"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-modal",3),e.\u0275\u0275elementContainerStart(1,4),e.\u0275\u0275i18n(2,1),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(3,5),e.\u0275\u0275elementStart(4,"form",6,0)(6,"div",7)(7,"p",8),e.\u0275\u0275i18n(8,2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,In,3,4,"div",9),e.\u0275\u0275pipe(10,"keyvalue"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"div",10)(12,"cd-form-button-panel",11),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.save())}),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()}2&n&&(e.\u0275\u0275property("modalRef",o.activeModal),e.\u0275\u0275advance(4),e.\u0275\u0275property("formGroup",o.settingsForm),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(10,5,o.settingsForm.controls)),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.settingsForm)("submitText",o.actionLabels.UPDATE))},dependencies:[c.NgForOf,_.\u0275NgNoValidate,_.NgControlStatusGroup,_.FormGroupDirective,q.z,F.e,S.C,N.E,Tt,c.KeyValuePipe]})}}return i})();var bn=p(92619),We=p(50889),Ft=p(12302),Pn=p(70946),Mt=p(56677),Le=p(37353);function An(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd())}function vn(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,9),e.\u0275\u0275elementEnd())}function Dn(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18n(2,10),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275element(3,"br"),e.\u0275\u0275elementContainerStart(4),e.\u0275\u0275i18n(5,11),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275element(6,"br"),e.\u0275\u0275elementStart(7,"a",95),e.\u0275\u0275i18n(8,12),e.\u0275\u0275elementEnd()())}function Ln(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",96),e.\u0275\u0275i18n(1,13),e.\u0275\u0275elementEnd())}function yn(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",97),e.\u0275\u0275element(2,"input",98),e.\u0275\u0275elementStart(3,"button",99),e.\u0275\u0275listener("click",function(){const o=e.\u0275\u0275restoreView(t),a=o.$implicit,s=o.index,l=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(l.removePortal(s,a))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(4,"svg",75),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=r.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("value",t),e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",n.icons.destroy)("size",n.icons.size16)}}function $n(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,14),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275i18nExp(t.minimum_gateways),e.\u0275\u0275i18nApply(1)}}function Bn(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"div",102),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1("lun: ",n.imagesSettings[t].lun,"")}}function Gn(i,r){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275i18n(1,15),e.\u0275\u0275pipe(2,"iscsiBackstore"),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(2,1,n.imagesSettings[t].backstore)),e.\u0275\u0275i18nApply(1)}}function xn(i,r){1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275i18n(1,16),e.\u0275\u0275elementContainerEnd())}function wn(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",97),e.\u0275\u0275element(2,"input",98),e.\u0275\u0275template(3,Bn,2,1,"div",100),e.\u0275\u0275elementStart(4,"button",99),e.\u0275\u0275listener("click",function(){const o=e.\u0275\u0275restoreView(t).$implicit,a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.imageSettingsModal(o))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(5,"svg",75),e.\u0275\u0275elementEnd(),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementStart(6,"button",99),e.\u0275\u0275listener("click",function(){const o=e.\u0275\u0275restoreView(t),a=o.$implicit,s=o.index,l=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(l.removeImage(s,a))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(7,"svg",75),e.\u0275\u0275elementEnd()(),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementStart(8,"span",96),e.\u0275\u0275template(9,Gn,3,3,"ng-container",101)(10,xn,2,0,"ng-container",101),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=r.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("value",t),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.api_version>=1),e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",n.icons.deepCheck)("size",n.icons.size16),e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",n.icons.destroy)("size",n.icons.size16),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.backstores.length>1),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.hasAdvancedSettings(n.imagesSettings[t][n.imagesSettings[t].backstore]))}}function Vn(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,17),e.\u0275\u0275elementEnd())}function Hn(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,18),e.\u0275\u0275elementEnd())}function kn(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,23),e.\u0275\u0275elementEnd())}function Kn(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,24),e.\u0275\u0275elementEnd())}function zn(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,25),e.\u0275\u0275elementEnd())}function Xn(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,26),e.\u0275\u0275elementEnd())}function Un(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,27),e.\u0275\u0275elementEnd())}function jn(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,28),e.\u0275\u0275elementEnd())}function qn(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,29),e.\u0275\u0275elementEnd())}function Qn(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,30),e.\u0275\u0275elementEnd())}function Yn(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"div",103)(1,"div",69)(2,"label",104),e.\u0275\u0275elementContainerStart(3),e.\u0275\u0275i18n(4,19),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",71),e.\u0275\u0275element(6,"input",105),e.\u0275\u0275template(7,kn,2,0,"span",76)(8,Kn,2,0,"span",76),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(9,"div",69)(10,"label",106),e.\u0275\u0275elementContainerStart(11),e.\u0275\u0275i18n(12,20),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"div",71)(14,"div",72),e.\u0275\u0275element(15,"input",107)(16,"button",108)(17,"cd-copy-2-clipboard-button",109),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(18,zn,2,0,"span",76)(19,Xn,2,0,"span",76),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(20,"div",69)(21,"label",110),e.\u0275\u0275elementContainerStart(22),e.\u0275\u0275i18n(23,21),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"div",71),e.\u0275\u0275element(25,"input",111),e.\u0275\u0275template(26,Un,2,0,"span",76)(27,jn,2,0,"span",76),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(28,"div",69)(29,"label",112),e.\u0275\u0275elementContainerStart(30),e.\u0275\u0275i18n(31,22),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(32,"div",71)(33,"div",72),e.\u0275\u0275element(34,"input",113)(35,"button",114)(36,"cd-copy-2-clipboard-button",115),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(37,qn,2,0,"span",76)(38,Qn,2,0,"span",76),e.\u0275\u0275elementEnd()()()),2&i){e.\u0275\u0275nextContext();const t=e.\u0275\u0275reference(2),n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",n.targetForm.showError("user",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.targetForm.showError("user",t,"pattern")),e.\u0275\u0275advance(10),e.\u0275\u0275property("ngIf",n.targetForm.showError("password",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.targetForm.showError("password",t,"pattern")),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",n.targetForm.showError("mutual_user",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.targetForm.showError("mutual_user",t,"pattern")),e.\u0275\u0275advance(10),e.\u0275\u0275property("ngIf",n.targetForm.showError("mutual_password",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.targetForm.showError("mutual_password",t,"pattern"))}}function Wn(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,40),e.\u0275\u0275elementEnd())}function Jn(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,41),e.\u0275\u0275elementEnd())}function Zn(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,42),e.\u0275\u0275elementEnd())}function eo(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,43),e.\u0275\u0275elementEnd())}function to(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,44),e.\u0275\u0275elementEnd())}function no(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,45),e.\u0275\u0275elementEnd())}function oo(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,46),e.\u0275\u0275elementEnd())}function io(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,47),e.\u0275\u0275elementEnd())}function ao(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,48),e.\u0275\u0275elementEnd())}function ro(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,49),e.\u0275\u0275elementEnd())}function so(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,50),e.\u0275\u0275elementEnd())}function lo(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",97),e.\u0275\u0275element(2,"input",98),e.\u0275\u0275elementStart(3,"button",99),e.\u0275\u0275listener("click",function(){const o=e.\u0275\u0275restoreView(t),a=o.$implicit,s=o.index,l=e.\u0275\u0275nextContext(),d=l.$implicit,u=l.index,f=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(f.removeInitiatorImage(d,s,u,a))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(4,"svg",75),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=r.$implicit,n=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(2),e.\u0275\u0275property("value",t),e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",n.icons.destroy)("size",n.icons.size16)}}function _o(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275i18n(1,51),e.\u0275\u0275elementEnd())}function co(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"div",80)(1,"div",81)(2,"cd-select",136),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(3,"svg",75),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementContainerStart(4),e.\u0275\u0275i18n(5,52),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()()()),2&i){const t=e.\u0275\u0275nextContext(),n=t.$implicit,o=t.index,a=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(2),e.\u0275\u0275property("data",n.getValue("luns"))("options",a.imagesInitiatorSelections[o])("messages",a.messages.initiatorImage),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",a.icons.add)("size",a.icons.size16)}}function mo(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",120)(1,"div",67),e.\u0275\u0275elementContainerStart(2),e.\u0275\u0275i18n(3,33),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275text(4),e.\u0275\u0275elementStart(5,"button",121),e.\u0275\u0275listener("click",function(){const o=e.\u0275\u0275restoreView(t).index,a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.removeInitiator(o))}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",68)(7,"div",69)(8,"label",122),e.\u0275\u0275i18n(9,34),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"div",71)(11,"input",123),e.\u0275\u0275listener("blur",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(o.updatedInitiatorSelector())}),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(12,Wn,2,0,"span",76)(13,Jn,2,0,"span",76)(14,Zn,2,0,"span",76),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerStart(15,103),e.\u0275\u0275elementStart(16,"div",69)(17,"label",124),e.\u0275\u0275i18n(18,35),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"div",71),e.\u0275\u0275element(20,"input",125),e.\u0275\u0275template(21,eo,2,0,"span",76)(22,to,2,0,"span",76),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(23,"div",69)(24,"label",126),e.\u0275\u0275i18n(25,36),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(26,"div",71)(27,"div",72),e.\u0275\u0275element(28,"input",127)(29,"button",128)(30,"cd-copy-2-clipboard-button",129),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(31,no,2,0,"span",76)(32,oo,2,0,"span",76),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(33,"div",69)(34,"label",130),e.\u0275\u0275elementContainerStart(35),e.\u0275\u0275i18n(36,37),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(37,"div",71),e.\u0275\u0275element(38,"input",131),e.\u0275\u0275template(39,io,2,0,"span",76)(40,ao,2,0,"span",76),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(41,"div",69)(42,"label",132),e.\u0275\u0275i18n(43,38),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(44,"div",71)(45,"div",72),e.\u0275\u0275element(46,"input",133)(47,"button",128)(48,"cd-copy-2-clipboard-button",129),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(49,ro,2,0,"span",76)(50,so,2,0,"span",76),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementStart(51,"div",69)(52,"label",134),e.\u0275\u0275i18n(53,39),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(54,"div",71),e.\u0275\u0275template(55,lo,5,3,"ng-container",79)(56,_o,2,0,"span",101)(57,co,6,5,"div",135),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=r.$implicit,n=r.index;e.\u0275\u0275nextContext(2);const o=e.\u0275\u0275reference(2);e.\u0275\u0275property("formGroup",t),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(": ",t.getValue("client_iqn")," "),e.\u0275\u0275advance(8),e.\u0275\u0275property("ngIf",t.showError("client_iqn",o,"notUnique")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("client_iqn",o,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("client_iqn",o,"pattern")),e.\u0275\u0275advance(6),e.\u0275\u0275property("id","user"+n),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("user",o,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("user",o,"pattern")),e.\u0275\u0275advance(6),e.\u0275\u0275property("id","password"+n),e.\u0275\u0275advance(),e.\u0275\u0275property("cdPasswordButton","password"+n),e.\u0275\u0275advance(),e.\u0275\u0275property("source","password"+n),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("password",o,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("password",o,"pattern")),e.\u0275\u0275advance(6),e.\u0275\u0275property("id","mutual_user"+n),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("mutual_user",o,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("mutual_user",o,"pattern")),e.\u0275\u0275advance(6),e.\u0275\u0275property("id","mutual_password"+n),e.\u0275\u0275advance(),e.\u0275\u0275property("cdPasswordButton","mutual_password"+n),e.\u0275\u0275advance(),e.\u0275\u0275property("source","mutual_password"+n),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("mutual_password",o,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("mutual_password",o,"pattern")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",t.getValue("luns")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.getValue("cdIsInGroup")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!t.getValue("cdIsInGroup"))}}function po(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",96),e.\u0275\u0275i18n(1,53),e.\u0275\u0275elementEnd())}function uo(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",69)(1,"label",116),e.\u0275\u0275i18n(2,31),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",117),e.\u0275\u0275template(4,mo,58,24,"div",118),e.\u0275\u0275elementStart(5,"div",80)(6,"div",81),e.\u0275\u0275template(7,po,2,0,"span",77),e.\u0275\u0275elementStart(8,"button",119),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).addInitiator(),e.\u0275\u0275resetView(!1)}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(9,"svg",75),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementContainerStart(10),e.\u0275\u0275i18n(11,32),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(12,"hr"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",t.initiators.controls),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",0===t.initiators.controls.length),e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",t.icons.add)("size",t.icons.size16)}}function go(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",97),e.\u0275\u0275element(2,"input",98),e.\u0275\u0275elementStart(3,"button",99),e.\u0275\u0275listener("click",function(){const o=e.\u0275\u0275restoreView(t).index,a=e.\u0275\u0275nextContext(),s=a.$implicit,l=a.index,d=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(d.removeGroupInitiator(s,o,l))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(4,"svg",75),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=r.$implicit,n=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(2),e.\u0275\u0275property("value",t),e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",n.icons.destroy)("size",n.icons.size16)}}function So(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",97),e.\u0275\u0275element(2,"input",98),e.\u0275\u0275elementStart(3,"button",99),e.\u0275\u0275listener("click",function(){const o=e.\u0275\u0275restoreView(t).index,a=e.\u0275\u0275nextContext(),s=a.$implicit,l=a.index,d=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(d.removeGroupDisk(s,o,l))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(4,"svg",75),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=r.$implicit,n=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(2),e.\u0275\u0275property("value",t),e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",n.icons.destroy)("size",n.icons.size16)}}function fo(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",120)(1,"div",67),e.\u0275\u0275elementContainerStart(2),e.\u0275\u0275i18n(3,56),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275text(4),e.\u0275\u0275elementStart(5,"button",121),e.\u0275\u0275listener("click",function(){const o=e.\u0275\u0275restoreView(t).index,a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.removeGroup(o))}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",68)(7,"div",69)(8,"label",138),e.\u0275\u0275i18n(9,57),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"div",71),e.\u0275\u0275element(11,"input",139),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(12,"div",69)(13,"label",140),e.\u0275\u0275elementContainerStart(14),e.\u0275\u0275i18n(15,58),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div",71),e.\u0275\u0275template(17,go,5,3,"ng-container",79),e.\u0275\u0275elementStart(18,"div",80)(19,"div",81)(20,"cd-select",82),e.\u0275\u0275listener("selection",function(o){const a=e.\u0275\u0275restoreView(t).index,s=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(s.onGroupMemberSelection(o,a))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(21,"svg",75),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementContainerStart(22),e.\u0275\u0275i18n(23,59),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(24,"hr"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(25,"div",69)(26,"label",84),e.\u0275\u0275elementContainerStart(27),e.\u0275\u0275i18n(28,60),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(29,"div",71),e.\u0275\u0275template(30,So,5,3,"ng-container",79),e.\u0275\u0275elementStart(31,"div",80)(32,"div",81)(33,"cd-select",136),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(34,"svg",75),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementContainerStart(35),e.\u0275\u0275i18n(36,61),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(37,"hr"),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=r.$implicit,n=r.index,o=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("formGroup",t),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(": ",t.getValue("group_id")," "),e.\u0275\u0275advance(13),e.\u0275\u0275property("ngForOf",t.getValue("members")),e.\u0275\u0275advance(3),e.\u0275\u0275property("data",t.getValue("members"))("options",o.groupMembersSelections[n])("messages",o.messages.groupInitiator),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",o.icons.add)("size",o.icons.size16),e.\u0275\u0275advance(9),e.\u0275\u0275property("ngForOf",t.getValue("disks")),e.\u0275\u0275advance(3),e.\u0275\u0275property("data",t.getValue("disks"))("options",o.groupDiskSelections[n])("messages",o.messages.initiatorImage),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",o.icons.add)("size",o.icons.size16)}}function Co(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",96),e.\u0275\u0275i18n(1,62),e.\u0275\u0275elementEnd())}function Eo(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",69)(1,"label",116),e.\u0275\u0275i18n(2,54),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",137),e.\u0275\u0275template(4,fo,38,14,"div",118),e.\u0275\u0275elementStart(5,"div",80)(6,"div",81),e.\u0275\u0275template(7,Co,2,0,"span",77),e.\u0275\u0275elementStart(8,"button",119),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).addGroup(),e.\u0275\u0275resetView(!1)}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(9,"svg",75),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementContainerStart(10),e.\u0275\u0275i18n(11,55),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()()()()()}if(2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",t.groups.controls),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",0===t.groups.controls.length),e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",t.icons.add)("size",t.icons.size16)}}function To(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",64)(1,"form",65,0)(3,"div",66)(4,"div",67),e.\u0275\u0275i18n(5,1),e.\u0275\u0275pipe(6,"titlecase"),e.\u0275\u0275pipe(7,"upperFirst"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"div",68)(9,"div",69)(10,"label",70),e.\u0275\u0275i18n(11,2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"div",71)(13,"div",72),e.\u0275\u0275element(14,"input",73),e.\u0275\u0275elementStart(15,"button",74),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.targetSettingsModal())}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(16,"svg",75),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(17,An,2,0,"span",76)(18,vn,2,0,"span",76)(19,Dn,9,0,"span",76)(20,Ln,2,0,"span",77),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275element(21,"hr"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(22,"div",69)(23,"label",78),e.\u0275\u0275i18n(24,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(25,"div",71),e.\u0275\u0275template(26,yn,5,3,"ng-container",79),e.\u0275\u0275elementStart(27,"div",80)(28,"div",81)(29,"cd-select",82),e.\u0275\u0275listener("selection",function(o){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.onPortalSelection(o))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(30,"svg",75),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementContainerStart(31),e.\u0275\u0275i18n(32,4),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(33,"input",83),e.\u0275\u0275template(34,$n,2,1,"span",76),e.\u0275\u0275element(35,"hr"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(36,"div",69)(37,"label",84),e.\u0275\u0275i18n(38,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(39,"div",71),e.\u0275\u0275template(40,wn,11,8,"ng-container",79),e.\u0275\u0275element(41,"input",85),e.\u0275\u0275template(42,Vn,2,0,"span",76)(43,Hn,2,0,"span",76),e.\u0275\u0275elementStart(44,"div",80)(45,"div",81)(46,"cd-select",82),e.\u0275\u0275listener("selection",function(o){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.onImageSelection(o))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(47,"svg",75),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementContainerStart(48),e.\u0275\u0275i18n(49,6),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(50,"hr"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(51,"div",69)(52,"div",86)(53,"div",87),e.\u0275\u0275element(54,"input",88),e.\u0275\u0275elementStart(55,"label",89),e.\u0275\u0275i18n(56,7),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(57,"hr"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(58,Yn,39,8,"div",90)(59,uo,13,4,"div",91)(60,Eo,12,4,"div",91),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(61,"div",92)(62,"cd-form-button-panel",93),e.\u0275\u0275pipe(63,"titlecase"),e.\u0275\u0275pipe(64,"upperFirst"),e.\u0275\u0275listener("submitActionEvent",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.submit())}),e.\u0275\u0275elementEnd()()()()()}if(2&i){const t=e.\u0275\u0275reference(2),n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("formGroup",n.targetForm),e.\u0275\u0275advance(6),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(6,29,n.action))(e.\u0275\u0275pipeBind1(7,31,n.resource)),e.\u0275\u0275i18nApply(5),e.\u0275\u0275advance(9),e.\u0275\u0275property("cdsIcon",n.icons.deepCheck)("size",n.icons.size16),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.targetForm.showError("target_iqn",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.targetForm.showError("target_iqn",t,"pattern")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.targetForm.showError("target_iqn",t,"iqn")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.hasAdvancedSettings(n.targetForm.getValue("target_controls"))),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",n.portals.value),e.\u0275\u0275advance(3),e.\u0275\u0275property("data",n.portals.value)("options",n.portalsSelections)("messages",n.messages.portals),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",n.icons.add)("size",n.icons.size16),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",n.targetForm.showError("portals",t,"minGateways")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",n.targetForm.getValue("disks")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.targetForm.showError("disks",t,"dupLunId")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.targetForm.showError("disks",t,"dupWwn")),e.\u0275\u0275advance(3),e.\u0275\u0275property("data",n.disks.value)("options",n.imagesSelections)("messages",n.messages.images),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",n.icons.add)("size",n.icons.size16),e.\u0275\u0275advance(11),e.\u0275\u0275property("ngIf",n.cephIscsiConfigVersion>10&&!n.targetForm.getValue("acl_enabled")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.targetForm.getValue("acl_enabled")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.targetForm.getValue("acl_enabled")),e.\u0275\u0275advance(2),e.\u0275\u0275property("form",n.targetForm)("submitText",e.\u0275\u0275pipeBind1(63,33,n.action)+" "+e.\u0275\u0275pipeBind1(64,35,n.resource))}}let ht=(()=>{class i extends Ge.g{constructor(t,n,o,a,s,l,d){super(),this.iscsiService=t,this.modalService=n,this.rbdService=o,this.router=a,this.route=s,this.taskWrapper=l,this.actionLabels=d,this.api_version=0,this.minimum_gateways=1,this.icons=T.FI,this.isEdit=!1,this.portalsSelections=[],this.imagesInitiatorSelections=[],this.groupDiskSelections=[],this.groupMembersSelections=[],this.imagesSettings={},this.messages={portals:new Fe.z({noOptions:"There are no portals available."}),images:new Fe.z({noOptions:"There are no images available."}),initiatorImage:new Fe.z({noOptions:"There are no images available. Please make sure you add an image to the target."}),groupInitiator:new Fe.z({noOptions:"There are no initiators available. Please make sure you add an initiator to the target."})},this.IQN_REGEX=/^iqn\.(19|20)\d\d-(0[1-9]|1[0-2])\.\D{2,3}(\.[A-Za-z0-9-]+)+(:[A-Za-z0-9-\.]+)*$/,this.USER_REGEX=/^[\w\.:@_-]{8,64}$/,this.PASSWORD_REGEX=/^[\w@\-_\/]{12,16}$/,this.resource="target"}ngOnInit(){const t=new W.n(()=>{});t.pageInfo.limit=-1;const n=[this.iscsiService.listTargets(),this.rbdService.list(t.toParams()),this.iscsiService.portals(),this.iscsiService.settings(),this.iscsiService.version()];this.router.url.startsWith("/block/iscsi/targets/edit")&&(this.isEdit=!0,this.route.params.subscribe(o=>{this.target_iqn=decodeURIComponent(o.target_iqn),n.push(this.iscsiService.getTarget(this.target_iqn))})),this.action=this.isEdit?this.actionLabels.EDIT:this.actionLabels.CREATE,(0,z.forkJoin)(n).subscribe(o=>{const a=C()(o[0]).filter(l=>l.target_iqn!==this.target_iqn).flatMap(l=>l.disks).map(l=>`${l.pool}/${l.image}`).value();"api_version"in o[3]&&(this.api_version=o[3].api_version),this.minimum_gateways=o[3].config.minimum_gateways,this.target_default_controls=o[3].target_default_controls,this.target_controls_limits=o[3].target_controls_limits,this.disk_default_controls=o[3].disk_default_controls,this.disk_controls_limits=o[3].disk_controls_limits,this.backstores=o[3].backstores,this.default_backstore=o[3].default_backstore,this.unsupported_rbd_features=o[3].unsupported_rbd_features,this.required_rbd_features=o[3].required_rbd_features,this.imagesAll=C()(o[1]).flatMap(l=>l.value).filter(l=>!l.namespace&&!(-1!==a.indexOf(`${l.pool_name}/${l.name}`)||0===this.getValidBackstores(l).length)).value(),this.imagesSelections=this.imagesAll.map(l=>new te.O(!1,`${l.pool_name}/${l.name}`,""));const s=[];o[2].forEach(l=>{l.ip_addresses.forEach(d=>{s.push(new te.O(!1,l.name+":"+d,""))})}),this.portalsSelections=[...s],this.cephIscsiConfigVersion=o[4].ceph_iscsi_config_version,this.createForm(),o[5]&&this.resolveModel(o[5]),this.loadingReady()})}createForm(){if(this.targetForm=new k.$({target_iqn:new _.UntypedFormControl("iqn.2001-07.com.ceph:"+Date.now(),{validators:[_.Validators.required,_.Validators.pattern(this.IQN_REGEX)]}),target_controls:new _.UntypedFormControl({}),portals:new _.UntypedFormControl([],{validators:[I.xQ.custom("minGateways",t=>C().uniq(t.map(o=>o.split(":")[0])).length<Math.max(1,this.minimum_gateways))]}),disks:new _.UntypedFormControl([],{validators:[I.xQ.custom("dupLunId",t=>{const n=this.getLunIds(t);return n.length!==C().uniq(n).length}),I.xQ.custom("dupWwn",t=>{const n=this.getWwns(t);return n.length!==C().uniq(n).length})]}),initiators:new _.UntypedFormArray([]),groups:new _.UntypedFormArray([]),acl_enabled:new _.UntypedFormControl(!1)}),this.cephIscsiConfigVersion>10){const t=new k.$({user:new _.UntypedFormControl(""),password:new _.UntypedFormControl(""),mutual_user:new _.UntypedFormControl(""),mutual_password:new _.UntypedFormControl("")});this.setAuthValidator(t),this.targetForm.addControl("auth",t)}}resolveModel(t){this.targetForm.patchValue({target_iqn:t.target_iqn,target_controls:t.target_controls,acl_enabled:t.acl_enabled}),this.cephIscsiConfigVersion>10&&this.targetForm.patchValue({auth:t.auth});const n=[];C().forEach(t.portals,a=>{n.push(`${a.host}:${a.ip}`)}),this.targetForm.patchValue({portals:n});const o=[];C().forEach(t.disks,a=>{const s=`${a.pool}/${a.image}`;o.push(s),this.imagesSettings[s]={backstore:a.backstore},this.imagesSettings[s][a.backstore]=a.controls,"lun"in a&&(this.imagesSettings[s].lun=a.lun),"wwn"in a&&(this.imagesSettings[s].wwn=a.wwn),this.onImageSelection({option:{name:s,selected:!0}})}),this.targetForm.patchValue({disks:o}),C().forEach(t.clients,a=>{const s=this.addInitiator();a.luns=C().map(a.luns,l=>`${l.pool}/${l.image}`),s.patchValue(a)}),t.groups.forEach((a,s)=>{const l=this.addGroup();a.disks=C().map(a.disks,d=>`${d.pool}/${d.image}`),l.patchValue(a),C().forEach(a.members,d=>{this.onGroupMemberSelection({option:new te.O(!0,d,"")},s)})})}hasAdvancedSettings(t){return Object.values(t).length>0}get portals(){return this.targetForm.get("portals")}onPortalSelection(){this.portals.setValue(this.portals.value)}removePortal(t,n){return this.portalsSelections.forEach(o=>{o.name===n&&(o.selected=!1)}),this.portals.value.splice(t,1),this.portals.setValue(this.portals.value),!1}get disks(){return this.targetForm.get("disks")}removeImage(t,n){return this.imagesSelections.forEach(o=>{o.name===n&&(o.selected=!1)}),this.disks.value.splice(t,1),this.removeImageRefs(n),this.targetForm.get("disks").updateValueAndValidity({emitEvent:!1}),!1}removeImageRefs(t){this.initiators.controls.forEach(n=>{const o=n.value.luns.filter(a=>a!==t);n.get("luns").setValue(o)}),this.groups.controls.forEach(n=>{const o=n.value.disks.filter(a=>a!==t);n.get("disks").setValue(o)}),C().forEach(this.imagesInitiatorSelections,(n,o)=>{this.imagesInitiatorSelections[o]=n.filter(a=>a.name!==t)}),C().forEach(this.groupDiskSelections,(n,o)=>{this.groupDiskSelections[o]=n.filter(a=>a.name!==t)})}getDefaultBackstore(t){let n=this.default_backstore;const o=this.getImageById(t);return this.validFeatures(o,this.default_backstore)||this.backstores.forEach(a=>{a!==this.default_backstore&&this.validFeatures(o,a)&&(n=a)}),n}isLunIdInUse(t,n){const o=this.disks.value.filter(a=>a!==n);return this.getLunIds(o).includes(t)}getLunIds(t){return C().map(t,n=>this.imagesSettings[n].lun)}nextLunId(t){const n=this.disks.value.filter(s=>s!==t),o=this.getLunIds(n);let a=0;for(;o.includes(a);)a++;return a}getWwns(t){return C().map(t,o=>this.imagesSettings[o].wwn).filter(o=>C().isString(o)&&""!==o)}onImageSelection(t){const n=t.option;if(n.selected){if(this.imagesSettings[n.name])this.isLunIdInUse(this.imagesSettings[n.name].lun,n.name)&&(this.imagesSettings[n.name].lun=this.nextLunId(n.name));else{const o=this.getDefaultBackstore(n.name);this.imagesSettings[n.name]={backstore:o,lun:this.nextLunId(n.name)},this.imagesSettings[n.name][o]={}}C().forEach(this.imagesInitiatorSelections,(o,a)=>{o.push(new te.O(!1,n.name,"")),this.imagesInitiatorSelections[a]=[...o]}),C().forEach(this.groupDiskSelections,(o,a)=>{o.push(new te.O(!1,n.name,"")),this.groupDiskSelections[a]=[...o]})}else this.removeImageRefs(n.name);this.targetForm.get("disks").updateValueAndValidity({emitEvent:!1})}get initiators(){return this.targetForm.get("initiators")}addInitiator(){const t=new k.$({client_iqn:new _.UntypedFormControl("",{validators:[_.Validators.required,I.xQ.custom("notUnique",o=>{const a=this.initiators.controls.reduce(function(s,l){return s.concat(l.value.client_iqn)},[]);return a.indexOf(o)!==a.lastIndexOf(o)}),_.Validators.pattern(this.IQN_REGEX)]}),auth:new k.$({user:new _.UntypedFormControl(""),password:new _.UntypedFormControl(""),mutual_user:new _.UntypedFormControl(""),mutual_password:new _.UntypedFormControl("")}),luns:new _.UntypedFormControl([]),cdIsInGroup:new _.UntypedFormControl(!1)});this.setAuthValidator(t),this.initiators.push(t),C().forEach(this.groupMembersSelections,(o,a)=>{o.push(new te.O(!1,"","")),this.groupMembersSelections[a]=[...o]});const n=C().map(this.targetForm.getValue("disks"),o=>new te.O(!1,o,""));return this.imagesInitiatorSelections.push(n),t}setAuthValidator(t){I.xQ.validateIf(t.get("user"),()=>t.getValue("password")||t.getValue("mutual_user")||t.getValue("mutual_password"),[_.Validators.required],[_.Validators.pattern(this.USER_REGEX)],[t.get("password"),t.get("mutual_user"),t.get("mutual_password")]),I.xQ.validateIf(t.get("password"),()=>t.getValue("user")||t.getValue("mutual_user")||t.getValue("mutual_password"),[_.Validators.required],[_.Validators.pattern(this.PASSWORD_REGEX)],[t.get("user"),t.get("mutual_user"),t.get("mutual_password")]),I.xQ.validateIf(t.get("mutual_user"),()=>t.getValue("mutual_password"),[_.Validators.required],[_.Validators.pattern(this.USER_REGEX)],[t.get("user"),t.get("password"),t.get("mutual_password")]),I.xQ.validateIf(t.get("mutual_password"),()=>t.getValue("mutual_user"),[_.Validators.required],[_.Validators.pattern(this.PASSWORD_REGEX)],[t.get("user"),t.get("password"),t.get("mutual_user")])}removeInitiator(t){const n=this.initiators.value[t];this.initiators.removeAt(t),C().forEach(this.groupMembersSelections,(o,a)=>{o.splice(t,1),this.groupMembersSelections[a]=[...o]}),this.groups.controls.forEach(o=>{const a=o.value.members.filter(s=>s!==n.client_iqn);o.get("members").setValue(a)}),this.imagesInitiatorSelections.splice(t,1)}updatedInitiatorSelector(){this.initiators.controls.forEach(t=>{t.get("client_iqn").updateValueAndValidity({emitEvent:!1})}),C().forEach(this.groupMembersSelections,(t,n)=>{C().forEach(t,(o,a)=>{const s=o.name;o.name=this.initiators.controls[a].value.client_iqn,this.groups.controls.forEach(l=>{const d=l.value.members,u=d.indexOf(s);-1!==u&&(d[u]=o.name),l.get("members").setValue(d)})}),this.groupMembersSelections[n]=[...this.groupMembersSelections[n]]})}removeInitiatorImage(t,n,o,a){const s=t.getValue("luns");return s.splice(n,1),t.patchValue({luns:s}),this.imagesInitiatorSelections[o].forEach(l=>{l.name===a&&(l.selected=!1)}),!1}get groups(){return this.targetForm.get("groups")}addGroup(){const t=new k.$({group_id:new _.UntypedFormControl("",{validators:[_.Validators.required]}),members:new _.UntypedFormControl([]),disks:new _.UntypedFormControl([])});this.groups.push(t);const n=C().map(this.targetForm.getValue("disks"),a=>new te.O(!1,a,""));this.groupDiskSelections.push(n);const o=C().map(this.initiators.value,a=>new te.O(!1,a.client_iqn,"",!a.cdIsInGroup));return this.groupMembersSelections.push(o),t}removeGroup(t){this.groups.removeAt(t),this.groupMembersSelections[t].filter(o=>o.selected).forEach(o=>{o.selected=!1,this.onGroupMemberSelection({option:o},t)}),this.groupMembersSelections.splice(t,1),this.groupDiskSelections.splice(t,1)}onGroupMemberSelection(t,n){const o=t.option;let a=[];o.selected||(a=this.groupDiskSelections[n].filter(l=>l.selected).map(l=>l.name)),this.initiators.controls.forEach((s,l)=>{s.value.client_iqn===o.name&&(s.patchValue({luns:a}),s.get("cdIsInGroup").setValue(o.selected),C().forEach(this.groupMembersSelections,d=>{d[l].enabled=!o.selected}),this.imagesInitiatorSelections[l].forEach(d=>{d.selected=a.includes(d.name)}))})}removeGroupInitiator(t,n,o){const a=t.getValue("members")[n];t.getValue("members").splice(n,1),this.onGroupMemberSelection({option:new te.O(!1,a,"")},o)}removeGroupDisk(t,n,o){const a=t.getValue("disks")[n];t.getValue("disks").splice(n,1),this.groupDiskSelections[o].forEach(s=>{s.name===a&&(s.selected=!1)}),this.groupDiskSelections[o]=[...this.groupDiskSelections[o]]}submit(){const t=C().cloneDeep(this.targetForm.value),n={target_iqn:this.targetForm.getValue("target_iqn"),target_controls:this.targetForm.getValue("target_controls"),acl_enabled:this.targetForm.getValue("acl_enabled"),portals:[],disks:[],clients:[],groups:[]};if(this.cephIscsiConfigVersion>10){const a=this.targetForm.get("auth");a.getValue("user")||a.get("user").setValue(""),a.getValue("password")||a.get("password").setValue(""),a.getValue("mutual_user")||a.get("mutual_user").setValue(""),a.getValue("mutual_password")||a.get("mutual_password").setValue("");const s=this.targetForm.getValue("acl_enabled");n.auth={user:s?"":a.getValue("user"),password:s?"":a.getValue("password"),mutual_user:s?"":a.getValue("mutual_user"),mutual_password:s?"":a.getValue("mutual_password")}}let o;t.disks.forEach(a=>{const s=a.split("/"),l=this.imagesSettings[a].backstore;n.disks.push({pool:s[0],image:s[1],backstore:l,controls:this.imagesSettings[a][l],lun:this.imagesSettings[a].lun,wwn:this.imagesSettings[a].wwn})}),t.portals.forEach(a=>{const s=a.indexOf(":");n.portals.push({host:a.substring(0,s),ip:a.substring(s+1)})}),n.acl_enabled&&(t.initiators.forEach(a=>{a.auth.user||(a.auth.user=""),a.auth.password||(a.auth.password=""),a.auth.mutual_user||(a.auth.mutual_user=""),a.auth.mutual_password||(a.auth.mutual_password=""),delete a.cdIsInGroup;const s=[];a.luns.forEach(l=>{const d=l.split("/");s.push({pool:d[0],image:d[1]})}),a.luns=s}),n.clients=t.initiators),n.acl_enabled&&(t.groups.forEach(a=>{const s=[];a.disks.forEach(l=>{const d=l.split("/");s.push({pool:d[0],image:d[1]})}),a.disks=s}),n.groups=t.groups),this.isEdit?(n.new_target_iqn=n.target_iqn,n.target_iqn=this.target_iqn,o=this.taskWrapper.wrapTaskAroundCall({task:new h.O("iscsi/target/edit",{target_iqn:n.target_iqn}),call:this.iscsiService.updateTarget(this.target_iqn,n)})):o=this.taskWrapper.wrapTaskAroundCall({task:new h.O("iscsi/target/create",{target_iqn:n.target_iqn}),call:this.iscsiService.createTarget(n)}),o.subscribe({error:()=>{this.targetForm.setErrors({cdSubmitButton:!0})},complete:()=>this.router.navigate(["/block/iscsi/targets"])})}targetSettingsModal(){const t={target_controls:this.targetForm.get("target_controls"),target_default_controls:this.target_default_controls,target_controls_limits:this.target_controls_limits};this.modalRef=this.modalService.show(Nn,t)}imageSettingsModal(t){const n={imagesSettings:this.imagesSettings,image:t,api_version:this.api_version,disk_default_controls:this.disk_default_controls,disk_controls_limits:this.disk_controls_limits,backstores:this.getValidBackstores(this.getImageById(t)),control:this.targetForm.get("disks")};this.modalRef=this.modalService.show(Rn,n)}validFeatures(t,n){const o=t.features,a=this.required_rbd_features[n];return(o&a)===a&&!(o&this.unsupported_rbd_features[n])}getImageById(t){return this.imagesAll.find(n=>t===`${n.pool_name}/${n.name}`)}getValidBackstores(t){return this.backstores.filter(n=>this.validFeatures(t,n))}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(Q),e.\u0275\u0275directiveInject(K.B),e.\u0275\u0275directiveInject(U.U),e.\u0275\u0275directiveInject(v.Router),e.\u0275\u0275directiveInject(v.ActivatedRoute),e.\u0275\u0275directiveInject(y.a),e.\u0275\u0275directiveInject(O.Ss))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-iscsi-target-form"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:()=>{let t,n,o,a,s,l,d,u,f,M,E,b,D,B,V,oe,ie,ae,H,ge,P,Oe,Re,Ie,Ne,be,Pe,Ae,ve,$,Xe,Ue,je,qe,Qe,L,Vt,Ht,kt,Kt,zt,Xt,Ut,jt,qt,Qt,Yt,Wt,Jt,Zt,en,tn,nn,on,an,rn,sn,ln,_n,cn,dn,mn;return t="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",n="Target IQN",o="Portals",a="Add portal",s="Images",l="Add image",d="ACL authentication",u="This field is required.",f="IQN has wrong pattern.",M="An IQN has the following notation 'iqn.$year-$month.$reversedAddress:$definedName'",E="For example: iqn.2016-06.org.dashboard:storage:disk.sn-a8675309",b="More information",D="This target has modified advanced settings.",B="At least " + "\ufffd0\ufffd" + " gateways are required.",V="Backstore: " + "\ufffd0\ufffd" + ".\xA0",oe="This image has modified settings.",ie="Duplicated LUN numbers.",ae="Duplicated WWN.",H="User",ge="Password",P="Mutual User",Oe="Mutual Password",Re="This field is required.",Ie="User names must have a length of 8 to 64 characters and can contain alphanumeric characters, '.', '@', '-', '_' or ':'.",Ne="This field is required.",be="Passwords must have a length of 12 to 16 characters and can contain alphanumeric characters, '@', '-', '_' or '/'.",Pe="This field is required.",Ae="User names must have a length of 8 to 64 characters and can contain alphanumeric characters, '.', '@', '-', '_' or ':'.",ve="This field is required.",$="Passwords must have a length of 12 to 16 characters and can contain alphanumeric characters, '@', '-', '_' or '/'.",Xe="Initiators",Ue="Add initiator",je="Initiator",qe="Client IQN",Qe="User",L="Password",Vt="Mutual User",Ht="Mutual Password",kt="Images",Kt="Initiator IQN needs to be unique.",zt="This field is required.",Xt="IQN has wrong pattern.",Ut="This field is required.",jt="User names must have a length of 8 to 64 characters and can contain alphanumeric characters, '.', '@', '-', '_' or ':'.",qt="This field is required.",Qt="Passwords must have a length of 12 to 16 characters and can contain alphanumeric characters, '@', '-', '_' or '/'.",Yt="This field is required.",Wt="User names must have a length of 8 to 64 characters and can contain alphanumeric characters, '.', '@', '-', '_' or ':'.",Jt="This field is required.",Zt="Passwords must have a length of 12 to 16 characters and can contain alphanumeric characters, '@', '-', '_' or '/'.",en="Initiator belongs to a group. Images will be configure in the group.",tn="Add image",nn="No items added.",on="Groups",an="Add group",rn="Group",sn="Name",ln="Initiators",_n="Add initiator",cn="Images",dn="Add image",mn="No items added.",[["formDir","ngForm"],t,n,o,a,s,l,d,u,f,M,E,b,D,B,V,oe,ie,ae,H,ge,P,Oe,Re,Ie,Ne,be,Pe,Ae,ve,$,Xe,Ue,je,qe,Qe,L,Vt,Ht,kt,Kt,zt,Xt,Ut,jt,qt,Qt,Yt,Wt,Jt,Zt,en,tn,nn,on,an,rn,sn,ln,_n,cn,dn,mn,["class","cd-col-form",4,"cdFormLoading"],[1,"cd-col-form"],["name","targetForm","novalidate","",3,"formGroup"],[1,"card"],[1,"card-header"],[1,"card-body"],[1,"form-group","row"],["for","target_iqn",1,"cd-col-form-label","required"],[1,"cd-col-form-input"],[1,"input-group"],["type","text","id","target_iqn","name","target_iqn","formControlName","target_iqn","cdTrim","",1,"form-control"],["id","ecp-info-button","type","button",1,"btn","btn-light",3,"click"],[3,"cdsIcon","size"],["class","invalid-feedback",4,"ngIf"],["class","form-text text-muted",4,"ngIf"],["for","portals",1,"cd-col-form-label","required"],[4,"ngFor","ngForOf"],[1,"row"],[1,"col-md-12"],["elemClass","btn btn-light float-end",3,"selection","data","options","messages"],["type","hidden","id","portals","name","portals","formControlName","portals",1,"form-control"],["for","disks",1,"cd-col-form-label"],["type","hidden","id","disks","name","disks","formControlName","disks",1,"form-control"],[1,"cd-col-form-offset"],[1,"custom-control","custom-checkbox"],["type","checkbox","formControlName","acl_enabled","name","acl_enabled","id","acl_enabled",1,"custom-control-input"],["for","acl_enabled",1,"custom-control-label"],["formGroupName","auth",4,"ngIf"],["class","form-group row",4,"ngIf"],[1,"card-footer"],["wrappingClass","text-right",3,"submitActionEvent","form","submitText"],[1,"invalid-feedback"],["target","_blank","href","https://en.wikipedia.org/wiki/ISCSI#Addressing"],[1,"form-text","text-muted"],[1,"input-group","cd-mb"],["type","text","disabled","",1,"cd-form-control",3,"value"],["type","button",1,"btn","btn-light",3,"click"],["class","input-group-text",4,"ngIf"],[4,"ngIf"],[1,"input-group-text"],["formGroupName","auth"],["for","target_user",1,"cd-col-form-label"],["type","text","autocomplete","off","id","target_user","name","target_user","formControlName","user",1,"form-control"],["for","target_password",1,"cd-col-form-label"],["type","password","autocomplete","new-password","id","target_password","name","target_password","formControlName","password",1,"form-control"],["type","button","cdPasswordButton","target_password",1,"btn","btn-light"],["source","target_password"],["for","target_mutual_user",1,"cd-col-form-label"],["type","text","autocomplete","off","id","target_mutual_user","name","target_mutual_user","formControlName","mutual_user",1,"form-control"],["for","target_mutual_password",1,"cd-col-form-label"],["type","password","autocomplete","new-password","id","target_mutual_password","name","target_mutual_password","formControlName","mutual_password",1,"form-control"],["type","button","cdPasswordButton","target_mutual_password",1,"btn","btn-light"],["source","target_mutual_password"],["for","initiators",1,"cd-col-form-label"],["formArrayName","initiators",1,"cd-col-form-input"],["class","card mb-2",3,"formGroup",4,"ngFor","ngForOf"],[1,"btn","btn-light","float-end",3,"click"],[1,"card","mb-2",3,"formGroup"],["type","button",1,"btn-close","float-end",3,"click"],["for","client_iqn",1,"cd-col-form-label","required"],["type","text","formControlName","client_iqn","cdTrim","",1,"form-control",3,"blur"],["for","user",1,"cd-col-form-label"],["formControlName","user","autocomplete","off","type","text",1,"form-control",3,"id"],["for","password",1,"cd-col-form-label"],["formControlName","password","autocomplete","new-password","type","password",1,"form-control",3,"id"],["type","button",1,"btn","btn-light",3,"cdPasswordButton"],[3,"source"],["for","mutual_user",1,"cd-col-form-label"],["formControlName","mutual_user","autocomplete","off","type","text",1,"form-control",3,"id"],["for","mutual_password",1,"cd-col-form-label"],["formControlName","mutual_password","autocomplete","new-password","type","password",1,"form-control",3,"id"],["for","luns",1,"cd-col-form-label"],["class","row",4,"ngIf"],["elemClass","btn btn-light float-end",3,"data","options","messages"],["formArrayName","groups",1,"cd-col-form-input"],["for","group_id",1,"cd-col-form-label","required"],["type","text","formControlName","group_id",1,"form-control"],["for","members",1,"cd-col-form-label"]]},template:function(n,o){1&n&&e.\u0275\u0275template(0,To,65,37,"div",63),2&n&&e.\u0275\u0275property("cdFormLoading",o.loading)},dependencies:[c.NgForOf,c.NgIf,_.\u0275NgNoValidate,_.DefaultValueAccessor,_.CheckboxControlValueAccessor,_.NgControlStatus,_.NgControlStatusGroup,_.FormGroupDirective,_.FormControlName,_.FormGroupName,_.FormArrayName,bn.w,We.N,F.e,Ft.h,Pn.c,Mt.G,x.S,g.a,S.C,N.E,m.IconDirective,c.TitleCasePipe,Ye.k,Le.r],styles:[".cd-mb[_ngcontent-%COMP%]{margin-bottom:10px}"]})}}return i})();var rt=p(25947),le=p(84821),Y=p(62847),xe=p(2148),_e=p(19380),Fo=p(47782),Ot=p(91653),j=p(82254),Se=p(58510),st=p(88285),He=p(88701);function Mo(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,6),e.\u0275\u0275elementEnd())}function ho(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,7),e.\u0275\u0275elementEnd())}function Oo(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd())}function Ro(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,9),e.\u0275\u0275elementEnd())}function Io(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,10),e.\u0275\u0275elementEnd())}function No(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,11),e.\u0275\u0275elementEnd())}function bo(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,12),e.\u0275\u0275elementEnd())}function Po(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,13),e.\u0275\u0275elementEnd())}let Ao=(()=>{class i{constructor(t,n,o,a,s){this.authStorageService=t,this.activeModal=n,this.actionLabels=o,this.iscsiService=a,this.notificationService=s,this.USER_REGEX=/^[\w\.:@_-]{8,64}$/,this.PASSWORD_REGEX=/^[\w@\-_\/]{12,16}$/,this.permission=this.authStorageService.getPermissions().iscsi}ngOnInit(){this.hasPermission=this.permission.update,this.createForm(),this.iscsiService.getDiscovery().subscribe(t=>{this.discoveryForm.patchValue(t)})}createForm(){this.discoveryForm=new k.$({user:new _.UntypedFormControl({value:"",disabled:!this.hasPermission}),password:new _.UntypedFormControl({value:"",disabled:!this.hasPermission}),mutual_user:new _.UntypedFormControl({value:"",disabled:!this.hasPermission}),mutual_password:new _.UntypedFormControl({value:"",disabled:!this.hasPermission})}),I.xQ.validateIf(this.discoveryForm.get("user"),()=>this.discoveryForm.getValue("password")||this.discoveryForm.getValue("mutual_user")||this.discoveryForm.getValue("mutual_password"),[_.Validators.required],[_.Validators.pattern(this.USER_REGEX)],[this.discoveryForm.get("password"),this.discoveryForm.get("mutual_user"),this.discoveryForm.get("mutual_password")]),I.xQ.validateIf(this.discoveryForm.get("password"),()=>this.discoveryForm.getValue("user")||this.discoveryForm.getValue("mutual_user")||this.discoveryForm.getValue("mutual_password"),[_.Validators.required],[_.Validators.pattern(this.PASSWORD_REGEX)],[this.discoveryForm.get("user"),this.discoveryForm.get("mutual_user"),this.discoveryForm.get("mutual_password")]),I.xQ.validateIf(this.discoveryForm.get("mutual_user"),()=>this.discoveryForm.getValue("mutual_password"),[_.Validators.required],[_.Validators.pattern(this.USER_REGEX)],[this.discoveryForm.get("user"),this.discoveryForm.get("password"),this.discoveryForm.get("mutual_password")]),I.xQ.validateIf(this.discoveryForm.get("mutual_password"),()=>this.discoveryForm.getValue("mutual_user"),[_.Validators.required],[_.Validators.pattern(this.PASSWORD_REGEX)],[this.discoveryForm.get("user"),this.discoveryForm.get("password"),this.discoveryForm.get("mutual_user")])}submitAction(){this.iscsiService.updateDiscovery(this.discoveryForm.value).subscribe(()=>{this.notificationService.show(st._.success,"Updated discovery authentication"),this.activeModal.close()},()=>{this.discoveryForm.setErrors({cdSubmitButton:!0})})}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(j.v),e.\u0275\u0275directiveInject(A.NgbActiveModal),e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(Q),e.\u0275\u0275directiveInject(He.J))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-iscsi-target-discovery-modal"]],decls:44,vars:13,consts:()=>{let t,n,o,a,s,l,d,u,f,M,E,b,D;return t="Discovery Authentication",n="User",o="Password",a="Mutual User",s="Mutual Password",l="This field is required.",d="User names must have a length of 8 to 64 characters and can contain alphanumeric characters, '.', '@', '-', '_' or ':'.",u="This field is required.",f="Passwords must have a length of 12 to 16 characters and can contain alphanumeric characters, '@', '-', '_' or '/'.",M="This field is required.",E="User names must have a length of 8 to 64 characters and can contain alphanumeric characters, '.', '@', '-', '_' or ':'.",b="This field is required.",D="Passwords must have a length of 12 to 16 characters and can contain alphanumeric characters, '@', '-', '_' or '/'.",[["formDir","ngForm"],t,n,o,a,s,l,d,u,f,M,E,b,D,[3,"modalRef"],[1,"modal-title"],[1,"modal-content"],["name","discoveryForm","novalidate","",3,"formGroup"],[1,"modal-body"],[1,"form-group","row"],["for","user",1,"cd-col-form-label"],[1,"cd-col-form-input"],["id","user","formControlName","user","type","text","autocomplete","off",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","password",1,"cd-col-form-label"],[1,"input-group"],["id","password","formControlName","password","type","password","autocomplete","new-password",1,"form-control"],["type","button","cdPasswordButton","password",1,"btn","btn-light"],["source","password"],["for","mutual_user",1,"cd-col-form-label"],["id","mutual_user","formControlName","mutual_user","type","text","autocomplete","off",1,"form-control"],["for","mutual_password",1,"cd-col-form-label"],["id","mutual_password","formControlName","mutual_password","type","password","autocomplete","new-password",1,"form-control"],["type","button","cdPasswordButton","mutual_password",1,"btn","btn-light"],["source","mutual_password"],[1,"modal-footer"],[3,"submitActionEvent","form","showSubmit","submitText"],[1,"invalid-feedback"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-modal",14),e.\u0275\u0275elementContainerStart(1,15),e.\u0275\u0275i18n(2,1),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(3,16),e.\u0275\u0275elementStart(4,"form",17,0)(6,"div",18)(7,"div",19)(8,"label",20),e.\u0275\u0275i18n(9,2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"div",21),e.\u0275\u0275element(11,"input",22),e.\u0275\u0275template(12,Mo,2,0,"span",23)(13,ho,2,0,"span",23),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(14,"div",19)(15,"label",24),e.\u0275\u0275i18n(16,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"div",21)(18,"div",25),e.\u0275\u0275element(19,"input",26)(20,"button",27)(21,"cd-copy-2-clipboard-button",28),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(22,Oo,2,0,"span",23)(23,Ro,2,0,"span",23),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(24,"div",19)(25,"label",29),e.\u0275\u0275elementContainerStart(26),e.\u0275\u0275i18n(27,4),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(28,"div",21),e.\u0275\u0275element(29,"input",30),e.\u0275\u0275template(30,Io,2,0,"span",23)(31,No,2,0,"span",23),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(32,"div",19)(33,"label",31),e.\u0275\u0275i18n(34,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(35,"div",21)(36,"div",25),e.\u0275\u0275element(37,"input",32)(38,"button",33)(39,"cd-copy-2-clipboard-button",34),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(40,bo,2,0,"span",23)(41,Po,2,0,"span",23),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(42,"div",35)(43,"cd-form-button-panel",36),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.submitAction())}),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()}if(2&n){const a=e.\u0275\u0275reference(5);e.\u0275\u0275property("modalRef",o.activeModal),e.\u0275\u0275advance(4),e.\u0275\u0275property("formGroup",o.discoveryForm),e.\u0275\u0275advance(8),e.\u0275\u0275property("ngIf",o.discoveryForm.showError("user",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.discoveryForm.showError("user",a,"pattern")),e.\u0275\u0275advance(9),e.\u0275\u0275property("ngIf",o.discoveryForm.showError("password",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.discoveryForm.showError("password",a,"pattern")),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",o.discoveryForm.showError("mutual_user",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.discoveryForm.showError("mutual_user",a,"pattern")),e.\u0275\u0275advance(9),e.\u0275\u0275property("ngIf",o.discoveryForm.showError("mutual_password",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.discoveryForm.showError("mutual_password",a,"pattern")),e.\u0275\u0275advance(2),e.\u0275\u0275property("form",o.discoveryForm)("showSubmit",o.hasPermission)("submitText",o.actionLabels.SUBMIT)}},dependencies:[c.NgIf,_.\u0275NgNoValidate,_.DefaultValueAccessor,_.NgControlStatus,_.NgControlStatusGroup,_.FormGroupDirective,_.FormControlName,q.z,We.N,F.e,Ft.h,x.S,g.a,S.C,N.E]})}}return i})();var ce=p(94254),we=p(92805),vo=p(87837),de=p(32295),lt=p(45843);let Rt=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-iscsi-tabs"]],decls:7,vars:0,consts:()=>{let t,n;return t="Overview",n="Targets",[t,n,[1,"nav","nav-tabs"],[1,"nav-item"],["routerLink","/block/iscsi/overview","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link"],["routerLink","/block/iscsi/targets","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link"]]},template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"ul",2)(1,"li",3)(2,"a",4),e.\u0275\u0275i18n(3,0),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"li",3)(5,"a",5),e.\u0275\u0275i18n(6,1),e.\u0275\u0275elementEnd()()())},dependencies:[v.RouterLink,v.RouterLinkActive]})}}return i})();var Do=p(91822),Lo=p(30540);const yo=["highlightTpl"],$o=["detailTable"],Bo=["treeNodeTemplate"],Go=()=>["logged_in"],xo=()=>["logged_out"],wo=(i,r)=>({"badge-success":i,"badge-danger":r});function Vo(i,r){if(1&i&&(e.\u0275\u0275text(0),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(1,"svg",9),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementStart(2,"span"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(4," \xa0 "),e.\u0275\u0275elementStart(5,"span",10),e.\u0275\u0275text(6),e.\u0275\u0275elementEnd()),2&i){const t=r.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275textInterpolate1(" ",null==t||null==t.data?null:t.data.cdIcon," "),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",null==t||null==t.data?null:t.data.cdIcon)("size",n.icons.size16),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(null==t?null:t.name),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction2(8,wo,e.\u0275\u0275pureFunction0(6,Go).includes(null==t?null:t.status),e.\u0275\u0275pureFunction0(7,xo).includes(null==t?null:t.status))),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",null==t?null:t.status," ")}}function Ho(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"div",11)(1,"legend"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"cd-table",12,3),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.title),e.\u0275\u0275advance(),e.\u0275\u0275property("data",t.data)("columns",t.columns)("limit",0)}}function ko(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t)}}function Ko(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"strong"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t)}}function zo(i,r){if(1&i&&e.\u0275\u0275template(0,ko,2,1,"span",13)(1,Ko,2,1,"strong",13),2&i){const t=r.data.row;e.\u0275\u0275property("ngIf",void 0===t.default||t.default===t.current),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",void 0!==t.default&&t.default!==t.current)}}let Xo=(()=>{class i{set content(t){this.detailTable=t,t&&t.updateColumns()}constructor(t,n,o){this.iscsiBackstorePipe=t,this.booleanTextPipe=n,this.treeViewService=o,this.icons=T.FI,this.metadata={},this.nodes=[]}ngOnInit(){this.columns=[{prop:"displayName",name:"Name",flexGrow:1,cellTemplate:this.highlightTpl},{prop:"current",name:"Current",flexGrow:1,cellTemplate:this.highlightTpl},{prop:"default",name:"Default",flexGrow:1,cellTemplate:this.highlightTpl}]}ngOnChanges(){this.selection&&(this.selectedItem=this.selection,this.generateTree()),this.data=void 0}generateTree(){const t=C().cloneDeep(this.selectedItem.target_controls);this.cephIscsiConfigVersion>10&&C().extend(t,C().cloneDeep(this.selectedItem.auth)),this.metadata={root:t};const n={target:{expanded:C().join(this.selectedItem.cdExecuting?[T.FI.large,T.FI.spinner,T.FI.spin]:[T.FI.large,T.FI.bullseye]," ")},initiators:{expanded:C().join([T.FI.large,T.FI.user]," "),leaf:C().join([T.FI.user]," ")},groups:{expanded:C().join([T.FI.large,T.FI.users]," "),leaf:C().join([T.FI.users]," ")},disks:{expanded:C().join([T.FI.large,T.FI.disk]," "),leaf:C().join([T.FI.disk]," ")},portals:{expanded:C().join([T.FI.large,T.FI.server]," "),leaf:C().join([T.FI.server]," ")}},o=[];C().forEach(this.selectedItem.disks,d=>{const u="disk_"+d.pool+"_"+d.image;this.metadata[u]={controls:d.controls,backstore:d.backstore},["wwn","lun"].forEach(f=>{f in d&&(this.metadata[u][f]=d[f])}),o.push({id:u,name:`${d.pool}/${d.image}`,label:`${d.pool}/${d.image}`,value:{cdIcon:n.disks.leaf}})});const a=[];C().forEach(this.selectedItem.portals,d=>{a.push({label:this.labelTpl,labelContext:{name:`${d.host}:${d.ip}`,cdIcon:n.portals.leaf},value:{name:`${d.host}:${d.ip}`,cdIcon:n.portals.leaf}})});const s=[];C().forEach(this.selectedItem.clients,d=>{const u=C().cloneDeep(d.auth);d.info&&(C().extend(u,d.info),delete u.state,C().forEach(Object.keys(d.info.state),E=>{u[E.toLowerCase()]=d.info.state[E]})),this.metadata["client_"+d.client_iqn]=u;const f=[];d.luns.forEach(E=>{f.push({label:this.labelTpl,labelContext:{name:`${E.pool}/${E.image}`,cdIcon:n.disks.leaf},value:{name:`${E.pool}/${E.image}`,cdIcon:n.disks.leaf},id:"disk_"+E.pool+"_"+E.image})});let M="";d.info&&(M=Object.keys(d.info.state).includes("LOGGED_IN")?"logged_in":"logged_out"),s.push({label:this.labelTpl,labelContext:{name:d.client_iqn,status:M,cdIcon:n.initiators.leaf},value:{name:d.client_iqn,status:M,cdIcon:n.initiators.leaf},id:"client_"+d.client_iqn,children:f})});const l=[];C().forEach(this.selectedItem.groups,d=>{const u=[];d.disks.forEach(M=>{u.push({label:this.labelTpl,labelContext:{name:`${M.pool}/${M.image}`,cdIcon:n.disks.leaf},value:{name:`${M.pool}/${M.image}`,cdIcon:n.disks.leaf},id:"disk_"+M.pool+"_"+M.image})});const f=[];d.members.forEach(M=>{f.push({label:this.labelTpl,labelContext:{name:M},value:{name:M},id:"client_"+M})}),l.push({label:this.labelTpl,labelContext:{name:d.group_id,cdIcon:n.groups.leaf},value:{name:d.group_id,cdIcon:n.groups.leaf},children:[{label:this.labelTpl,labelContext:{name:"Disks",cdIcon:n.disks.expanded},value:{name:"Disks",cdIcon:n.disks.expanded},children:u},{label:this.labelTpl,labelContext:{name:"Initiators",cdIcon:n.initiators.expanded},value:{name:"Initiators",cdIcon:n.initiators.expanded},children:f}]})}),this.nodes=[{id:"root",label:this.labelTpl,labelContext:{name:this.selectedItem.target_iqn,cdIcon:n.target.expanded},value:{name:this.selectedItem.target_iqn,cdIcon:n.target.expanded},expanded:!0,children:[{label:this.labelTpl,labelContext:{name:"Disks",cdIcon:n.disks.expanded},value:{name:"Disks",cdIcon:n.disks.expanded},expanded:!0,children:o},{label:this.labelTpl,labelContext:{name:"Portals",cdIcon:n.portals.expanded},value:{name:"Portals",cdIcon:n.portals.expanded},expanded:!0,children:a},{label:this.labelTpl,labelContext:{name:"Initiators",cdIcon:n.initiators.expanded},value:{name:"Initiators",cdIcon:n.initiators.expanded},expanded:!0,children:s},{label:this.labelTpl,labelContext:{name:"Groups",cdIcon:n.groups.expanded},value:{name:"Groups",cdIcon:n.groups.expanded},expanded:!0,children:l}]}]}format(t){return"boolean"==typeof t?this.booleanTextPipe.transform(t):t}onNodeSelected(t){if(t.id){this.title=t?.value?.name;const n=this.metadata[t.id]||{};"root"===t.id?(this.detailTable?.toggleColumn({prop:"default",isHidden:!0}),this.data=C().map(this.settings.target_default_controls,(o,a)=>({displayName:a,default:o=this.format(o),current:C().isUndefined(n[a])?o:this.format(n[a])})),this.cephIscsiConfigVersion>10&&["user","password","mutual_user","mutual_password"].forEach(o=>{this.data.push({displayName:o,default:null,current:n[o]})})):t.id.toString().startsWith("disk_")?(this.detailTable?.toggleColumn({prop:"default",isHidden:!0}),this.data=C().map(this.settings.disk_default_controls[n.backstore],(o,a)=>({displayName:a,default:o=this.format(o),current:C().isUndefined(n.controls[a])?o:this.format(n.controls[a])})),this.data.push({displayName:"backstore",default:this.iscsiBackstorePipe.transform(this.settings.default_backstore),current:this.iscsiBackstorePipe.transform(n.backstore)}),["wwn","lun"].forEach(o=>{o in n&&this.data.push({displayName:o,default:void 0,current:n[o]})})):(this.detailTable?.toggleColumn({prop:"default",isHidden:!1}),this.data=C().map(n,(o,a)=>({displayName:a,default:void 0,current:this.format(o)})))}else this.data=void 0;this.detailTable?.updateColumns()}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(Ye.k),e.\u0275\u0275directiveInject(Do.s),e.\u0275\u0275directiveInject(Lo.X))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-iscsi-target-details"]],viewQuery:function(n,o){if(1&n&&(e.\u0275\u0275viewQuery(yo,7),e.\u0275\u0275viewQuery($o,5),e.\u0275\u0275viewQuery(Bo,7)),2&n){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.highlightTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.content=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.labelTpl=a.first)}},inputs:{selection:"selection",settings:"settings",cephIscsiConfigVersion:"cephIscsiConfigVersion"},features:[e.\u0275\u0275NgOnChangesFeature],decls:11,vars:2,consts:()=>{let t;return t="iSCSI Topology",[["tree",""],["treeNodeTemplate",""],["highlightTpl",""],["detailTable",""],t,[1,"row"],[1,"col-6","card-tree"],[3,"select","tree"],["class","col-6 metadata",4,"ngIf"],[3,"cdsIcon","size"],[1,"badge",3,"ngClass"],[1,"col-6","metadata"],["columnMode","flex",3,"data","columns","limit"],[4,"ngIf"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",5)(1,"div",6)(2,"legend"),e.\u0275\u0275i18n(3,4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"cds-tree-view",7,0),e.\u0275\u0275listener("select",function(l){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onNodeSelected(l))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(6,Vo,7,11,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,Ho,5,4,"div",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,zo,2,2,"ng-template",null,2,e.\u0275\u0275templateRefExtractor)}2&n&&(e.\u0275\u0275advance(4),e.\u0275\u0275property("tree",o.nodes),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",o.data))},dependencies:[c.NgClass,c.NgIf,Y.O,m.TreeViewComponent,m.IconDirective],styles:[".card-tree[_ngcontent-%COMP%]{height:50vh;overflow-y:auto}"]})}}return i})();function Uo(i,r){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"br"),e.\u0275\u0275elementStart(2,"span"),e.\u0275\u0275i18n(3,2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"pre"),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(t.status)}}function jo(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"cd-alert-panel",6),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18nStart(2,1),e.\u0275\u0275element(3,"cd-doc",7),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275template(4,Uo,6,1,"ng-container",8),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",t.status)}}function qo(i,r){if(1&i&&e.\u0275\u0275element(0,"cd-iscsi-target-details",15),2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("cephIscsiConfigVersion",t.cephIscsiConfigVersion)("selection",t.expandedRow)("settings",t.settings)}}function Qo(i,r){1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,qo,1,3,"cd-iscsi-target-details",14),e.\u0275\u0275elementContainerEnd())}function Yo(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-table",9,0),e.\u0275\u0275listener("fetchData",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.getTargets())})("setExpandedRow",function(o){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.setExpandedRow(o))})("updateSelection",function(o){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.updateSelection(o))}),e.\u0275\u0275elementStart(2,"div",10),e.\u0275\u0275element(3,"cd-table-actions",11),e.\u0275\u0275elementStart(4,"button",12),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.configureDiscoveryAuth())}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(5,"svg",13),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementContainerStart(6),e.\u0275\u0275i18n(7,3),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(8,Qo,2,0,"ng-container",8),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("data",t.targets)("columns",t.columns)("hasDetails",!0)("autoReload",!1)("status",t.tableStatus),e.\u0275\u0275advance(3),e.\u0275\u0275property("permission",t.permission)("selection",t.selection)("tableActions",t.tableActions),e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",t.icons.key)("size",t.icons.size16),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",t.expandedRow)}}let Wo=(()=>{class i extends rt.D{constructor(t,n,o,a,s,l,d,u,f){super(f),this.authStorageService=t,this.iscsiService=n,this.joinPipe=o,this.taskListService=a,this.notAvailablePipe=s,this.modalService=l,this.taskWrapper=d,this.actionLabels=u,this.ngZone=f,this.available=void 0,this.selection=new _e.y,this.targets=[],this.icons=T.FI,this.builders={"iscsi/target/create":M=>({target_iqn:M.target_iqn})},this.permission=this.authStorageService.getPermissions().iscsi,this.tableActions=[{permission:"create",icon:T.FI.add,routerLink:()=>"/block/iscsi/targets/create",name:this.actionLabels.CREATE},{permission:"update",icon:T.FI.edit,routerLink:()=>`/block/iscsi/targets/edit/${this.selection.first().target_iqn}`,name:this.actionLabels.EDIT,disable:()=>this.getEditDisableDesc()},{permission:"delete",icon:T.FI.destroy,click:()=>this.deleteIscsiTargetModal(),name:this.actionLabels.DELETE,disable:()=>this.getDeleteDisableDesc()}]}ngOnInit(){this.columns=[{name:"Target",prop:"target_iqn",flexGrow:2,cellTransformation:xe.x.executing},{name:"Portals",prop:"cdPortals",pipe:this.joinPipe,flexGrow:2},{name:"Images",prop:"cdImages",pipe:this.joinPipe,flexGrow:2},{name:"# Sessions",prop:"info.num_sessions",pipe:this.notAvailablePipe,flexGrow:1}],this.iscsiService.status().subscribe(t=>{this.available=t.available,t.available||(this.status=t.message)})}getTargets(){this.available&&(this.setTableRefreshTimeout(),this.iscsiService.version().subscribe(t=>{this.cephIscsiConfigVersion=t.ceph_iscsi_config_version}),this.taskListService.init(()=>this.iscsiService.listTargets(),t=>this.prepareResponse(t),t=>this.targets=t,()=>this.onFetchError(),this.taskFilter,this.itemFilter,this.builders),this.iscsiService.settings().subscribe(t=>{this.settings=t}))}ngOnDestroy(){this.summaryDataSubscription&&this.summaryDataSubscription.unsubscribe()}getEditDisableDesc(){const t=this.selection.first();return t&&t?.cdExecuting?t.cdExecuting:t&&C().isUndefined(t?.info)?"Unavailable gateway(s)":!t}getDeleteDisableDesc(){const t=this.selection.first();return t?.cdExecuting?t.cdExecuting:t&&C().isUndefined(t?.info)?"Unavailable gateway(s)":t&&t?.info?.num_sessions?"Target has active sessions":!t}prepareResponse(t){return t.forEach(n=>{n.cdPortals=n.portals.map(o=>`${o.host}:${o.ip}`),n.cdImages=n.disks.map(o=>`${o.pool}/${o.image}`)}),t}onFetchError(){this.table.reset()}itemFilter(t,n){return t.target_iqn===n.metadata.target_iqn}taskFilter(t){return["iscsi/target/create","iscsi/target/edit","iscsi/target/delete"].includes(t.name)}updateSelection(t){this.selection=t}deleteIscsiTargetModal(){const t=this.selection.first().target_iqn;this.modalRef=this.modalService.show(le.D,{itemDescription:"iSCSI target",itemNames:[t],submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new h.O("iscsi/target/delete",{target_iqn:t}),call:this.iscsiService.deleteTarget(t)})})}configureDiscoveryAuth(){this.modalService.show(Ao)}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(j.v),e.\u0275\u0275directiveInject(Q),e.\u0275\u0275directiveInject(Fo.r),e.\u0275\u0275directiveInject(Se.D),e.\u0275\u0275directiveInject(Ot.z),e.\u0275\u0275directiveInject(ce.V),e.\u0275\u0275directiveInject(y.a),e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(e.NgZone))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-iscsi-target-list"]],viewQuery:function(n,o){if(1&n&&e.\u0275\u0275viewQuery(Y.O,5),2&n){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.table=a.first)}},features:[e.\u0275\u0275ProvidersFeature([Se.D]),e.\u0275\u0275InheritDefinitionFeature],decls:3,vars:2,consts:()=>{let t,n,o,a;return t="iSCSI Targets not available",n="Please consult the\xA0" + "\ufffd#3\ufffd" + "" + "\ufffd/#3\ufffd" + "\xA0on how to configure and enable the iSCSI Targets management functionality.",o="Available information:",a="Discovery authentication",[["table",""],n,o,a,["type","info","title",t,4,"ngIf"],["columnMode","flex","identifier","target_iqn","forceIdentifier","true","selectionType","single",3,"data","columns","hasDetails","autoReload","status","fetchData","setExpandedRow","updateSelection",4,"ngIf"],["type","info","title",t],["section","iscsi"],[4,"ngIf"],["columnMode","flex","identifier","target_iqn","forceIdentifier","true","selectionType","single",3,"fetchData","setExpandedRow","updateSelection","data","columns","hasDetails","autoReload","status"],[1,"table-actions"],[1,"btn-group",3,"permission","selection","tableActions"],["type","button",1,"btn","btn-light",3,"click"],[3,"cdsIcon","size"],[3,"cephIscsiConfigVersion","selection","settings",4,"cdTableDetail"],[3,"cephIscsiConfigVersion","selection","settings"]]},template:function(n,o){1&n&&(e.\u0275\u0275element(0,"cd-iscsi-tabs"),e.\u0275\u0275template(1,jo,5,1,"cd-alert-panel",4)(2,Yo,9,11,"cd-table",5)),2&n&&(e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!1===o.available),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!0===o.available))},dependencies:[c.NgIf,we.m,vo.C,Y.O,de.j,lt.N,x.S,m.IconDirective,Rt,Xo]})}}return i})();var _t=p(18457),Jo=p(5661),Zo=p(39113);const ei=["iscsiSparklineTpl"],ti=["iscsiPerSecondTpl"],ni=["iscsiRelativeDateTpl"];function oi(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"cd-sparkline",9),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(),n=t.data.row,o=t.data.value;e.\u0275\u0275advance(),e.\u0275\u0275property("data",o)("isBinary",n.cdIsBinary)}}function ii(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",10),e.\u0275\u0275text(1," n/a "),e.\u0275\u0275elementEnd())}function ai(i,r){if(1&i&&e.\u0275\u0275template(0,oi,2,2,"span",7)(1,ii,2,0,"span",8),2&i){const t=r.data.row;e.\u0275\u0275property("ngIf","user:rbd"===t.backstore),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","user:rbd"!==t.backstore)}}function ri(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t," /s ")}}function si(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",10),e.\u0275\u0275text(1," n/a "),e.\u0275\u0275elementEnd())}function li(i,r){if(1&i&&e.\u0275\u0275template(0,ri,2,1,"span",7)(1,si,2,0,"span",8),2&i){const t=r.data.row;e.\u0275\u0275property("ngIf","user:rbd"===t.backstore),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","user:rbd"!==t.backstore)}}function _i(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"relativeDate"),e.\u0275\u0275pipe(3,"notAvailable"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,3,e.\u0275\u0275pipeBind1(2,1,t))," ")}}function ci(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",10),e.\u0275\u0275text(1," n/a "),e.\u0275\u0275elementEnd())}function di(i,r){if(1&i&&e.\u0275\u0275template(0,_i,4,5,"span",7)(1,ci,2,0,"span",8),2&i){const t=r.data.row;e.\u0275\u0275property("ngIf","user:rbd"===t.backstore),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","user:rbd"!==t.backstore)}}let mi=(()=>{class i{constructor(t,n,o){this.iscsiService=t,this.dimlessPipe=n,this.iscsiBackstorePipe=o,this.gateways=[],this.images=[]}ngOnInit(){this.gatewaysColumns=[{name:"Name",prop:"name"},{name:"State",prop:"state",flexGrow:1,cellTransformation:xe.x.badge,customTemplateConfig:{map:{up:{class:"badge-success"},down:{class:"badge-danger"}}}},{name:"# Targets",prop:"num_targets"},{name:"# Sessions",prop:"num_sessions"}],this.imagesColumns=[{name:"Pool",prop:"pool"},{name:"Image",prop:"image"},{name:"Backstore",prop:"backstore",pipe:this.iscsiBackstorePipe},{name:"Read Bytes",prop:"stats_history.rd_bytes",cellTemplate:this.iscsiSparklineTpl},{name:"Write Bytes",prop:"stats_history.wr_bytes",cellTemplate:this.iscsiSparklineTpl},{name:"Read Ops",prop:"stats.rd",pipe:this.dimlessPipe,cellTemplate:this.iscsiPerSecondTpl},{name:"Write Ops",prop:"stats.wr",pipe:this.dimlessPipe,cellTemplate:this.iscsiPerSecondTpl},{name:"A/O Since",prop:"optimized_since",cellTemplate:this.iscsiRelativeDateTpl}]}refresh(){this.iscsiService.overview().subscribe(t=>{this.gateways=t.gateways,this.images=t.images,this.images.map(n=>(n.stats_history&&(n.stats_history.rd_bytes=n.stats_history.rd_bytes.map(o=>o[1]),n.stats_history.wr_bytes=n.stats_history.wr_bytes.map(o=>o[1])),n.cdIsBinary=!0,n))})}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(Q),e.\u0275\u0275directiveInject(_t.u),e.\u0275\u0275directiveInject(Ye.k))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-iscsi"]],viewQuery:function(n,o){if(1&n&&(e.\u0275\u0275viewQuery(ei,7),e.\u0275\u0275viewQuery(ti,7),e.\u0275\u0275viewQuery(ni,7)),2&n){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.iscsiSparklineTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.iscsiPerSecondTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.iscsiRelativeDateTpl=a.first)}},decls:15,vars:4,consts:()=>{let t,n;return t="Gateways",n="Images",[["iscsiSparklineTpl",""],["iscsiPerSecondTpl",""],["iscsiRelativeDateTpl",""],t,n,[3,"fetchData","data","columns"],[3,"data","columns"],[4,"ngIf"],["class","text-muted",4,"ngIf"],[3,"data","isBinary"],[1,"text-muted"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275element(0,"cd-iscsi-tabs"),e.\u0275\u0275elementStart(1,"legend"),e.\u0275\u0275i18n(2,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div")(4,"cd-table",5),e.\u0275\u0275listener("fetchData",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.refresh())}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"legend"),e.\u0275\u0275i18n(6,4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div"),e.\u0275\u0275element(8,"cd-table",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,ai,2,2,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)(11,li,2,2,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)(13,di,2,2,"ng-template",null,2,e.\u0275\u0275templateRefExtractor)}2&n&&(e.\u0275\u0275advance(4),e.\u0275\u0275property("data",o.gateways)("columns",o.gatewaysColumns),e.\u0275\u0275advance(4),e.\u0275\u0275property("data",o.images)("columns",o.imagesColumns))},dependencies:[c.NgIf,Jo.B,Y.O,Rt,Zo.D,Ot.z]})}}return i})();var pi={elem:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:32,height:32},content:[{elem:"path",attrs:{d:"M2 26H30V28H2zM25.4 9c.8-.8.8-2 0-2.8 0 0 0 0 0 0l-3.6-3.6c-.8-.8-2-.8-2.8 0 0 0 0 0 0 0l-15 15V24h6.4L25.4 9zM20.4 4L24 7.6l-3 3L17.4 7 20.4 4zM6 22v-3.6l10-10 3.6 3.6-10 10H6z"}}],name:"edit",size:32},ui={elem:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:32,height:32},content:[{elem:"path",attrs:{d:"M13 24L4 15 5.414 13.586 13 21.171 26.586 7.586 28 9 13 24z"}}],name:"checkmark",size:32},It=p(88263),gi={elem:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:16,height:16},content:[{elem:"path",attrs:{d:"M30 24L26 24 26 20 24 20 24 24 20 24 20 26 24 26 24 30 26 30 26 26 30 26 30 24z"}},{elem:"path",attrs:{d:"M16,28H8V4h8v6a2.0058,2.0058,0,0,0,2,2h6v4h2V10a.9092.9092,0,0,0-.3-.7l-7-7A.9087.9087,0,0,0,18,2H8A2.0058,2.0058,0,0,0,6,4V28a2.0058,2.0058,0,0,0,2,2h8ZM18,4.4,23.6,10H18Z"}}],name:"document--add",size:16},Si={elem:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:16,height:16},content:[{elem:"path",attrs:{d:"M28 19L14.83 19 17.41 16.41 16 15 11 20 16 25 17.41 23.59 14.83 21 28 21 28 19z"}},{elem:"path",attrs:{d:"M24,14V10a1,1,0,0,0-.29-.71l-7-7A1,1,0,0,0,16,2H6A2,2,0,0,0,4,4V28a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V26H22v2H6V4h8v6a2,2,0,0,0,2,2h6v2Zm-8-4V4.41L21.59,10Z"}}],name:"document--import",size:16};let fi=(()=>{class i{constructor(t){this.iconService=t,this.iconService.registerAll([pi,ui,It.A,gi,Si])}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275inject(m.IconService))}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:i})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[c.CommonModule,ee.G,A.NgbNavModule,v.RouterModule,_.FormsModule,_.ReactiveFormsModule,A.NgbProgressbarModule,A.NgbTooltipModule,m.ModalModule,m.InputModule,m.CheckboxModule,m.SelectModule,m.GridModule,m.ButtonModule,m.IconModule]})}}return i})();var me=p(6872),Me=p(50619),Ci=p(35141),ye=p(23603),he=p(51862);function Ei(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",28),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd())}function Ti(i,r){if(1&i&&e.\u0275\u0275template(0,Ei,2,0,"span",21),2&i){const t=e.\u0275\u0275nextContext(),n=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.createBootstrapForm.showError("siteName",n,"required"))}}function Fi(i,r){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"cds-checkbox",29),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&i){const t=r.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275property("id",t.name)("name",t.name)("formControlName",t.name),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t.name," ")}}function Mi(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",28),e.\u0275\u0275i18n(1,9),e.\u0275\u0275elementEnd())}let hi=(()=>{class i extends m.BaseModal{constructor(t,n,o,a){super(),this.rbdMirroringService=t,this.taskWrapper=n,this.changeDetectorRef=o,this.siteName=a,this.pools=[],this.createForm()}ngAfterViewInit(){this.changeDetectorRef.detectChanges()}createForm(){this.createBootstrapForm=new k.$({siteName:new _.UntypedFormControl("",{validators:[_.Validators.required]}),pools:new _.UntypedFormGroup({},{validators:[this.validatePools()]}),token:new _.UntypedFormControl("",{})})}ngOnInit(){this.createBootstrapForm.get("siteName").setValue(this.siteName),this.rbdMirroringService.getSiteName().subscribe(t=>{this.createBootstrapForm.get("siteName").setValue(t.site_name)}),this.subs=this.rbdMirroringService.subscribeSummary(t=>{this.pools=t.content_data.pools.reduce((a,s)=>(a.push({name:s.name,mirror_mode:s.mirror_mode}),a),[]);const o=this.createBootstrapForm.get("pools");C().each(this.pools,a=>{const s=a.name,l="disabled"===a.mirror_mode,d=o.controls[s];d?l&&d.disabled?d.enable():!l&&d.enabled&&(d.disable(),d.setValue(!0)):o.addControl(s,new _.UntypedFormControl({value:!l,disabled:!l}))})})}ngOnDestroy(){this.subs&&this.subs.unsubscribe()}validatePools(){return t=>{let n=0;return C().each(t.controls,o=>{!0===o.value&&++n}),n>0?null:{requirePool:!0}}}generate(){this.createBootstrapForm.get("token").setValue("");let t="";const n=[],o=this.createBootstrapForm.get("pools");C().each(o.controls,(u,f)=>{!0===u.value&&(t=f,u.disabled||n.push(f))});const a={mirror_mode:"image"},s=(0,z.concat)(this.rbdMirroringService.setSiteName(this.createBootstrapForm.getValue("siteName")),(0,z.forkJoin)(n.map(u=>this.rbdMirroringService.updatePool(u,a))),this.rbdMirroringService.createBootstrapToken(t).pipe((0,Me.tap)(u=>this.createBootstrapForm.get("token").setValue(u.token)))).pipe((0,Me.last)()),l=()=>{this.rbdMirroringService.refresh(),this.createBootstrapForm.setErrors({cdSubmitButton:!0})};this.taskWrapper.wrapTaskAroundCall({task:new h.O("rbd/mirroring/bootstrap/create",{}),call:s}).subscribe({error:l,complete:l})}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(me.B),e.\u0275\u0275directiveInject(y.a),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject("siteName",8))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-bootstrap-create-modal"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:31,vars:11,consts:()=>{let t,n,o,a,s,l,d,u,f,M;return t="Name...",n="Generated token...",o="Create Bootstrap Token",a="To create a bootstrap token which can be imported by a peer site cluster, provide the local site's name, select which pools will have mirroring enabled, and click\xA0 " + "\ufffd#10\ufffd" + "Generate" + "\ufffd/#10\ufffd" + ".",s="Site Name " + "\ufffd#14\ufffd\ufffd/#14\ufffd" + "",l="Pools",d="Generate",u="Token " + "\ufffd#28\ufffd" + "          " + "\ufffd/#28\ufffd" + "",f="This field is required.",M="At least one pool is required.",[["formDir","ngForm"],["siteNameError",""],o,a,s,l,d,u,f,M,["size","md",3,"overlaySelected","open","hasScrollingContent"],[3,"closeSelect"],["cdsModalHeaderHeading",""],["cdsModalContent",""],["name","createBootstrapForm","novalidate","",1,"form",3,"formGroup"],[1,"form-item"],["for","siteName","cdRequiredField","Site Name",3,"invalid","invalidText"],["cdsText","","placeholder",t,"id","siteName","name","siteName","formControlName","siteName","autofocus","",3,"invalid"],["formGroupName","pools",1,"form-item"],["for","pools",1,"cds--label"],[4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],[3,"submitAction","form"],[1,"form-item","mt-2"],["for","token"],["cdsTextArea","","placeholder",n,"id","token","formControlName","token","cols","200","rows","5","readonly",""],["source","token"],["cancelText","Close",3,"backAction","showSubmit","modalForm"],[1,"invalid-feedback"],[3,"id","name","formControlName"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-modal",10),e.\u0275\u0275listener("overlaySelected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(1,"cds-modal-header",11),e.\u0275\u0275listener("closeSelect",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(2,"h3",12),e.\u0275\u0275i18n(3,2),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"section",13)(5,"form",14,0)(7,"p"),e.\u0275\u0275elementContainerStart(8),e.\u0275\u0275i18nStart(9,3),e.\u0275\u0275element(10,"kbd"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"div",15)(12,"cds-text-label",16),e.\u0275\u0275i18nStart(13,4),e.\u0275\u0275element(14,"input",17),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(15,Ti,1,1,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"div",18)(18,"fieldset")(19,"label",19),e.\u0275\u0275i18n(20,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(21,Fi,3,4,"ng-container",20),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(22,Mi,2,0,"span",21),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(23,"cd-submit-button",22),e.\u0275\u0275listener("submitAction",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.generate())}),e.\u0275\u0275i18n(24,6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(25,"div",23)(26,"cds-textarea-label",24),e.\u0275\u0275i18nStart(27,7),e.\u0275\u0275element(28,"textarea",25),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(29,"cd-copy-2-clipboard-button",26),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(30,"cd-form-button-panel",27),e.\u0275\u0275listener("backAction",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementEnd()()}if(2&n){const a=e.\u0275\u0275reference(6),s=e.\u0275\u0275reference(16);e.\u0275\u0275property("open",o.open)("hasScrollingContent",!0),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",o.createBootstrapForm),e.\u0275\u0275advance(7),e.\u0275\u0275property("invalid",!o.createBootstrapForm.controls.siteName.valid&&(o.createBootstrapForm.controls.siteName.dirty||o.createBootstrapForm.controls.siteName.touched))("invalidText",s),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",!o.createBootstrapForm.controls.siteName.valid&&(o.createBootstrapForm.controls.siteName.dirty||o.createBootstrapForm.controls.siteName.touched)),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngForOf",o.pools),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.createBootstrapForm.showError("pools",a,"requirePool")),e.\u0275\u0275advance(),e.\u0275\u0275property("form",o.createBootstrapForm),e.\u0275\u0275advance(7),e.\u0275\u0275property("showSubmit",!1)("modalForm",!0)}},dependencies:[c.NgForOf,c.NgIf,Ci._,We.N,F.e,ye.B,x.S,N.E,he.P,_.\u0275NgNoValidate,_.DefaultValueAccessor,_.NgControlStatus,_.NgControlStatusGroup,_.FormGroupDirective,_.FormControlName,_.FormGroupName,m.Modal,m.ModalHeader,m.ModalContent,m.ModalHeaderHeading,m.TextareaLabelComponent,m.TextInputLabelComponent,m.TextInput,m.TextArea,m.Checkbox],styles:[".form-group.ng-invalid[_ngcontent-%COMP%]   .invalid-feedback[_ngcontent-%COMP%]{display:block}"]})}}return i})();function Oi(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",29),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd())}function Ri(i,r){if(1&i&&e.\u0275\u0275template(0,Oi,2,0,"span",25),2&i){const t=e.\u0275\u0275nextContext(),n=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.importBootstrapForm.showError("siteName",n,"required"))}}function Ii(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"option",30),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=r.$implicit;e.\u0275\u0275property("value",t.key),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t.desc)}}function Ni(i,r){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"cds-checkbox",31),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&i){const t=r.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275property("id",t.name)("name",t.name)("formControlName",t.name),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t.name," ")}}function bi(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",29),e.\u0275\u0275i18n(1,9),e.\u0275\u0275elementEnd())}function Pi(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",29),e.\u0275\u0275i18n(1,10),e.\u0275\u0275elementEnd())}function Ai(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",29),e.\u0275\u0275i18n(1,11),e.\u0275\u0275elementEnd())}function vi(i,r){if(1&i&&e.\u0275\u0275template(0,Pi,2,0,"span",25)(1,Ai,2,0,"span",25),2&i){const t=e.\u0275\u0275nextContext(),n=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.importBootstrapForm.showError("token",n,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.importBootstrapForm.showError("token",n,"invalidToken"))}}let Di=(()=>{class i extends m.BaseModal{constructor(t,n,o,a){super(),this.actionLabels=t,this.rbdMirroringService=n,this.taskWrapper=o,this.siteName=a,this.pools=[],this.directions=[{key:"rx-tx",desc:"Bidirectional"},{key:"rx",desc:"Unidirectional (receive-only)"}],this.createForm()}createForm(){this.importBootstrapForm=new k.$({siteName:new _.UntypedFormControl("",{validators:[_.Validators.required]}),direction:new _.UntypedFormControl("rx-tx",{}),pools:new _.UntypedFormGroup({},{validators:[this.validatePools()]}),token:new _.UntypedFormControl("",{validators:[_.Validators.required,this.validateToken()]})})}ngOnInit(){this.rbdMirroringService.getSiteName().subscribe(t=>{this.importBootstrapForm.get("siteName").setValue(t.site_name)}),this.subs=this.rbdMirroringService.subscribeSummary(t=>{this.pools=t.content_data.pools.reduce((a,s)=>(a.push({name:s.name,mirror_mode:s.mirror_mode}),a),[]);const o=this.importBootstrapForm.get("pools");C().each(this.pools,a=>{const s=a.name,l="disabled"===a.mirror_mode,d=o.controls[s];d?l&&d.disabled?d.enable():!l&&d.enabled&&(d.disable(),d.setValue(!0)):o.addControl(s,new _.UntypedFormControl({value:!l,disabled:!l}))})})}ngOnDestroy(){this.subs&&this.subs.unsubscribe()}validatePools(){return t=>{let n=0;return C().each(t.controls,o=>{!0===o.value&&++n}),n>0?null:{requirePool:!0}}}validateToken(){return t=>{try{if(JSON.parse(atob(t.value)))return null}catch{}return{invalidToken:!0}}}import(){const t=[],n=[],o=this.importBootstrapForm.get("pools");C().each(o.controls,(u,f)=>{!0===u.value&&(t.push(f),u.disabled||n.push(f))});const a={mirror_mode:"image"};let s=(0,z.concat)(this.rbdMirroringService.setSiteName(this.importBootstrapForm.getValue("siteName")),(0,z.forkJoin)(n.map(u=>this.rbdMirroringService.updatePool(u,a))));s=t.reduce((u,f)=>(0,z.concat)(u,this.rbdMirroringService.importBootstrapToken(f,this.importBootstrapForm.getValue("direction"),this.importBootstrapForm.getValue("token"))),s).pipe((0,Me.last)());const l=()=>{this.rbdMirroringService.refresh(),this.importBootstrapForm.setErrors({cdSubmitButton:!0})};this.taskWrapper.wrapTaskAroundCall({task:new h.O("rbd/mirroring/bootstrap/import",{}),call:s}).subscribe({error:l,complete:()=>{l(),this.closeModal()}})}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(me.B),e.\u0275\u0275directiveInject(y.a),e.\u0275\u0275directiveInject("siteName",8))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-bootstrap-import-modal"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:33,vars:14,consts:()=>{let t,n,o,a,s,l,d,u,f,M,E;return t="Name...",n="Generated token...",o="Import Bootstrap Token",a="To import a bootstrap token which was created by a peer site cluster, provide the local site's name, select which pools will have mirroring enabled, provide the generated token, and click\xA0" + "\ufffd#10\ufffd" + "Import" + "\ufffd/#10\ufffd" + ".",s="Site Name " + "\ufffd#14\ufffd\ufffd/#14\ufffd" + "",l="Pools",d="Token " + "\ufffd#29\ufffd" + "          " + "\ufffd/#29\ufffd" + "",u="This field is required.",f="At least one pool is required.",M="This field is required.",E="The token is invalid.",[["formDir","ngForm"],["siteNameError",""],["tokenError",""],o,a,s,l,d,u,f,M,E,["size","md",3,"overlaySelected","open"],[3,"closeSelect"],["cdsModalHeaderHeading",""],["cdsModalContent",""],["name","importBootstrapForm","novalidate","",1,"form",3,"formGroup"],[1,"form-item"],["for","siteName","cdRequiredField","Site Name",3,"invalid","invalidText"],["cdsText","","placeholder",t,"id","siteName","name","siteName","formControlName","siteName","autofocus","",3,"invalid"],["label","Direction","for","direction","name","direction","id","direction","formControlName","direction"],[3,"value",4,"ngFor","ngForOf"],["formGroupName","pools",1,"form-item"],["for","pools",1,"cds--label"],[4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],["for","token","cdRequiredField","Token",3,"invalid","invalidText"],["cdsTextArea","","placeholder",n,"id","token","formControlName","token","cols","200","rows","5",3,"invalid"],[3,"submitActionEvent","form","submitText","modalForm"],[1,"invalid-feedback"],[3,"value"],[3,"id","name","formControlName"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-modal",12),e.\u0275\u0275listener("overlaySelected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(1,"cds-modal-header",13),e.\u0275\u0275listener("closeSelect",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(2,"h3",14),e.\u0275\u0275i18n(3,3),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"section",15)(5,"form",16,0)(7,"p"),e.\u0275\u0275elementContainerStart(8),e.\u0275\u0275i18nStart(9,4),e.\u0275\u0275element(10,"kbd"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"div",17)(12,"cds-text-label",18),e.\u0275\u0275i18nStart(13,5),e.\u0275\u0275element(14,"input",19),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(15,Ri,1,1,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"div",17)(18,"cds-select",20),e.\u0275\u0275template(19,Ii,2,2,"option",21),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(20,"div",22)(21,"fieldset")(22,"label",23),e.\u0275\u0275i18n(23,6),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(24,Ni,3,4,"ng-container",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(25,bi,2,0,"span",25),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(26,"div",17)(27,"cds-textarea-label",26),e.\u0275\u0275i18nStart(28,7),e.\u0275\u0275element(29,"textarea",27),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(30,vi,2,2,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(32,"cd-form-button-panel",28),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.import())}),e.\u0275\u0275elementEnd()()}if(2&n){const a=e.\u0275\u0275reference(6),s=e.\u0275\u0275reference(16),l=e.\u0275\u0275reference(31);e.\u0275\u0275property("open",o.open),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",o.importBootstrapForm),e.\u0275\u0275advance(7),e.\u0275\u0275property("invalid",!o.importBootstrapForm.controls.siteName.valid&&o.importBootstrapForm.controls.siteName.dirty)("invalidText",s),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",!o.importBootstrapForm.controls.siteName.valid&&o.importBootstrapForm.controls.siteName.dirty),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",o.directions),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",o.pools),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.importBootstrapForm.showError("pools",a,"requirePool")),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.importBootstrapForm.controls.token.invalid&&o.importBootstrapForm.controls.token.dirty)("invalidText",l),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.importBootstrapForm.controls.token.invalid&&o.importBootstrapForm.controls.token.dirty),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.importBootstrapForm)("submitText",o.actionLabels.SUBMIT)("modalForm",!0)}},dependencies:[c.NgForOf,c.NgIf,F.e,ye.B,x.S,N.E,he.P,_.\u0275NgNoValidate,_.NgSelectOption,_.\u0275NgSelectMultipleOption,_.DefaultValueAccessor,_.NgControlStatus,_.NgControlStatusGroup,_.FormGroupDirective,_.FormControlName,_.FormGroupName,m.Modal,m.ModalHeader,m.ModalContent,m.ModalHeaderHeading,m.TextareaLabelComponent,m.TextInputLabelComponent,m.TextInput,m.TextArea,m.Checkbox,m.Select,m.Option]})}}return i})();var pe=p(2243),Li=p(16748);let ct=(()=>{class i{transform(t){return"warning"===t?"badge badge-warning":"error"===t?"badge badge-danger":"success"===t?"badge badge-success":"badge badge-info"}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275pipe=e.\u0275\u0275definePipe({name:"mirrorHealthColor",type:i,pure:!0})}}return i})();const yi=["healthTmpl"];function $i(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span",2),e.\u0275\u0275pipe(1,"mirrorHealthColor"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()),2&i){const n=r.data.value;e.\u0275\u0275property("ngClass",e.\u0275\u0275pipeBind1(1,2,r.data.row.health_color)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(n)}}let Bi=(()=>{class i{constructor(t,n){this.rbdMirroringService=t,this.cephShortVersionPipe=n,this.tableStatus=new pe.m}ngOnInit(){this.columns=[{prop:"instance_id",name:"Instance",flexGrow:2},{prop:"id",name:"ID",flexGrow:2},{prop:"server_hostname",name:"Hostname",flexGrow:2},{prop:"version",name:"Version",pipe:this.cephShortVersionPipe,flexGrow:2},{prop:"health",name:"Health",cellTemplate:this.healthTmpl,flexGrow:1}],this.subs=this.rbdMirroringService.subscribeSummary(t=>{this.data=t.content_data.daemons,this.tableStatus=new pe.m(t.status)})}ngOnDestroy(){this.subs.unsubscribe()}refresh(){this.rbdMirroringService.refresh()}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(me.B),e.\u0275\u0275directiveInject(Li.Z))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-mirroring-daemons"]],viewQuery:function(n,o){if(1&n&&e.\u0275\u0275viewQuery(yi,7),2&n){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.healthTmpl=a.first)}},decls:3,vars:4,consts:[["healthTmpl",""],["columnMode","flex",3,"fetchData","data","columns","autoReload","status"],[3,"ngClass"]],template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-table",1),e.\u0275\u0275listener("fetchData",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.refresh())}),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(1,$i,3,4,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)}2&n&&e.\u0275\u0275property("data",o.data)("columns",o.columns)("autoReload",-1)("status",o.tableStatus)},dependencies:[c.NgClass,Y.O,ct]})}}return i})();var dt=p(62988);const Gi=["stateTmpl"],xi=["syncTmpl"],wi=["progressTmpl"],Vi=["entriesBehindPrimaryTpl"];function Hi(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-table",14),e.\u0275\u0275listener("fetchData",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.refresh())}),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("data",t.image_error.data)("columns",t.image_error.columns)("autoReload",-1)("status",t.tableStatus)}}function ki(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-table",14),e.\u0275\u0275listener("fetchData",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.refresh())}),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("data",t.image_syncing.data)("columns",t.image_syncing.columns)("autoReload",-1)("status",t.tableStatus)}}function Ki(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-table",14),e.\u0275\u0275listener("fetchData",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.refresh())}),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("data",t.image_ready.data)("columns",t.image_ready.columns)("autoReload",-1)("status",t.tableStatus)}}function zi(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span",15),e.\u0275\u0275pipe(1,"mirrorHealthColor"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()),2&i){const n=r.data.value;e.\u0275\u0275property("ngClass",e.\u0275\u0275pipeBind1(1,2,r.data.row.state_color)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(n)}}function Xi(i,r){1&i&&e.\u0275\u0275element(0,"div")}function Ui(i,r){if(1&i&&e.\u0275\u0275element(0,"ngb-progressbar",19),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275property("value",t)("showValue",!0)}}function ji(i,r){if(1&i&&(e.\u0275\u0275template(0,Xi,1,0,"div",16),e.\u0275\u0275elementStart(1,"div",17),e.\u0275\u0275template(2,Ui,1,2,"ngb-progressbar",18),e.\u0275\u0275elementEnd()),2&i){const t=r.data.row;e.\u0275\u0275property("ngIf","Replaying"===t.state),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf","Replaying"===t.state)}}function qi(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t," ")}}function Qi(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",21),e.\u0275\u0275text(1,"-"),e.\u0275\u0275elementEnd())}function Yi(i,r){if(1&i&&e.\u0275\u0275template(0,qi,2,1,"span",16)(1,Qi,2,0,"span",20),2&i){const t=r.data.row;e.\u0275\u0275property("ngIf","journal"===t.mirror_mode),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","snapshot"===t.mirror_mode)}}let Wi=(()=>{class i{constructor(t){this.rbdMirroringService=t,this.image_error={data:[],columns:{}},this.image_syncing={data:[],columns:{}},this.image_ready={data:[],columns:{}},this.tableStatus=new pe.m}ngOnInit(){this.image_error.columns=[{prop:"pool_name",name:"Pool",flexGrow:2},{prop:"name",name:"Image",flexGrow:2},{prop:"state",name:"State",cellTemplate:this.stateTmpl,flexGrow:1},{prop:"description",name:"Issue",flexGrow:4}],this.image_syncing.columns=[{prop:"pool_name",name:"Pool",flexGrow:2},{prop:"name",name:"Image",flexGrow:2},{prop:"state",name:"State",cellTemplate:this.stateTmpl,flexGrow:1},{prop:"syncing_percent",name:"Progress",cellTemplate:this.progressTmpl,flexGrow:2},{prop:"bytes_per_second",name:"Bytes per second",flexGrow:2},{prop:"entries_behind_primary",name:"Entries behind primary",cellTemplate:this.entriesBehindPrimaryTpl,flexGrow:2}],this.image_ready.columns=[{prop:"pool_name",name:"Pool",flexGrow:2},{prop:"name",name:"Image",flexGrow:2},{prop:"state",name:"State",cellTemplate:this.stateTmpl,flexGrow:1},{prop:"description",name:"Description",flexGrow:4}],this.subs=this.rbdMirroringService.subscribeSummary(t=>{this.image_error.data=t.content_data.image_error,this.image_syncing.data=t.content_data.image_syncing,this.image_ready.data=t.content_data.image_ready,this.tableStatus=new pe.m(t.status)})}ngOnDestroy(){this.subs.unsubscribe()}refresh(){this.rbdMirroringService.refresh()}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(me.B))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-mirroring-images"]],viewQuery:function(n,o){if(1&n&&(e.\u0275\u0275viewQuery(Gi,7),e.\u0275\u0275viewQuery(xi,7),e.\u0275\u0275viewQuery(wi,7),e.\u0275\u0275viewQuery(Vi,7)),2&n){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.stateTmpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.syncTmpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.progressTmpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.entriesBehindPrimaryTpl=a.first)}},decls:21,vars:4,consts:()=>{let t,n,o;return t="Issues (" + "\ufffd0\ufffd" + ")",n="Syncing (" + "\ufffd0\ufffd" + ")",o="Ready (" + "\ufffd0\ufffd" + ")",[["nav","ngbNav"],["stateTmpl",""],["progressTmpl",""],["entriesBehindPrimaryTpl",""],t,n,o,["ngbNav","","cdStatefulTab","image-list",1,"nav-tabs"],["ngbNavItem","issues"],["ngbNavLink",""],["ngbNavContent",""],["ngbNavItem","syncing"],["ngbNavItem","ready"],[3,"ngbNavOutlet"],["columnMode","flex",3,"fetchData","data","columns","autoReload","status"],[3,"ngClass"],[4,"ngIf"],[1,"w-100","h-100","d-flex","justify-content-center","align-items-center"],["type","info","class","w-100",3,"value","showValue",4,"ngIf"],["type","info",1,"w-100",3,"value","showValue"],["ngbTooltip","Not available with mirroring snapshot mode",4,"ngIf"],["ngbTooltip","Not available with mirroring snapshot mode"]]},template:function(n,o){if(1&n&&(e.\u0275\u0275elementStart(0,"nav",7,0),e.\u0275\u0275elementContainerStart(2,8),e.\u0275\u0275elementStart(3,"a",9),e.\u0275\u0275i18n(4,4),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,Hi,1,4,"ng-template",10),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(6,11),e.\u0275\u0275elementStart(7,"a",9),e.\u0275\u0275i18n(8,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,ki,1,4,"ng-template",10),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(10,12),e.\u0275\u0275elementStart(11,"a",9),e.\u0275\u0275i18n(12,6),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(13,Ki,1,4,"ng-template",10),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(14,"div",13),e.\u0275\u0275template(15,zi,3,4,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)(17,ji,3,2,"ng-template",null,2,e.\u0275\u0275templateRefExtractor)(19,Yi,2,2,"ng-template",null,3,e.\u0275\u0275templateRefExtractor)),2&n){const a=e.\u0275\u0275reference(1);e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(o.image_error.data.length),e.\u0275\u0275i18nApply(4),e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(o.image_syncing.data.length),e.\u0275\u0275i18nApply(8),e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(o.image_ready.data.length),e.\u0275\u0275i18nApply(12),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngbNavOutlet",a)}},dependencies:[c.NgClass,c.NgIf,Y.O,dt.B,A.NgbNavContent,A.NgbNav,A.NgbNavItem,A.NgbNavLink,A.NgbNavLinkBase,A.NgbNavOutlet,A.NgbProgressbar,A.NgbTooltip,ct]})}}return i})();class Ji{}function Zi(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",33),e.\u0275\u0275i18n(1,11),e.\u0275\u0275elementEnd())}function ea(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",33),e.\u0275\u0275i18n(1,12),e.\u0275\u0275elementEnd())}function ta(i,r){if(1&i&&e.\u0275\u0275template(0,Zi,2,0,"span",32)(1,ea,2,0,"span",32),2&i){const t=e.\u0275\u0275nextContext(),n=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.editPeerForm.showError("clusterName",n,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.editPeerForm.showError("clusterName",n,"invalidClusterName"))}}function na(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",33),e.\u0275\u0275i18n(1,13),e.\u0275\u0275elementEnd())}function oa(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",33),e.\u0275\u0275i18n(1,14),e.\u0275\u0275elementEnd())}function ia(i,r){if(1&i&&e.\u0275\u0275template(0,na,2,0,"span",32)(1,oa,2,0,"span",32),2&i){const t=e.\u0275\u0275nextContext(),n=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.editPeerForm.showError("clientID",n,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.editPeerForm.showError("clientID",n,"invalidClientID"))}}function aa(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",33),e.\u0275\u0275i18n(1,15),e.\u0275\u0275elementEnd())}function ra(i,r){if(1&i&&e.\u0275\u0275template(0,aa,2,0,"span",32),2&i){const t=e.\u0275\u0275nextContext(),n=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.editPeerForm.showError("monAddr",n,"invalidMonAddr"))}}function sa(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",33),e.\u0275\u0275i18n(1,16),e.\u0275\u0275elementEnd())}function la(i,r){if(1&i&&e.\u0275\u0275template(0,sa,2,0,"span",32),2&i){const t=e.\u0275\u0275nextContext(),n=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.editPeerForm.showError("key",n,"invalidKey"))}}let _a=(()=>{class i extends m.BaseModal{constructor(t,n,o,a,s="",l=""){super(),this.actionLabels=t,this.rbdMirroringService=n,this.taskWrapper=o,this.poolName=a,this.peerUUID=s,this.mode=l,this.bsConfig={containerClass:"theme-default"},this.createForm()}createForm(){this.editPeerForm=new k.$({clusterName:new _.UntypedFormControl("",{validators:[_.Validators.required,this.validateClusterName]}),clientID:new _.UntypedFormControl("",{validators:[_.Validators.required,this.validateClientID]}),monAddr:new _.UntypedFormControl("",{validators:[this.validateMonAddr]}),key:new _.UntypedFormControl("",{validators:[this.validateKey]})})}ngOnInit(){this.pattern=`${this.poolName}/${this.peerUUID}`,"edit"===this.mode&&this.rbdMirroringService.getPeer(this.poolName,this.peerUUID).subscribe(t=>{this.setResponse(t)})}validateClusterName(t){if(!t.value.match(/^[\w\-_]*$/))return{invalidClusterName:{value:t.value}}}validateClientID(t){if(!t.value.match(/^(?!client\.)[\w\-_.]*$/))return{invalidClientID:{value:t.value}}}validateMonAddr(t){if(!t.value.match(/^[,; ]*([\w.\-_\[\]]+(:[\d]+)?[,; ]*)*$/))return{invalidMonAddr:{value:t.value}}}validateKey(t){try{if(""===t.value||atob(t.value))return null}catch{}return{invalidKey:{value:t.value}}}setResponse(t){this.response=t,this.editPeerForm.get("clusterName").setValue(t.cluster_name),this.editPeerForm.get("clientID").setValue(t.client_id),this.editPeerForm.get("monAddr").setValue(t.mon_host),this.editPeerForm.get("key").setValue(t.key)}update(){const t=new Ji;let n;t.cluster_name=this.editPeerForm.getValue("clusterName"),t.client_id=this.editPeerForm.getValue("clientID"),t.mon_host=this.editPeerForm.getValue("monAddr"),t.key=this.editPeerForm.getValue("key"),n=this.taskWrapper.wrapTaskAroundCall("edit"===this.mode?{task:new h.O("rbd/mirroring/peer/edit",{pool_name:this.poolName}),call:this.rbdMirroringService.updatePeer(this.poolName,this.peerUUID,t)}:{task:new h.O("rbd/mirroring/peer/add",{pool_name:this.poolName}),call:this.rbdMirroringService.addPeer(this.poolName,t)}),n.subscribe({error:()=>this.editPeerForm.setErrors({cdSubmitButton:!0}),complete:()=>{this.rbdMirroringService.refresh(),this.closeModal()}})}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(me.B),e.\u0275\u0275directiveInject(y.a),e.\u0275\u0275directiveInject("poolName"),e.\u0275\u0275directiveInject("peerUUID",8),e.\u0275\u0275directiveInject("mode",8))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-pool-edit-peer-modal"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:37,vars:21,consts:()=>{let t,n,o,a,s,l,d,u,f,M,E,b,D,B,V,oe,ie,ae;return t="Name...",n="CephX ID...",o="Comma-delimited addresses...",a="Base64-encoded key...",s="{VAR_SELECT, select, edit {Edit} other {Add}}",s=e.\u0275\u0275i18nPostprocess(s,{VAR_SELECT:"\ufffd0\ufffd"}),l=" " + s + " pool mirror peer ",d="{VAR_SELECT, select, edit {Edit} other {Add}}",d=e.\u0275\u0275i18nPostprocess(d,{VAR_SELECT:"\ufffd0\ufffd"}),u="" + d + " the pool mirror peer attributes for pool " + "[\ufffd#10\ufffd|\ufffd#11\ufffd]" + "" + "\ufffd1\ufffd" + "" + "[\ufffd/#10\ufffd|\ufffd/#11\ufffd]" + " and click " + "[\ufffd#10\ufffd|\ufffd#11\ufffd]" + "Submit" + "[\ufffd/#10\ufffd|\ufffd/#11\ufffd]" + ".",u=e.\u0275\u0275i18nPostprocess(u),f="Cluster Name " + "\ufffd#15\ufffd\ufffd/#15\ufffd" + "",M="CephX ID " + "\ufffd#21\ufffd\ufffd/#21\ufffd" + "",E="Monitor Addresses " + "\ufffd#27\ufffd\ufffd/#27\ufffd" + "",b="CephX Key " + "\ufffd#33\ufffd\ufffd/#33\ufffd" + "",D="This field is required.",B="The cluster name is not valid.",V="This field is required.",oe="The CephX ID is not valid.",ie="The monitory address is not valid.",ae="CephX key must be base64 encoded.",[["formDir","ngForm"],["clusterNameError",""],["clientIDError",""],["monAddrError",""],["keyError",""],l,u,f,M,E,b,D,B,V,oe,ie,ae,["size","md",3,"overlaySelected","open","hasScrollingContent"],[3,"closeSelect"],["cdsModalHeaderHeading",""],["cdsModalContent",""],["name","editPeerForm","novalidate","",1,"form",3,"formGroup"],[1,"form-item"],["for","clusterName","cdRequiredField","Cluster Name",3,"invalid","invalidText"],["cdsText","","type","text","placeholder",t,"id","clusterName","name","clusterName","formControlName","clusterName","autofocus","",3,"invalid"],["for","clientID","cdRequiredField","CephX ID",3,"invalid","invalidText"],["cdsText","","type","text","placeholder",n,"id","clientID","name","clientID","formControlName","clientID",3,"invalid"],["for","monAddr",3,"invalid","invalidText"],["cdsText","","type","text","placeholder",o,"id","monAddr","name","monAddr","formControlName","monAddr",3,"invalid"],["for","key",3,"invalid","invalidText"],["cdsText","","type","text","placeholder",a,"id","key","name","key","formControlName","key",3,"invalid"],[3,"submitActionEvent","form","submitText","modalForm"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-modal",17),e.\u0275\u0275listener("overlaySelected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(1,"cds-modal-header",18),e.\u0275\u0275listener("closeSelect",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(2,"h3",19),e.\u0275\u0275i18n(3,5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"section",20)(5,"form",21,0)(7,"p")(8,"span"),e.\u0275\u0275i18nStart(9,6),e.\u0275\u0275element(10,"kbd")(11,"kbd"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(12,"div",22)(13,"cds-text-label",23),e.\u0275\u0275i18nStart(14,7),e.\u0275\u0275element(15,"input",24),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(16,ta,2,2,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"div",22)(19,"cds-text-label",25),e.\u0275\u0275i18nStart(20,8),e.\u0275\u0275element(21,"input",26),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(22,ia,2,2,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"div",22)(25,"cds-text-label",27),e.\u0275\u0275i18nStart(26,9),e.\u0275\u0275element(27,"input",28),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(28,ra,1,1,"ng-template",null,3,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(30,"div",22)(31,"cds-text-label",29),e.\u0275\u0275i18nStart(32,10),e.\u0275\u0275element(33,"input",30),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(34,la,1,1,"ng-template",null,4,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(36,"cd-form-button-panel",31),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.update())}),e.\u0275\u0275elementEnd()()}if(2&n){const a=e.\u0275\u0275reference(17),s=e.\u0275\u0275reference(23),l=e.\u0275\u0275reference(29),d=e.\u0275\u0275reference(35);e.\u0275\u0275property("open",o.open)("hasScrollingContent",!0),e.\u0275\u0275advance(3),e.\u0275\u0275i18nExp(o.mode),e.\u0275\u0275i18nApply(3),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",o.editPeerForm),e.\u0275\u0275advance(6),e.\u0275\u0275i18nExp(o.mode)(o.poolName),e.\u0275\u0275i18nApply(9),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.editPeerForm.controls.clusterName.invalid&&o.editPeerForm.controls.clusterName.dirty)("invalidText",a),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.editPeerForm.controls.clusterName.invalid&&o.editPeerForm.controls.clusterName.dirty),e.\u0275\u0275advance(4),e.\u0275\u0275property("invalid",o.editPeerForm.controls.clientID.invalid&&o.editPeerForm.controls.clientID.dirty)("invalidText",s),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.editPeerForm.controls.clientID.invalid&&o.editPeerForm.controls.clientID.dirty),e.\u0275\u0275advance(4),e.\u0275\u0275property("invalid",o.editPeerForm.controls.monAddr.invalid&&o.editPeerForm.controls.monAddr.dirty)("invalidText",l),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.editPeerForm.controls.monAddr.invalid&&o.editPeerForm.controls.monAddr.dirty),e.\u0275\u0275advance(4),e.\u0275\u0275property("invalid",o.editPeerForm.controls.key.invalid&&o.editPeerForm.controls.key.dirty)("invalidText",d),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.editPeerForm.controls.key.invalid&&o.editPeerForm.controls.key.dirty),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.editPeerForm)("submitText",o.actionLabels.SUBMIT)("modalForm",!0)}},dependencies:[c.NgIf,F.e,ye.B,x.S,N.E,he.P,_.\u0275NgNoValidate,_.DefaultValueAccessor,_.NgControlStatus,_.NgControlStatusGroup,_.FormGroupDirective,_.FormControlName,m.Modal,m.ModalHeader,m.ModalContent,m.ModalHeaderHeading,m.TextInputLabelComponent,m.TextInput]})}}return i})();var mt=p(22453);const ca=["healthTmpl"],da=["localTmpl"],ma=["remoteTmpl"];function pa(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span",8),e.\u0275\u0275pipe(1,"mirrorHealthColor"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()),2&i){const n=r.data.value;e.\u0275\u0275property("ngClass",e.\u0275\u0275pipeBind1(1,2,r.data.row.health_color)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(n)}}function ua(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",9),e.\u0275\u0275i18n(1,3),e.\u0275\u0275elementEnd())}function ga(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",10),e.\u0275\u0275i18n(1,4),e.\u0275\u0275elementEnd())}let fa=(()=>{class i{constructor(t,n,o,a,s){this.authStorageService=t,this.rbdMirroringService=n,this.modalService=o,this.taskWrapper=a,this.router=s,this.selection=new _e.y,this.tableStatus=new pe.m,this.data=[],this.permission=this.authStorageService.getPermissions().rbdMirroring;const l={permission:"update",icon:T.FI.edit,click:()=>this.editModeModal(),name:"Edit Mode",canBePrimary:()=>!0},d={permission:"create",icon:T.FI.add,name:"Add Peer",click:()=>this.editPeersModal("add"),disable:()=>!this.selection.first()||"disabled"===this.selection.first().mirror_mode,visible:()=>!this.getPeerUUID(),canBePrimary:()=>!1},u={permission:"update",icon:T.FI.exchange,name:"Edit Peer",click:()=>this.editPeersModal("edit"),visible:()=>!!this.getPeerUUID()},f={permission:"delete",icon:T.FI.destroy,name:"Delete Peer",click:()=>this.deletePeersModal(),visible:()=>!!this.getPeerUUID()};this.tableActions=[l,d,u,f]}ngOnInit(){this.columns=[{prop:"name",name:"Name",flexGrow:2},{prop:"mirror_mode",name:"Mode",flexGrow:2},{prop:"leader_id",name:"Leader",flexGrow:2},{prop:"image_local_count",name:"# Local",headerTemplate:this.localTmpl,flexGrow:2},{prop:"image_remote_count",name:"# Remote",headerTemplate:this.remoteTmpl,flexGrow:2},{prop:"health",name:"Health",cellTemplate:this.healthTmpl,flexGrow:1}],this.subs=this.rbdMirroringService.subscribeSummary(t=>{this.data=t.content_data.pools,this.tableStatus=new pe.m(t.status)})}ngOnDestroy(){this.subs.unsubscribe()}refresh(){this.rbdMirroringService.refresh()}editModeModal(){this.router.navigate(["/block/mirroring",{outlets:{modal:[O.Qp.EDIT,this.selection.first().name]}}])}editPeersModal(t){const n={poolName:this.selection.first().name,mode:t};"edit"===t&&(n.peerUUID=this.getPeerUUID()),this.modalService.show(_a,n)}deletePeersModal(){const t=this.selection.first().name,n=this.getPeerUUID();this.modalService.show(le.D,{impact:mt.r.high,itemDescription:"mirror peer",itemNames:[`${t} (${n})`],submitActionObservable:()=>new z.Observable(o=>{this.taskWrapper.wrapTaskAroundCall({task:new h.O("rbd/mirroring/peer/delete",{pool_name:t}),call:this.rbdMirroringService.deletePeer(t,n)}).subscribe({error:a=>o.error(a),complete:()=>{this.rbdMirroringService.refresh(),o.complete()}})})})}getPeerUUID(){const t=this.selection.first(),n=this.data.find(o=>t&&t.name===o.name);if(n&&n.peer_uuids)return n.peer_uuids[0]}updateSelection(t){this.selection=t}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(j.v),e.\u0275\u0275directiveInject(me.B),e.\u0275\u0275directiveInject(ce.V),e.\u0275\u0275directiveInject(y.a),e.\u0275\u0275directiveInject(v.Router))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-mirroring-pools"]],viewQuery:function(n,o){if(1&n&&(e.\u0275\u0275viewQuery(ca,7),e.\u0275\u0275viewQuery(da,7),e.\u0275\u0275viewQuery(ma,7)),2&n){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.healthTmpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.localTmpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.remoteTmpl=a.first)}},decls:9,vars:7,consts:()=>{let t,n,o,a;return t="Local image count",n="# Local",o="Remote image count",a="# Remote",[["healthTmpl",""],["localTmpl",""],["remoteTmpl",""],n,a,["columnMode","flex","identifier","name","forceIdentifier","true","selectionType","single",3,"fetchData","updateSelection","data","columns","autoReload","status"],[1,"table-actions",3,"permission","selection","tableActions"],["name","modal"],[3,"ngClass"],["ngbTooltip",t],["ngbTooltip",o]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-table",5),e.\u0275\u0275listener("fetchData",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.refresh())})("updateSelection",function(l){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.updateSelection(l))}),e.\u0275\u0275element(1,"cd-table-actions",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(2,pa,3,4,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)(4,ua,2,0,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)(6,ga,2,0,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275element(8,"router-outlet",7)}2&n&&(e.\u0275\u0275property("data",o.data)("columns",o.columns)("autoReload",-1)("status",o.tableStatus),e.\u0275\u0275advance(),e.\u0275\u0275property("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[c.NgClass,Y.O,de.j,v.RouterOutlet,A.NgbTooltip,ct]})}}return i})();const Ca=()=>({md:4});function Ea(i,r){if(1&i&&(e.\u0275\u0275i18nStart(0,1,1),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(1,"svg",21),e.\u0275\u0275i18nEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",t.icons.edit)("size",t.icons.size32)}}function Ta(i,r){if(1&i&&(e.\u0275\u0275i18nStart(0,1,2),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(1,"svg",21),e.\u0275\u0275i18nEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",t.icons.check)("size",t.icons.size32)}}function Fa(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"button",22),e.\u0275\u0275listener("click",function(o){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275resetView(a.click(o))}),e.\u0275\u0275elementStart(2,"span"),e.\u0275\u0275i18n(3,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(4,"svg",23),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=r.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275property("cdsButton",t.buttonKind)("title",t.name)("disabled",t.disable())("preserveFragment",t.preserveFragment?"":null),e.\u0275\u0275attribute("aria-label",t.name)("data-testid",t.name),e.\u0275\u0275advance(2),e.\u0275\u0275i18nExp(t.name),e.\u0275\u0275i18nApply(3),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",t.icon)}}let Ma=(()=>{class i{constructor(t,n,o,a){this.authStorageService=t,this.rbdMirroringService=n,this.modalService=o,this.taskWrapper=a,this.selection=new _e.y,this.peersExist=!0,this.subs=new z.Subscription,this.editing=!1,this.icons=T.FI,this.permission=this.authStorageService.getPermissions().rbdMirroring;const s={permission:"update",icon:"document--add",click:()=>this.createBootstrapModal(),name:"Create Bootstrap Token",canBePrimary:()=>!0,disable:()=>!1,buttonKind:"primary"},l={permission:"update",icon:"document--import",click:()=>this.importBootstrapModal(),name:"Import Bootstrap Token",disable:()=>!1,buttonKind:"tertiary"};this.tableActions=[s,l]}ngOnInit(){this.createForm(),this.subs.add(this.rbdMirroringService.startPolling()),this.subs.add(this.rbdMirroringService.subscribeSummary(t=>{this.status=t.content_data.status,this.peersExist=!!t.content_data.pools.find(n=>n.peer_uuids.length>0)})),this.rbdMirroringService.getSiteName().subscribe(t=>{this.siteName=t.site_name,this.rbdmirroringForm.get("siteName").setValue(this.siteName)})}createForm(){this.rbdmirroringForm=new k.$({siteName:new _.UntypedFormControl({value:"",disabled:!0})})}ngOnDestroy(){this.subs.unsubscribe()}updateSiteName(){this.editing&&this.taskWrapper.wrapTaskAroundCall({task:new h.O("rbd/mirroring/site_name/edit",{}),call:this.rbdMirroringService.setSiteName(this.rbdmirroringForm.getValue("siteName"))}).subscribe({complete:()=>{this.rbdMirroringService.refresh()}}),this.editing=!this.editing}createBootstrapModal(){this.modalRef=this.modalService.show(hi,{siteName:this.siteName})}importBootstrapModal(){this.modalRef=this.modalService.show(Di,{siteName:this.siteName})}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(j.v),e.\u0275\u0275directiveInject(me.B),e.\u0275\u0275directiveInject(ce.V),e.\u0275\u0275directiveInject(y.a))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-mirroring"]],decls:32,vars:10,consts:()=>{let t,n,o,a,s;return t="Site Name " + "\ufffd#6\ufffd" + "" + "\ufffd#7\ufffd\ufffd/#7\ufffd" + "" + "\ufffd#8\ufffd" + "" + "\ufffd*9:1\ufffd\ufffd#1:1\ufffd" + "" + "[\ufffd/#1:1\ufffd\ufffd/*9:1\ufffd|\ufffd/#1:2\ufffd\ufffd/*10:2\ufffd]" + "" + "\ufffd*10:2\ufffd\ufffd#1:2\ufffd" + "" + "[\ufffd/#1:1\ufffd\ufffd/*9:1\ufffd|\ufffd/#1:2\ufffd\ufffd/*10:2\ufffd]" + "" + "\ufffd/#8\ufffd" + "" + "\ufffd#11\ufffd" + "" + "\ufffd/#11\ufffd" + "" + "\ufffd/#6\ufffd" + "",t=e.\u0275\u0275i18nPostprocess(t),n="Daemons",o="Pools",a="Images",s="" + "\ufffd0\ufffd" + "",[["formDir","ngForm"],t,n,o,a,s,["name","rbdmirroringForm","novalidate","",3,"formGroup"],[1,"form-item"],["cdsCol","",1,"d-flex",3,"columnNumbers"],["for","siteName"],[1,"cds-input-group"],["type","text","id","siteName","name","siteName","formControlName","siteName","cdsText",""],["kind","ghost","size","md",3,"click","title"],["class","cds--btn__icon",3,"cdsIcon","size",4,"ngIf"],[3,"source","byId"],["cdsCol","{md:5}"],[1,"d-flex","flex-row-reverse","gap-3"],[4,"ngFor","ngForOf"],[1,"row"],[1,"col-sm-6"],[1,"col-md-12"],[1,"cds--btn__icon",3,"cdsIcon","size"],["type","button",3,"click","cdsButton","title","disabled","preserveFragment"],["size","16",1,"cds--btn__icon",3,"cdsIcon"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"form",6,0)(2,"div",7)(3,"div",8)(4,"cds-text-label",9),e.\u0275\u0275i18nStart(5,1),e.\u0275\u0275elementStart(6,"div",10),e.\u0275\u0275element(7,"input",11),e.\u0275\u0275elementStart(8,"cds-icon-button",12),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.updateSiteName())}),e.\u0275\u0275template(9,Ea,2,2,"svg",13)(10,Ta,2,2,"svg",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(11,"cd-copy-2-clipboard-button",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(12,"div",15)(13,"div",16),e.\u0275\u0275template(14,Fa,5,8,"ng-container",17),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(15,"div",18)(16,"div",19)(17,"legend"),e.\u0275\u0275i18n(18,2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"div"),e.\u0275\u0275element(20,"cd-mirroring-daemons"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(21,"div",19)(22,"legend"),e.\u0275\u0275i18n(23,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"div"),e.\u0275\u0275element(25,"cd-mirroring-pools"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(26,"div",18)(27,"div",20)(28,"legend"),e.\u0275\u0275i18n(29,4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(30,"div"),e.\u0275\u0275element(31,"cd-mirroring-images"),e.\u0275\u0275elementEnd()()()}2&n&&(e.\u0275\u0275property("formGroup",o.rbdmirroringForm),e.\u0275\u0275advance(3),e.\u0275\u0275property("columnNumbers",e.\u0275\u0275pureFunction0(9,Ca)),e.\u0275\u0275advance(4),e.\u0275\u0275attribute("disabled",!o.editing||null),e.\u0275\u0275advance(),e.\u0275\u0275property("title",o.editing?"Save":"Edit"),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!o.editing),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.editing),e.\u0275\u0275advance(),e.\u0275\u0275property("source",o.siteName)("byId",!1),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",o.tableActions))},dependencies:[c.NgForOf,c.NgIf,We.N,x.S,N.E,_.\u0275NgNoValidate,_.DefaultValueAccessor,_.NgControlStatus,_.NgControlStatusGroup,_.FormGroupDirective,_.FormControlName,m.TextInputLabelComponent,m.TextInput,m.ColumnDirective,m.Button,m.IconButton,m.IconDirective,Bi,Wi,fa]})}}return i})();class ha{}function Oa(i,r){if(1&i&&(e.\u0275\u0275i18nStart(0,4,1),e.\u0275\u0275element(1,"option",15),e.\u0275\u0275i18nEnd()),2&i){const t=r.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275property("value",t.id),e.\u0275\u0275i18nExp(t.name),e.\u0275\u0275i18nApply(0)}}function Ra(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",17),e.\u0275\u0275i18n(1,5),e.\u0275\u0275elementEnd())}function Ia(i,r){if(1&i&&e.\u0275\u0275template(0,Ra,2,0,"span",16),2&i){const t=e.\u0275\u0275nextContext(),n=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.editModeForm.showError("mirrorMode",n,"cannotDisable"))}}let Na=(()=>{class i extends m.BaseModal{constructor(t,n,o,a,s){super(),this.actionLabels=t,this.rbdMirroringService=n,this.taskWrapper=o,this.route=a,this.location=s,this.open=!1,this.bsConfig={containerClass:"theme-default"},this.peerExists=!1,this.mirrorModes=[{id:"disabled",name:"Disabled"},{id:"pool",name:"Pool"},{id:"image",name:"Image"}],this.createForm()}createForm(){this.editModeForm=new k.$({mirrorMode:new _.UntypedFormControl("",{validators:[_.Validators.required,this.validateMode.bind(this)]})})}ngOnInit(){this.open="modal"===this.route.outlet,this.route.params.subscribe(t=>{this.poolName=t.pool_name}),this.pattern=`${this.poolName}`,this.rbdMirroringService.getPool(this.poolName).subscribe(t=>{this.setResponse(t)}),this.subs=this.rbdMirroringService.subscribeSummary(t=>{this.peerExists=!1;const o=t.content_data.pools.find(a=>this.poolName===a.name);this.peerExists=o&&o.peer_uuids.length})}ngOnDestroy(){this.subs.unsubscribe()}validateMode(t){return"disabled"===t.value&&this.peerExists?{cannotDisable:{value:t.value}}:null}setResponse(t){this.editModeForm.get("mirrorMode").setValue(t.mirror_mode)}update(){const t=new ha;t.mirror_mode=this.editModeForm.getValue("mirrorMode"),this.taskWrapper.wrapTaskAroundCall({task:new h.O("rbd/mirroring/pool/edit",{pool_name:this.poolName}),call:this.rbdMirroringService.updatePool(this.poolName,t)}).subscribe({error:()=>this.editModeForm.setErrors({cdSubmitButton:!0}),complete:()=>{this.rbdMirroringService.refresh(),this.location.back()}})}closeModal(){this.location.back()}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(me.B),e.\u0275\u0275directiveInject(y.a),e.\u0275\u0275directiveInject(v.ActivatedRoute),e.\u0275\u0275directiveInject(c.Location))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-pool-edit-mode-modal"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:19,vars:9,consts:()=>{let t,n,o,a;return t="Edit pool mirror mode",n="To edit the mirror mode for pool\xA0 " + "[\ufffd#10\ufffd|\ufffd#11\ufffd]" + "" + "\ufffd0\ufffd" + "" + "[\ufffd/#10\ufffd|\ufffd/#11\ufffd]" + ", select a new mode from the list and click\xA0 " + "[\ufffd#10\ufffd|\ufffd#11\ufffd]" + "Update" + "[\ufffd/#10\ufffd|\ufffd/#11\ufffd]" + ".",n=e.\u0275\u0275i18nPostprocess(n),o="" + "\ufffd*15:1\ufffd\ufffd#1:1\ufffd" + "" + "\ufffd0:1\ufffd" + "" + "\ufffd/#1:1\ufffd\ufffd/*15:1\ufffd" + "",a="Peer clusters must be removed prior to disabling mirror.",[["formDir","ngForm"],["mirrorModeError",""],t,n,o,a,["size","md",3,"overlaySelected","open"],[3,"closeSelect"],["cdsModalHeaderHeading",""],["cdsModalContent",""],["name","editModeForm","novalidate","",1,"form",3,"formGroup"],[1,"form-item"],["label","Mode","for","mirrorMode","formControlName","mirrorMode","name","mirrorMode","id","mirrorMode","cdRequiredField","Mode",3,"invalid","invalidText"],[3,"value",4,"ngFor","ngForOf"],[3,"submitActionEvent","form","submitText","modalForm"],[3,"value"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-modal",6),e.\u0275\u0275listener("overlaySelected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(1,"cds-modal-header",7),e.\u0275\u0275listener("closeSelect",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(2,"h3",8),e.\u0275\u0275i18n(3,2),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"section",9)(5,"form",10,0)(7,"p"),e.\u0275\u0275elementContainerStart(8),e.\u0275\u0275i18nStart(9,3),e.\u0275\u0275element(10,"kbd")(11,"kbd"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"div",11)(13,"cds-select",12),e.\u0275\u0275i18nStart(14,4),e.\u0275\u0275template(15,Oa,2,2,"option",13),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(16,Ia,1,1,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(18,"cd-form-button-panel",14),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.update())}),e.\u0275\u0275elementEnd()()}if(2&n){const a=e.\u0275\u0275reference(17);e.\u0275\u0275property("open",o.open),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",o.editModeForm),e.\u0275\u0275advance(6),e.\u0275\u0275i18nExp(o.poolName),e.\u0275\u0275i18nApply(9),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.editModeForm.controls.mirrorMode.invalid&&o.editModeForm.controls.mirrorMode.dirty)("invalidText",a),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",o.mirrorModes),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.editModeForm)("submitText",o.actionLabels.UPDATE)("modalForm",!0)}},dependencies:[c.NgForOf,c.NgIf,F.e,N.E,he.P,_.\u0275NgNoValidate,_.NgSelectOption,_.\u0275NgSelectMultipleOption,_.NgControlStatus,_.NgControlStatusGroup,_.FormGroupDirective,_.FormControlName,m.Modal,m.ModalHeader,m.ModalContent,m.ModalHeaderHeading,m.Select,m.Option]})}}return i})();var ke=p(59870),pt=p(6107),w=p(65218),$e=p(73651),ut=p(12540);class ba{}var Je=function(i){return i[i.V1=1]="V1",i[i.V2=2]="V2",i}(Je||{});class Pa{constructor(){this.features=[]}}class Aa{constructor(){this.features=[]}}class va{}class Da extends va{constructor(){super(...arguments),this.features=[]}}class gt{constructor(){this.features=[],this.remove_scheduling=!1}}var Nt=function(i){return i.editing="editing",i.cloning="cloning",i.copying="copying",i}(Nt||{});const ne={moveToTrash:"Move an image to the trash. Images, even ones actively in-use by clones, can be moved to the trash and deleted at a later time.",delete:"Delete an rbd image (including all data blocks). If the image has snapshots, this fails and nothing is deleted.",copy:"Copy the content of a source image into the newly created destination image",flatten:"If the image is a clone, copy all shared blocks from the parent snapshot and make the child independent of the parent, severing the link between parent snap and child. ",enableMirroring:"Mirroring needs to be enabled on the image to perform this action",clonedSnapshot:"This RBD has cloned snapshots. Please delete related RBDs before deleting this RBD",secondayImageDelete:"The image cannot be deleted as it is secondary",primaryImageResync:"Primary RBD images cannot be resynced",invalidNameDisable:"This RBD image has an invalid name and can't be managed by ceph.",removingStatus:"Action not possible for an RBD in status 'Removing'",journalTooltipText:"'Ensures reliable replication by logging changes before updating the image, but doubles write time, impacting performance. Not recommended for high-speed data processing tasks.",snapshotTooltipText:"This mode replicates RBD images between clusters using snapshots, efficiently copying data changes but requiring complete delta syncing during failover. Ideal for less demanding tasks due to its less granular approach compared to journaling."};var La=p(55472),ue=p(64333),ya=p(95131),$a=p(42865),Ba=p(45413);const Ga=()=>({md:4});function xa(i,r){if(1&i&&(e.\u0275\u0275i18nStart(0,8,1),e.\u0275\u0275element(1,"div"),e.\u0275\u0275i18nEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275i18nExp(t.copyMessage),e.\u0275\u0275i18nApply(0)}}function wa(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"div",49)(1,"cds-text-label",72),e.\u0275\u0275i18nStart(2,16),e.\u0275\u0275pipe(3,"titlecase"),e.\u0275\u0275element(4,"input",73),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(3,1,t.action)),e.\u0275\u0275i18nApply(2)}}function Va(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18n(2,17),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd())}function Ha(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18n(2,18),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd())}function ka(i,r){if(1&i&&e.\u0275\u0275template(0,Va,3,0,"span",47)(1,Ha,3,0,"span",47),2&i){e.\u0275\u0275nextContext();const t=e.\u0275\u0275reference(2),n=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngIf",n.rbdForm.showError("name",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.rbdForm.showError("name",t,"pattern"))}}function Ka(i,r){1&i&&(e.\u0275\u0275elementStart(0,"cds-text-label",74),e.\u0275\u0275i18nStart(1,19),e.\u0275\u0275element(2,"input",75),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd())}function za(i,r){1&i&&(e.\u0275\u0275elementStart(0,"option",68),e.\u0275\u0275i18n(1,20),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function Xa(i,r){1&i&&(e.\u0275\u0275elementStart(0,"option",68),e.\u0275\u0275i18n(1,21),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function Ua(i,r){1&i&&(e.\u0275\u0275elementStart(0,"option",68),e.\u0275\u0275i18n(1,22),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function ja(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"option",78),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=r.$implicit;e.\u0275\u0275property("value",t.pool_name),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t.pool_name)}}function qa(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"cds-select",76),e.\u0275\u0275template(1,za,2,1,"option",77)(2,Xa,2,1,"option",77)(3,Ua,2,1,"option",77)(4,ja,2,2,"option",66),e.\u0275\u0275elementEnd()),2&i){e.\u0275\u0275nextContext();const t=e.\u0275\u0275reference(20),n=e.\u0275\u0275nextContext();e.\u0275\u0275property("invalid",!n.rbdForm.controls.pool.valid&&n.rbdForm.controls.pool.dirty)("invalidText",t),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null===n.pools),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null!==n.pools&&0===n.pools.length),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null!==n.pools&&n.pools.length>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",n.pools)}}function Qa(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,23),e.\u0275\u0275elementEnd())}function Ya(i,r){if(1&i&&e.\u0275\u0275template(0,Qa,2,0,"span",79),2&i){e.\u0275\u0275nextContext();const t=e.\u0275\u0275reference(2),n=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngIf",n.rbdForm.showError("pool",t,"required"))}}function Wa(i,r){1&i&&(e.\u0275\u0275elementStart(0,"cd-alert-panel",81),e.\u0275\u0275text(1,"Mirroring can not be disabled on "),e.\u0275\u0275elementStart(2,"b"),e.\u0275\u0275text(3,"\xa0Pool\xa0"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(4," mirror mode. You need to change the mirror mode to enable this option. "),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("showTitle",!1)}function Ja(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-alert-panel",82),e.\u0275\u0275listener("action",function(o){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.onAlertAction(o))}),e.\u0275\u0275text(1," You need to set\xa0"),e.\u0275\u0275elementStart(2,"b"),e.\u0275\u0275text(3,"mirror mode"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(4,"\xa0in the selected pool to enable mirroring. "),e.\u0275\u0275elementEnd()}2&i&&e.\u0275\u0275property("showTitle",!1)}function Za(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-radio",85),e.\u0275\u0275listener("change",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(o.setExclusiveLock())}),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"titlecase"),e.\u0275\u0275elementStart(3,"cd-helper"),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd()()}if(2&i){const t=r.$implicit,n=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("value",t.value)("id",t.value)("disabled",n.shouldDisable(t.value)),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,5,t.value)," "),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",t.text," ")}}function er(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-alert-panel",82),e.\u0275\u0275listener("action",function(o){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.onAlertAction(o))}),e.\u0275\u0275i18nStart(1,24),e.\u0275\u0275element(2,"b"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd()}2&i&&e.\u0275\u0275property("showTitle",!1)}function tr(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"div",49)(1,"cds-radio-group",83),e.\u0275\u0275template(2,Za,5,7,"cds-radio",84),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,er,3,1,"cd-alert-panel",57),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t.mirroringOptions),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","pool"===t.currentPoolMirrorMode&&"editing"!==t.mode)}}function nr(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,26),e.\u0275\u0275elementEnd())}function or(i,r){if(1&i&&e.\u0275\u0275template(0,nr,2,0,"span",79),2&i){e.\u0275\u0275nextContext(2);const t=e.\u0275\u0275reference(2),n=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngIf",n.rbdForm.showError("schedule",t,"required"))}}function ir(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"div",49)(1,"cds-text-label",86),e.\u0275\u0275i18nStart(2,25),e.\u0275\u0275element(3,"input",87),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(4,or,1,1,"ng-template",null,6,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275reference(5),n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("invalid",!n.rbdForm.controls.schedule.valid&&n.rbdForm.controls.schedule.dirty)("invalidText",t),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!1===n.peerConfigured||null)("invalid",!n.rbdForm.controls.schedule.valid&&n.rbdForm.controls.schedule.dirty)}}function ar(i,r){1&i&&(e.\u0275\u0275i18nStart(0,27,1),e.\u0275\u0275elementStart(1,"cd-helper"),e.\u0275\u0275element(2,"span"),e.\u0275\u0275elementEnd(),e.\u0275\u0275i18nEnd())}function rr(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",49)(1,"cds-checkbox",88),e.\u0275\u0275listener("change",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(o.onUseDataPoolChange())}),e.\u0275\u0275i18nStart(2,27),e.\u0275\u0275element(3,"cd-help-text"),e.\u0275\u0275template(4,ar,3,0,"cd-helper",47),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",t.allDataPools.length<=1&&"editing"!==t.mode)}}function sr(i,r){1&i&&(e.\u0275\u0275elementStart(0,"option",68),e.\u0275\u0275i18n(1,28),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function lr(i,r){1&i&&(e.\u0275\u0275elementStart(0,"option",68),e.\u0275\u0275i18n(1,29),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function _r(i,r){1&i&&(e.\u0275\u0275elementStart(0,"option",68),e.\u0275\u0275i18n(1,30),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function cr(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"option",78),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=r.$implicit;e.\u0275\u0275property("value",t.pool_name),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t.pool_name)}}function dr(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"cds-select",90),e.\u0275\u0275template(1,sr,2,1,"option",77)(2,lr,2,1,"option",77)(3,_r,2,1,"option",77)(4,cr,2,2,"option",66),e.\u0275\u0275elementEnd()),2&i){e.\u0275\u0275nextContext();const t=e.\u0275\u0275reference(3),n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("invalid",!n.rbdForm.controls.dataPool.valid&&n.rbdForm.controls.dataPool.dirty)("invalidText",t),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null===n.dataPools),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null!==n.dataPools&&0===n.dataPools.length),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null!==n.dataPools&&n.dataPools.length>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",n.dataPools)}}function mr(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,31),e.\u0275\u0275elementEnd())}function pr(i,r){if(1&i&&e.\u0275\u0275template(0,mr,2,0,"span",79),2&i){e.\u0275\u0275nextContext(2);const t=e.\u0275\u0275reference(2),n=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngIf",n.rbdForm.showError("dataPool",t,"required"))}}function ur(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"div",49),e.\u0275\u0275template(1,dr,5,6,"cds-select",89)(2,pr,1,1,"ng-template",null,7,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","editing"!==t.mode&&t.poolPermission.read)}}function gr(i,r){1&i&&(e.\u0275\u0275elementStart(0,"div",49)(1,"cds-select",91)(2,"option",68),e.\u0275\u0275i18n(3,32),e.\u0275\u0275elementEnd()()()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275property("skeleton",!0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngValue",null))}function Sr(i,r){1&i&&(e.\u0275\u0275elementStart(0,"option",68),e.\u0275\u0275i18n(1,33),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function fr(i,r){1&i&&(e.\u0275\u0275elementStart(0,"option",68),e.\u0275\u0275i18n(1,34),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function Cr(i,r){1&i&&(e.\u0275\u0275elementStart(0,"option",68),e.\u0275\u0275i18n(1,35),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function Er(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"option",78),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=r.$implicit;e.\u0275\u0275property("value",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t)}}function Tr(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"cds-select",92),e.\u0275\u0275template(1,Sr,2,1,"option",77)(2,fr,2,1,"option",77)(3,Cr,2,1,"option",77)(4,Er,2,2,"option",66),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null===t.namespaces),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null!==t.namespaces&&0===t.namespaces.length),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null!==t.namespaces&&t.namespaces.length>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",t.namespaces)}}function Fr(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,36),e.\u0275\u0275elementEnd())}function Mr(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,37),e.\u0275\u0275elementEnd())}function hr(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,38),e.\u0275\u0275elementEnd())}function Or(i,r){if(1&i&&e.\u0275\u0275template(0,Fr,2,0,"span",79)(1,Mr,2,0,"span",79)(2,hr,2,0,"span",79),2&i){e.\u0275\u0275nextContext();const t=e.\u0275\u0275reference(2),n=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngIf",n.rbdForm.showError("size",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.rbdForm.showError("size",t,"invalidSizeObject")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.rbdForm.showError("size",t,"pattern"))}}function Rr(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"cd-help-text"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t.helperText," ")}}function Ir(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"cd-alert-panel",95),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275property("showTitle",!1),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t.helperHtml," ")}}function Nr(i,r){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"cds-checkbox",93),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"titlecase"),e.\u0275\u0275template(4,Rr,2,1,"cd-help-text",47)(5,Ir,2,2,"cd-alert-panel",94),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&i){const t=r.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("id",t.key)("name",t.key)("formControlName",t.key),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,6,t.key)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",t.helperText),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.helperHtml&&!1===n.rbdForm.getValue(t.key))}}function br(i,r){if(1&i&&(e.\u0275\u0275i18nStart(0,14,1),e.\u0275\u0275element(1,"option",78),e.\u0275\u0275i18nEnd()),2&i){const t=r.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275property("value",t),e.\u0275\u0275i18nExp(t),e.\u0275\u0275i18nApply(0)}}function Pr(i,r){if(1&i&&(e.\u0275\u0275i18nStart(0,15,1),e.\u0275\u0275element(1,"option",78),e.\u0275\u0275i18nEnd()),2&i){const t=r.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275property("value",t),e.\u0275\u0275i18nExp(t),e.\u0275\u0275i18nApply(0)}}function Ar(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,39),e.\u0275\u0275elementEnd())}function vr(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,40),e.\u0275\u0275elementEnd())}function Dr(i,r){if(1&i&&e.\u0275\u0275template(0,Ar,2,0,"span",79)(1,vr,2,0,"span",79),2&i){e.\u0275\u0275nextContext();const t=e.\u0275\u0275reference(2),n=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngIf",n.rbdForm.showError("stripingUnit",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.rbdForm.showError("stripingUnit",t,"invalidStripingUnit"))}}function Lr(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,41),e.\u0275\u0275elementEnd())}function yr(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,42),e.\u0275\u0275elementEnd())}function $r(i,r){if(1&i&&e.\u0275\u0275template(0,Lr,2,0,"span",79)(1,yr,2,0,"span",79),2&i){e.\u0275\u0275nextContext();const t=e.\u0275\u0275reference(2),n=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngIf",n.rbdForm.showError("stripingCount",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.rbdForm.showError("stripingCount",t,"min"))}}function Br(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"form",45,0)(3,"div",46),e.\u0275\u0275i18nStart(4,8),e.\u0275\u0275pipe(5,"titlecase"),e.\u0275\u0275pipe(6,"upperFirst"),e.\u0275\u0275elementStart(7,"cd-help-text"),e.\u0275\u0275template(8,xa,2,1,"div",47),e.\u0275\u0275elementEnd(),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,wa,5,3,"div",48),e.\u0275\u0275elementStart(10,"div",49)(11,"cds-text-label",50),e.\u0275\u0275i18nStart(12,9),e.\u0275\u0275element(13,"input",51),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(14,ka,2,2,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div",52),e.\u0275\u0275listener("change",function(o){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.onPoolChange(o.target.value))}),e.\u0275\u0275template(17,Ka,3,0,"cds-text-label",53)(18,qa,5,6,"cds-select",54)(19,Ya,1,1,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"div",49)(22,"cds-checkbox",55),e.\u0275\u0275listener("checkedChange",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.setMirrorMode())}),e.\u0275\u0275i18nStart(23,10),e.\u0275\u0275element(24,"cd-help-text"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(25,Wa,5,1,"cd-alert-panel",56)(26,Ja,5,1,"cd-alert-panel",57),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(27,tr,4,2,"div",48)(28,ir,6,4,"div",48)(29,rr,5,1,"div",48)(30,ur,4,1,"div",48)(31,gr,4,2,"div",48),e.\u0275\u0275elementStart(32,"div",49),e.\u0275\u0275template(33,Tr,5,4,"cds-select",58),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(34,"div",49)(35,"cds-text-label",59),e.\u0275\u0275i18nStart(36,11),e.\u0275\u0275element(37,"input",60),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(38,Or,3,3,"ng-template",null,3,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(40,"cd-form-advanced-fieldset")(41,"div",61)(42,"fieldset")(43,"label",62),e.\u0275\u0275i18n(44,12),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(45,Nr,6,8,"ng-container",63),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(46,"legend",64),e.\u0275\u0275i18n(47,13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(48,"div",49)(49,"cds-select",65),e.\u0275\u0275i18nStart(50,14),e.\u0275\u0275template(51,br,2,2,"option",66),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(52,"div",49)(53,"cds-select",67),e.\u0275\u0275i18nStart(54,15),e.\u0275\u0275element(55,"option",68),e.\u0275\u0275template(56,Pr,2,2,"option",66),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(57,Dr,2,2,"ng-template",null,4,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(59,"div",49),e.\u0275\u0275element(60,"cds-number",69),e.\u0275\u0275template(61,$r,2,2,"ng-template",null,5,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(63,"cd-rbd-configuration-form",70),e.\u0275\u0275listener("changes",function(o){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.getDirtyConfigurationValues=o)}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(64,"cd-form-button-panel",71),e.\u0275\u0275pipe(65,"titlecase"),e.\u0275\u0275pipe(66,"upperFirst"),e.\u0275\u0275listener("submitActionEvent",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.submit())}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=e.\u0275\u0275reference(2),n=e.\u0275\u0275reference(15),o=e.\u0275\u0275reference(39),a=e.\u0275\u0275reference(58),s=e.\u0275\u0275reference(62),l=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("formGroup",l.rbdForm),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf","Copy"===l.action),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(5,35,l.action))(e.\u0275\u0275pipeBind1(6,37,l.resource)),e.\u0275\u0275i18nApply(4),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",l.rbdForm.getValue("parent")),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",!l.rbdForm.controls.name.valid&&l.rbdForm.controls.name.dirty)("invalidText",n),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",!l.rbdForm.controls.name.valid&&l.rbdForm.controls.name.dirty),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf","editing"===l.mode||!l.poolPermission.read),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","editing"!==l.mode&&l.poolPermission.read),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",l.showMirrorDisableMessage),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","disabled"===l.currentPoolMirrorMode),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",l.mirroring&&"disabled"!==l.currentPoolMirrorMode),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","snapshot"===l.rbdForm.getValue("mirroringMode")&&l.mirroring),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",l.allDataPools.length>1||"editing"===l.mode),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",l.rbdForm.getValue("useDataPool")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","editing"!==l.mode&&l.rbdForm.getValue("pool")&&null===l.namespaces),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf","editing"===l.mode&&l.rbdForm.getValue("namespace")||"editing"!==l.mode&&(l.namespaces&&l.namespaces.length>0||!l.poolPermission.read)),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",!l.rbdForm.controls.size.valid&&l.rbdForm.controls.size.dirty)("invalidText",o),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",!l.rbdForm.controls.size.valid&&l.rbdForm.controls.size.dirty),e.\u0275\u0275advance(8),e.\u0275\u0275property("ngForOf",l.featuresList),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",l.objectSizes),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",!l.rbdForm.controls.stripingUnit.valid&&l.rbdForm.controls.stripingUnit.dirty)("invalidText",a),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngValue",null),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",l.objectSizes),e.\u0275\u0275advance(4),e.\u0275\u0275property("min",1)("invalid",!l.rbdForm.controls.stripingCount.valid&&l.rbdForm.controls.stripingCount.dirty)("invalidText",s)("required",!0),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",l.rbdForm)("initializeData",l.initializeConfigData),e.\u0275\u0275advance(),e.\u0275\u0275property("form",t)("submitText",e.\u0275\u0275pipeBind1(65,39,l.action)+" "+e.\u0275\u0275pipeBind1(66,41,l.resource))}}let Ke=(()=>{class i extends Ge.g{constructor(t,n,o,a,s,l,d,u,f,M){super(),this.authStorageService=t,this.route=n,this.poolService=o,this.rbdService=a,this.formatter=s,this.taskWrapper=l,this.dimlessBinaryPipe=d,this.actionLabels=u,this.router=f,this.rbdMirroringService=M,this.namespaces=[],this.namespacesByPoolCache={},this.pools=null,this.allPools=null,this.dataPools=null,this.allDataPools=[],this.featuresList=[],this.initializeConfigData=new z.ReplaySubject(1),this.peerConfigured=!1,this.advancedEnabled=!1,this.rbdFormMode=Nt,this.defaultObjectSize="4 MiB",this.mirroringOptions=[{value:"journal",text:ne.journalTooltipText},{value:"snapshot",text:ne.snapshotTooltipText}],this.mirroring=!1,this.currentPoolName="",this.currentPoolMirrorMode="",this.copyMessage=ne.copy,this.objectSizes=["4 KiB","8 KiB","16 KiB","32 KiB","64 KiB","128 KiB","256 KiB","512 KiB","1 MiB","2 MiB","4 MiB","8 MiB","16 MiB","32 MiB"],this.defaultStripingUnit="4 MiB",this.defaultStripingCount=1,this.rbdImage=new z.ReplaySubject(1),this.icons=T.FI,this.currentImageMirrorMode="",this.showMirrorDisableMessage=!1,this.routerUrl=this.router.url,this.poolPermission=this.authStorageService.getPermissions().pool,this.resource="Image",this.features={"deep-flatten":{desc:"Deep flatten",requires:null,allowEnable:!1,allowDisable:!0,helperHtml:"Feature can be disabled but can't be re-enabled later",helperText:"Speeds up the process of deleting a clone by removing the dependency on the parent image."},layering:{desc:"Layering",requires:null,allowEnable:!1,allowDisable:!1,helperHtml:"Feature flag can't be manipulated after the image is created. Disabling this option will also disable the Protect and Clone actions on Snapshot",helperText:"Allows the creation of snapshots and clones of an image."},"exclusive-lock":{desc:"Exclusive lock",requires:null,allowEnable:!0,allowDisable:!0,helperText:"Ensures that only one client can write to the image at a time."},"object-map":{desc:"Object map (requires exclusive-lock)",requires:"exclusive-lock",allowEnable:!0,allowDisable:!0,initDisabled:!0,helperText:"Tracks which objects actually exist (have data stored on a device). Enabling object map support speeds up I/O operations for cloning, importing and exporting a sparsely populated image, and deleting."},"fast-diff":{desc:"Fast diff (interlocked with object-map)",requires:"object-map",allowEnable:!0,allowDisable:!0,interlockedWith:"object-map",initDisabled:!0,helperText:"Speeds up the process of comparing two images."}},this.featuresList=this.objToArray(this.features),this.createForm()}objToArray(t){return C().map(t,(n,o)=>Object.assign(n,{key:o}))}createForm(){this.rbdForm=new k.$({parent:new _.UntypedFormControl(""),name:new _.UntypedFormControl("",{validators:[_.Validators.required,_.Validators.pattern(/^[^@/]+?$/)]}),pool:new _.UntypedFormControl(null,{validators:[_.Validators.required]}),namespace:new _.UntypedFormControl(null),useDataPool:new _.UntypedFormControl(!1),dataPool:new _.UntypedFormControl(null),size:new _.UntypedFormControl(null,{updateOn:"blur"}),obj_size:new _.UntypedFormControl(this.defaultObjectSize),features:new k.$(this.featuresList.reduce((t,n)=>(t[n.key]=new _.UntypedFormControl({value:!1,disabled:!!n.initDisabled}),t),{})),mirroring:new _.UntypedFormControl(!1),schedule:new _.UntypedFormControl("",{validators:[_.Validators.pattern(/^([0-9]+)d|([0-9]+)h|([0-9]+)m$/),I.xQ.requiredIf({mirroringMode:"snapshot",mirroring:!0})]}),mirroringMode:new _.UntypedFormControl(""),stripingUnit:new _.UntypedFormControl(this.defaultStripingUnit),stripingCount:new _.UntypedFormControl(this.defaultStripingCount,{updateOn:"blur"})},this.validateRbdForm(this.formatter))}disableForEdit(){this.rbdForm.get("parent").disable(),this.rbdForm.get("pool").disable(),this.rbdForm.get("namespace").disable(),this.rbdForm.get("useDataPool").disable(),this.rbdForm.get("dataPool").disable(),this.rbdForm.get("obj_size").disable(),this.rbdForm.get("stripingUnit").disable(),this.rbdForm.get("stripingCount").disable(),this.rbdImage.subscribe(t=>{t.image_format===Je.V1?(this.rbdForm.get("deep-flatten").disable(),this.rbdForm.get("layering").disable(),this.rbdForm.get("exclusive-lock").disable()):(this.rbdForm.get("deep-flatten").value||this.rbdForm.get("deep-flatten").disable(),this.rbdForm.get("layering").disable())})}disableForClone(){this.rbdForm.get("parent").disable(),this.rbdForm.get("size").disable()}disableForCopy(){this.rbdForm.get("parent").disable(),this.rbdForm.get("size").disable()}ngOnInit(){this.prepareFormForAction(),this.gatherNeededData().subscribe(this.handleExternalData.bind(this))}setExclusiveLock(){this.mirroring&&"journal"===this.rbdForm.get("mirroringMode").value?(this.rbdForm.get("exclusive-lock").setValue(!0),this.rbdForm.get("exclusive-lock").disable()):this.rbdForm.get("exclusive-lock").enable()}setMirrorMode(){this.mirroring=!this.mirroring,this.mirroring&&this.rbdForm.get("mirroringMode").setValue(this.mirroringOptions[0].value),this.setExclusiveLock(),this.checkPeersConfigured()}checkPeersConfigured(t){var n=t||this.rbdForm.get("pool").value;this.rbdMirroringService.getPeerForPool(n).subscribe(o=>{o.length>0&&(this.peerConfigured=!0)})}setPoolMirrorMode(){this.currentPoolName=this.mode===this.rbdFormMode.editing?this.response?.pool_name:this.rbdForm.getValue("pool"),this.currentPoolName?(this.rbdMirroringService.refresh(),this.rbdMirroringService.subscribeSummary(t=>{const n=t.content_data.pools.find(o=>o.name===this.currentPoolName);this.currentPoolMirrorMode=n.mirror_mode,this.mode===this.rbdFormMode.editing?(this.showMirrorDisableMessage="pool"===this.currentPoolMirrorMode,"image"!==this.currentPoolMirrorMode&&(this.rbdForm.get("mirroring").disable(),this.rbdForm.get("mirroringMode").disable())):"disabled"===n.mirror_mode?(this.mirroring=!1,this.rbdForm.get("mirroring").setValue(this.mirroring),this.rbdForm.get("mirroring").disable()):(this.mirroring=!0,this.rbdForm.get("mirroring").enable(),this.rbdForm.get("mirroring").setValue(this.mirroring),this.rbdForm.get("mirroringMode").setValue(this.mirroringOptions[0].value))})):this.mode!==this.rbdFormMode.editing&&this.rbdForm.get("mirroring").disable(),this.setExclusiveLock()}prepareFormForAction(){const t=this.routerUrl;t.startsWith("/block/rbd/edit")?(this.mode=this.rbdFormMode.editing,this.action=this.actionLabels.EDIT,this.disableForEdit()):t.startsWith("/block/rbd/clone")?(this.mode=this.rbdFormMode.cloning,this.disableForClone(),this.action=this.actionLabels.CLONE):t.startsWith("/block/rbd/copy")?(this.mode=this.rbdFormMode.copying,this.action=this.actionLabels.COPY,this.disableForCopy()):this.action=this.actionLabels.CREATE,C().each(this.features,n=>{this.rbdForm.get("features").get(n.key).valueChanges.subscribe(o=>this.featureFormUpdate(n.key,o))})}gatherNeededData(){const t={};return this.mode?this.route.params.subscribe(n=>{const o=w.J.fromString(decodeURIComponent(n.image_spec));n.snap&&(this.snapName=decodeURIComponent(n.snap)),t.rbd=this.rbdService.get(o),this.checkPeersConfigured(o.poolName)}):t.defaultFeatures=this.rbdService.defaultFeatures(),this.mode!==this.rbdFormMode.editing&&this.poolPermission.read&&(t.pools=this.poolService.list(["pool_name","type","flags_names","application_metadata"])),(0,z.forkJoin)(t)}handleExternalData(t){if(this.handlePoolData(t.pools),this.setPoolMirrorMode(),t.defaultFeatures&&this.setFeatures(t.defaultFeatures),t.rbd){const n=t.rbd;this.setResponse(n,this.snapName),this.rbdImage.next(n)}this.loadingReady()}handlePoolData(t){if(!t)return;const n=[],o=[];for(const a of t)this.rbdService.isRBDPool(a)&&("replicated"===a.type?(n.push(a),o.push(a)):"erasure"===a.type&&-1!==a.flags_names.indexOf("ec_overwrites")&&o.push(a));if(this.pools=n,this.allPools=n,this.dataPools=o,this.allDataPools=o,this.pools.length>=1){const s=this.pools.map(l=>l.pool_name).includes("rbd")?"rbd":this.pools[0].pool_name;this.rbdForm.get("pool").setValue(s),this.onPoolChange(s)}this.allDataPools.length<=1&&this.rbdForm.get("useDataPool").disable()}onPoolChange(t){const n=this.rbdForm.get("dataPool");n.value===t&&n.setValue(null),this.dataPools=this.allDataPools?this.allDataPools.filter(o=>o.pool_name!==t):[],this.namespaces=null,t in this.namespacesByPoolCache?this.namespaces=this.namespacesByPoolCache[t]:this.rbdService.listNamespaces(t).subscribe(o=>{o=o.map(a=>a.namespace),this.namespacesByPoolCache[t]=o,this.namespaces=o}),this.rbdForm.get("namespace").setValue(null)}onUseDataPoolChange(){this.rbdForm.getValue("useDataPool")||(this.rbdForm.get("dataPool").setValue(null),this.onDataPoolChange(null))}onDataPoolChange(t){const n=this.allPools.filter(o=>o.pool_name!==t);this.rbdForm.getValue("pool")===t&&this.rbdForm.get("pool").setValue(null),this.pools=n}validateRbdForm(t){return n=>{const o=n.get("useDataPool"),a=n.get("dataPool");let s=null;o.value&&null==a.value&&(s={required:!0}),a.setErrors(s);const l=n.get("size"),d=n.get("obj_size"),u=t.toBytes(null!=d.value?d.value:this.defaultObjectSize),f=n.get("stripingCount"),M=null!=f.value?f.value:this.defaultStripingCount;let E=null;null===l.value?E={required:!0}:M*u>=t.toBytes(l.value)&&(E={invalidSizeObject:!0}),l.setErrors(E);const b=n.get("stripingUnit");let D=null;null===b.value&&null!==f.value?D={required:!0}:null!==b.value&&t.toBytes(b.value)>u&&(D={invalidStripingUnit:!0}),b.setErrors(D);let B=null;return null===f.value&&null!==b.value?B={required:!0}:M<1&&(B={min:!0}),f.setErrors(B),null}}deepBoxCheck(t,n){this.getDependentChildFeatures(t).forEach(a=>{const s=this.rbdForm.get(a.key);n?s.enable({emitEvent:!1}):(s.disable({emitEvent:!1}),s.setValue(!1,{emitEvent:!1}),this.deepBoxCheck(a.key,n));const l=this.rbdForm.get("features");this.mode===this.rbdFormMode.editing&&l.get(a.key).enabled&&(-1!==this.response.features_name.indexOf(a.key)&&!a.allowDisable||-1===this.response.features_name.indexOf(a.key)&&!a.allowEnable)&&l.get(a.key).disable()})}getDependentChildFeatures(t){return C().filter(this.features,n=>n.requires===t)||[]}interlockCheck(t,n){const o=this.featuresList.find(a=>a.key===t);if(this.response){const a=null!=o.interlockedWith,s=this.featuresList.find(d=>d.interlockedWith===o.key),l=!!this.response.features_name.find(d=>d===o.key);if(a){if(l!==!!this.response.features_name.find(u=>u===o.interlockedWith))return}else if(s&&!!this.response.features_name.find(u=>u===s.key)!==l)return}n?C().filter(this.features,a=>a.interlockedWith===t).forEach(a=>this.rbdForm.get(a.key).setValue(!0,{emitEvent:!1})):o.interlockedWith&&this.rbdForm.get("features").get(o.interlockedWith).setValue(!1)}featureFormUpdate(t,n){if(n){const o=this.features[t].requires;if(o&&!this.rbdForm.getValue(o))return void this.rbdForm.get(`features.${t}`).setValue(!1)}this.deepBoxCheck(t,n),this.interlockCheck(t,n)}setFeatures(t){const n=this.rbdForm.get("features");C().forIn(this.features,o=>{-1!==t.indexOf(o.key)&&n.get(o.key).setValue(!0),this.featureFormUpdate(o.key,n.get(o.key).value)})}setResponse(t,n){this.response=t;const o=new w.J(t.pool_name,t.namespace,t.name).toString();if(this.mode===this.rbdFormMode.cloning)this.rbdForm.get("parent").setValue(`${o}@${n}`);else if(this.mode===this.rbdFormMode.copying)n?this.rbdForm.get("parent").setValue(`${o}@${n}`):this.rbdForm.get("parent").setValue(`${o}`);else if(t.parent){const a=t.parent;this.rbdForm.get("parent").setValue(`${a.pool_name}/${a.image_name}@${a.snap_name}`)}this.mode===this.rbdFormMode.editing&&(this.rbdForm.get("name").setValue(t.name),"snapshot"===t?.mirror_mode||t.features_name.includes("journaling")?(this.mirroring=!0,this.rbdForm.get("mirroring").setValue(this.mirroring),this.rbdForm.get("mirroringMode").setValue(t?.mirror_mode),this.currentImageMirrorMode=t?.mirror_mode,this.rbdForm.get("schedule").setValue(t?.schedule_interval)):(this.mirroring=!1,this.rbdForm.get("mirroring").setValue(this.mirroring)),this.setPoolMirrorMode()),this.rbdForm.get("pool").setValue(t.pool_name),this.onPoolChange(t.pool_name),this.rbdForm.get("namespace").setValue(t.namespace),t.data_pool&&(this.rbdForm.get("useDataPool").setValue(!0),this.rbdForm.get("dataPool").setValue(t.data_pool)),this.rbdForm.get("size").setValue(this.dimlessBinaryPipe.transform(t.size)),this.rbdForm.get("obj_size").setValue(this.dimlessBinaryPipe.transform(t.obj_size)),this.setFeatures(t.features_name),this.rbdForm.get("stripingUnit").setValue(this.dimlessBinaryPipe.transform(t.stripe_unit)),this.rbdForm.get("stripingCount").setValue(t.stripe_count),this.initializeConfigData.next({initialData:this.response.configuration,sourceType:pt.M.image})}createRequest(){const t=new Da;return t.pool_name=this.rbdForm.getValue("pool"),t.namespace=this.rbdForm.getValue("namespace"),t.name=this.rbdForm.getValue("name"),t.schedule_interval=this.rbdForm.getValue("schedule"),t.size=this.formatter.toBytes(this.rbdForm.getValue("size")),this.addObjectSizeAndStripingToRequest(t),t.configuration=this.getDirtyConfigurationValues(),this.mirroring&&"image"===this.currentPoolMirrorMode&&(t.mirror_mode=this.rbdForm.getValue("mirroringMode")),t}addObjectSizeAndStripingToRequest(t){t.obj_size=this.formatter.toBytes(this.rbdForm.getValue("obj_size")),C().forIn(this.features,n=>{this.rbdForm.getValue(n.key)&&t.features.push(n.key)}),this.mirroring&&"journal"===this.rbdForm.getValue("mirroringMode")&&t.features.push("journaling"),t.stripe_unit=this.formatter.toBytes(this.rbdForm.getValue("stripingUnit")),t.stripe_count=this.rbdForm.getValue("stripingCount"),t.data_pool=this.rbdForm.getValue("dataPool")}createAction(){const t=this.createRequest();return this.taskWrapper.wrapTaskAroundCall({task:new h.O("rbd/create",{pool_name:t.pool_name,namespace:t.namespace,image_name:t.name,schedule_interval:t.schedule_interval,start_time:t.start_time,mirror_mode:t.mirror_mode}),call:this.rbdService.create(t)})}editRequest(){const t=new gt;if(t.name=this.rbdForm.getValue("name"),t.schedule_interval=this.rbdForm.getValue("schedule"),t.enable_mirror=this.mirroring,t.size=this.formatter.toBytes(this.rbdForm.getValue("size")),C().forIn(this.features,n=>{this.rbdForm.getValue(n.key)&&t.features.push(n.key)}),t.enable_mirror)t.image_mirror_mode=this.currentImageMirrorMode,"journal"===this.rbdForm.getValue("mirroringMode")&&(t.mirror_mode="journal",t.features.push("journaling")),"image"===this.currentPoolMirrorMode&&(t.mirror_mode=this.rbdForm.getValue("mirroringMode"));else{const n=t.features.indexOf("journaling",0);n>-1&&t.features.splice(n,1)}return t.configuration=this.getDirtyConfigurationValues(),t}cloneRequest(){const t=new Pa;return t.child_pool_name=this.rbdForm.getValue("pool"),t.child_namespace=this.rbdForm.getValue("namespace"),t.child_image_name=this.rbdForm.getValue("name"),this.addObjectSizeAndStripingToRequest(t),t.configuration=this.getDirtyConfigurationValues(!0,pt.M.image),t}editAction(){const t=new w.J(this.response.pool_name,this.response.namespace,this.response.name);return this.taskWrapper.wrapTaskAroundCall({task:new h.O("rbd/edit",{image_spec:t.toString()}),call:this.rbdService.update(t,this.editRequest())})}cloneAction(){const t=this.cloneRequest(),n=new w.J(this.response.pool_name,this.response.namespace,this.response.name);return this.taskWrapper.wrapTaskAroundCall({task:new h.O("rbd/clone",{parent_image_spec:n.toString(),parent_snap_name:this.snapName,child_pool_name:t.child_pool_name,child_namespace:t.child_namespace,child_image_name:t.child_image_name}),call:this.rbdService.cloneSnapshot(n,this.snapName,t)})}copyRequest(){const t=new Aa;return this.snapName&&(t.snapshot_name=this.snapName),t.dest_pool_name=this.rbdForm.getValue("pool"),t.dest_namespace=this.rbdForm.getValue("namespace"),t.dest_image_name=this.rbdForm.getValue("name"),this.addObjectSizeAndStripingToRequest(t),t.configuration=this.getDirtyConfigurationValues(!0,pt.M.image),t}copyAction(){const t=this.copyRequest(),n=new w.J(this.response.pool_name,this.response.namespace,this.response.name);return this.taskWrapper.wrapTaskAroundCall({task:new h.O("rbd/copy",{src_image_spec:n.toString(),dest_pool_name:t.dest_pool_name,dest_namespace:t.dest_namespace,dest_image_name:t.dest_image_name}),call:this.rbdService.copy(n,t)})}shouldDisable(t){return"pool"===this.currentPoolMirrorMode&&"snapshot"===t||null}submit(){this.mode||this.rbdImage.next("create"),this.rbdImage.pipe((0,Me.first)(),(0,Me.switchMap)(()=>this.mode===this.rbdFormMode.editing?this.editAction():this.mode===this.rbdFormMode.cloning?this.cloneAction():this.mode===this.rbdFormMode.copying?this.copyAction():this.createAction())).subscribe(()=>{},()=>this.rbdForm.setErrors({cdSubmitButton:!0}),()=>this.router.navigate(["/block/rbd"]))}onAlertAction(){this.router.navigate(["/block/mirroring",{outlets:{modal:["edit",this.rbdForm.getValue("pool")]}}])}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(j.v),e.\u0275\u0275directiveInject(v.ActivatedRoute),e.\u0275\u0275directiveInject(ke.m),e.\u0275\u0275directiveInject(U.U),e.\u0275\u0275directiveInject(ut.k),e.\u0275\u0275directiveInject(y.a),e.\u0275\u0275directiveInject($e.l),e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(v.Router),e.\u0275\u0275directiveInject(me.B))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-rbd-form"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:3,consts:()=>{let t,n,o,a,s,l,d,u,f,M,E,b,D,B,V,oe,ie,ae,H,ge,P,Oe,Re,Ie,Ne,be,Pe,Ae,ve,$,Xe,Ue,je,qe,Qe;return t="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + " " + "\ufffd#7\ufffd" + "" + "\ufffd*8:1\ufffd\ufffd#1:1\ufffd" + "" + "\ufffd0:1\ufffd" + " " + "\ufffd/#1:1\ufffd\ufffd/*8:1\ufffd" + "" + "\ufffd/#7\ufffd" + "",n="Name " + "\ufffd#13\ufffd\ufffd/#13\ufffd" + "",o="Mirroring " + "\ufffd#24\ufffd" + "Allow data to be asynchronously mirrored between two Ceph clusters" + "\ufffd/#24\ufffd" + "",a="Size " + "\ufffd#37\ufffd\ufffd/#37\ufffd" + "",s="Features",l="Striping",d="" + "\ufffd*51:1\ufffd\ufffd#1:1\ufffd" + "" + "\ufffd0:1\ufffd" + "" + "\ufffd/#1:1\ufffd\ufffd/*51:1\ufffd" + "",u="" + "\ufffd#55\ufffd" + "-- Select stripe unit --" + "[\ufffd/#55\ufffd|\ufffd/#1:1\ufffd\ufffd/*56:1\ufffd]" + "" + "\ufffd*56:1\ufffd\ufffd#1:1\ufffd" + "" + "\ufffd0:1\ufffd" + "" + "[\ufffd/#55\ufffd|\ufffd/#1:1\ufffd\ufffd/*56:1\ufffd]" + "",u=e.\u0275\u0275i18nPostprocess(u),f="" + "\ufffd0\ufffd" + " from " + "\ufffd#4\ufffd\ufffd/#4\ufffd" + "",M="This field is required.",E="'/' and '@' are not allowed.",b="Pool " + "\ufffd#2\ufffd\ufffd/#2\ufffd" + "",D="Loading...",B="-- No block pools available --",V="-- Select a pool --",oe="This field is required.",ie=" You need to set mode as\xA0" + "\ufffd#2\ufffd" + "Image" + "\ufffd/#2\ufffd" + "\xA0in the selected pool to enable snapshot mirroring. ",ae="Schedule Interval " + "\ufffd#3\ufffd\ufffd/#3\ufffd" + "",H="This field is required.",ge=" Use a dedicated data pool " + "\ufffd#3\ufffd" + "Use a dedicated pool to store the image data. If not selected, the image data will be stored in the same pool as the image metadata. " + "\ufffd/#3\ufffd" + "" + "\ufffd*4:1\ufffd\ufffd#1:1\ufffd" + "" + "\ufffd#2:1\ufffd" + "You need more than one pool with the rbd application label use to use a dedicated data pool." + "\ufffd/#2:1\ufffd" + "" + "\ufffd/#1:1\ufffd\ufffd/*4:1\ufffd" + "",P="Loading...",Oe="-- No data pools available --",Re="-- Select a data pool --",Ie="This field is required.",Ne="Loading...",be="Loading...",Pe="-- No namespaces available --",Ae="-- Select a namespace --",ve="This field is required.",$="You have to increase the size.",Xe="Size must be a number or in a valid format. eg: 5 GiB",Ue="This field is required because stripe count is defined!",je="Stripe unit is greater than object size.",qe="This field is required because stripe unit is defined!",Qe="Stripe count must be greater than 0.",[["formDir","ngForm"],["nameError",""],["poolError",""],["sizeError",""],["stripingUnitError",""],["stripingCountError",""],["scheduleError",""],["dataPoolError",""],t,n,o,a,s,l,d,u,f,M,E,b,D,B,V,oe,ie,ae,H,ge,P,Oe,Re,Ie,Ne,be,Pe,Ae,ve,$,Xe,Ue,je,qe,Qe,["cdsCol","",3,"columnNumbers"],[4,"cdFormLoading"],["name","rbdForm","novalidate","",3,"formGroup"],[1,"form-header"],[4,"ngIf"],["class","form-item",4,"ngIf"],[1,"form-item"],["for","name","cdRequiredField","Name",3,"invalid","invalidText"],["cdsText","","type","text","placeholder","Name...","id","name","name","name","formControlName","name","autofocus","",3,"invalid"],[1,"form-item",3,"change"],["for","pool",4,"ngIf"],["label","Pool","for","pool","name","pool","id","pool","formControlName","pool","cdRequiredField","Pool",3,"invalid","invalidText",4,"ngIf"],["id","mirroring","name","mirroring","formControlName","mirroring",3,"checkedChange"],["spacingClass","mt-2","type","info",3,"showTitle",4,"ngIf"],["type","info","spacingClass","mt-2","actionName","Set mode",3,"showTitle","action",4,"ngIf"],["label","Namespace","helperText","Namespace allows you to logically group RBD images within your Ceph Cluster.Choosing a namespace makes it easier to locate and manage related RBD images efficiently","for","namespace","name","namespace","id","namespace","formControlName","namespace",4,"ngIf"],["for","size","cdRequiredField","Size",3,"invalid","invalidText"],["cdsText","","type","text","placeholder","e.g., 10GiB","id","size","name","size","formControlName","size","defaultUnit","GiB","cdDimlessBinary","",3,"invalid"],["formGroupName","features",1,"form-item"],["for","features",1,"cds--label"],[4,"ngFor","ngForOf"],[1,"cd-header"],["for","obj_size","label","Object size","helperText","Objects in the Ceph Storage Cluster have a maximum configurable size (e.g., 2MB, 4MB, etc.). The object size should be large enough to accommodate many stripe units, and should be a multiple of the stripe unit.","id","obj_size","name","obj_size","formControlName","obj_size"],[3,"value",4,"ngFor","ngForOf"],["for","stripingUnit","label","Stripe unit","helperText","Stripes have a configurable unit size (e.g., 64kb). The Ceph Client divides the data it will write to objects into equally sized stripe units, except for the last stripe unit. A stripe width, should be a fraction of the Object Size so that an object may contain many stripe units","id","stripingUnit","name","stripingUnit","formControlName","stripingUnit","cdRequiredField","Striping Unit",3,"invalid","invalidText"],[3,"ngValue"],["for","stripingCount","label","Stripe count","helperText","The Ceph Client writes a sequence of stripe units over a series of objects determined by the stripe count. The series of objects is called an object set. After the Ceph Client writes to the last object in the object set, it returns to the first object in the object set.","id","stripingCount","name","stripingCount","formControlName","stripingCount","cdRequiredField","Striping Count",3,"min","invalid","invalidText","required"],[3,"changes","form","initializeData"],["wrappingClass","text-right",3,"submitActionEvent","form","submitText"],["for","parent"],["cdsText","","type","text","id","parent","name","parent","formControlName","parent","autofocus",""],["for","pool"],["cdsText","","type","text","placeholder","Pool name...","id","pool","name","pool","formControlName","pool"],["label","Pool","for","pool","name","pool","id","pool","formControlName","pool","cdRequiredField","Pool",3,"invalid","invalidText"],[3,"ngValue",4,"ngIf"],[3,"value"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"],["spacingClass","mt-2","type","info",3,"showTitle"],["type","info","spacingClass","mt-2","actionName","Set mode",3,"action","showTitle"],["formControlName","mirroringMode","name","mirroringMode"],[3,"value","id","disabled","change",4,"ngFor","ngForOf"],[3,"change","value","id","disabled"],["for","schedule","helperText","Create Mirror-Snapshots automatically on a periodic basis. The interval can be specified in days, hours, or minutes using d, h, m suffix respectively. To create mirror snapshots, you must import or create and have available peers to mirror","cdRequiredField","Schedule Interval",3,"invalid","invalidText"],["cdsText","","type","text","placeholder","e.g., 12h or 1d or 10m","id","schedule","name","schedule","formControlName","schedule",3,"disabled","invalid"],["id","useDataPool","name","useDataPool","formControlName","useDataPool",3,"change"],["label","Data pool","helperText","Dedicated pool that stores the object-data of the RBD","for","dataPool","name","dataPool","id","dataPool","formControlName","dataPool","cdRequiredField","Data pool",3,"invalid","invalidText",4,"ngIf"],["label","Data pool","helperText","Dedicated pool that stores the object-data of the RBD","for","dataPool","name","dataPool","id","dataPool","formControlName","dataPool","cdRequiredField","Data pool",3,"invalid","invalidText"],["label","Namespace","for","namespace","name","namespace","id","namespace","formControlName","namespace",3,"skeleton"],["label","Namespace","helperText","Namespace allows you to logically group RBD images within your Ceph Cluster.Choosing a namespace makes it easier to locate and manage related RBD images efficiently","for","namespace","name","namespace","id","namespace","formControlName","namespace"],[1,"spacing-03",3,"id","name","formControlName"],["type","warning","spacingClass","mt-2",3,"showTitle",4,"ngIf"],["type","warning","spacingClass","mt-2",3,"showTitle"]]},template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"div",43),e.\u0275\u0275template(1,Br,67,43,"ng-container",44),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275property("columnNumbers",e.\u0275\u0275pureFunction0(2,Ga)),e.\u0275\u0275advance(),e.\u0275\u0275property("cdFormLoading",o.loading))},dependencies:[c.NgForOf,c.NgIf,_.\u0275NgNoValidate,_.NgSelectOption,_.\u0275NgSelectMultipleOption,_.DefaultValueAccessor,_.NgControlStatus,_.NgControlStatusGroup,_.RequiredValidator,_.FormGroupDirective,_.FormControlName,_.FormGroupName,La.m,we.m,F.e,ue.O,ya.e,ye.B,$a.Y,Mt.G,x.S,N.E,he.P,m.TextInputLabelComponent,m.TextInput,m.ColumnDirective,m.Checkbox,m.Radio,m.RadioGroup,m.Select,m.Option,m.NumberComponent,Ba.c,c.TitleCasePipe,Le.r]})}}return i})();var bt=p(3912),St=p(34177),Gr=p(54980),ft=p(2361),xr=p(89939),Be=p.n(xr),Ze=p(43808),wr=p(41861);function Vr(i,r){1&i&&(e.\u0275\u0275elementStart(0,"cd-alert-panel",17)(1,"span"),e.\u0275\u0275i18n(2,4),e.\u0275\u0275elementEnd()())}function Hr(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",20),e.\u0275\u0275i18n(1,5),e.\u0275\u0275elementEnd())}function kr(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",20),e.\u0275\u0275i18n(1,6),e.\u0275\u0275elementEnd())}function Kr(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"div",13),e.\u0275\u0275element(1,"cd-date-time-picker",18),e.\u0275\u0275template(2,Hr,2,0,"span",19)(3,kr,2,0,"span",19),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(),n=e.\u0275\u0275reference(6);e.\u0275\u0275advance(),e.\u0275\u0275property("control",t.moveForm.get("expiresAt")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.moveForm.showError("expiresAt",n,"format")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.moveForm.showError("expiresAt",n,"expired"))}}let zr=(()=>{class i extends m.BaseModal{constructor(t,n,o,a,s,l,d,u){super(),this.rbdService=t,this.actionLabels=n,this.fb=o,this.taskWrapper=a,this.poolName=s,this.namespace=l,this.imageName=d,this.hasSnapshots=u,this.setExpirationDate=!1,this.createForm()}createForm(){this.moveForm=this.fb.group({expiresAt:["",[I.xQ.custom("format",t=>!(""===t||Be()(t,"YYYY-MM-DD HH:mm:ss").isValid())),I.xQ.custom("expired",t=>Be()().isAfter(t))]],setExpiry:[!1]})}ngOnInit(){this.imageSpec=new w.J(this.poolName,this.namespace,this.imageName),this.imageSpecStr=this.imageSpec.toString(),this.pattern=`${this.poolName}/${this.imageName}`}moveImage(){let t=0;const n=this.moveForm.getValue("expiresAt");n&&(t=Be()(n,"YYYY-MM-DD HH:mm:ss").diff(Be()(),"seconds",!0)),t<0&&(t=0),this.taskWrapper.wrapTaskAroundCall({task:new h.O("rbd/trash/move",{image_spec:this.imageSpecStr}),call:this.rbdService.moveTrash(this.imageSpec,t)}).subscribe({complete:()=>{this.closeModal()}})}toggleExpiration(){this.setExpirationDate=!this.setExpirationDate,this.setExpirationDate||(this.moveForm.get("expiresAt").setValue(""),this.moveForm.get("expiresAt").markAsPristine(),this.moveForm.get("expiresAt").updateValueAndValidity())}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(U.U),e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(Ze.$),e.\u0275\u0275directiveInject(y.a),e.\u0275\u0275directiveInject("poolName"),e.\u0275\u0275directiveInject("namespace"),e.\u0275\u0275directiveInject("imageName"),e.\u0275\u0275directiveInject("hasSnapshots"))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-rbd-trash-move-modal"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:17,vars:8,consts:()=>{let t,n,o,a,s,l,d;return t="Move an image to trash",n="To move " + "[\ufffd#10\ufffd|\ufffd#11\ufffd]" + "" + "\ufffd0\ufffd" + "" + "[\ufffd/#10\ufffd|\ufffd/#11\ufffd]" + " to trash, click " + "[\ufffd#10\ufffd|\ufffd#11\ufffd]" + "Move" + "[\ufffd/#10\ufffd|\ufffd/#11\ufffd]" + ". Optionally, you can pick an expiration date.",n=e.\u0275\u0275i18nPostprocess(n),o="Set expiration date",a="This image contains snapshot(s), which will prevent it from being removed after moved to trash.",s="Protection expires at",l="Wrong date format. Please use \"YYYY-MM-DD HH:mm:ss\".",d="Protection has already expired. Please pick a future date or leave it empty.",[["formDir","ngForm"],t,n,o,a,l,d,["size","sm",3,"overlaySelected","open"],[3,"closeSelect"],["cdsModalHeaderHeading",""],["cdsModalContent",""],["name","moveForm","novalidate","",1,"form",3,"formGroup"],["type","warning","spacingClass","mb-2",4,"ngIf"],[1,"form-item"],["formControlName","setExpiry","id","setExpiry","name","setExpiry","modal-primary-focus","",3,"checkedChange"],["class","form-item",4,"ngIf"],[3,"submitActionEvent","form","submitText","modalForm"],["type","warning","spacingClass","mb-2"],["name",s,3,"control"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-modal",7),e.\u0275\u0275listener("overlaySelected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(1,"cds-modal-header",8),e.\u0275\u0275listener("closeSelect",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(2,"h3",9),e.\u0275\u0275i18n(3,1),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"section",10)(5,"form",11,0),e.\u0275\u0275template(7,Vr,3,0,"cd-alert-panel",12),e.\u0275\u0275elementStart(8,"p"),e.\u0275\u0275i18nStart(9,2),e.\u0275\u0275element(10,"kbd")(11,"kbd"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"div",13)(13,"cds-checkbox",14),e.\u0275\u0275listener("checkedChange",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.toggleExpiration())}),e.\u0275\u0275i18n(14,3),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(15,Kr,4,3,"div",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(16,"cd-form-button-panel",16),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.moveImage())}),e.\u0275\u0275elementEnd()()}2&n&&(e.\u0275\u0275property("open",o.open),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",o.moveForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",o.hasSnapshots),e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(o.imageSpecStr),e.\u0275\u0275i18nApply(9),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",o.setExpirationDate),e.\u0275\u0275advance(),e.\u0275\u0275property("form",o.moveForm)("submitText",o.actionLabels.MOVE)("modalForm",!0))},dependencies:[c.NgIf,_.\u0275NgNoValidate,_.NgControlStatus,_.NgControlStatusGroup,_.FormGroupDirective,_.FormControlName,we.m,wr.P,F.e,N.E,m.Checkbox,m.Modal,m.ModalHeader,m.ModalContent,m.ModalHeaderHeading]})}}return i})();var Xr=p(68316),et=p(1505),Pt=p(32609),Ct=p(12959),ze=p(71138),Ur=p(63882),At=p(60977);function jr(i,r){if(1&i&&(e.\u0275\u0275i18nStart(0,3,1),e.\u0275\u0275elementStart(1,"span"),e.\u0275\u0275element(2,"b"),e.\u0275\u0275elementEnd(),e.\u0275\u0275i18nEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275i18nExp(t.imageName),e.\u0275\u0275i18nApply(0)}}function qr(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",18),e.\u0275\u0275i18n(1,4),e.\u0275\u0275elementEnd())}function Qr(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",18),e.\u0275\u0275i18n(1,5),e.\u0275\u0275elementEnd())}function Yr(i,r){if(1&i&&e.\u0275\u0275template(0,qr,2,0,"span",17)(1,Qr,2,0,"span",17),2&i){const t=e.\u0275\u0275nextContext(),n=e.\u0275\u0275reference(8);e.\u0275\u0275property("ngIf",t.snapshotForm.showError("snapshotName",n,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.snapshotForm.showError("snapshotName",n,"pattern"))}}function Wr(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",12)(1,"cds-checkbox",20),e.\u0275\u0275listener("checkedChange",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(o.onMirrorCheckBoxChange())}),e.\u0275\u0275i18n(2,6),e.\u0275\u0275elementEnd()()}if(2&i){const t=r.ngIf;e.\u0275\u0275advance(),e.\u0275\u0275attribute("disabled",!t.length>0||null)}}function Jr(i,r){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Wr,3,1,"div",19),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(2,1,t.peerConfigured$))}}let Zr=(()=>{class i extends m.BaseModal{constructor(t,n,o,a,s,l,d,u="",f="",M="",E=""){super(),this.cdsModalService=t,this.rbdService=n,this.taskManagerService=o,this.notificationService=a,this.actionLabels=s,this.rbdMirrorService=l,this.poolName=d,this.namespace=u,this.imageName=f,this.mirroring=M,this.snapName=E,this.editing=!1,this.onSubmit=new z.Subject,this.action=this.actionLabels.CREATE,this.resource="RBD Snapshot",this.createForm()}createForm(){this.snapshotForm=new k.$({snapshotName:new _.UntypedFormControl("",{validators:[_.Validators.required,_.Validators.pattern(/^(?!\.)[^/@]+$/)]}),mirrorImageSnapshot:new _.UntypedFormControl(!1,{})})}ngOnInit(){this.peerConfigured$=this.rbdMirrorService.getPeerForPool(this.poolName)}setSnapName(t){this.snapName=t,this.snapshotForm.get("snapshotName").setValue(t)}onMirrorCheckBoxChange(){!0===this.snapshotForm.getValue("mirrorImageSnapshot")?(this.snapshotForm.get("snapshotName").setValue(""),this.snapshotForm.get("snapshotName").clearValidators()):(this.snapshotForm.get("snapshotName").setValue(this.snapName),this.snapshotForm.get("snapshotName").setValidators([_.Validators.required]),this.snapshotForm.get("snapshotName").updateValueAndValidity())}setEditing(t=!0){this.editing=t,this.action=this.editing?this.actionLabels.RENAME:this.actionLabels.CREATE}editAction(){const t=this.snapshotForm.getValue("snapshotName"),n=new w.J(this.poolName,this.namespace,this.imageName),o=new h.O;o.name="rbd/snap/edit",o.metadata={image_spec:n.toString(),snapshot_name:t},this.rbdService.renameSnapshot(n,this.snapName,t).toPromise().then(()=>{this.taskManagerService.subscribe(o.name,o.metadata,a=>{this.notificationService.notifyTask(a)}),this.cdsModalService.dismissAll(),this.onSubmit.next(this.snapName)}).catch(()=>{this.snapshotForm.setErrors({cdSubmitButton:!0})})}createAction(){const t=this.snapshotForm.getValue("snapshotName"),n=this.snapshotForm.getValue("mirrorImageSnapshot"),o=new w.J(this.poolName,this.namespace,this.imageName),a=new h.O;a.name="rbd/snap/create",a.metadata={image_spec:o.toString(),snapshot_name:t},this.rbdService.createSnapshot(o,t,n).toPromise().then(()=>{this.taskManagerService.subscribe(a.name,a.metadata,s=>{this.notificationService.notifyTask(s)}),this.cdsModalService.dismissAll(),this.onSubmit.next(t)}).catch(()=>{this.snapshotForm.setErrors({cdSubmitButton:!0})})}submit(){this.editing?this.editAction():this.createAction()}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(ce.V),e.\u0275\u0275directiveInject(U.U),e.\u0275\u0275directiveInject(At.C),e.\u0275\u0275directiveInject(He.J),e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(me.B),e.\u0275\u0275directiveInject("poolName"),e.\u0275\u0275directiveInject("namespace",8),e.\u0275\u0275directiveInject("imageName",8),e.\u0275\u0275directiveInject("mirroring",8),e.\u0275\u0275directiveInject("snapName",8))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-rbd-snapshot-form-modal"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:20,vars:21,consts:()=>{let t,n,o,a,s,l;return t="Name",n="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",o="" + "\ufffd#12\ufffd\ufffd/#12\ufffd" + "" + "\ufffd*13:1\ufffd\ufffd#1:1\ufffd" + " Snapshot mode is enabled on image " + "\ufffd#2:1\ufffd" + "" + "\ufffd0:1\ufffd" + "" + "\ufffd/#2:1\ufffd" + ": snapshot names are auto generated" + "\ufffd/#1:1\ufffd\ufffd/*13:1\ufffd" + "",a="This field is required.",s="The snapshot name cannot start with \".\" and cannot contain \"/\" and \"@\".",l="Mirror Image Snapshot ",[["formDir","ngForm"],["snapshotError",""],n,o,a,s,l,["size","md",3,"overalSelected","open"],[3,"closeSelect"],["cdsModalHeaderHeading",""],["cdsModalContent",""],["name","snapshotForm","novalidate","",3,"formGroup"],[1,"form-item"],["label",t,"for","snapshotName","cdRequiredField","Name",3,"invalid","invalidText"],["cdsText","","type","text","placeholder","Snapshot name...","id","snapshotName","name","snapshotName","formControlName","snapshotName","autofocus","",3,"invalid"],[4,"ngIf"],[3,"submitActionEvent","form","submitText","modalForm"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"],["class","form-item",4,"ngIf"],["id","mirrorImageSnapshot","formControlName","mirrorImageSnapshot","name","mirrorImageSnapshot",3,"checkedChange"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-modal",7),e.\u0275\u0275listener("overalSelected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(1,"cds-modal-header",8),e.\u0275\u0275listener("closeSelect",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(2,"h3",9),e.\u0275\u0275i18n(3,2),e.\u0275\u0275pipe(4,"titlecase"),e.\u0275\u0275pipe(5,"upperFirst"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"section",10)(7,"form",11,0)(9,"div",12)(10,"cds-text-label",13),e.\u0275\u0275i18nStart(11,3),e.\u0275\u0275element(12,"input",14),e.\u0275\u0275template(13,jr,3,1,"span",15),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(14,Yr,2,2,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(16,Jr,3,3,"ng-container",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(17,"cd-form-button-panel",16),e.\u0275\u0275pipe(18,"titlecase"),e.\u0275\u0275pipe(19,"upperFirst"),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.submit())}),e.\u0275\u0275elementEnd()()}if(2&n){const a=e.\u0275\u0275reference(15);e.\u0275\u0275property("open",o.open),e.\u0275\u0275advance(5),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(4,13,o.action))(e.\u0275\u0275pipeBind1(5,15,o.resource)),e.\u0275\u0275i18nApply(3),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",o.snapshotForm),e.\u0275\u0275advance(3),e.\u0275\u0275property("invalid",o.snapshotForm.controls.snapshotName.invalid&&o.snapshotForm.controls.snapshotName.dirty)("invalidText",a),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.snapshotForm.controls.snapshotName.invalid&&o.snapshotForm.controls.snapshotName.dirty),e.\u0275\u0275attribute("disabled","snapshot"===o.mirroring&&!0===o.snapshotForm.getValue("mirrorImageSnapshot")||null),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","snapshot"===o.mirroring&&!0===o.snapshotForm.getValue("mirrorImageSnapshot")||null),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf","snapshot"===o.mirroring),e.\u0275\u0275advance(),e.\u0275\u0275property("form",o.snapshotForm)("submitText",e.\u0275\u0275pipeBind1(18,17,o.action)+" "+e.\u0275\u0275pipeBind1(19,19,o.resource))("modalForm",!0)}},dependencies:[c.NgIf,_.\u0275NgNoValidate,_.DefaultValueAccessor,_.NgControlStatus,_.NgControlStatusGroup,_.FormGroupDirective,_.FormControlName,F.e,ye.B,x.S,N.E,he.P,m.TextInputLabelComponent,m.TextInput,m.Checkbox,m.Modal,m.ModalHeader,m.ModalContent,m.ModalHeaderHeading,c.AsyncPipe,c.TitleCasePipe,Le.r]})}}return i})();class es{constructor(r,t,n){this.featuresName=t,this.cloneFormatVersion=1,n.cloneFormatVersion().subscribe(o=>{this.cloneFormatVersion=o}),this.create={permission:"create",icon:T.FI.add,name:r.CREATE},this.rename={permission:"update",icon:T.FI.edit,name:r.RENAME,disable:o=>this.disableForMirrorSnapshot(o)||!o.hasSingleSelection},this.protect={permission:"update",icon:T.FI.lock,visible:o=>o.hasSingleSelection&&!o.first().is_protected,name:r.PROTECT,disable:o=>this.disableForMirrorSnapshot(o)||this.getProtectDisableDesc(o,this.featuresName)},this.unprotect={permission:"update",icon:T.FI.unlock,visible:o=>o.hasSingleSelection&&o.first().is_protected,name:r.UNPROTECT,disable:o=>this.disableForMirrorSnapshot(o)},this.clone={permission:"create",canBePrimary:o=>o.hasSingleSelection,disable:o=>this.getCloneDisableDesc(o)||this.disableForMirrorSnapshot(o),icon:T.FI.clone,name:r.CLONE},this.copy={permission:"create",canBePrimary:o=>o.hasSingleSelection,disable:o=>!o.hasSingleSelection||o.first().cdExecuting||this.disableForMirrorSnapshot(o),icon:T.FI.copy,name:r.COPY},this.rollback={permission:"update",icon:T.FI.undo,name:r.ROLLBACK,disable:o=>this.disableForMirrorSnapshot(o)||!o.hasSingleSelection},this.deleteSnap={permission:"delete",icon:T.FI.destroy,disable:o=>{const a=o.first();return!o.hasSingleSelection||a.cdExecuting||a.is_protected||this.disableForMirrorSnapshot(o)},name:r.DELETE},this.ordering=[this.create,this.rename,this.protect,this.unprotect,this.clone,this.copy,this.rollback,this.deleteSnap]}getProtectDisableDesc(r,t){return!(r.hasSingleSelection&&!r.first().cdExecuting)||!t?.includes("layering")&&"The layering feature needs to be enabled on parent image"}getCloneDisableDesc(r){return!(r.hasSingleSelection&&!r.first().cdExecuting)||1===this.cloneFormatVersion&&!r.first().is_protected&&"Snapshot must be protected in order to clone."}disableForMirrorSnapshot(r){return r.hasSingleSelection&&"snapshot"===r.first().mirror_mode&&r.first().name.includes(".mirror.")}}class ts{}const ns=["nameTpl"],os=["rollbackTpl"];function is(i,r){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275i18n(1,1),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementStart(2,"strong"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(4,".\n")),2&i){const t=r.$implicit;e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",t.snapName,"")}}let as=(()=>{class i{constructor(t,n,o,a,s,l,d,u,f,M,E){this.authStorageService=t,this.dimlessBinaryPipe=n,this.cdDatePipe=o,this.rbdService=a,this.taskManagerService=s,this.notificationService=l,this.summaryService=d,this.taskListService=u,this.actionLabels=f,this.cdr=M,this.cdsModalService=E,this.snapshots=[],this.selection=new _e.y,this.builders={"rbd/snap/create":b=>{const D=new ts;return D.name=b.snapshot_name,D}},this.permission=this.authStorageService.getPermissions().rbdImage}ngOnInit(){this.columns=[{name:"Name",prop:"name",cellTransformation:xe.x.executing,flexGrow:2},{name:"Size",prop:"size",flexGrow:1,cellClass:"text-right",pipe:this.dimlessBinaryPipe},{name:"Used",prop:"disk_usage",flexGrow:1,cellClass:"text-right",pipe:this.dimlessBinaryPipe},{name:"State",prop:"is_protected",flexGrow:1,cellTransformation:xe.x.badge,customTemplateConfig:{map:{true:{value:"PROTECTED",class:"badge-success"},false:{value:"UNPROTECTED",class:"badge-info"}}}},{name:"Created",prop:"timestamp",flexGrow:1,pipe:this.cdDatePipe}],this.imageSpec=new w.J(this.poolName,this.namespace,this.rbdName),this.rbdTableActions=new es(this.actionLabels,this.featuresName,this.rbdService),this.rbdTableActions.create.click=()=>this.openCreateSnapshotModal(),this.rbdTableActions.rename.click=()=>this.openEditSnapshotModal(),this.rbdTableActions.protect.click=()=>this.toggleProtection(),this.rbdTableActions.unprotect.click=()=>this.toggleProtection();const t=()=>this.selection.first()&&`${this.imageSpec.toStringEncoded()}/${encodeURIComponent(this.selection.first().name)}`;this.rbdTableActions.clone.routerLink=()=>`/block/rbd/clone/${t()}`,this.rbdTableActions.copy.routerLink=()=>`/block/rbd/copy/${t()}`,this.rbdTableActions.rollback.click=()=>this.rollbackModal(),this.rbdTableActions.deleteSnap.click=()=>this.deleteSnapshotModal(),this.tableActions=this.rbdTableActions.ordering,this.taskListService.init(()=>(0,z.of)(this.snapshots),null,a=>{Pt.c.updateChanged(this,{data:a})&&(this.cdr.detectChanges(),this.data=[...this.data])},()=>{Pt.c.updateChanged(this,{data:this.snapshots})&&(this.cdr.detectChanges(),this.data=[...this.data])},a=>["rbd/snap/create","rbd/snap/delete","rbd/snap/edit","rbd/snap/rollback"].includes(a.name)&&this.imageSpec.toString()===a.metadata.image_spec,(a,s)=>a.name===s.metadata.snapshot_name,this.builders)}ngOnChanges(){this.columns&&(this.imageSpec=new w.J(this.poolName,this.namespace,this.rbdName),this.rbdTableActions&&(this.rbdTableActions.featuresName=this.featuresName),this.taskListService.fetch())}openSnapshotModal(t,n=null){this.modalRef=this.cdsModalService.show(Zr,{poolName:this.poolName,imageName:this.rbdName,namespace:this.namespace,mirroring:this.mirroring}),n?this.modalRef.setEditing():n=`${this.rbdName}_${Be()().toISOString(!0)}`,this.modalRef.setSnapName(n),this.modalRef.onSubmit.subscribe(a=>{const s=new Ct.G;s.name=t,s.metadata={image_spec:this.imageSpec.toString(),snapshot_name:a},this.summaryService.addRunningTask(s)})}openCreateSnapshotModal(){this.openSnapshotModal("rbd/snap/create")}openEditSnapshotModal(){this.openSnapshotModal("rbd/snap/edit",this.selection.first().name)}toggleProtection(){const t=this.selection.first().name,n=this.selection.first().is_protected,o=new h.O;o.name="rbd/snap/edit";const a=new w.J(this.poolName,this.namespace,this.rbdName);o.metadata={image_spec:a.toString(),snapshot_name:t},this.rbdService.protectSnapshot(a,t,!n).toPromise().then(()=>{const s=new Ct.G;s.name=o.name,s.metadata=o.metadata,this.summaryService.addRunningTask(s),this.taskManagerService.subscribe(o.name,o.metadata,l=>{this.notificationService.notifyTask(l)})})}_asyncTask(t,n,o){const a=new h.O;a.name=n,a.metadata={image_spec:new w.J(this.poolName,this.namespace,this.rbdName).toString(),snapshot_name:o};const s=new w.J(this.poolName,this.namespace,this.rbdName);this.rbdService[t](s,o).toPromise().then(()=>{const l=new Ct.G;l.name=a.name,l.metadata=a.metadata,this.summaryService.addRunningTask(l),this.cdsModalService.dismissAll(),this.taskManagerService.subscribe(l.name,l.metadata,d=>{this.notificationService.notifyTask(d)})}).catch(()=>{this.cdsModalService.stopLoadingSpinner(this.modalRef.snapshotForm)})}rollbackModal(){const t=this.selection.selected[0].name,n=new w.J(this.poolName,this.namespace,this.rbdName).toString(),o={titleText:"RBD snapshot rollback",buttonText:"Rollback",bodyTpl:this.rollbackTpl,bodyData:{snapName:`${n}@${t}`},onSubmit:()=>{this._asyncTask("rollbackSnapshot","rbd/snap/rollback",t)}};this.modalRef=this.cdsModalService.show(St.M,o)}deleteSnapshotModal(){const t=this.selection.selected[0].name;this.modalRef=this.cdsModalService.show(le.D,{impact:mt.r.high,itemDescription:"RBD snapshot",itemNames:[t],submitAction:()=>this._asyncTask("deleteSnapshot","rbd/snap/delete",t)})}updateSelection(t){this.selection=t}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(j.v),e.\u0275\u0275directiveInject($e.l),e.\u0275\u0275directiveInject(ze.Q),e.\u0275\u0275directiveInject(U.U),e.\u0275\u0275directiveInject(At.C),e.\u0275\u0275directiveInject(He.J),e.\u0275\u0275directiveInject(Ur.E),e.\u0275\u0275directiveInject(Se.D),e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(ce.V))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-rbd-snapshot-list"]],viewQuery:function(n,o){if(1&n&&(e.\u0275\u0275viewQuery(ns,5),e.\u0275\u0275viewQuery(os,7)),2&n){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.nameTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.rollbackTpl=a.first)}},inputs:{snapshots:"snapshots",featuresName:"featuresName",poolName:"poolName",namespace:"namespace",mirroring:"mirroring",primary:"primary",rbdName:"rbdName"},features:[e.\u0275\u0275ProvidersFeature([Se.D]),e.\u0275\u0275NgOnChangesFeature],decls:4,vars:5,consts:()=>{let t;return t="You are about to rollback",[["rollbackTpl",""],t,["columnMode","flex","selectionType","single",3,"updateSelection","data","columns"],[1,"table-actions",3,"permission","selection","tableActions"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-table",2),e.\u0275\u0275listener("updateSelection",function(l){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.updateSelection(l))}),e.\u0275\u0275element(1,"cd-table-actions",3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(2,is,5,1,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)}2&n&&(e.\u0275\u0275property("data",o.data)("columns",o.columns),e.\u0275\u0275advance(),e.\u0275\u0275property("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[Y.O,de.j],changeDetection:0})}}return i})();var rs=p(15224),ss=p(76139);const ls=["poolConfigurationSourceTpl"];function _s(i,r){1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275i18nStart(1,4),e.\u0275\u0275element(2,"strong"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementContainerEnd())}function cs(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span")(1,"span",46),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()()),2&i){const t=r.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t)}}function ds(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span")(1,"span",47),e.\u0275\u0275i18n(2,25),e.\u0275\u0275elementEnd()()),2&i){e.\u0275\u0275nextContext(3);const t=e.\u0275\u0275reference(1);e.\u0275\u0275advance(),e.\u0275\u0275property("ngbTooltip",t)}}function ms(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"dimlessBinary"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.selection.disk_usage)," ")}}function ps(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span")(1,"span",47),e.\u0275\u0275i18n(2,26),e.\u0275\u0275elementEnd()()),2&i){e.\u0275\u0275nextContext(3);const t=e.\u0275\u0275reference(1);e.\u0275\u0275advance(),e.\u0275\u0275property("ngbTooltip",t)}}function us(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"dimlessBinary"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.selection.total_disk_usage)," ")}}function gs(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1("/",t.selection.parent.pool_namespace,"")}}function Ss(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275template(2,gs,2,1,"span",30),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t.selection.parent.pool_name),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.selection.parent.pool_namespace),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate2("/",t.selection.parent.image_name,"@",t.selection.parent.snap_name,"")}}function fs(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1,"-"),e.\u0275\u0275elementEnd())}function Cs(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"table",39)(1,"tbody")(2,"tr",40)(3,"td",41),e.\u0275\u0275i18n(4,9),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"td",42),e.\u0275\u0275text(6),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(7,"tr",40)(8,"td",43),e.\u0275\u0275i18n(9,10),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"td"),e.\u0275\u0275text(11),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(12,"tr",40)(13,"td",44),e.\u0275\u0275i18n(14,11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"td"),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"empty"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(18,"tr",40)(19,"td",44),e.\u0275\u0275i18n(20,12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"td"),e.\u0275\u0275text(22),e.\u0275\u0275pipe(23,"cdDate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(24,"tr",40)(25,"td",44),e.\u0275\u0275i18n(26,13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(27,"td"),e.\u0275\u0275text(28),e.\u0275\u0275pipe(29,"dimlessBinary"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(30,"tr",40)(31,"td",44),e.\u0275\u0275i18n(32,14),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(33,"td"),e.\u0275\u0275text(34),e.\u0275\u0275pipe(35,"dimless"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(36,"tr",40)(37,"td",44),e.\u0275\u0275i18n(38,15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(39,"td"),e.\u0275\u0275text(40),e.\u0275\u0275pipe(41,"dimlessBinary"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(42,"tr",40)(43,"td",44),e.\u0275\u0275i18n(44,16),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(45,"td"),e.\u0275\u0275template(46,cs,3,1,"span",45),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(47,"tr",40)(48,"td",44),e.\u0275\u0275i18n(49,17),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(50,"td"),e.\u0275\u0275template(51,ds,3,1,"span",30)(52,ms,3,3,"span",30),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(53,"tr",40)(54,"td",44),e.\u0275\u0275i18n(55,18),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(56,"td"),e.\u0275\u0275template(57,ps,3,1,"span",30)(58,us,3,3,"span",30),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(59,"tr",40)(60,"td",44),e.\u0275\u0275i18n(61,19),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(62,"td"),e.\u0275\u0275text(63),e.\u0275\u0275pipe(64,"dimlessBinary"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(65,"tr",40)(66,"td",44),e.\u0275\u0275i18n(67,20),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(68,"td"),e.\u0275\u0275text(69),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(70,"tr",40)(71,"td",44),e.\u0275\u0275i18n(72,21),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(73,"td"),e.\u0275\u0275template(74,Ss,4,4,"span",30)(75,fs,2,0,"span",30),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(76,"tr",40)(77,"td",44),e.\u0275\u0275i18n(78,22),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(79,"td"),e.\u0275\u0275text(80),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(81,"tr",40)(82,"td",44),e.\u0275\u0275i18n(83,23),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(84,"td"),e.\u0275\u0275text(85),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(86,"tr",40)(87,"td",44),e.\u0275\u0275i18n(88,24),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(89,"td"),e.\u0275\u0275text(90),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(t.selection.name),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(t.selection.pool_name),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,19,t.selection.data_pool)),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(23,21,t.selection.timestamp)),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(29,23,t.selection.size)),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(35,25,t.selection.num_objs)),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(41,27,t.selection.obj_size)),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",t.selection.features_name),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",-1===(null==t.selection.features_name?null:t.selection.features_name.indexOf("fast-diff"))),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",-1!==(null==t.selection.features_name?null:t.selection.features_name.indexOf("fast-diff"))),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",-1===(null==t.selection.features_name?null:t.selection.features_name.indexOf("fast-diff"))),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",-1!==(null==t.selection.features_name?null:t.selection.features_name.indexOf("fast-diff"))),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(64,29,t.selection.stripe_unit)),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(t.selection.stripe_count),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",t.selection.parent),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!t.selection.parent),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(t.selection.block_name_prefix),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(t.selection.order),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(t.selection.image_format)}}function Es(i,r){if(1&i&&e.\u0275\u0275element(0,"cd-rbd-snapshot-list",48),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("snapshots",t.selection.snapshots)("featuresName",t.selection.features_name)("poolName",t.selection.pool_name)("primary",t.selection.primary)("namespace",t.selection.namespace)("mirroring",t.selection.mirror_mode)("rbdName",t.selection.name)}}function Ts(i,r){if(1&i&&e.\u0275\u0275element(0,"cd-rbd-configuration-table",49),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("data",t.selection.configuration)}}function Fs(i,r){if(1&i&&e.\u0275\u0275element(0,"cd-grafana",50),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("grafanaPath",t.rbdDashboardUrl)("type","metrics")}}function Ms(i,r){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"nav",31,2),e.\u0275\u0275elementContainerStart(3,32),e.\u0275\u0275elementStart(4,"a",33),e.\u0275\u0275i18n(5,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(6,Cs,91,31,"ng-template",34),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(7,35),e.\u0275\u0275elementStart(8,"a",33),e.\u0275\u0275i18n(9,6),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(10,Es,1,7,"ng-template",34),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(11,36),e.\u0275\u0275elementStart(12,"a",33),e.\u0275\u0275i18n(13,7),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(14,Ts,1,1,"ng-template",34),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(15,37),e.\u0275\u0275elementStart(16,"a",33),e.\u0275\u0275i18n(17,8),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(18,Fs,1,2,"ng-template",34),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(19,"div",38),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275reference(2);e.\u0275\u0275advance(19),e.\u0275\u0275property("ngbNavOutlet",t)}}function hs(i,r){1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"cd-alert-panel",51),e.\u0275\u0275i18n(2,27),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd())}function Os(i,r){1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"strong",53),e.\u0275\u0275i18n(2,28),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd())}function Rs(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",54),e.\u0275\u0275i18n(1,29),e.\u0275\u0275elementEnd())}function Is(i,r){if(1&i&&e.\u0275\u0275template(0,Os,3,0,"ng-container",52)(1,Rs,2,0,"ng-template",null,3,e.\u0275\u0275templateRefExtractor),2&i){const t=r.data.value,n=e.\u0275\u0275reference(2);e.\u0275\u0275property("ngIf",+t)("ngIfElse",n)}}let Ns=(()=>{class i{ngOnChanges(){this.selection&&(this.rbdDashboardUrl=`rbd-details?var-pool=${this.selection.pool_name}&var-image=${this.selection.name}`)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-rbd-details"]],viewQuery:function(n,o){if(1&n&&(e.\u0275\u0275viewQuery(ls,7),e.\u0275\u0275viewQuery(A.NgbNav,7)),2&n){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.poolConfigurationSourceTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.nav=a.first)}},inputs:{selection:"selection",images:"images"},features:[e.\u0275\u0275NgOnChangesFeature],decls:6,vars:2,consts:()=>{let t,n,o,a,s,l,d,u,f,M,E,b,D,B,V,oe,ie,ae,H,ge,P,Oe,Re,Ie,Ne,be,Pe,Ae,ve;return t="Only available for RBD images with " + "\ufffd#2\ufffd" + "fast-diff" + "\ufffd/#2\ufffd" + " enabled",n="Details",o="Snapshots",a="Configuration",s="Performance",l="Name",d="Pool",u="Data Pool",f="Created",M="Size",E="Objects",b="Object size",D="Features",B="Provisioned",V="Total provisioned",oe="Striping unit",ie="Striping count",ae="Parent",H="Block name prefix",ge="Order",P="Format Version",Oe="N/A",Re="N/A",Ie="RBD details",Ne="Information can not be displayed for RBD in status 'Removing'.",be="This setting overrides the global value",Pe="Image",Ae="This is the global value. No value for this option has been set for this image.",ve="Global",[["usageNotAvailableTooltipTpl",""],["poolConfigurationSourceTpl",""],["nav","ngbNav"],["global",""],t,n,o,a,s,l,d,u,f,M,E,b,D,B,V,oe,ie,ae,H,ge,P,Oe,Re,Ne,Pe,ve,[4,"ngIf"],["ngbNav","","cdStatefulTab","rbd-details",1,"nav-tabs"],["ngbNavItem","details"],["ngbNavLink",""],["ngbNavContent",""],["ngbNavItem","snapshots"],["ngbNavItem","configuration"],["ngbNavItem","performance"],[3,"ngbNavOutlet"],["data-testid","rbd-details-table",1,"cds--data-table--sort","cds--data-table--no-border","cds--data-table","cds--data-table--md"],["cdstablerow",""],["cdstabledata","",1,"bold","w-25"],[1,"w-75"],["cdstabledata","",1,"bold"],[1,"bold"],[4,"ngFor","ngForOf"],[1,"badge","badge-dark","me-2"],["placement","top",1,"form-text","text-muted",3,"ngbTooltip"],[3,"snapshots","featuresName","poolName","primary","namespace","mirroring","rbdName"],[3,"data"],["title",Ie,"uid","YhCYGcuZz","grafanaStyle","one",3,"grafanaPath","type"],["type","warning"],[4,"ngIf","ngIfElse"],["ngbTooltip",be],["ngbTooltip",Ae]]},template:function(n,o){1&n&&e.\u0275\u0275template(0,_s,3,0,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)(2,Ms,20,1,"ng-container",30)(3,hs,3,0,"ng-container",30)(4,Is,3,2,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),2&n&&(e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",o.selection&&"REMOVING"!==o.selection.source),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.selection&&"REMOVING"===o.selection.source))},dependencies:[c.NgForOf,c.NgIf,A.NgbNavContent,A.NgbNav,A.NgbNavItem,A.NgbNavLink,A.NgbNavLinkBase,A.NgbNavOutlet,A.NgbTooltip,et.c,we.m,dt.B,as,rs.k,$e.l,_t.u,ze.Q,ss.y]})}}return i})();const tt=()=>({exact:!0});function bs(i,r){1&i&&(e.\u0275\u0275elementStart(0,"li",5)(1,"a",10),e.\u0275\u0275i18n(2,3),e.\u0275\u0275elementEnd()()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275property("routerLinkActiveOptions",e.\u0275\u0275pureFunction0(1,tt)))}let nt=(()=>{class i{constructor(t){this.authStorageService=t,this.grafanaPermission=this.authStorageService.getPermissions().grafana}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(j.v))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-rbd-tabs"]],decls:11,vars:7,consts:()=>{let t,n,o,a;return t="Images",n="Namespaces",o="Trash",a="Overall Performance",[t,n,o,a,[1,"nav","nav-tabs"],[1,"nav-item"],["routerLink","/block/rbd","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link",3,"routerLinkActiveOptions"],["routerLink","/block/rbd/namespaces","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link",3,"routerLinkActiveOptions"],["routerLink","/block/rbd/trash","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link",3,"routerLinkActiveOptions"],["class","nav-item",4,"ngIf"],["routerLink","/block/rbd/performance","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link",3,"routerLinkActiveOptions"]]},template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"ul",4)(1,"li",5)(2,"a",6),e.\u0275\u0275i18n(3,0),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"li",5)(5,"a",7),e.\u0275\u0275i18n(6,1),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(7,"li",5)(8,"a",8),e.\u0275\u0275i18n(9,2),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(10,bs,3,2,"li",9),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLinkActiveOptions",e.\u0275\u0275pureFunction0(4,tt)),e.\u0275\u0275advance(3),e.\u0275\u0275property("routerLinkActiveOptions",e.\u0275\u0275pureFunction0(5,tt)),e.\u0275\u0275advance(3),e.\u0275\u0275property("routerLinkActiveOptions",e.\u0275\u0275pureFunction0(6,tt)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",o.grafanaPermission.read))},dependencies:[c.NgIf,v.RouterLink,v.RouterLinkActive]})}}return i})();const Ps=["usageTpl"],As=["parentTpl"],vs=["nameTpl"],Ds=["ScheduleTpl"],Ls=["mirroringTpl"],ys=["flattenTpl"],$s=["deleteTpl"],Bs=["removingStatTpl"],Gs=["forcePromoteConfirmation"],xs=["usedTmpl"],ws=["totalUsedTmpl"],Vs=["imageUsageTpl"],Hs=(i,r)=>[i,r];function ks(i,r){if(1&i&&e.\u0275\u0275element(0,"cd-rbd-details",20),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("selection",t.expandedRow)}}function Ks(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(2).data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1("/",t.pool_namespace,"")}}function zs(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275template(2,Ks,2,1,"span",21),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t.pool_name),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.pool_namespace),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate2("/",t.image_name,"@",t.snap_name,"")}}function Xs(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1,"-"),e.\u0275\u0275elementEnd())}function Us(i,r){if(1&i&&e.\u0275\u0275template(0,zs,4,4,"span",21)(1,Xs,2,0,"span",21),2&i){const t=r.data.value;e.\u0275\u0275property("ngIf",t),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!t)}}function js(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span",24),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t[0])}}function qs(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span",24),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t[1])}}function Qs(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",24),e.\u0275\u0275i18n(1,12),e.\u0275\u0275elementEnd())}function Ys(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",24),e.\u0275\u0275i18n(1,13),e.\u0275\u0275elementEnd())}function Ws(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span",24),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t)}}function Js(i,r){if(1&i&&(e.\u0275\u0275template(0,js,2,1,"span",22),e.\u0275\u0275text(1,"\xa0 "),e.\u0275\u0275template(2,qs,2,1,"span",23),e.\u0275\u0275text(3,"\xa0 "),e.\u0275\u0275template(4,Qs,2,0,"span",23)(5,Ys,2,0,"span",23)(6,Ws,2,1,"ng-template",null,10,e.\u0275\u0275templateRefExtractor)),2&i){const t=r.data.value,n=r.data.row,o=e.\u0275\u0275reference(7);e.\u0275\u0275property("ngIf",3===(null==t?null:t.length))("ngIfElse",o),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",3===(null==t?null:t.length)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!0===(null==n?null:n.primary)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!1===(null==n?null:n.primary))}}function Zs(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span",24),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"cdDate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,t[2]))}}function el(i,r){if(1&i&&e.\u0275\u0275template(0,Zs,3,3,"span",23),2&i){const t=r.data.value;e.\u0275\u0275property("ngIf",3===(null==t?null:t.length))}}function tl(i,r){if(1&i&&(e.\u0275\u0275text(0," You are about to flatten "),e.\u0275\u0275elementStart(1,"strong"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(3,". "),e.\u0275\u0275element(4,"br")(5,"br"),e.\u0275\u0275text(6," All blocks will be copied from parent "),e.\u0275\u0275elementStart(7,"strong"),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(9," to child "),e.\u0275\u0275elementStart(10,"strong"),e.\u0275\u0275text(11),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(12,".\n")),2&i){const t=r.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.child),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(t.parent),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(t.child)}}function nl(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"li"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=r.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t)}}function ol(i,r){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"span"),e.\u0275\u0275i18n(2,15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"ul"),e.\u0275\u0275template(4,nl,2,1,"li",27),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext(2).snapshots;e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",t)}}function il(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"div",26)(1,"span"),e.\u0275\u0275i18n(2,14),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"br"),e.\u0275\u0275template(4,ol,5,1,"ng-container",21),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().snapshots;e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",t.length>0)}}function al(i,r){1&i&&e.\u0275\u0275template(0,il,5,1,"div",25),2&i&&e.\u0275\u0275property("ngIf",r.hasSnapshots)}function rl(i,r){if(1&i&&e.\u0275\u0275element(0,"i",29),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction2(1,Hs,t.icons.spinner,t.icons.spin))}}function sl(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span",29),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(),n=t.data.column,o=t.data.row;e.\u0275\u0275property("ngClass",null!=n&&null!=n.customTemplateConfig&&n.customTemplateConfig.executingClass?n.customTemplateConfig.executingClass:"text-muted italic"),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" (",o.cdExecuting,") ")}}function ll(i,r){if(1&i&&(e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(0,"svg",31)),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("cdsIcon",t.icons.warning)("size",t.icons.size16)}}function _l(i,r){if(1&i&&(e.\u0275\u0275template(0,rl,1,4,"i",28),e.\u0275\u0275elementStart(1,"span",29),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,sl,2,2,"span",28)(4,ll,1,2,"svg",30)),2&i){const t=r.data.column,n=r.data.value,o=r.data.row;e.\u0275\u0275property("ngIf",o.cdExecuting),e.\u0275\u0275advance(),e.\u0275\u0275property("ngClass",null==t||null==t.customTemplateConfig?null:t.customTemplateConfig.valueClass),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",n," "),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.cdExecuting),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.source&&"REMOVING"===o.source)}}function cl(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"cd-alert-panel",32),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(2,"div",33),e.\u0275\u0275i18nStart(3,16),e.\u0275\u0275element(4,"strong"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t.errorMessage)}}function dl(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span",35)(1,"span"),e.\u0275\u0275text(2,"-"),e.\u0275\u0275elementEnd()()),2&i){e.\u0275\u0275nextContext(2);const t=e.\u0275\u0275reference(22);e.\u0275\u0275property("ngbTooltip",t)}}function ml(i,r){if(1&i&&e.\u0275\u0275element(0,"cd-usage-bar",37),2&i){const t=e.\u0275\u0275nextContext(2).data.row;e.\u0275\u0275property("total",t.size)("used",t.disk_usage)("title",t.name)}}function pl(i,r){if(1&i&&e.\u0275\u0275template(0,ml,1,3,"cd-usage-bar",36),2&i){const t=e.\u0275\u0275nextContext().data.row;e.\u0275\u0275property("ngIf",t)}}function ul(i,r){if(1&i&&e.\u0275\u0275template(0,dl,3,1,"span",34)(1,pl,1,1,"ng-template",null,11,e.\u0275\u0275templateRefExtractor),2&i){const t=r.data.row,n=e.\u0275\u0275reference(2);e.\u0275\u0275property("ngIf",t.features_name&&(!t.features_name.includes("fast-diff")||"snapshot"===t.mirror_mode))("ngIfElse",n)}}function gl(i,r){1&i&&e.\u0275\u0275element(0,"div",38),2&i&&e.\u0275\u0275property("innerHtml","Only available for RBD images with <strong>fast-diff</strong> enabled and without snapshot mirroring",e.\u0275\u0275sanitizeHtml)}let fl=(()=>{class i extends rt.D{createRbdFromTaskImageSpec(t){const n=w.J.fromString(t);return this.createRbdFromTask(n.poolName,n.namespace,n.imageName)}createRbdFromTask(t,n,o){const a=new ba;return a.id="-1",a.unique_id="-1",a.name=o,a.namespace=n,a.pool_name=t,a.image_format=Je.V2,a}constructor(t,n,o,a,s,l,d,u,f){super(),this.authStorageService=t,this.rbdService=n,this.dimlessBinaryPipe=o,this.dimlessPipe=a,this.taskWrapper=s,this.taskListService=l,this.urlBuilder=d,this.actionLabels=u,this.cdsModalService=f,this.tableStatus=new bt.F("ghost"),this.selection=new _e.y,this.icons=T.FI,this.count=0,this.tableContext=null,this.builders={"rbd/create":P=>this.createRbdFromTask(P.pool_name,P.namespace,P.image_name),"rbd/delete":P=>this.createRbdFromTaskImageSpec(P.image_spec),"rbd/clone":P=>this.createRbdFromTask(P.child_pool_name,P.child_namespace,P.child_image_name),"rbd/copy":P=>this.createRbdFromTask(P.dest_pool_name,P.dest_namespace,P.dest_image_name)},this.permission=this.authStorageService.getPermissions().rbdImage;const M=()=>this.selection.first()&&new w.J(this.selection.first().pool_name,this.selection.first().namespace,this.selection.first().name).toStringEncoded();this.tableActions=[{permission:"create",icon:T.FI.add,routerLink:()=>this.urlBuilder.getCreate(),canBePrimary:P=>!P.hasSingleSelection,name:this.actionLabels.CREATE},{permission:"update",icon:T.FI.edit,routerLink:()=>this.urlBuilder.getEdit(M()),name:this.actionLabels.EDIT,disable:P=>this.getRemovingStatusDesc(P)||this.getInvalidNameDisable(P)},{permission:"create",canBePrimary:P=>P.hasSingleSelection,disable:P=>this.getRemovingStatusDesc(P)||this.getInvalidNameDisable(P)||!!P.first().cdExecuting,icon:T.FI.copy,routerLink:()=>`/block/rbd/copy/${M()}`,name:this.actionLabels.COPY,title:ne.copy},{permission:"update",disable:P=>this.getRemovingStatusDesc(P)||this.getInvalidNameDisable(P)||P.first().cdExecuting||!P.first().parent,icon:T.FI.flatten,click:()=>this.flattenRbdModal(),name:this.actionLabels.FLATTEN,title:ne.flatten},{permission:"update",icon:T.FI.refresh,click:()=>this.resyncRbdModal(),name:this.actionLabels.RESYNC,disable:P=>this.getResyncDisableDesc(P)},{permission:"update",icon:T.FI.edit,click:()=>this.removeSchedulingModal(),name:this.actionLabels.REMOVE_SCHEDULING,disable:P=>this.getRemovingStatusDesc(P)||this.getInvalidNameDisable(P)||void 0===P.first().schedule_info},{permission:"update",icon:T.FI.edit,click:()=>this.actionPrimary(!0),name:this.actionLabels.PROMOTE,visible:()=>null!=this.selection.first()&&!this.selection.first().primary,disable:()=>"Disabled"===this.selection.first().mirror_mode?ne.enableMirroring:""},{permission:"update",icon:T.FI.edit,click:()=>this.actionPrimary(!1),name:this.actionLabels.DEMOTE,visible:()=>null!=this.selection.first()&&this.selection.first().primary,disable:()=>"Disabled"===this.selection.first().mirror_mode?ne.enableMirroring:""},{permission:"delete",icon:T.FI.trash,title:ne.moveToTrash,click:()=>this.trashRbdModal(),name:this.actionLabels.TRASH,disable:P=>this.getRemovingStatusDesc(P)||this.getInvalidNameDisable(P)||P.first().image_format===Je.V1},{permission:"delete",icon:T.FI.destroy,click:()=>this.deleteRbdModal(),name:this.actionLabels.DELETE,title:ne.delete,disable:P=>this.getDeleteDisableDesc(P)}]}ngOnInit(){this.columns=[{name:"Name",prop:"name",flexGrow:2,cellTemplate:this.removingStatTpl},{name:"Pool",prop:"pool_name",flexGrow:2},{name:"Namespace",prop:"namespace",flexGrow:2},{name:"Size",prop:"size",flexGrow:1,cellClass:"text-right",sortable:!1,pipe:this.dimlessBinaryPipe},{name:"Usage",prop:"usage",cellTemplate:this.imageUsageTpl,flexGrow:1.5},{name:"Objects",prop:"num_objs",flexGrow:1,cellClass:"text-right",sortable:!1,pipe:this.dimlessPipe},{name:"Object size",prop:"obj_size",flexGrow:1,cellClass:"text-right",sortable:!1,pipe:this.dimlessBinaryPipe},{name:"Parent",prop:"parent",flexGrow:2,sortable:!1,cellTemplate:this.parentTpl},{name:"Mirroring",prop:"mirror_mode",flexGrow:3,sortable:!1,cellTemplate:this.mirroringTpl},{name:"Next Scheduled Snapshot",prop:"mirror_mode",flexGrow:3,sortable:!1,cellTemplate:this.ScheduleTpl}],this.taskListService.init(o=>this.getRbdImages(o),o=>this.prepareResponse(o),o=>this.images=o,()=>this.onFetchError(),o=>["rbd/clone","rbd/copy","rbd/create","rbd/delete","rbd/edit","rbd/flatten","rbd/trash/move"].includes(o.name),(o,a)=>{let s;switch(a.name){case"rbd/copy":s=new w.J(a.metadata.dest_pool_name,a.metadata.dest_namespace,a.metadata.dest_image_name).toString();break;case"rbd/clone":s=new w.J(a.metadata.child_pool_name,a.metadata.child_namespace,a.metadata.child_image_name).toString();break;case"rbd/create":s=new w.J(a.metadata.pool_name,a.metadata.namespace,a.metadata.image_name).toString();break;default:s=a.metadata.image_spec}return s===new w.J(o.pool_name,o.namespace,o.name).toString()},this.builders)}onFetchError(){this.table.reset(),this.tableStatus=new bt.F("danger")}getRbdImages(t){return null!==t&&(this.tableContext=t),null==this.tableContext&&(this.tableContext=new W.n(()=>{})),this.rbdService.list(this.tableContext?.toParams())}prepareResponse(t){let n=[];return t.forEach(o=>{n=n.concat(o.value)}),n.forEach(o=>{if(void 0!==o.schedule_info){let a=[];const s="scheduled";let l=+new Date(o.schedule_info.schedule_time);const d=(new Date).getTimezoneOffset();l=(l+6e4*Math.abs(d))/1e3,a.push(o.mirror_mode,s,l),o.mirror_mode=a,a=[]}}),this.count=n.length>0?Gr.Z.getCount(t[0]):0,n}updateSelection(t){this.selection=t}deleteRbdModal(){const t=this.selection.first().pool_name,n=this.selection.first().namespace,o=this.selection.first().name,a=new w.J(t,n,o);this.cdsModalService.show(le.D,{impact:mt.r.high,itemDescription:"RBD",itemNames:[a.imageName],bodyTemplate:this.deleteTpl,bodyContext:{hasSnapshots:this.hasSnapshots(),snapshots:this.listProtectedSnapshots()},submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new h.O("rbd/delete",{image_spec:a.toString()}),call:this.rbdService.delete(a)})})}resyncRbdModal(){const t=this.selection.first().pool_name,n=this.selection.first().namespace,o=this.selection.first().name,a=new w.J(t,n,o);this.cdsModalService.show(le.D,{itemDescription:"RBD",itemNames:[a],actionDescription:"resync",submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new h.O("rbd/edit",{image_spec:a.toString()}),call:this.rbdService.update(a,{resync:!0})})})}trashRbdModal(){const t={poolName:this.selection.first().pool_name,namespace:this.selection.first().namespace,imageName:this.selection.first().name,hasSnapshots:this.hasSnapshots()};this.cdsModalService.show(zr,t)}flattenRbd(t){this.taskWrapper.wrapTaskAroundCall({task:new h.O("rbd/flatten",{image_spec:t.toString()}),call:this.rbdService.flatten(t)}).subscribe({complete:()=>{this.cdsModalService.dismissAll()}})}flattenRbdModal(){const t=this.selection.first().pool_name,n=this.selection.first().namespace,o=this.selection.first().name,a=this.selection.first().parent,s=new w.J(a.pool_name,a.pool_namespace,a.image_name),l=new w.J(t,n,o),d={titleText:"RBD flatten",buttonText:"Flatten",bodyTpl:this.flattenTpl,bodyData:{parent:`${s}@${a.snap_name}`,child:l.toString()},onSubmit:()=>{this.flattenRbd(l)}};this.cdsModalService.show(St.M,d)}editRequest(){const t=new gt;return t.remove_scheduling=!t.remove_scheduling,t}removeSchedulingModal(){const t=this.selection.first().name,n=new w.J(this.selection.first().pool_name,this.selection.first().namespace,this.selection.first().name);this.cdsModalService.show(le.D,{actionDescription:"remove scheduling on",itemDescription:"image",itemNames:[`${t}`],submitActionObservable:()=>new z.Observable(o=>{this.taskWrapper.wrapTaskAroundCall({task:new h.O("rbd/edit",{image_spec:n.toString()}),call:this.rbdService.update(n,this.editRequest())}).subscribe({error:a=>o.error(a),complete:()=>{this.cdsModalService.dismissAll()}})})})}actionPrimary(t){const n=new gt;n.primary=t,n.features=null;const o=new w.J(this.selection.first().pool_name,this.selection.first().namespace,this.selection.first().name);this.taskWrapper.wrapTaskAroundCall({task:new h.O("rbd/edit",{image_spec:o.toString()}),call:this.rbdService.update(o,n)}).subscribe(()=>{},a=>{a.preventDefault(),t&&(this.errorMessage=a.error.detail.replace(/\[.*?\]\s*/,""),n.force=!0,this.cdsModalService.show(St.M,{titleText:"Warning",buttonText:"Enforce",warning:!0,bodyTpl:this.forcePromoteConfirmation,onSubmit:()=>{this.rbdService.update(o,n).subscribe(()=>{this.cdsModalService.dismissAll()},()=>{this.cdsModalService.dismissAll()})}}))})}hasSnapshots(){return(this.selection.first().snapshots||[]).length>0}hasClonedSnapshots(t){return(t.snapshots||[]).some(o=>o.children&&o.children.length>0)}listProtectedSnapshots(){return this.selection.first().snapshots.reduce((o,a)=>(a.is_protected&&o.push(a.name),o),[])}getDeleteDisableDesc(t){const n=t.first();return n&&this.hasClonedSnapshots(n)?ne.clonedSnapshot:n&&!1===n.primary?ne.secondayImageDelete:this.getInvalidNameDisable(t)||this.hasClonedSnapshots(t.first())||!1===n.primary}getResyncDisableDesc(t){const n=t.first();return n&&this.imageIsPrimary(n)?ne.primaryImageResync:this.getInvalidNameDisable(t)}imageIsPrimary(t){return t.primary}getInvalidNameDisable(t){return t.first()?.name?.match(/[@/]/)?ne.invalidNameDisable:!t.first()||!t.hasSingleSelection}getRemovingStatusDesc(t){return"REMOVING"===t.first()?.source&&ne.removingStatus}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(j.v),e.\u0275\u0275directiveInject(U.U),e.\u0275\u0275directiveInject($e.l),e.\u0275\u0275directiveInject(_t.u),e.\u0275\u0275directiveInject(y.a),e.\u0275\u0275directiveInject(Se.D),e.\u0275\u0275directiveInject(ft.E),e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(ce.V))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-rbd-list"]],viewQuery:function(n,o){if(1&n&&(e.\u0275\u0275viewQuery(Y.O,7),e.\u0275\u0275viewQuery(Ps,5),e.\u0275\u0275viewQuery(As,7),e.\u0275\u0275viewQuery(vs,5),e.\u0275\u0275viewQuery(Ds,7),e.\u0275\u0275viewQuery(Ls,7),e.\u0275\u0275viewQuery(ys,7),e.\u0275\u0275viewQuery($s,7),e.\u0275\u0275viewQuery(Bs,7),e.\u0275\u0275viewQuery(Gs,7),e.\u0275\u0275viewQuery(xs,7),e.\u0275\u0275viewQuery(ws,7),e.\u0275\u0275viewQuery(Vs,7)),2&n){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.table=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.usageTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.parentTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.nameTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.ScheduleTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.mirroringTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.flattenTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.deleteTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.removingStatTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.forcePromoteConfirmation=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.usedTmpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.totalUsedTmpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.imageUsageTpl=a.first)}},features:[e.\u0275\u0275ProvidersFeature([Se.D,{provide:ft.E,useValue:new ft.E("block/rbd")}]),e.\u0275\u0275InheritDefinitionFeature],decls:23,vars:12,consts:()=>{let t,n,o,a,s,l;return t="primary",n="secondary",o="Deleting this image will also delete all its snapshots.",a="The following snapshots are currently protected and will be removed:",s="RBD in status 'Removing'",l="" + "\ufffd#4\ufffd" + " Do you want to force the operation? " + "\ufffd/#4\ufffd" + "",[["table",""],["parentTpl",""],["mirroringTpl",""],["ScheduleTpl",""],["flattenTpl",""],["deleteTpl",""],["removingStatTpl",""],["forcePromoteConfirmation",""],["imageUsageTpl",""],["usageTooltip",""],["probb",""],["usageBar",""],t,n,o,a,l,["columnMode","flex","identifier","unique_id","forceIdentifier","true","selectionType","single",3,"fetchData","setExpandedRow","updateSelection","data","columns","searchableObjects","serverSide","count","hasDetails","status","maxLimit","autoReload"],[1,"table-actions",3,"permission","selection","tableActions"],[3,"selection",4,"cdTableDetail"],[3,"selection"],[4,"ngIf"],["class","badge badge-info",4,"ngIf","ngIfElse"],["class","badge badge-info",4,"ngIf"],[1,"badge","badge-info"],["class","alert alert-warning","role","alert",4,"ngIf"],["role","alert",1,"alert","alert-warning"],[4,"ngFor","ngForOf"],[3,"ngClass",4,"ngIf"],[3,"ngClass"],["title",s,"class","cds-warning-color",3,"cdsIcon","size",4,"ngIf"],["title",s,1,"cds-warning-color",3,"cdsIcon","size"],["type","warning"],[1,"m-4"],[3,"ngbTooltip",4,"ngIf","ngIfElse"],[3,"ngbTooltip"],["decimals","2",3,"total","used","title",4,"ngIf"],["decimals","2",3,"total","used","title"],[3,"innerHtml"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275element(0,"cd-rbd-tabs"),e.\u0275\u0275elementStart(1,"cd-table",17,0),e.\u0275\u0275listener("fetchData",function(l){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.taskListService.fetch(l))})("setExpandedRow",function(l){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.setExpandedRow(l))})("updateSelection",function(l){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.updateSelection(l))}),e.\u0275\u0275element(3,"cd-table-actions",18),e.\u0275\u0275template(4,ks,1,1,"cd-rbd-details",19),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,Us,2,2,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)(7,Js,8,5,"ng-template",null,2,e.\u0275\u0275templateRefExtractor)(9,el,1,1,"ng-template",null,3,e.\u0275\u0275templateRefExtractor)(11,tl,13,3,"ng-template",null,4,e.\u0275\u0275templateRefExtractor)(13,al,1,1,"ng-template",null,5,e.\u0275\u0275templateRefExtractor)(15,_l,5,5,"ng-template",null,6,e.\u0275\u0275templateRefExtractor)(17,cl,5,1,"ng-template",null,7,e.\u0275\u0275templateRefExtractor)(19,ul,3,2,"ng-template",null,8,e.\u0275\u0275templateRefExtractor)(21,gl,1,1,"ng-template",null,9,e.\u0275\u0275templateRefExtractor)}2&n&&(e.\u0275\u0275advance(),e.\u0275\u0275property("data",o.images)("columns",o.columns)("searchableObjects",!0)("serverSide",!0)("count",o.count)("hasDetails",!0)("status",o.tableStatus)("maxLimit",25)("autoReload",-1),e.\u0275\u0275advance(2),e.\u0275\u0275property("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[c.NgClass,c.NgForOf,c.NgIf,A.NgbTooltip,Xr.o,we.m,Y.O,de.j,lt.N,m.IconDirective,Ns,nt,ze.Q],styles:[".warn[_ngcontent-%COMP%]{color:#d48200}"]})}}return i})();function Cl(i,r){1&i&&(e.\u0275\u0275i18nStart(0,5,1),e.\u0275\u0275element(1,"option",22),e.\u0275\u0275i18nEnd()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275property("ngValue",null))}function El(i,r){1&i&&(e.\u0275\u0275i18nStart(0,5,2),e.\u0275\u0275element(1,"option",22),e.\u0275\u0275i18nEnd()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275property("ngValue",null))}function Tl(i,r){1&i&&(e.\u0275\u0275i18nStart(0,5,3),e.\u0275\u0275element(1,"option",22),e.\u0275\u0275i18nEnd()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275property("ngValue",null))}function Fl(i,r){if(1&i&&(e.\u0275\u0275i18nStart(0,5,4),e.\u0275\u0275element(1,"option",23),e.\u0275\u0275i18nEnd()),2&i){const t=r.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275property("value",t.pool_name),e.\u0275\u0275i18nExp(t.pool_name),e.\u0275\u0275i18nApply(0)}}function Ml(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"cds-select",19),e.\u0275\u0275i18nStart(1,5),e.\u0275\u0275template(2,Cl,2,1,"option",20)(3,El,2,1,"option",20)(4,Tl,2,1,"option",20)(5,Fl,2,2,"option",21),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(),n=e.\u0275\u0275reference(10);e.\u0275\u0275property("invalid",t.namespaceForm.controls.pool.invalid&&t.namespaceForm.controls.pool.dirty)("invalidText",n),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",null===t.pools),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null!==t.pools&&0===t.pools.length),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null!==t.pools&&t.pools.length>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",t.pools)}}function hl(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",25),e.\u0275\u0275i18n(1,6),e.\u0275\u0275elementEnd())}function Ol(i,r){if(1&i&&e.\u0275\u0275template(0,hl,2,0,"span",24),2&i){const t=e.\u0275\u0275nextContext(),n=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.namespaceForm.showError("pool",n,"required"))}}function Rl(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",25),e.\u0275\u0275i18n(1,7),e.\u0275\u0275elementEnd())}function Il(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",25),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd())}function Nl(i,r){if(1&i&&e.\u0275\u0275template(0,Rl,2,0,"span",24)(1,Il,2,0,"span",24),2&i){const t=e.\u0275\u0275nextContext(),n=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.namespaceForm.showError("namespace",n,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.namespaceForm.showError("namespace",n,"namespaceExists"))}}let bl=(()=>{class i extends m.BaseModal{constructor(t,n,o,a,s,l){super(),this.actionLabels=t,this.authStorageService=n,this.notificationService=o,this.poolService=a,this.rbdService=s,this.modalService=l,this.pools=null,this.editing=!1,this.onSubmit=new z.Subject,this.poolPermission=this.authStorageService.getPermissions().pool,this.createForm()}createForm(){this.namespaceForm=new k.$({pool:new _.UntypedFormControl(""),namespace:new _.UntypedFormControl("")},this.validator(),this.asyncValidator())}validator(){return t=>{const n=t.get("pool"),o=t.get("namespace");let a=null;n.value||(a={required:!0}),n.setErrors(a);let s=null;return o.value||(s={required:!0}),o.setErrors(s),null}}asyncValidator(){return t=>new Promise(n=>{const o=t.get("pool"),a=t.get("namespace");this.rbdService.listNamespaces(o.value).subscribe(s=>{if(s.some(l=>l.namespace===a.value)){const l={namespaceExists:!0};a.setErrors(l),n(l)}else n(null)})})}ngOnInit(){this.poolPermission.read&&this.poolService.list(["pool_name","type","application_metadata"]).then(t=>{const n=[];for(const o of t)this.rbdService.isRBDPool(o)&&"replicated"===o.type&&n.push(o);if(this.pools=n,1===this.pools.length){const o=this.pools[0].pool_name;this.namespaceForm.get("pool").setValue(o)}})}submit(){const t=this.namespaceForm.getValue("pool"),n=this.namespaceForm.getValue("namespace"),o=new h.O;o.name="rbd/namespace/create",o.metadata={pool:t,namespace:n},this.rbdService.createNamespace(t,n).toPromise().then(()=>{this.modalService.destroy(),this.notificationService.show(st._.success,"Created namespace '" + t + "/" + n + "'"),this.onSubmit.next()}).catch(()=>{this.namespaceForm.setErrors({cdSubmitButton:!0})})}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(j.v),e.\u0275\u0275directiveInject(He.J),e.\u0275\u0275directiveInject(ke.m),e.\u0275\u0275directiveInject(U.U),e.\u0275\u0275directiveInject(m.ModalService))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-rbd-namespace-form-modal"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:18,vars:10,consts:()=>{let t,n,o,a,s,l;return t=" Create Namespace ",n="Namespace " + "\ufffd#14\ufffd\ufffd/#14\ufffd" + "",o="" + "\ufffd*2:1\ufffd\ufffd#1:1\ufffd" + "Loading..." + "[\ufffd/#1:1\ufffd\ufffd/*2:1\ufffd|\ufffd/#1:2\ufffd\ufffd/*3:2\ufffd|\ufffd/#1:3\ufffd\ufffd/*4:3\ufffd|\ufffd/#1:4\ufffd\ufffd/*5:4\ufffd]" + "" + "\ufffd*3:2\ufffd\ufffd#1:2\ufffd" + "-- No rbd pools available --" + "[\ufffd/#1:1\ufffd\ufffd/*2:1\ufffd|\ufffd/#1:2\ufffd\ufffd/*3:2\ufffd|\ufffd/#1:3\ufffd\ufffd/*4:3\ufffd|\ufffd/#1:4\ufffd\ufffd/*5:4\ufffd]" + "" + "\ufffd*4:3\ufffd\ufffd#1:3\ufffd" + "-- Select a pool --" + "[\ufffd/#1:1\ufffd\ufffd/*2:1\ufffd|\ufffd/#1:2\ufffd\ufffd/*3:2\ufffd|\ufffd/#1:3\ufffd\ufffd/*4:3\ufffd|\ufffd/#1:4\ufffd\ufffd/*5:4\ufffd]" + "" + "\ufffd*5:4\ufffd\ufffd#1:4\ufffd" + "" + "\ufffd0:4\ufffd" + "" + "[\ufffd/#1:1\ufffd\ufffd/*2:1\ufffd|\ufffd/#1:2\ufffd\ufffd/*3:2\ufffd|\ufffd/#1:3\ufffd\ufffd/*4:3\ufffd|\ufffd/#1:4\ufffd\ufffd/*5:4\ufffd]" + "",o=e.\u0275\u0275i18nPostprocess(o),a="This field is required.",s="This field is required.",l="The namespace already exists.",[["formDir","ngForm"],["poolError",""],["namespaceError",""],t,n,o,a,s,l,["size","md",3,"overlaySelected","open","hasScrollingContent"],[3,"closeSelect"],["cdsModalHeaderHeading",""],["cdsModalContent",""],["name","namespaceForm","novalidate","",3,"formGroup"],[1,"form-item"],["label","Pool","for","pool","formControlName","pool","name","pool","id","pool","cdRequiredField","Pool","modal-primary-focus","",3,"invalid","invalidText",4,"ngIf"],["label","Name","for","namespace","cdRequiredField","Namespace",3,"invalid","invalidText"],["cdsText","","type","text","placeholder","Namespace name...","id","namespace","name","namespace","formControlName","namespace","autofocus","",3,"invalid"],[3,"submitActionEvent","form","submitText","modalForm"],["label","Pool","for","pool","formControlName","pool","name","pool","id","pool","cdRequiredField","Pool","modal-primary-focus","",3,"invalid","invalidText"],[3,"ngValue",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[3,"ngValue"],[3,"value"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-modal",9),e.\u0275\u0275listener("overlaySelected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(1,"cds-modal-header",10),e.\u0275\u0275listener("closeSelect",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(2,"h3",11),e.\u0275\u0275i18n(3,3),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"section",12)(5,"form",13,0)(7,"div",14),e.\u0275\u0275template(8,Ml,6,6,"cds-select",15)(9,Ol,1,1,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"div",14)(12,"cds-text-label",16),e.\u0275\u0275i18nStart(13,4),e.\u0275\u0275element(14,"input",17),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(15,Nl,2,2,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(17,"cd-form-button-panel",18),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.submit())}),e.\u0275\u0275elementEnd()()}if(2&n){const a=e.\u0275\u0275reference(16);e.\u0275\u0275property("open",o.open)("hasScrollingContent",!0),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",o.namespaceForm),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",o.poolPermission.read),e.\u0275\u0275advance(4),e.\u0275\u0275property("invalid",o.namespaceForm.controls.namespace.invalid&&o.namespaceForm.controls.namespace.dirty)("invalidText",a),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.namespaceForm.controls.namespace.invalid&&o.namespaceForm.controls.namespace.dirty),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.namespaceForm)("submitText",o.actionLabels.CREATE)("modalForm",!0)}},dependencies:[c.NgForOf,c.NgIf,_.\u0275NgNoValidate,_.NgSelectOption,_.\u0275NgSelectMultipleOption,_.DefaultValueAccessor,_.NgControlStatus,_.NgControlStatusGroup,_.FormGroupDirective,_.FormControlName,F.e,ye.B,x.S,N.E,he.P,m.TextInputLabelComponent,m.TextInput,m.Select,m.Option,m.Modal,m.ModalHeader,m.ModalContent,m.ModalHeaderHeading]})}}return i})(),Pl=(()=>{class i{constructor(t,n,o,a,s,l){this.authStorageService=t,this.rbdService=n,this.poolService=o,this.notificationService=a,this.actionLabels=s,this.cdsModalService=l,this.selection=new _e.y,this.permission=this.authStorageService.getPermissions().rbdImage,this.tableActions=[{permission:"create",icon:T.FI.add,click:()=>this.createModal(),name:this.actionLabels.CREATE},{permission:"delete",icon:T.FI.destroy,click:()=>this.deleteModal(),name:this.actionLabels.DELETE,disable:()=>this.getDeleteDisableDesc()}]}ngOnInit(){this.columns=[{name:"Namespace",prop:"namespace",flexGrow:1},{name:"Pool",prop:"pool",flexGrow:1},{name:"Total images",prop:"num_images",flexGrow:1}],this.refresh()}refresh(){this.poolService.list(["pool_name","type","application_metadata"]).then(t=>{t=t.filter(o=>this.rbdService.isRBDPool(o)&&"replicated"===o.type);const n=[];t.forEach(o=>{n.push(this.rbdService.listNamespaces(o.pool_name))}),n.length>0?(0,z.forkJoin)(n).subscribe(o=>{const a=[];for(let s=0;s<o.length;s++){const d=t[s].pool_name;o[s].forEach(u=>{a.push({id:`${d}/${u.namespace}`,pool:d,namespace:u.namespace,num_images:u.num_images})})}this.namespaces=a}):this.namespaces=[]})}updateSelection(t){this.selection=t}createModal(){this.cdsModalService.show(bl).onSubmit?.subscribe(()=>this.refresh())}deleteModal(){const t=this.selection.first().pool,n=this.selection.first().namespace,o=this.cdsModalService.show(le.D,{itemDescription:"Namespace",itemNames:[`${t}/${n}`],submitAction:()=>this.rbdService.deleteNamespace(t,n).subscribe(()=>{this.notificationService.show(st._.success,"Deleted namespace '" + t + "/" + n + "'"),this.cdsModalService.dismissAll(),this.refresh()},()=>{this.cdsModalService.stopLoadingSpinner(o.deletionForm)})})}getDeleteDisableDesc(){return this.selection.first()?.num_images>0?"Namespace contains images":!this.selection?.first()}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(j.v),e.\u0275\u0275directiveInject(U.U),e.\u0275\u0275directiveInject(ke.m),e.\u0275\u0275directiveInject(He.J),e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(ce.V))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-rbd-namespace-list"]],features:[e.\u0275\u0275ProvidersFeature([Se.D])],decls:4,vars:5,consts:[["columnMode","flex","identifier","id","forceIdentifier","true","selectionType","single",3,"fetchData","updateSelection","data","columns"],[1,"table-actions"],[1,"btn-group",3,"permission","selection","tableActions"]],template:function(n,o){1&n&&(e.\u0275\u0275element(0,"cd-rbd-tabs"),e.\u0275\u0275elementStart(1,"cd-table",0),e.\u0275\u0275listener("fetchData",function(){return o.refresh()})("updateSelection",function(s){return o.updateSelection(s)}),e.\u0275\u0275elementStart(2,"div",1),e.\u0275\u0275element(3,"cd-table-actions",2),e.\u0275\u0275elementEnd()()),2&n&&(e.\u0275\u0275advance(),e.\u0275\u0275property("data",o.namespaces)("columns",o.columns),e.\u0275\u0275advance(2),e.\u0275\u0275property("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[Y.O,de.j,nt]})}}return i})(),Al=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-rbd-performance"]],decls:2,vars:2,consts:()=>{let t;return t="RBD overview",[["title",t,"uid","41FrpeUiz","grafanaStyle","two",3,"grafanaPath","type"]]},template:function(n,o){1&n&&e.\u0275\u0275element(0,"cd-rbd-tabs")(1,"cd-grafana",0),2&n&&(e.\u0275\u0275advance(),e.\u0275\u0275property("grafanaPath","rbd-overview?")("type","metrics"))},dependencies:[et.c,nt]})}}return i})();var vl=p(29130);function Dl(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"option",15),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=r.$implicit;e.\u0275\u0275property("value",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t)}}function Ll(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"cds-select",12)(1,"option",13),e.\u0275\u0275i18n(2,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,Dl,2,2,"option",14),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.pools)}}let yl=(()=>{class i extends m.BaseModal{constructor(t,n,o,a,s,l){super(),this.authStorageService=t,this.rbdService=n,this.actionLabels=o,this.fb=a,this.poolService=s,this.taskWrapper=l,this.poolPermission=this.authStorageService.getPermissions().pool}createForm(){this.purgeForm=this.fb.group({poolName:""})}ngOnInit(){this.poolPermission.read&&this.poolService.list(["pool_name","application_metadata"]).then(t=>{this.pools=t.filter(n=>n.application_metadata.includes("rbd")).map(n=>n.pool_name)}),this.createForm()}purge(){const t=this.purgeForm.getValue("poolName")||"";this.taskWrapper.wrapTaskAroundCall({task:new h.O("rbd/trash/purge",{pool_name:t}),call:this.rbdService.purgeTrash(t)}).subscribe({error:()=>{this.purgeForm.setErrors({cdSubmitButton:!0})},complete:()=>{this.closeModal()}})}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(j.v),e.\u0275\u0275directiveInject(U.U),e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(Ze.$),e.\u0275\u0275directiveInject(ke.m),e.\u0275\u0275directiveInject(y.a))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-rbd-trash-purge-modal"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:14,vars:7,consts:()=>{let t,n,o;return t="Purge Trash",n="To purge, select\xA0 " + "[\ufffd#9\ufffd|\ufffd#10\ufffd]" + "All" + "[\ufffd/#9\ufffd|\ufffd/#10\ufffd]" + "\xA0 or one pool and click\xA0 " + "[\ufffd#9\ufffd|\ufffd#10\ufffd]" + "Purge" + "[\ufffd/#9\ufffd|\ufffd/#10\ufffd]" + ".\xA0",n=e.\u0275\u0275i18nPostprocess(n),o="All",[["formDir","ngForm"],t,n,o,["size","md",3,"overlaySelected","open","hasScrollingContent"],[3,"closeSelect"],["cdsModalHeaderHeading",""],["cdsModalContent",""],["name","purgeForm","novalidate","",1,"form",3,"formGroup"],[1,"form-item"],["label","Pool","for","poolName","id","poolName","formControlName","poolName",4,"ngIf"],[3,"submitActionEvent","form","submitText","modalForm"],["label","Pool","for","poolName","id","poolName","formControlName","poolName"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-modal",4),e.\u0275\u0275listener("overlaySelected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(1,"cds-modal-header",5),e.\u0275\u0275listener("closeSelect",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(2,"h3",6),e.\u0275\u0275i18n(3,1),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"section",7)(5,"form",8,0)(7,"p"),e.\u0275\u0275i18nStart(8,2),e.\u0275\u0275element(9,"kbd")(10,"kbd"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"div",9),e.\u0275\u0275template(12,Ll,4,1,"cds-select",10),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(13,"cd-form-button-panel",11),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.purge())}),e.\u0275\u0275elementEnd()()}2&n&&(e.\u0275\u0275property("open",!0)("hasScrollingContent",!0),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",o.purgeForm),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",o.poolPermission.read),e.\u0275\u0275advance(),e.\u0275\u0275property("form",o.purgeForm)("submitText",o.actionLabels.PURGE)("modalForm",!0))},dependencies:[c.NgForOf,c.NgIf,_.\u0275NgNoValidate,_.NgSelectOption,_.\u0275NgSelectMultipleOption,_.NgControlStatus,_.NgControlStatusGroup,_.FormGroupDirective,_.FormControlName,F.e,N.E,m.Select,m.Option,m.Modal,m.ModalHeader,m.ModalContent,m.ModalHeaderHeading]})}}return i})(),$l=(()=>{class i extends m.BaseModal{constructor(t,n,o,a,s,l,d,u,f=""){super(),this.rbdService=t,this.actionLabels=n,this.fb=o,this.taskWrapper=a,this.poolName=s,this.namespace=l,this.imageName=d,this.imageId=u,this.imageSpec=f}ngOnInit(){this.imageSpec=new w.J(this.poolName,this.namespace,this.imageName).toString(),this.restoreForm=this.fb.group({name:this.imageName})}restore(){const t=this.restoreForm.getValue("name"),n=new w.J(this.poolName,this.namespace,this.imageId);this.taskWrapper.wrapTaskAroundCall({task:new h.O("rbd/trash/restore",{image_id_spec:n.toString(),new_image_name:t}),call:this.rbdService.restoreTrash(n,t)}).subscribe({error:()=>{this.restoreForm.setErrors({cdSubmitButton:!0})},complete:()=>{this.closeModal()}})}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(U.U),e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(Ze.$),e.\u0275\u0275directiveInject(y.a),e.\u0275\u0275directiveInject("poolName"),e.\u0275\u0275directiveInject("namespace"),e.\u0275\u0275directiveInject("imageName"),e.\u0275\u0275directiveInject("imageId"),e.\u0275\u0275directiveInject("imageSpec",8))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-rbd-trash-restore-modal"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:16,vars:8,consts:()=>{let t,n,o;return t="Restore Image",n="To restore\xA0 " + "[\ufffd#9\ufffd|\ufffd#10\ufffd]" + "" + "\ufffd0\ufffd" + "@" + "\ufffd1\ufffd" + "" + "[\ufffd/#9\ufffd|\ufffd/#10\ufffd]" + ",\xA0 type the image's new name and click\xA0 " + "[\ufffd#9\ufffd|\ufffd#10\ufffd]" + "Restore" + "[\ufffd/#9\ufffd|\ufffd/#10\ufffd]" + ".",n=e.\u0275\u0275i18nPostprocess(n),o="Name " + "\ufffd#14\ufffd\ufffd/#14\ufffd" + "",[["formDir","ngForm"],t,n,o,["size","sm",3,"overlaySelected","open"],[3,"closeSelect"],["cdsModalHeaderHeading",""],["cdsModalContent",""],["name","restoreForm","novalidate","",1,"form",3,"formGroup"],[1,"form-item"],["for","name","invalidText","The field is required","cdRequiredField","Name",3,"invalid"],["cdsText","","name","name","id","name","formControlName","name","autocomplete","off","autofocus",""],[3,"submitActionEvent","form","submitText","modalForm"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-modal",4),e.\u0275\u0275listener("overlaySelected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(1,"cds-modal-header",5),e.\u0275\u0275listener("closeSelect",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(2,"h3",6),e.\u0275\u0275i18n(3,1),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"section",7)(5,"form",8,0)(7,"p"),e.\u0275\u0275i18nStart(8,2),e.\u0275\u0275element(9,"kbd")(10,"kbd"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"div",9)(12,"cds-text-label",10),e.\u0275\u0275i18nStart(13,3),e.\u0275\u0275element(14,"input",11),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(15,"cd-form-button-panel",12),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.restore())}),e.\u0275\u0275elementEnd()()}if(2&n){const a=e.\u0275\u0275reference(6);e.\u0275\u0275property("open",o.open),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",o.restoreForm),e.\u0275\u0275advance(5),e.\u0275\u0275i18nExp(o.imageSpec)(o.imageId),e.\u0275\u0275i18nApply(8),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.restoreForm.showError("name",a,"required")),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.restoreForm)("submitText",o.actionLabels.RESTORE)("modalForm",!0)}},dependencies:[_.\u0275NgNoValidate,_.DefaultValueAccessor,_.NgControlStatus,_.NgControlStatusGroup,_.FormGroupDirective,_.FormControlName,F.e,ye.B,x.S,N.E,he.P,m.TextInputLabelComponent,m.TextInput,m.Modal,m.ModalHeader,m.ModalContent,m.ModalHeaderHeading]})}}return i})();const Bl=["expiresTpl"],Gl=["deleteTpl"];function xl(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",10),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.purgeModal())}),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18n(2,2),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(3,"svg",11),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("disabled",t.disablePurgeBtn)}}function wl(i,r){1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275i18n(1,3),e.\u0275\u0275elementContainerEnd())}function Vl(i,r){1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275i18n(1,4),e.\u0275\u0275elementContainerEnd())}function Hl(i,r){if(1&i&&(e.\u0275\u0275template(0,wl,2,0,"ng-container",12)(1,Vl,2,0,"ng-container",12),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"cdDate")),2&i){const t=r.data.row,n=r.data.value;e.\u0275\u0275property("ngIf",t.cdIsExpired),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!t.cdIsExpired),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,3,n),"\n")}}function kl(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"p",14)(1,"strong"),e.\u0275\u0275elementContainerStart(2),e.\u0275\u0275i18n(3,5),e.\u0275\u0275pipe(4,"cdDate"),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext().expiresAt;e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(4,1,t)),e.\u0275\u0275i18nApply(3)}}function Kl(i,r){1&i&&e.\u0275\u0275template(0,kl,5,3,"p",13),2&i&&e.\u0275\u0275property("ngIf",!r.isExpired)}let zl=(()=>{class i{constructor(t,n,o,a,s,l,d){this.authStorageService=t,this.rbdService=n,this.modalService=o,this.cdDatePipe=a,this.taskListService=s,this.taskWrapper=l,this.actionLabels=d,this.icons=T.FI,this.executingTasks=[],this.selection=new _e.y,this.tableStatus=new pe.m,this.disablePurgeBtn=!0,this.permission=this.authStorageService.getPermissions().rbdImage,this.tableActions=[{permission:"update",icon:T.FI.undo,click:()=>this.restoreModal(),name:this.actionLabels.RESTORE},{permission:"delete",icon:T.FI.destroy,click:()=>this.deleteModal(),name:this.actionLabels.DELETE}]}ngOnInit(){this.columns=[{name:"ID",prop:"id",flexGrow:1,cellTransformation:xe.x.executing},{name:"Name",prop:"name",flexGrow:1},{name:"Pool",prop:"pool_name",flexGrow:1},{name:"Namespace",prop:"namespace",flexGrow:1},{name:"Status",prop:"deferment_end_time",flexGrow:1,cellTemplate:this.expiresTpl},{name:"Deleted At",prop:"deletion_time",flexGrow:1,pipe:this.cdDatePipe}],this.taskListService.init(()=>this.rbdService.listTrash(),o=>this.prepareResponse(o),o=>this.images=o,()=>this.onFetchError(),o=>["rbd/trash/remove","rbd/trash/restore"].includes(o.name),(o,a)=>new w.J(o.pool_name,o.namespace,o.id).toString()===a.metadata.image_id_spec,void 0)}prepareResponse(t){let n=[];const o={};let a;if(t.forEach(s=>{C().isUndefined(o[s.status])&&(o[s.status]=[]),o[s.status].push(s.pool_name),n=n.concat(s.value),this.disablePurgeBtn=!n.length}),o[3]?a=3:o[1]?a=1:o[2]&&(a=2),a){const s=(o[a].length>1?"pools ":"pool ")+o[a].join();this.tableStatus=new pe.m(a,s)}else this.tableStatus=new pe.m;return n.forEach(s=>{s.cdIsExpired=Be()().isAfter(s.deferment_end_time)}),n}onFetchError(){this.table.reset(),this.tableStatus=new pe.m(vl.k.ValueException)}updateSelection(t){this.selection=t}restoreModal(){const t={poolName:this.selection.first().pool_name,namespace:this.selection.first().namespace,imageName:this.selection.first().name,imageId:this.selection.first().id};this.modalRef=this.modalService.show($l,t)}deleteModal(){const t=this.selection.first().pool_name,n=this.selection.first().namespace,o=this.selection.first().id,a=this.selection.first().deferment_end_time,s=Be()().isAfter(a),l=new w.J(t,n,o);this.modalRef=this.modalService.show(le.D,{itemDescription:"RBD",itemNames:[l],bodyTemplate:this.deleteTpl,bodyContext:{expiresAt:a,isExpired:s},submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new h.O("rbd/trash/remove",{image_id_spec:l.toString()}),call:this.rbdService.removeTrash(l,!0)})})}purgeModal(){this.modalService.show(yl)}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(j.v),e.\u0275\u0275directiveInject(U.U),e.\u0275\u0275directiveInject(ce.V),e.\u0275\u0275directiveInject(ze.Q),e.\u0275\u0275directiveInject(Se.D),e.\u0275\u0275directiveInject(y.a),e.\u0275\u0275directiveInject(O.Ss))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-rbd-trash-list"]],viewQuery:function(n,o){if(1&n&&(e.\u0275\u0275viewQuery(Y.O,7),e.\u0275\u0275viewQuery(Bl,7),e.\u0275\u0275viewQuery(Gl,7)),2&n){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.table=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.expiresTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.deleteTpl=a.first)}},features:[e.\u0275\u0275ProvidersFeature([Se.D])],decls:9,vars:8,consts:()=>{let t,n,o,a;return t="Purge Trash",n="Expired at",o="Protected until",a="This image is protected until " + "\ufffd0\ufffd" + ".",[["expiresTpl",""],["deleteTpl",""],t,n,o,a,["columnMode","flex","identifier","id","forceIdentifier","true","selectionType","single",3,"fetchData","updateSelection","data","columns","status","autoReload"],[1,"table-actions"],[1,"btn-group",3,"permission","selection","tableActions"],["cdsButton","tertiary","type","button",3,"disabled","click",4,"ngIf"],["cdsButton","tertiary","type","button",3,"click","disabled"],["cdsIcon","close","size","16",1,"cds--btn__icon"],[4,"ngIf"],["class","text-danger",4,"ngIf"],[1,"text-danger"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275element(0,"cd-rbd-tabs"),e.\u0275\u0275elementStart(1,"cd-table",6),e.\u0275\u0275listener("fetchData",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.taskListService.fetch())})("updateSelection",function(l){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.updateSelection(l))}),e.\u0275\u0275elementStart(2,"div",7),e.\u0275\u0275element(3,"cd-table-actions",8),e.\u0275\u0275template(4,xl,4,1,"button",9),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(5,Hl,4,5,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)(7,Kl,1,1,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)}2&n&&(e.\u0275\u0275advance(),e.\u0275\u0275property("data",o.images)("columns",o.columns)("status",o.tableStatus)("autoReload",-1),e.\u0275\u0275advance(2),e.\u0275\u0275property("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.permission.delete))},dependencies:[c.NgIf,Y.O,de.j,x.S,m.Button,m.IconDirective,nt,ze.Q]})}}return i})();const J="api/nvmeof",vt="ui-api/nvmeof";let fe=(()=>{class i{constructor(t){this.http=t}formatGwGroupsList(t,n=!1){return t[0].reduce((o,a)=>(n&&a?.spec?.group&&a?.service_name?o.push({content:a.spec.group,serviceName:a.service_name}):a?.spec?.group&&o.push({content:a.spec.group}),o),[])}listGatewayGroups(){return this.http.get(`${J}/gateway/group`)}listGateways(){return this.http.get(`${J}/gateway`)}listSubsystems(t){return this.http.get(`${J}/subsystem?gw_group=${t}`)}getSubsystem(t,n){return this.http.get(`${J}/subsystem/${t}?gw_group=${n}`)}createSubsystem(t){return this.http.post(`${J}/subsystem`,t,{observe:"response"})}deleteSubsystem(t,n){return this.http.delete(`${J}/subsystem/${t}?gw_group=${n}`,{observe:"response"})}isSubsystemPresent(t,n){return this.getSubsystem(t,n).pipe((0,Me.mapTo)(!0),(0,Me.catchError)(o=>(o?.preventDefault(),(0,z.of)(!1))))}getInitiators(t,n){return this.http.get(`${J}/subsystem/${t}/host?gw_group=${n}`)}addInitiators(t,n){return this.http.post(`${vt}/subsystem/${t}/host`,n,{observe:"response"})}removeInitiators(t,n){return this.http.delete(`${vt}/subsystem/${t}/host/${n.host_nqn}/${n.gw_group}`,{observe:"response"})}listListeners(t,n){return this.http.get(`${J}/subsystem/${t}/listener?gw_group=${n}`)}createListener(t,n){return this.http.post(`${J}/subsystem/${t}/listener`,n,{observe:"response"})}deleteListener(t,n,o,a,s){return this.http.delete(`${J}/subsystem/${t}/listener/${o}/${a}`,{observe:"response",params:{gw_group:n,trsvcid:s,force:"true"}})}listNamespaces(t,n){return this.http.get(`${J}/subsystem/${t}/namespace?gw_group=${n}`)}getNamespace(t,n,o){return this.http.get(`${J}/subsystem/${t}/namespace/${n}?gw_group=${o}`)}createNamespace(t,n){return this.http.post(`${J}/subsystem/${t}/namespace`,n,{observe:"response"})}updateNamespace(t,n,o){return this.http.patch(`${J}/subsystem/${t}/namespace/${n}`,o,{observe:"response"})}deleteNamespace(t,n,o){return this.http.delete(`${J}/subsystem/${t}/namespace/${n}?gw_group=${o}`,{observe:"response"})}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275inject(De.HttpClient))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Ul=p(28886);let Dt=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-nvmeof-tabs"]],decls:7,vars:0,consts:()=>{let t,n;return t="Subsystems",n="Gateways",[t,n,[1,"nav","nav-tabs"],[1,"nav-item"],["routerLink","/block/nvmeof/subsystems","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link"],["routerLink","/block/nvmeof/gateways","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link"]]},template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"ul",2)(1,"li",3)(2,"a",4),e.\u0275\u0275i18n(3,0),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"li",3)(5,"a",5),e.\u0275\u0275i18n(6,1),e.\u0275\u0275elementEnd()()())},dependencies:[v.RouterLink,v.RouterLinkActive]})}}return i})();var jl=p(45757);const ql=["statusTpl"],Ql=()=>({md:4});function Yl(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span",11),e.\u0275\u0275pipe(1,"pipeFunction"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()),2&i){const t=r.data.row,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngClass",e.\u0275\u0275pipeBind2(1,2,t,n.getStatusClass)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",t.status_desc," ")}}function Wl(i,r){1&i&&(e.\u0275\u0275elementStart(0,"legend"),e.\u0275\u0275i18nStart(1,4),e.\u0275\u0275element(2,"cd-help-text"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd())}function Jl(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275template(0,Wl,3,0,"legend",12),e.\u0275\u0275elementStart(1,"div")(2,"cd-table",13),e.\u0275\u0275listener("fetchData",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.getGateways())}),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngIf",t.selectedTab===t.Tabs.gateways),e.\u0275\u0275advance(2),e.\u0275\u0275property("data",t.gateways)("columns",t.gatewayColumns)}}function Zl(i,r){if(1&i&&e.\u0275\u0275element(0,"cd-grafana",14),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate1("grafanaPath","ceph-nvme-of-gateways-overview?var-group=",t.selectedGatewayGroup,"&var-gateway=All"),e.\u0275\u0275property("type","metrics")}}function e_(i,r){if(1&i&&e.\u0275\u0275element(0,"cd-grafana",15),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate1("grafanaPath","ceph-nvme-of-gateways-performance?var-group=",t.selectedGatewayGroup,""),e.\u0275\u0275property("type","metrics")}}var Lt=function(i){return i[i.gateways=0]="gateways",i[i.overview=1]="overview",i}(Lt||{});const yt="Enter group name";let t_=(()=>{class i{onSelected(t){this.selectedTab=t}get Tabs(){return Lt}constructor(t,n,o){this.nvmeofService=t,this.cephServiceService=n,this.actionLabels=o,this.gateways=[],this.selection=new _e.y,this.gwGroups=[],this.groupService=null,this.selectedGatewayGroup=null,this.gwGroupsEmpty=!1,this.gwGroupPlaceholder=yt}ngOnInit(){this.setGatewayGroups(),this.gatewayColumns=[{name:"Gateway ID",prop:"id"},{name:"Hostname",prop:"hostname"},{name:"Status",prop:"status_desc",cellTemplate:this.statusTpl}]}getStatusClass(t){return C().get({"-1":"badge-danger",0:"badge-warning",1:"badge-success"},t.status,"badge-dark")}getGateways(){this.cephServiceService.getDaemons(this.groupService).subscribe(t=>{this.gateways=t.length?t.map(n=>({id:`client.${n.daemon_name}`,hostname:n.hostname,status_desc:n.status_desc,status:n.status})):[]})}onGroupSelection(t){t.selected=!0,this.groupService=t.serviceName,this.selectedGatewayGroup=t.content,this.getGateways()}onGroupClear(){this.groupService=null,this.getGateways()}setGatewayGroups(){this.nvmeofService.listGatewayGroups().subscribe(t=>{this.gwGroups=t?.[0]?.length?this.nvmeofService.formatGwGroupsList(t,!0):[],!this.groupService&&this.gwGroups.length?(this.onGroupSelection(this.gwGroups[0]),this.gwGroupsEmpty=!1,this.gwGroupPlaceholder=yt):(this.gwGroupsEmpty=!0,this.gwGroupPlaceholder="No groups available")})}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(fe),e.\u0275\u0275directiveInject(Ul.t),e.\u0275\u0275directiveInject(O.Ss))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-nvmeof-gateway"]],viewQuery:function(n,o){if(1&n&&e.\u0275\u0275viewQuery(ql,7),2&n){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.statusTpl=a.first)}},decls:16,vars:9,consts:()=>{let t,n,o,a,s,l,d;return t="Selected Gateway Group",n="Gateways",o="Overview",a="Performance",s=" Gateways " + "\ufffd#2\ufffd" + " Ceph NVMe-oF gateways provide Ceph Block Device storage through NVMe/TCP. For VMware clients the NVMe/TCP volumes display as VMFS Datastores. For Linux clients the NVMe/TCP volumes display as as block devices. " + "\ufffd/#2\ufffd" + "",l="Gateway overview",d="Gateway performance",[["statusTpl",""],["gateways_content",""],["overview_content",""],["performance_content",""],s,["cdsCol","",1,"pb-3",3,"columnNumbers"],["type","single","label",t,3,"selected","clear","placeholder","items","disabled"],["type","contained","followFocus","true","isNavigation","true",3,"cacheActive"],["heading",n,3,"selected","tabContent"],["heading",o,3,"selected","tabContent"],["heading",a,3,"selected","tabContent"],[1,"badge",3,"ngClass"],[4,"ngIf"],[3,"fetchData","data","columns"],["title",l,"uid","feeuv1dno43r4ddjhjssdd","grafanaStyle","three",3,"grafanaPath","type"],["title",d,"uid","feeuv1dno43r4deed","grafanaStyle","three",3,"grafanaPath","type"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275element(0,"cd-nvmeof-tabs"),e.\u0275\u0275elementStart(1,"div",5)(2,"cds-combo-box",6),e.\u0275\u0275listener("selected",function(l){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onGroupSelection(l))})("clear",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onGroupClear())}),e.\u0275\u0275element(3,"cds-dropdown-list"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(4,Yl,3,5,"ng-template",null,0,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(6,"cds-tabs",7)(7,"cds-tab",8),e.\u0275\u0275listener("selected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onSelected(o.Tabs.gateways))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"cds-tab",9),e.\u0275\u0275listener("selected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onSelected(o.Tabs.overview))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"cds-tab",10),e.\u0275\u0275listener("selected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onSelected(o.Tabs.overview))}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(10,Jl,3,3,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)(12,Zl,1,3,"ng-template",null,2,e.\u0275\u0275templateRefExtractor)(14,e_,1,3,"ng-template",null,3,e.\u0275\u0275templateRefExtractor)}if(2&n){const a=e.\u0275\u0275reference(11),s=e.\u0275\u0275reference(13),l=e.\u0275\u0275reference(15);e.\u0275\u0275advance(),e.\u0275\u0275property("columnNumbers",e.\u0275\u0275pureFunction0(8,Ql)),e.\u0275\u0275advance(),e.\u0275\u0275property("placeholder",o.gwGroupPlaceholder)("items",o.gwGroups)("disabled",o.gwGroupsEmpty),e.\u0275\u0275advance(4),e.\u0275\u0275property("cacheActive",!1),e.\u0275\u0275advance(),e.\u0275\u0275property("tabContent",a),e.\u0275\u0275advance(),e.\u0275\u0275property("tabContent",s),e.\u0275\u0275advance(),e.\u0275\u0275property("tabContent",l)}},dependencies:[c.NgClass,c.NgIf,et.c,ue.O,Y.O,m.ColumnDirective,m.ComboBox,m.DropdownList,m.Tabs,m.Tab,Dt,jl.N]})}}return i})();var n_=p(37823);let i_=(()=>{class i{constructor(t,n,o,a,s,l){this.actionLabels=t,this.modalService=n,this.authStorageService=o,this.taskWrapper=a,this.nvmeofService=s,this.router=l,this.selection=new _e.y,this.permission=this.authStorageService.getPermissions().nvmeof}ngOnInit(){this.listenerColumns=[{name:"Host",prop:"host_name"},{name:"Transport",prop:"trtype"},{name:"Address",prop:"full_addr",cellTransformation:xe.x.copy}],this.tableActions=[{name:this.actionLabels.CREATE,permission:"create",icon:T.FI.add,click:()=>this.router.navigate(["block/nvmeof/subsystems",{outlets:{modal:[O.Qp.CREATE,this.subsystemNQN,"listener"]}}],{queryParams:{group:this.group}}),canBePrimary:t=>!t.hasSelection},{name:this.actionLabels.DELETE,permission:"delete",icon:T.FI.destroy,click:()=>this.deleteListenerModal()}]}updateSelection(t){this.selection=t}listListeners(){this.nvmeofService.listListeners(this.subsystemNQN,this.group).subscribe(t=>{this.listeners=t.map((n,o)=>(n.id=o,n.full_addr=`${n.traddr}:${n.trsvcid}`,n))})}deleteListenerModal(){const t=this.selection.first();this.modalService.show(le.D,{itemDescription:"Listener",actionDescription:"delete",infoMessage:"This action will delete listener despite any active connections.",itemNames:["listener"+` ${t.host_name} (${t.traddr}:${t.trsvcid})`],submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new h.O("nvmeof/listener/delete",{nqn:this.subsystemNQN,host_name:t.host_name}),call:this.nvmeofService.deleteListener(this.subsystemNQN,this.group,t.host_name,t.traddr,t.trsvcid)})})}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(ce.V),e.\u0275\u0275directiveInject(j.v),e.\u0275\u0275directiveInject(y.a),e.\u0275\u0275directiveInject(fe),e.\u0275\u0275directiveInject(v.Router))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-nvmeof-listeners-list"]],inputs:{subsystemNQN:"subsystemNQN",group:"group"},decls:6,vars:5,consts:[["columnMode","flex","identifier","id","forceIdentifier","true","selectionType","single",3,"fetchData","updateSelection","data","columns"],[1,"table-actions"],[1,"btn-group",3,"permission","selection","tableActions"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"legend")(1,"cd-help-text"),e.\u0275\u0275text(2," A listener defines the IP address and port on the gateway that is used to process NVMe/TCP admin and I/O commands to a subsystem. "),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(3,"cd-table",0),e.\u0275\u0275listener("fetchData",function(){return o.listListeners()})("updateSelection",function(s){return o.updateSelection(s)}),e.\u0275\u0275elementStart(4,"div",1),e.\u0275\u0275element(5,"cd-table-actions",2),e.\u0275\u0275elementEnd()()),2&n&&(e.\u0275\u0275advance(3),e.\u0275\u0275property("data",o.listeners)("columns",o.listenerColumns),e.\u0275\u0275advance(2),e.\u0275\u0275property("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[ue.O,Y.O,de.j]})}}return i})();var a_=p(25081),r_=p(49658);const $t="block/nvmeof/subsystems";let s_=(()=>{class i{constructor(t,n,o,a,s,l,d,u,f){this.actionLabels=t,this.router=n,this.modalService=o,this.authStorageService=a,this.taskWrapper=s,this.nvmeofService=l,this.dimlessBinaryPipe=d,this.mbPerSecondPipe=u,this.iopsPipe=f,this.selection=new _e.y,this.permission=this.authStorageService.getPermissions().nvmeof}ngOnInit(){this.namespacesColumns=[{name:"ID",prop:"nsid"},{name:"Bdev Name",prop:"bdev_name"},{name:"Pool ",prop:"rbd_pool_name",flexGrow:2},{name:"Image",prop:"rbd_image_name",flexGrow:3},{name:"Image Size",prop:"rbd_image_size",pipe:this.dimlessBinaryPipe},{name:"Block Size",prop:"block_size",pipe:this.dimlessBinaryPipe},{name:"IOPS",prop:"rw_ios_per_second",sortable:!1,pipe:this.iopsPipe,flexGrow:1.5},{name:"R/W Throughput",prop:"rw_mbytes_per_second",sortable:!1,pipe:this.mbPerSecondPipe,flexGrow:1.5},{name:"Read Throughput",prop:"r_mbytes_per_second",sortable:!1,pipe:this.mbPerSecondPipe,flexGrow:1.5},{name:"Write Throughput",prop:"w_mbytes_per_second",sortable:!1,pipe:this.mbPerSecondPipe,flexGrow:1.5},{name:"Load Balancing Group",prop:"load_balancing_group",flexGrow:1.5}],this.tableActions=[{name:this.actionLabels.CREATE,permission:"create",icon:T.FI.add,click:()=>this.router.navigate([$t,{outlets:{modal:[O.Qp.CREATE,this.subsystemNQN,"namespace"]}}],{queryParams:{group:this.group}}),canBePrimary:t=>!t.hasSelection},{name:this.actionLabels.EDIT,permission:"update",icon:T.FI.edit,click:()=>this.router.navigate([$t,{outlets:{modal:[O.Qp.EDIT,this.subsystemNQN,"namespace",this.selection.first().nsid]}}],{queryParams:{group:this.group}})},{name:this.actionLabels.DELETE,permission:"delete",icon:T.FI.destroy,click:()=>this.deleteNamespaceModal()}]}updateSelection(t){this.selection=t}listNamespaces(){this.nvmeofService.listNamespaces(this.subsystemNQN,this.group).subscribe(t=>{this.namespaces=t})}deleteNamespaceModal(){const t=this.selection.first();this.modalService.show(le.D,{itemDescription:"Namespace",itemNames:[t.nsid],actionDescription:"delete",submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new h.O("nvmeof/namespace/delete",{nqn:this.subsystemNQN,nsid:t.nsid}),call:this.nvmeofService.deleteNamespace(this.subsystemNQN,t.nsid,this.group)})})}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(v.Router),e.\u0275\u0275directiveInject(ce.V),e.\u0275\u0275directiveInject(j.v),e.\u0275\u0275directiveInject(y.a),e.\u0275\u0275directiveInject(fe),e.\u0275\u0275directiveInject($e.l),e.\u0275\u0275directiveInject(r_.n),e.\u0275\u0275directiveInject(a_.U))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-nvmeof-namespaces-list"]],inputs:{subsystemNQN:"subsystemNQN",group:"group"},decls:6,vars:5,consts:[["columnMode","flex","selectionType","single",3,"fetchData","updateSelection","data","columns"],[1,"table-actions"],[1,"btn-group",3,"permission","selection","tableActions"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"legend")(1,"cd-help-text"),e.\u0275\u0275text(2," An NVMe namespace is a quantity of non-volatile storage that can be formatted into logical blocks and presented to a host as a standard block device. "),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(3,"cd-table",0),e.\u0275\u0275listener("fetchData",function(){return o.listNamespaces()})("updateSelection",function(s){return o.updateSelection(s)}),e.\u0275\u0275elementStart(4,"div",1),e.\u0275\u0275element(5,"cd-table-actions",2),e.\u0275\u0275elementEnd()()),2&n&&(e.\u0275\u0275advance(3),e.\u0275\u0275property("data",o.namespaces)("columns",o.namespacesColumns),e.\u0275\u0275advance(2),e.\u0275\u0275property("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[ue.O,Y.O,de.j]})}}return i})();const l_=["hostTpl"];function __(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",6),e.\u0275\u0275i18n(1,1),e.\u0275\u0275elementEnd())}function c_(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span",6),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t)}}function d_(i,r){if(1&i&&e.\u0275\u0275template(0,__,2,0,"span",5)(1,c_,2,1,"span",5),2&i){const t=r.data.value;e.\u0275\u0275property("ngIf","*"===t),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","*"!==t)}}let p_=(()=>{class i{constructor(t,n,o,a,s,l){this.actionLabels=t,this.authStorageService=n,this.nvmeofService=o,this.modalService=a,this.router=s,this.taskWrapper=l,this.selection=new _e.y,this.initiators=[],this.permission=this.authStorageService.getPermissions().nvmeof}ngOnInit(){this.initiatorColumns=[{name:"Initiator",prop:"nqn",cellTemplate:this.hostTpl}],this.tableActions=[{name:this.actionLabels.ADD,permission:"create",icon:T.FI.add,click:()=>this.router.navigate(["block/nvmeof/subsystems",{outlets:{modal:[O.Qp.ADD,this.subsystemNQN,"initiator"]}}],{queryParams:{group:this.group}}),canBePrimary:t=>!t.hasSelection},{name:this.actionLabels.REMOVE,permission:"delete",icon:T.FI.destroy,click:()=>this.removeInitiatorModal(),disable:()=>!this.selection.hasSelection,canBePrimary:t=>t.hasSelection}]}getAllowAllHostIndex(){return this.selection.selected.findIndex(t=>"*"===t.nqn)}updateSelection(t){this.selection=t}listInitiators(){this.nvmeofService.getInitiators(this.subsystemNQN,this.group).subscribe(t=>{this.initiators=t})}getSelectedNQNs(){return this.selection.selected.map(t=>t.nqn)}removeInitiatorModal(){const t=this.getSelectedNQNs(),n=this.getAllowAllHostIndex(),o=t.join(",");let a=t;-1!==n&&(t.splice(n,1),a=[...t,"Allow any host(*)"]),this.modalService.show(le.D,{itemDescription:"Initiator",itemNames:a,actionDescription:"remove",submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new h.O("nvmeof/initiator/remove",{nqn:this.subsystemNQN,plural:a.length>1}),call:this.nvmeofService.removeInitiators(this.subsystemNQN,{host_nqn:o,gw_group:this.group})})})}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(j.v),e.\u0275\u0275directiveInject(fe),e.\u0275\u0275directiveInject(ce.V),e.\u0275\u0275directiveInject(v.Router),e.\u0275\u0275directiveInject(y.a))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-nvmeof-initiators-list"]],viewQuery:function(n,o){if(1&n&&e.\u0275\u0275viewQuery(l_,7),2&n){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.hostTpl=a.first)}},inputs:{subsystemNQN:"subsystemNQN",group:"group"},decls:8,vars:5,consts:()=>{let t;return t="Any host allowed (*)",[["hostTpl",""],t,["columnMode","flex","selectionType","multiClick",3,"fetchData","updateSelection","data","columns"],[1,"table-actions"],[1,"btn-group",3,"permission","selection","tableActions"],["class","font-monospace",4,"ngIf"],[1,"font-monospace"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"legend")(1,"cd-help-text"),e.\u0275\u0275text(2," An initiator (or host) is the client that connects to the NVMe-oF target to access NVMe storage. The NVMe/TCP protocol allows initiators, to send NVMe-oF commands to storage devices, which are known as targets. "),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(3,"cd-table",2),e.\u0275\u0275listener("fetchData",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.listInitiators())})("updateSelection",function(l){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.updateSelection(l))}),e.\u0275\u0275elementStart(4,"div",3),e.\u0275\u0275element(5,"cd-table-actions",4),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(6,d_,2,2,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)}2&n&&(e.\u0275\u0275advance(3),e.\u0275\u0275property("data",o.initiators)("columns",o.initiatorColumns),e.\u0275\u0275advance(2),e.\u0275\u0275property("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[c.NgIf,ue.O,Y.O,de.j]})}}return i})();function u_(i,r){if(1&i&&e.\u0275\u0275element(0,"cd-table-key-value",16),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("data",t.data)}}function g_(i,r){if(1&i&&e.\u0275\u0275element(0,"cd-nvmeof-listeners-list",17),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("subsystemNQN",t.subsystemNQN)("group",t.group)}}function S_(i,r){if(1&i&&e.\u0275\u0275element(0,"cd-nvmeof-namespaces-list",17),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("subsystemNQN",t.subsystemNQN)("group",t.group)}}function f_(i,r){if(1&i&&e.\u0275\u0275element(0,"cd-nvmeof-initiators-list",17),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("subsystemNQN",t.subsystemNQN)("group",t.group)}}function C_(i,r){if(1&i&&e.\u0275\u0275element(0,"cd-grafana",19),2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275propertyInterpolate2("grafanaPath","ceph-nvme-of-gateways-performance?var-group=",t.group,"&var-subsystem=",t.subsystemNQN,""),e.\u0275\u0275property("type","metrics")}}function E_(i,r){1&i&&(e.\u0275\u0275elementContainerStart(0,18),e.\u0275\u0275elementStart(1,"a",9),e.\u0275\u0275i18n(2,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,C_,1,4,"ng-template",10),e.\u0275\u0275elementContainerEnd())}function T_(i,r){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"nav",7,0),e.\u0275\u0275elementContainerStart(3,8),e.\u0275\u0275elementStart(4,"a",9),e.\u0275\u0275i18n(5,1),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(6,u_,1,1,"ng-template",10),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(7,11),e.\u0275\u0275elementStart(8,"a",9),e.\u0275\u0275i18n(9,2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(10,g_,1,2,"ng-template",10),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(11,12),e.\u0275\u0275elementStart(12,"a",9),e.\u0275\u0275i18n(13,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(14,S_,1,2,"ng-template",10),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(15,13),e.\u0275\u0275elementStart(16,"a",9),e.\u0275\u0275i18n(17,4),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(18,f_,1,2,"ng-template",10),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275template(19,E_,4,0,"ng-container",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(20,"div",15),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275reference(2),n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(19),e.\u0275\u0275property("ngIf",n.permissions.grafana.read),e.\u0275\u0275advance(),e.\u0275\u0275property("ngbNavOutlet",t)}}let F_=(()=>{class i{ngOnChanges(){this.selection&&(this.selectedItem=this.selection,this.subsystemNQN=this.selectedItem.nqn,this.data={},this.data["Serial Number"]=this.selectedItem.serial_number,this.data["Model Number"]=this.selectedItem.model_number,this.data["Minimum Controller Identifier"]=this.selectedItem.min_cntlid,this.data["Maximum Controller Identifier"]=this.selectedItem.max_cntlid,this.data["Subsystem Type"]=this.selectedItem.subtype)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-nvmeof-subsystems-details"]],inputs:{selection:"selection",group:"group",permissions:"permissions"},features:[e.\u0275\u0275NgOnChangesFeature],decls:1,vars:1,consts:()=>{let t,n,o,a,s,l;return t="Details",n="Listeners",o="Namespaces",a="Initiators",s="Performance Details",l="Subsystem details",[["nav","ngbNav"],t,n,o,a,s,[4,"ngIf"],["ngbNav","","cdStatefulTab","subsystem-details",1,"nav-tabs"],["ngbNavItem","details"],["ngbNavLink",""],["ngbNavContent",""],["ngbNavItem","listeners"],["ngbNavItem","namespaces"],["ngbNavItem","initiators"],["ngbNavItem","performance-details",4,"ngIf"],[3,"ngbNavOutlet"],[3,"data"],[3,"subsystemNQN","group"],["ngbNavItem","performance-details"],["title",l,"uid","feeuv1dno43r4deed","grafanaStyle","three",3,"grafanaPath","type"]]},template:function(n,o){1&n&&e.\u0275\u0275template(0,T_,21,2,"ng-container",6),2&n&&e.\u0275\u0275property("ngIf",o.selection)},dependencies:[c.NgIf,A.NgbNavContent,A.NgbNav,A.NgbNavItem,A.NgbNavLink,A.NgbNavLinkBase,A.NgbNavOutlet,et.c,n_.i,dt.B,i_,s_,p_]})}}return i})();const M_=()=>({md:4});function h_(i,r){if(1&i&&e.\u0275\u0275element(0,"cd-nvmeof-subsystems-details",8),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("selection",t.expandedRow)("permissions",t.permissions)("group",t.group)}}const Bt="Enter group name";let Gt=(()=>{class i extends rt.D{constructor(t,n,o,a,s,l,d){super(),this.nvmeofService=t,this.authStorageService=n,this.actionLabels=o,this.router=a,this.modalService=s,this.taskWrapper=l,this.route=d,this.subsystems=[],this.selection=new _e.y,this.gwGroups=[],this.group=null,this.gwGroupsEmpty=!1,this.gwGroupPlaceholder=Bt,this.permissions=this.authStorageService.getPermissions()}ngOnInit(){this.route.queryParams.subscribe(t=>{t?.group&&this.onGroupSelection({content:t?.group})}),this.setGatewayGroups(),this.subsystemsColumns=[{name:"NQN",prop:"nqn"},{name:"# Namespaces",prop:"namespace_count"},{name:"# Maximum Allowed Namespaces",prop:"max_namespaces"}],this.tableActions=[{name:this.actionLabels.CREATE,permission:"create",icon:T.FI.add,click:()=>this.router.navigate(["block/nvmeof/subsystems",{outlets:{modal:[O.Qp.CREATE]}}],{queryParams:{group:this.group}}),canBePrimary:t=>!t.hasSelection,disable:()=>!this.group},{name:this.actionLabels.DELETE,permission:"delete",icon:T.FI.destroy,click:()=>this.deleteSubsystemModal()}]}updateSelection(t){this.selection=t}getSubsystems(){this.group?this.nvmeofService.listSubsystems(this.group).subscribe(t=>{this.subsystems=Array.isArray(t)?t:[t]}):this.subsystems=[]}deleteSubsystemModal(){const t=this.selection.first();this.modalService.show(le.D,{itemDescription:"Subsystem",itemNames:[t.nqn],actionDescription:"delete",submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new h.O("nvmeof/subsystem/delete",{nqn:t.nqn}),call:this.nvmeofService.deleteSubsystem(t.nqn,this.group)})})}onGroupSelection(t){t.selected=!0,this.group=t.content,this.getSubsystems()}onGroupClear(){this.group=null,this.getSubsystems()}setGatewayGroups(){this.nvmeofService.listGatewayGroups().subscribe(t=>{this.gwGroups=t?.[0]?.length?this.nvmeofService.formatGwGroupsList(t):[],!this.group&&this.gwGroups.length?(this.onGroupSelection(this.gwGroups[0]),this.gwGroupsEmpty=!1,this.gwGroupPlaceholder=Bt):(this.gwGroupsEmpty=!0,this.gwGroupPlaceholder="No groups available")})}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(fe),e.\u0275\u0275directiveInject(j.v),e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(v.Router),e.\u0275\u0275directiveInject(ce.V),e.\u0275\u0275directiveInject(y.a),e.\u0275\u0275directiveInject(v.ActivatedRoute))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-nvmeof-subsystems"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:12,vars:11,consts:()=>{let t,n;return t="Selected Gateway Group",n=" Subsystems " + "\ufffd#6\ufffd" + " A subsystem provides access control to which hosts can access the namespaces within the subsystem. " + "\ufffd/#6\ufffd" + "",[n,["cdsCol","",1,"pb-3",3,"columnNumbers"],["type","single","label",t,3,"selected","clear","placeholder","items","disabled"],["columnMode","flex","selectionType","single",3,"fetchData","setExpandedRow","updateSelection","data","columns","hasDetails"],[1,"table-actions"],[1,"btn-group",3,"permission","selection","tableActions"],[3,"selection","permissions","group",4,"cdTableDetail"],["name","modal"],[3,"selection","permissions","group"]]},template:function(n,o){1&n&&(e.\u0275\u0275element(0,"cd-nvmeof-tabs"),e.\u0275\u0275elementStart(1,"div",1)(2,"cds-combo-box",2),e.\u0275\u0275listener("selected",function(s){return o.onGroupSelection(s)})("clear",function(){return o.onGroupClear()}),e.\u0275\u0275element(3,"cds-dropdown-list"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"legend"),e.\u0275\u0275i18nStart(5,0),e.\u0275\u0275element(6,"cd-help-text"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"cd-table",3),e.\u0275\u0275listener("fetchData",function(){return o.getSubsystems()})("setExpandedRow",function(s){return o.setExpandedRow(s)})("updateSelection",function(s){return o.updateSelection(s)}),e.\u0275\u0275elementStart(8,"div",4),e.\u0275\u0275element(9,"cd-table-actions",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(10,h_,1,3,"cd-nvmeof-subsystems-details",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(11,"router-outlet",7)),2&n&&(e.\u0275\u0275advance(),e.\u0275\u0275property("columnNumbers",e.\u0275\u0275pureFunction0(10,M_)),e.\u0275\u0275advance(),e.\u0275\u0275property("placeholder",o.gwGroupPlaceholder)("items",o.gwGroups)("disabled",o.gwGroupsEmpty),e.\u0275\u0275advance(5),e.\u0275\u0275property("data",o.subsystems)("columns",o.subsystemsColumns)("hasDetails",!0),e.\u0275\u0275advance(2),e.\u0275\u0275property("permission",o.permissions.nvmeof)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[ue.O,Y.O,de.j,lt.N,v.RouterOutlet,m.ColumnDirective,m.ComboBox,m.DropdownList,F_,Dt]})}}return i})();function R_(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",28),e.\u0275\u0275i18n(1,5),e.\u0275\u0275elementEnd())}function I_(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",28),e.\u0275\u0275i18n(1,6),e.\u0275\u0275elementEnd())}function N_(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",28),e.\u0275\u0275i18nStart(1,7),e.\u0275\u0275element(2,"br")(3,"code")(4,"br")(5,"code"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd())}function b_(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",28),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd())}function P_(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",28),e.\u0275\u0275i18n(1,9),e.\u0275\u0275elementEnd())}function A_(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"span",28),e.\u0275\u0275i18n(1,10),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275i18nExp(t.defaultMaxNamespace),e.\u0275\u0275i18nApply(1)}}function v_(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",28),e.\u0275\u0275i18n(1,11),e.\u0275\u0275elementEnd())}let D_=(()=>{class i{constructor(t,n,o,a,s,l,d){this.authStorageService=t,this.actionLabels=n,this.activeModal=o,this.nvmeofService=a,this.taskWrapperService=s,this.router=l,this.route=d,this.defaultMaxNamespace=4096,this.DEFAULT_NQN="nqn.2001-07.com.ceph:"+Date.now(),this.NQN_REGEX=/^nqn\.(19|20)\d\d-(0[1-9]|1[0-2])\.\D{2,3}(\.[A-Za-z0-9-]+)+(:[A-Za-z0-9-\.]+(:[A-Za-z0-9-\.]+)*)$/,this.NQN_REGEX_UUID=/^nqn\.2014-08\.org\.nvmexpress:uuid:[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/,this.customNQNValidator=I.xQ.custom("pattern",u=>!!u&&!(this.NQN_REGEX.test(u)||this.NQN_REGEX_UUID.test(u))),this.permission=this.authStorageService.getPermissions().nvmeof,this.resource="Subsystem",this.pageURL="block/nvmeof/subsystems"}ngOnInit(){this.route.queryParams.subscribe(t=>{this.group=t?.group}),this.createForm(),this.action=this.actionLabels.CREATE}createForm(){this.subsystemForm=new k.$({nqn:new _.UntypedFormControl(this.DEFAULT_NQN,{validators:[this.customNQNValidator,_.Validators.required,this.customNQNValidator,I.xQ.custom("maxLength",t=>(new TextEncoder).encode(t).length>223)],asyncValidators:[I.xQ.unique(this.nvmeofService.isSubsystemPresent,this.nvmeofService,null,null,this.group)]}),max_namespaces:new _.UntypedFormControl(this.defaultMaxNamespace,{validators:[I.xQ.number(!1),_.Validators.max(this.defaultMaxNamespace),_.Validators.min(1)]})})}onSubmit(){const t=this,n=this.subsystemForm.getValue("nqn"),o=Number(this.subsystemForm.getValue("max_namespaces"));let a=`nvmeof/subsystem/${O.Qp.CREATE}`;const s={nqn:n,enable_ha:!0,gw_group:this.group,max_namespaces:o};o||delete s.max_namespaces,this.taskWrapperService.wrapTaskAroundCall({task:new h.O(a,{nqn:n}),call:this.nvmeofService.createSubsystem(s)}).subscribe({error(){t.subsystemForm.setErrors({cdSubmitButton:!0})},complete:()=>{this.router.navigate([this.pageURL,{outlets:{modal:null}}])}})}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(j.v),e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(A.NgbActiveModal),e.\u0275\u0275directiveInject(fe),e.\u0275\u0275directiveInject(y.a),e.\u0275\u0275directiveInject(v.Router),e.\u0275\u0275directiveInject(v.ActivatedRoute))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-nvmeof-subsystems-form"]],decls:37,vars:23,consts:()=>{let t,n,o,a,s,l,d,u,f,M,E;return t="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",n="NQN",o="Maximum Namespaces",a="The maximum namespaces per subsystem. Default is " + "\ufffd0\ufffd" + "",s="This field is required.",l="This NQN is already in use.",d="Expected NQN format" + "[\ufffd#2\ufffd\ufffd/#2\ufffd|\ufffd#4\ufffd\ufffd/#4\ufffd]" + "<" + "[\ufffd#3\ufffd|\ufffd#5\ufffd]" + "nqn.$year-$month.$reverseDomainName:$utf8-string" + "[\ufffd/#3\ufffd|\ufffd/#5\ufffd]" + "\".> or " + "[\ufffd#2\ufffd\ufffd/#2\ufffd|\ufffd#4\ufffd\ufffd/#4\ufffd]" + "<" + "[\ufffd#3\ufffd|\ufffd#5\ufffd]" + "nqn.2014-08.org.nvmexpress:uuid:$UUID-string" + "[\ufffd/#3\ufffd|\ufffd/#5\ufffd]" + "\".>",d=e.\u0275\u0275i18nPostprocess(d),u="An NQN may not be more than 223 bytes in length.",f="The value must be at least 1.",M="The value cannot be greater than " + "\ufffd0\ufffd" + ".",E="The value must be a positive integer.",[["formDir","ngForm"],t,n,o,a,s,l,d,u,f,M,E,[3,"pageURL","modalRef"],[1,"modal-title"],[1,"modal-content"],["name","subsystemForm","novalidate","",3,"formGroup"],[1,"modal-body"],[1,"form-group","row"],["for","nqn",1,"cd-col-form-label"],[1,"required"],[1,"cd-col-form-input"],["name","nqn","type","text","formControlName","nqn",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","max_namespaces",1,"cd-col-form-label"],["id","max_namespaces","type","text","name","max_namespaces","formControlName","max_namespaces",1,"form-control"],[1,"modal-footer"],[1,"text-right"],[3,"submitActionEvent","form","submitText"],[1,"invalid-feedback"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-modal",12)(1,"span",13),e.\u0275\u0275i18n(2,1),e.\u0275\u0275pipe(3,"titlecase"),e.\u0275\u0275pipe(4,"upperFirst"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerStart(5,14),e.\u0275\u0275elementStart(6,"form",15,0)(8,"div",16)(9,"div",17)(10,"label",18)(11,"span",19),e.\u0275\u0275i18n(12,2),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(13,"div",20),e.\u0275\u0275element(14,"input",21),e.\u0275\u0275elementStart(15,"cd-help-text"),e.\u0275\u0275text(16," A unique and permanent name for the lifetime of the subsystem. "),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(17,R_,2,0,"span",22)(18,I_,2,0,"span",22)(19,N_,6,0,"span",22)(20,b_,2,0,"span",22),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(21,"div",17)(22,"label",23)(23,"span"),e.\u0275\u0275i18n(24,3),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(25,"div",20),e.\u0275\u0275element(26,"input",24),e.\u0275\u0275elementStart(27,"cd-help-text"),e.\u0275\u0275i18n(28,4),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(29,P_,2,0,"span",22)(30,A_,2,1,"span",22)(31,v_,2,0,"span",22),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(32,"div",25)(33,"div",26)(34,"cd-form-button-panel",27),e.\u0275\u0275pipe(35,"titlecase"),e.\u0275\u0275pipe(36,"upperFirst"),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onSubmit())}),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()}if(2&n){const a=e.\u0275\u0275reference(7);e.\u0275\u0275property("pageURL",o.pageURL)("modalRef",o.activeModal),e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(3,15,o.action))(e.\u0275\u0275pipeBind1(4,17,o.resource)),e.\u0275\u0275i18nApply(2),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",o.subsystemForm),e.\u0275\u0275advance(11),e.\u0275\u0275property("ngIf",o.subsystemForm.showError("nqn",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.subsystemForm.showError("nqn",a,"unique")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.subsystemForm.showError("nqn",a,"pattern")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.subsystemForm.showError("nqn",a,"maxLength")),e.\u0275\u0275advance(8),e.\u0275\u0275i18nExp(o.defaultMaxNamespace),e.\u0275\u0275i18nApply(28),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.subsystemForm.showError("max_namespaces",a,"min")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.subsystemForm.showError("max_namespaces",a,"max")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.subsystemForm.showError("max_namespaces",a,"pattern")),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.subsystemForm)("submitText",e.\u0275\u0275pipeBind1(35,19,o.action)+" "+e.\u0275\u0275pipeBind1(36,21,o.resource))}},dependencies:[c.NgIf,_.\u0275NgNoValidate,_.DefaultValueAccessor,_.NgControlStatus,_.NgControlStatusGroup,_.FormGroupDirective,_.FormControlName,q.z,F.e,ue.O,x.S,g.a,S.C,N.E,c.TitleCasePipe,Le.r]})}}return i})();var L_=p(7466);function y_(i,r){1&i&&(e.\u0275\u0275elementStart(0,"option",31),e.\u0275\u0275i18n(1,6),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function $_(i,r){1&i&&(e.\u0275\u0275elementStart(0,"option",31),e.\u0275\u0275i18n(1,7),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function B_(i,r){1&i&&(e.\u0275\u0275elementStart(0,"option",31),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function G_(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"option",31),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=r.$implicit;e.\u0275\u0275property("ngValue",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t.hostname)}}function x_(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",32),e.\u0275\u0275i18n(1,9),e.\u0275\u0275elementEnd())}function w_(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",32),e.\u0275\u0275i18n(1,10),e.\u0275\u0275elementEnd())}function V_(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",32),e.\u0275\u0275i18n(1,11),e.\u0275\u0275elementEnd())}function H_(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",32),e.\u0275\u0275i18n(1,12),e.\u0275\u0275elementEnd())}let k_=(()=>{class i{constructor(t,n,o,a,s,l,d,u,f,M){this.actionLabels=t,this.authStorageService=n,this.taskWrapperService=o,this.nvmeofService=a,this.hostService=s,this.router=l,this.route=d,this.activeModal=u,this.formatterService=f,this.dimlessBinaryPipe=M,this.hosts=null,this.permission=this.authStorageService.getPermissions().nvmeof,this.hostPermission=this.authStorageService.getPermissions().hosts,this.resource="Listener",this.pageURL="block/nvmeof/subsystems"}filterHostsByLabel(t,n){return t.filter(o=>{const a=o?.labels;return"string"==typeof n?a.includes(n):a?.length===n?.length&&C().isEqual(a,n)})}filterHostsByHostname(t,n){return t.filter(o=>n.includes(o.hostname))}getGwGroupPlacement(t){return t?.[0]?.find(n=>n?.spec?.group===this.group)?.placement||{hosts:[],label:[]}}setHosts(){(0,z.forkJoin)({gwGroups:this.nvmeofService.listGatewayGroups(),allHosts:this.hostService.getAllHosts()}).pipe((0,Me.map)(({gwGroups:t,allHosts:n})=>{const{hosts:o,label:a}=this.getGwGroupPlacement(t);return o?.length?this.filterHostsByHostname(n,o):a?.length?this.filterHostsByLabel(n,a):[]})).subscribe(t=>{this.hosts=t.map(n=>({hostname:n.hostname,addr:n.addr}))})}ngOnInit(){this.createForm(),this.action=this.actionLabels.CREATE,this.route.params.subscribe(t=>{this.subsystemNQN=t?.subsystem_nqn}),this.route.queryParams.subscribe(t=>{this.group=t?.group}),this.setHosts()}createForm(){this.listenerForm=new k.$({host:new _.UntypedFormControl(null,{validators:[_.Validators.required]}),trsvcid:new _.UntypedFormControl(4420,[_.Validators.required,I.xQ.number(!1),_.Validators.max(65535)])})}buildRequest(){const t=this.listenerForm.getValue("host");let n=Number(this.listenerForm.getValue("trsvcid"));return n||(n=4420),{gw_group:this.group,host_name:t.hostname,traddr:t.addr,trsvcid:n}}onSubmit(){const t=this,n=`nvmeof/listener/${O.Qp.CREATE}`,o=this.buildRequest();this.taskWrapperService.wrapTaskAroundCall({task:new h.O(n,{nqn:this.subsystemNQN,host_name:o.host_name}),call:this.nvmeofService.createListener(this.subsystemNQN,o)}).subscribe({error(){t.listenerForm.setErrors({cdSubmitButton:!0})},complete:()=>{this.router.navigate([this.pageURL,{outlets:{modal:null}}])}})}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(j.v),e.\u0275\u0275directiveInject(y.a),e.\u0275\u0275directiveInject(fe),e.\u0275\u0275directiveInject(L_.I),e.\u0275\u0275directiveInject(v.Router),e.\u0275\u0275directiveInject(v.ActivatedRoute),e.\u0275\u0275directiveInject(A.NgbActiveModal),e.\u0275\u0275directiveInject(ut.k),e.\u0275\u0275directiveInject($e.l))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-nvmeof-listeners-form"]],decls:38,vars:22,consts:()=>{let t,n,o,a,s,l,d,u,f,M,E,b;return t="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",n="Hostname",o=" This hostname uniquely identifies the gateway on which the listener is being set up. ",a="Transport Service ID",s="The IP port to use. Default is 4420.",l="Loading...",d="-- No hosts available --",u="-- Select a host --",f="This field is required.",M="This field is required.",E="The value cannot be greated than 65535.",b="The value must be a positive integer.",[["formDir","ngForm"],t,n,o,a,s,l,d,u,f,M,E,b,[3,"pageURL"],[1,"modal-title"],[1,"modal-content"],["name","listenerForm","novalidate","",3,"formGroup"],[1,"modal-body"],[1,"form-group","row"],["for","host",1,"cd-col-form-label"],[1,"required"],[1,"cd-col-form-input"],["id","host","name","host","formControlName","host",1,"form-select"],[3,"ngValue",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],["for","trsvcid",1,"cd-col-form-label"],["id","trsvcid","type","text","name","trsvcid","formControlName","trsvcid",1,"form-control"],[1,"modal-footer"],[1,"text-right"],[3,"submitActionEvent","form","submitText"],[3,"ngValue"],[1,"invalid-feedback"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-modal",13)(1,"span",14),e.\u0275\u0275i18n(2,1),e.\u0275\u0275pipe(3,"titlecase"),e.\u0275\u0275pipe(4,"upperFirst"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerStart(5,15),e.\u0275\u0275elementStart(6,"form",16,0)(8,"div",17)(9,"div",18)(10,"label",19)(11,"span",20),e.\u0275\u0275i18n(12,2),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(13,"div",21)(14,"select",22),e.\u0275\u0275template(15,y_,2,1,"option",23)(16,$_,2,1,"option",23)(17,B_,2,1,"option",23)(18,G_,2,2,"option",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"cd-help-text"),e.\u0275\u0275i18n(20,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(21,x_,2,0,"span",25),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(22,"div",18)(23,"label",26)(24,"span"),e.\u0275\u0275i18n(25,4),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(26,"div",21),e.\u0275\u0275element(27,"input",27),e.\u0275\u0275elementStart(28,"cd-help-text"),e.\u0275\u0275i18n(29,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(30,w_,2,0,"span",25)(31,V_,2,0,"span",25)(32,H_,2,0,"span",25),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(33,"div",28)(34,"div",29)(35,"cd-form-button-panel",30),e.\u0275\u0275pipe(36,"titlecase"),e.\u0275\u0275pipe(37,"upperFirst"),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onSubmit())}),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()}if(2&n){const a=e.\u0275\u0275reference(7);e.\u0275\u0275property("pageURL",o.pageURL),e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(3,14,o.action))(e.\u0275\u0275pipeBind1(4,16,o.resource)),e.\u0275\u0275i18nApply(2),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",o.listenerForm),e.\u0275\u0275advance(9),e.\u0275\u0275property("ngIf",null===o.hosts),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.hosts&&0===o.hosts.length),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.hosts&&o.hosts.length>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",o.hosts),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",o.listenerForm.showError("host",a,"required")),e.\u0275\u0275advance(9),e.\u0275\u0275property("ngIf",o.listenerForm.showError("trsvcid",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.listenerForm.showError("trsvcid",a,"max")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.listenerForm.showError("trsvcid",a,"pattern")),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.listenerForm)("submitText",e.\u0275\u0275pipeBind1(36,18,o.action)+" "+e.\u0275\u0275pipeBind1(37,20,o.resource))}},dependencies:[c.NgForOf,c.NgIf,_.\u0275NgNoValidate,_.NgSelectOption,_.\u0275NgSelectMultipleOption,_.DefaultValueAccessor,_.SelectControlValueAccessor,_.NgControlStatus,_.NgControlStatusGroup,_.FormGroupDirective,_.FormControlName,q.z,F.e,ue.O,x.S,g.a,S.C,N.E,m.Option,c.TitleCasePipe,Le.r]})}}return i})();const Et=i=>({required:i});function K_(i,r){1&i&&e.\u0275\u0275element(0,"input",36)}function z_(i,r){1&i&&(e.\u0275\u0275elementStart(0,"option",39),e.\u0275\u0275i18n(1,5),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function X_(i,r){1&i&&(e.\u0275\u0275elementStart(0,"option",39),e.\u0275\u0275i18n(1,6),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function U_(i,r){1&i&&(e.\u0275\u0275elementStart(0,"option",39),e.\u0275\u0275i18n(1,7),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function j_(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"option",40),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=r.$implicit;e.\u0275\u0275property("value",t.pool_name),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t.pool_name)}}function q_(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"select",37),e.\u0275\u0275template(1,z_,2,1,"option",38)(2,X_,2,1,"option",38)(3,U_,2,1,"option",38)(4,j_,2,2,"option",31),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null===t.rbdPools),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.rbdPools&&0===t.rbdPools.length),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.rbdPools&&t.rbdPools.length>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",t.rbdPools)}}function Q_(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",41),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd())}function Y_(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"div",42)(1,"label",43)(2,"span",21),e.\u0275\u0275i18n(3,9),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"div",22),e.\u0275\u0275element(5,"cds-number",44),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext(),n=e.\u0275\u0275reference(7);e.\u0275\u0275advance(2),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(5,Et,!t.edit)),e.\u0275\u0275advance(3),e.\u0275\u0275property("min",t.MIN_NAMESPACE_CREATE)("max",t.MAX_NAMESPACE_CREATE)("invalid",t.nsForm.showError("nsCount",n,"max")||t.nsForm.showError("nsCount",n,"min")||t.nsForm.showError("nsCount",n,"required"))("invalidText",t.nsForm.get("nsCount").hasError("required")?t.requiredInvalidText:t.nsCountInvalidText)}}function W_(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"option",40),e.\u0275\u0275i18n(1,10),e.\u0275\u0275elementEnd()),2&i){const t=r.$implicit;e.\u0275\u0275property("value",t),e.\u0275\u0275advance(),e.\u0275\u0275i18nExp(t),e.\u0275\u0275i18nApply(1)}}function J_(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",41),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18n(2,11),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd())}function Z_(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",41),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18n(2,12),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd())}function ec(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",45),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18n(2,13),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd())}let xt=(()=>{class i{constructor(t,n,o,a,s,l,d,u,f,M,E){this.actionLabels=t,this.authStorageService=n,this.taskWrapperService=o,this.nvmeofService=a,this.poolService=s,this.rbdService=l,this.router=d,this.route=u,this.activeModal=f,this.formatterService=M,this.dimlessBinaryPipe=E,this.edit=!1,this.rbdPools=null,this.units=["MiB","GiB","TiB"],this.MAX_NAMESPACE_CREATE=5,this.MIN_NAMESPACE_CREATE=1,this.requiredInvalidText="This field is required",this.nsCountInvalidText="The namespace count should be between 1 and 5",this.permission=this.authStorageService.getPermissions().nvmeof,this.poolPermission=this.authStorageService.getPermissions().pool,this.resource="Namespace",this.pageURL="block/nvmeof/subsystems"}init(){this.route.queryParams.subscribe(t=>{this.group=t?.group}),this.createForm(),this.action=this.actionLabels.CREATE,this.route.params.subscribe(t=>{this.subsystemNQN=t.subsystem_nqn,this.nsid=t?.nsid})}initForEdit(){this.edit=!0,this.action=this.actionLabels.EDIT,this.nvmeofService.getNamespace(this.subsystemNQN,this.nsid,this.group).subscribe(t=>{const n=this.dimlessBinaryPipe.transform(t.rbd_image_size).split(" ");this.currentBytes=t.rbd_image_size,this.nsForm.get("pool").setValue(t.rbd_pool_name),this.nsForm.get("unit").setValue(n[1]),this.nsForm.get("image_size").setValue(n[0]),this.nsForm.get("image_size").addValidators(_.Validators.required),this.nsForm.get("pool").disable()})}initForCreate(){this.poolService.getList().subscribe(t=>{this.rbdPools=t.filter(this.rbdService.isRBDPool),this.rbdPools?.length&&this.nsForm.get("pool").setValue(this.rbdPools[0].pool_name)})}ngOnInit(){this.init(),this.router.url.includes("subsystems/(modal:edit")?this.initForEdit():this.initForCreate()}createForm(){this.nsForm=new k.$({pool:new _.UntypedFormControl(null,{validators:[_.Validators.required]}),image_size:new _.UntypedFormControl(1,[I.xQ.number(!1),_.Validators.min(1)]),unit:new _.UntypedFormControl(this.units[1]),nsCount:new _.UntypedFormControl(this.MAX_NAMESPACE_CREATE,[_.Validators.required,_.Validators.max(this.MAX_NAMESPACE_CREATE),_.Validators.min(this.MIN_NAMESPACE_CREATE)])})}buildUpdateRequest(t){return this.nvmeofService.updateNamespace(this.subsystemNQN,this.nsid,{gw_group:this.group,rbd_image_size:t})}randomString(){return Math.random().toString(36).substring(2)}buildCreateRequest(t,n){const o=this.nsForm.getValue("pool"),a=[];for(let s=1;s<=n;s++){const l={gw_group:this.group,rbd_image_name:`nvme_${o}_${this.group}_${this.randomString()}`,rbd_pool:o,create_image:!0};t&&(l.rbd_image_size=t),a.push(this.nvmeofService.createNamespace(this.subsystemNQN,l))}return a}validateSize(){const t=this.nsForm.getValue("unit"),n=this.nsForm.getValue("image_size");return n&&t?this.formatterService.toBytes(n+t)<=this.currentBytes:null}onSubmit(){if(this.validateSize())this.invalidSizeError=!0,this.nsForm.setErrors({cdSubmitButton:!0});else{this.invalidSizeError=!1;const t=this,n=`nvmeof/namespace/${this.edit?O.Qp.EDIT:O.Qp.CREATE}`,o=this.nsForm.getValue("image_size"),a=this.nsForm.getValue("nsCount");let s,l=null;if(o){const d=this.nsForm.getValue("unit");l=this.formatterService.toBytes(o+d)}s=this.taskWrapperService.wrapTaskAroundCall(this.edit?{task:new h.O(n,{nqn:this.subsystemNQN,nsid:this.nsid}),call:this.buildUpdateRequest(l)}:{task:new h.O(n,{nqn:this.subsystemNQN,nsCount:a}),call:(0,z.forkJoin)(this.buildCreateRequest(l,a))}),s.subscribe({error(){t.nsForm.setErrors({cdSubmitButton:!0})},complete:()=>{this.router.navigate([this.pageURL,{outlets:{modal:null}}])}})}}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(j.v),e.\u0275\u0275directiveInject(y.a),e.\u0275\u0275directiveInject(fe),e.\u0275\u0275directiveInject(ke.m),e.\u0275\u0275directiveInject(U.U),e.\u0275\u0275directiveInject(v.Router),e.\u0275\u0275directiveInject(v.ActivatedRoute),e.\u0275\u0275directiveInject(A.NgbActiveModal),e.\u0275\u0275directiveInject(ut.k),e.\u0275\u0275directiveInject($e.l))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-nvmeof-namespaces-form"]],decls:37,vars:29,consts:()=>{let t,n,o,a,s,l,d,u,f,M,E,b,D,B;return t="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",n="Pool",o=" An RBD application-enabled pool where the image will be created. ",a="Image Size",s="Loading...",l="-- No block pools available --",d="-- Select a pool --",u="This field is required.",f="The number of namespaces to create",M="Namespace Count",E="" + "\ufffd0\ufffd" + "",b="Enter a positive integer.",D="This field is required",B="Enter a value above than previous. A block device image can be expanded but not reduced.",[["formDir","ngForm"],t,n,o,a,s,l,d,u,M,E,b,D,B,[3,"pageURL","modalRef"],[1,"modal-title"],[1,"modal-content"],["name","nsForm","novalidate","",3,"formGroup"],[1,"modal-body"],[1,"form-group","row"],["for","pool",1,"cd-col-form-label"],[3,"ngClass"],[1,"cd-col-form-input"],["class","form-control","type","text","id","pool-edit","formControlName","pool",4,"ngIf"],["id","pool-create","class","form-select","formControlName","pool",4,"ngIf"],["class","invalid-feedback",4,"ngIf"],["class","form-group row","id","namespace-count",4,"ngIf"],["for","image_size",1,"cd-col-form-label"],[1,"input-group"],["id","size","type","text","formControlName","image_size",1,"form-control"],["id","unit","formControlName","unit",1,"form-input","form-select"],[3,"value",4,"ngFor","ngForOf"],["class","invalid-feedback","id","image-size-invalid",4,"ngIf"],[1,"modal-footer"],[1,"text-right"],[3,"submitActionEvent","form","submitText"],["type","text","id","pool-edit","formControlName","pool",1,"form-control"],["id","pool-create","formControlName","pool",1,"form-select"],[3,"ngValue",4,"ngIf"],[3,"ngValue"],[3,"value"],[1,"invalid-feedback"],["id","namespace-count",1,"form-group","row"],["for","nsCount",1,"cd-col-form-label"],["formControlName","nsCount","helperText",f,"size","sm",3,"min","max","invalid","invalidText"],["id","image-size-invalid",1,"invalid-feedback"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-modal",14)(1,"span",15),e.\u0275\u0275i18n(2,1),e.\u0275\u0275pipe(3,"titlecase"),e.\u0275\u0275pipe(4,"upperFirst"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerStart(5,16),e.\u0275\u0275elementStart(6,"form",17,0)(8,"div",18)(9,"div",19)(10,"label",20)(11,"span",21),e.\u0275\u0275i18n(12,2),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(13,"div",22),e.\u0275\u0275template(14,K_,1,0,"input",23)(15,q_,5,4,"select",24),e.\u0275\u0275elementStart(16,"cd-help-text"),e.\u0275\u0275i18n(17,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(18,Q_,2,0,"span",25),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(19,Y_,6,7,"div",26),e.\u0275\u0275elementStart(20,"div",19)(21,"label",27)(22,"span",21),e.\u0275\u0275i18n(23,4),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(24,"div",22)(25,"div",28),e.\u0275\u0275element(26,"input",29),e.\u0275\u0275elementStart(27,"select",30),e.\u0275\u0275template(28,W_,2,2,"option",31),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(29,J_,3,0,"span",25)(30,Z_,3,0,"span",25)(31,ec,3,0,"span",32),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(32,"div",33)(33,"div",34)(34,"cd-form-button-panel",35),e.\u0275\u0275pipe(35,"titlecase"),e.\u0275\u0275pipe(36,"upperFirst"),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onSubmit())}),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()}if(2&n){const a=e.\u0275\u0275reference(7);e.\u0275\u0275property("pageURL",o.pageURL)("modalRef",o.activeModal),e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(3,17,o.action))(e.\u0275\u0275pipeBind1(4,19,o.resource)),e.\u0275\u0275i18nApply(2),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",o.nsForm),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(25,Et,!o.edit)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",o.edit),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!o.edit),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",o.nsForm.showError("pool",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!o.edit),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(27,Et,o.edit)),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",o.units),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.nsForm.showError("image_size",a,"pattern")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.edit&&o.nsForm.showError("image_size",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.edit&&o.invalidSizeError),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.nsForm)("submitText",e.\u0275\u0275pipeBind1(35,21,o.action)+" "+e.\u0275\u0275pipeBind1(36,23,o.resource))}},dependencies:[c.NgClass,c.NgForOf,c.NgIf,_.\u0275NgNoValidate,_.NgSelectOption,_.\u0275NgSelectMultipleOption,_.DefaultValueAccessor,_.SelectControlValueAccessor,_.NgControlStatus,_.NgControlStatusGroup,_.FormGroupDirective,_.FormControlName,q.z,F.e,ue.O,x.S,g.a,S.C,N.E,m.Option,m.NumberComponent,c.TitleCasePipe,Le.r]})}}return i})();function tc(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,6),e.\u0275\u0275elementEnd())}function nc(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18nStart(1,7),e.\u0275\u0275element(2,"br")(3,"code")(4,"br")(5,"code"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd())}function oc(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd())}function ic(i,r){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,tc,2,0,"span",31)(2,nc,6,0,"span",31)(3,oc,2,0,"span",31),e.\u0275\u0275elementContainerEnd()),2&i){let t,n,o;const a=e.\u0275\u0275nextContext().index,s=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null==(t=s.initiatorForm.get("addHost.addedHosts").controls[a].errors)?null:t.required),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null==(n=s.initiatorForm.get("addHost.addedHosts").controls[a].errors)?null:n.pattern),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null==(o=s.initiatorForm.get("addHost.addedHosts").controls[a].errors)?null:o.maxLength)}}function ac(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",32),e.\u0275\u0275element(1,"input",33),e.\u0275\u0275elementStart(2,"button",34),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(o.addHost())}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(3,"svg",35),e.\u0275\u0275elementEnd(),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementStart(4,"button",34),e.\u0275\u0275listener("click",function(){const o=e.\u0275\u0275restoreView(t).index,a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.removeHost(o))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(5,"svg",35),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(6,ic,4,3,"ng-container",36),e.\u0275\u0275elementEnd()}if(2&i){let t;const n=r.index,o=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("required",!o.initiatorForm.getValue("allowAnyHost"))("formControlName",n),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate1("id","add-button-",n,""),e.\u0275\u0275property("disabled",o.initiatorForm.get("addHost.addedHosts").controls[n].invalid||(null==(t=o.initiatorForm.get("addHost.addedHosts").errors)?null:t.duplicate)||32===o.initiatorForm.get("addHost.addedHosts").controls.length||1!==o.initiatorForm.get("addHost.addedHosts").controls.length&&o.initiatorForm.get("addHost.addedHosts").controls.length!==n+1),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",o.icons.add)("size",o.icons.size16),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate1("id","delete-button-",n,""),e.\u0275\u0275property("disabled",1===o.addedHosts.controls.length),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",o.icons.trash)("size",o.icons.size16),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.initiatorForm.get("addHost.addedHosts").controls[n].invalid&&(o.initiatorForm.get("addHost.addedHosts").controls[n].dirty||o.initiatorForm.get("addHost.addedHosts").controls[n].touched))}}function rc(i,r){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,9),e.\u0275\u0275elementEnd())}function sc(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"div",29),e.\u0275\u0275template(1,ac,7,13,"div",30)(2,rc,2,0,"span",31),e.\u0275\u0275elementEnd()),2&i){let t;const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",n.addedHosts.controls),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null==(t=n.initiatorForm.get("addHost.addedHosts").errors)?null:t.duplicate)}}function lc(i,r){1&i&&(e.\u0275\u0275elementStart(0,"cd-alert-panel",38),e.\u0275\u0275text(1,"Allowing any host to connect to the NVMe/TCP gateway may pose security risks. "),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("showTitle",!1)}let _c=(()=>{class i{constructor(t,n,o,a,s,l,d){this.authStorageService=t,this.actionLabels=n,this.nvmeofService=o,this.taskWrapperService=a,this.router=s,this.route=l,this.formBuilder=d,this.remove=!1,this.removeHosts=[],this.NQN_REGEX=/^nqn\.(19|20)\d\d-(0[1-9]|1[0-2])\.\D{2,3}(\.[A-Za-z0-9-]+)+(:[A-Za-z0-9-\.]+(:[A-Za-z0-9-\.]+)*)$/,this.NQN_REGEX_UUID=/^nqn\.2014-08\.org\.nvmexpress:uuid:[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/,this.ALLOW_ALL_HOST="*",this.customNQNValidator=I.xQ.custom("pattern",u=>!!u&&!(this.NQN_REGEX.test(u)||this.NQN_REGEX_UUID.test(u))),this.permission=this.authStorageService.getPermissions().nvmeof,this.resource="Initiator",this.pageURL="block/nvmeof/subsystems"}ngOnInit(){this.route.queryParams.subscribe(t=>{this.group=t?.group}),this.createForm(),this.action=this.actionLabels.ADD,this.route.params.subscribe(t=>{this.subsystemNQN=t.subsystem_nqn})}createForm(){this.initiatorForm=new k.$({allowAnyHost:new _.UntypedFormControl(!1),addHost:new k.$({addHostCheck:new _.UntypedFormControl(!1),addedHosts:this.formBuilder.array([],[I.xQ.custom("duplicate",t=>!!t.length&&new Set(t)?.size!==t.length)])})})}get addedHosts(){return this.initiatorForm.get("addHost.addedHosts")}addHost(){let t;t=this.formBuilder.control("",[this.customNQNValidator,_.Validators.required]),this.addedHosts.push(t)}removeHost(t){this.addedHosts.removeAt(t)}setAddHostCheck(){if(this.initiatorForm.get("addHost.addHostCheck").value)this.addHost();else for(;0!==this.addedHosts.length;)this.addedHosts.removeAt(0)}onSubmit(){const t=this,n=this.initiatorForm.getValue("allowAnyHost"),o=this.addedHosts.value;let a=`nvmeof/initiator/${O.Qp.ADD}`;const s={host_nqn:o.join(","),gw_group:this.group};n&&(o.push("*"),s.host_nqn=o.join(",")),this.taskWrapperService.wrapTaskAroundCall({task:new h.O(a,{nqn:this.subsystemNQN}),call:this.nvmeofService.addInitiators(this.subsystemNQN,s)}).subscribe({error(){t.initiatorForm.setErrors({cdSubmitButton:!0})},complete:()=>{this.router.navigate([this.pageURL,{outlets:{modal:null}}])}})}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275directiveInject(j.v),e.\u0275\u0275directiveInject(O.Ss),e.\u0275\u0275directiveInject(fe),e.\u0275\u0275directiveInject(y.a),e.\u0275\u0275directiveInject(v.Router),e.\u0275\u0275directiveInject(v.ActivatedRoute),e.\u0275\u0275directiveInject(Ze.$))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["cd-nvmeof-initiators-form"]],decls:31,vars:16,consts:()=>{let t,n,o,a,s,l,d,u,f,M;return t="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",n="Hosts ",o="Add host",a="Allow specific hosts to run NVMe/TCP commands to the NVMe subsystem.",s="Allow any host",l="Add host nqn",d="This field is required.",u="Expected NQN format" + "[\ufffd#2\ufffd\ufffd/#2\ufffd|\ufffd#4\ufffd\ufffd/#4\ufffd]" + "<" + "[\ufffd#3\ufffd|\ufffd#5\ufffd]" + "nqn.$year-$month.$reverseDomainName:$utf8-string" + "[\ufffd/#3\ufffd|\ufffd/#5\ufffd]" + "\".> or " + "[\ufffd#2\ufffd\ufffd/#2\ufffd|\ufffd#4\ufffd\ufffd/#4\ufffd]" + "<" + "[\ufffd#3\ufffd|\ufffd#5\ufffd]" + "nqn.2014-08.org.nvmexpress:uuid:$UUID-string" + "[\ufffd/#3\ufffd|\ufffd/#5\ufffd]" + "\".>",u=e.\u0275\u0275i18nPostprocess(u),f="An NQN may not be more than 223 bytes in length.",M="Duplicate entry detected. Enter a unique value.",[["formDir","ngForm"],t,n,o,a,s,d,u,f,M,[3,"pageURL"],[1,"modal-title"],[1,"modal-content"],["name","initiatorForm","novalidate","",3,"formGroup"],[1,"modal-body"],[1,"form-group","row"],[1,"cd-col-form-label","required"],[1,"cd-col-form-input"],["formGroupName","addHost",1,"custom-control","custom-checkbox"],["type","checkbox","id","addHostCheck","name","addHostCheck","formControlName","addHostCheck",1,"custom-control-input",3,"change"],["for","addHostCheck",1,"custom-control-label","mb-0"],["formArrayName","addedHosts",4,"ngIf"],[1,"custom-control","custom-checkbox","pt-0"],["type","checkbox","id","allowAnyHost","name","allowAnyHost","formControlName","allowAnyHost",1,"custom-control-input"],["for","allowAnyHost",1,"custom-control-label"],["type","warning",3,"showTitle",4,"ngIf"],[1,"modal-footer"],[1,"text-right"],[3,"submitActionEvent","form","submitText"],["formArrayName","addedHosts"],["class","input-group cd-mb my-1",4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],[1,"input-group","cd-mb","my-1"],["type","text","placeholder",l,1,"cd-form-control",3,"required","formControlName"],["type","button",1,"btn","btn-light",3,"click","id","disabled"],[3,"cdsIcon","size"],[4,"ngIf"],[1,"invalid-feedback"],["type","warning",3,"showTitle"]]},template:function(n,o){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-modal",10)(1,"span",11),e.\u0275\u0275i18n(2,1),e.\u0275\u0275pipe(3,"titlecase"),e.\u0275\u0275pipe(4,"upperFirst"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerStart(5,12),e.\u0275\u0275elementStart(6,"form",13,0)(8,"div",14)(9,"div",15)(10,"label",16),e.\u0275\u0275i18n(11,2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"div",17)(13,"div",18)(14,"input",19),e.\u0275\u0275listener("change",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.setAddHostCheck())}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"label",20),e.\u0275\u0275i18n(16,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"cd-help-text")(18,"span"),e.\u0275\u0275i18n(19,4),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(20,sc,3,2,"div",21),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"div",22),e.\u0275\u0275element(22,"input",23),e.\u0275\u0275elementStart(23,"label",24),e.\u0275\u0275i18n(24,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(25,lc,2,1,"cd-alert-panel",25),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(26,"div",26)(27,"div",27)(28,"cd-form-button-panel",28),e.\u0275\u0275pipe(29,"titlecase"),e.\u0275\u0275pipe(30,"upperFirst"),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onSubmit())}),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()}2&n&&(e.\u0275\u0275property("pageURL",o.pageURL),e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(3,8,o.action))(e.\u0275\u0275pipeBind1(4,10,o.resource)),e.\u0275\u0275i18nApply(2),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",o.initiatorForm),e.\u0275\u0275advance(14),e.\u0275\u0275property("ngIf",o.initiatorForm.get("addHost.addHostCheck").value),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",o.initiatorForm.getValue("allowAnyHost")),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.initiatorForm)("submitText",e.\u0275\u0275pipeBind1(29,12,o.action)+" "+e.\u0275\u0275pipeBind1(30,14,o.resource)))},dependencies:[c.NgForOf,c.NgIf,_.\u0275NgNoValidate,_.DefaultValueAccessor,_.CheckboxControlValueAccessor,_.NgControlStatus,_.NgControlStatusGroup,_.RequiredValidator,_.FormGroupDirective,_.FormControlName,_.FormGroupName,_.FormArrayName,q.z,we.m,F.e,ue.O,x.S,g.a,S.C,N.E,m.IconDirective,c.TitleCasePipe,Le.r]})}}return i})();var cc=p(97367),dc=p(99062),mc={elem:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:20,height:20},content:[{elem:"path",attrs:{d:"M16,2A14.1725,14.1725,0,0,0,2,16,14.1725,14.1725,0,0,0,16,30,14.1725,14.1725,0,0,0,30,16,14.1725,14.1725,0,0,0,16,2Zm8,15H17v7H15V17H8V15h7V8h2v7h7Z"}},{elem:"path",attrs:{fill:"none",d:"M24 17L17 17 17 24 15 24 15 17 8 17 8 15 15 15 15 8 17 8 17 15 24 15 24 17z","data-icon-path":"inner-path"}}],name:"add--filled",size:20},pc=p(63566),uc={elem:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:20,height:20},content:[{elem:"path",attrs:{d:"M16,4c6.6,0,12,5.4,12,12s-5.4,12-12,12S4,22.6,4,16S9.4,4,16,4 M16,2C8.3,2,2,8.3,2,16s6.3,14,14,14s14-6.3,14-14\tS23.7,2,16,2z"}},{elem:"path",attrs:{d:"M8 15H24V17H8z"}}],name:"subtract--alt",size:20},gc=p(55619);let wt=(()=>{class i{constructor(t){this.iconService=t,this.iconService.registerAll([cc.A,dc.A,mc,pc.A,It.A,gc.A,uc])}static{this.\u0275fac=function(n){return new(n||i)(e.\u0275\u0275inject(m.IconService))}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:i})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[c.CommonModule,fi,_.FormsModule,_.ReactiveFormsModule,A.NgbNavModule,A.NgbPopoverModule,A.NgbTooltipModule,Ee.Y,ee.G,v.RouterModule,m.TreeviewModule,m.UIShellModule,m.InputModule,m.GridModule,m.ButtonModule,m.IconModule,m.CheckboxModule,m.RadioModule,m.SelectModule,m.NumberModule,m.ModalModule,m.DatePickerModule,m.ComboBoxModule,m.TabsModule]})}}return i})();const Sc=[{path:"",redirectTo:"rbd",pathMatch:"full"},{path:"rbd",canActivate:[re.k,Z.x],data:{moduleStatusGuardConfig:{uiApiPath:"block/rbd",redirectTo:"error",header:"Block Pool is not configured",button_name:"Configure Default pool",button_route:"/pool/create",component:"Default Pool",uiConfig:!0},breadcrumbs:"Images"},children:[{path:"",component:fl},{path:"namespaces",component:Pl,data:{breadcrumbs:"Namespaces"}},{path:"trash",component:zl,data:{breadcrumbs:"Trash"}},{path:"performance",component:Al,data:{breadcrumbs:"Overall Performance"}},{path:O.Qp.CREATE,component:Ke,data:{breadcrumbs:O.yY.CREATE}},{path:`${O.Qp.EDIT}/:image_spec`,component:Ke,data:{breadcrumbs:O.yY.EDIT}},{path:`${O.Qp.CLONE}/:image_spec/:snap`,component:Ke,data:{breadcrumbs:O.yY.CLONE}},{path:`${O.Qp.COPY}/:image_spec`,component:Ke,data:{breadcrumbs:O.yY.COPY}},{path:`${O.Qp.COPY}/:image_spec/:snap`,component:Ke,data:{breadcrumbs:O.yY.COPY}}]},{path:"mirroring",component:Ma,canActivate:[re.k,Z.x],data:{moduleStatusGuardConfig:{uiApiPath:"block/mirroring",redirectTo:"error",header:"Block Mirroring is not configured",button_name:"Configure Block Mirroring",button_title:"This will create \"rbd-mirror\" service and a replicated Block pool",component:"Block Mirroring",uiConfig:!0},breadcrumbs:"Mirroring"},children:[{path:`${O.Qp.EDIT}/:pool_name`,component:Na,outlet:"modal"}]},{path:"iscsi",canActivate:[re.k],data:{breadcrumbs:"iSCSI"},children:[{path:"",redirectTo:"overview",pathMatch:"full"},{path:"overview",component:mi,data:{breadcrumbs:"Overview"}},{path:"targets",data:{breadcrumbs:"Targets"},children:[{path:"",component:Wo},{path:O.Qp.CREATE,component:ht,data:{breadcrumbs:O.yY.CREATE}},{path:`${O.Qp.EDIT}/:target_iqn`,component:ht,data:{breadcrumbs:O.yY.EDIT}}]}]},{path:"nvmeof",canActivate:[Z.x],data:{breadcrumbs:!0,text:"NVMe/TCP",path:"nvmeof",disableSplit:!0,moduleStatusGuardConfig:{uiApiPath:"nvmeof",redirectTo:"error",header:"NVMe/TCP Gateway not configured",button_name:"Configure NVMe/TCP",button_route:["/services",{outlets:{modal:["create","nvmeof"]}}],uiConfig:!1}},children:[{path:"",redirectTo:"subsystems",pathMatch:"full"},{path:"subsystems",component:Gt,data:{breadcrumbs:"Subsystems"},children:[{path:"",component:Gt},{path:O.Qp.CREATE,component:D_,outlet:"modal"},{path:`${O.Qp.CREATE}/:subsystem_nqn/listener`,component:k_,outlet:"modal"},{path:`${O.Qp.CREATE}/:subsystem_nqn/namespace`,component:xt,outlet:"modal"},{path:`${O.Qp.EDIT}/:subsystem_nqn/namespace/:nsid`,component:xt,outlet:"modal"},{path:`${O.Qp.ADD}/:subsystem_nqn/initiator`,component:_c,outlet:"modal"}]},{path:"gateways",component:t_,data:{breadcrumbs:"Gateways"}}]}];let fc=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:i})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[wt,v.RouterModule.forChild(Sc)]})}}return i})()},45413:(at,Ce,p)=>{p.d(Ce,{c:()=>q});var c=p(87536),_=p(53648),v=p(29841),A=p.n(v),Ee=p(95631),O=p(46045),re=p(58384),Z=p(6107),ee=p(12540),Te=p(77241),C=p(91974),z=p(19116);let se=(()=>{class F{constructor(g,S,N,m){this.elementRef=g,this.control=S,this.dimlessBinaryPerSecondPipe=N,this.formatter=m,this.ngModelChange=new c.EventEmitter,this.el=this.elementRef.nativeElement}ngOnInit(){this.setValue(this.el.value),this.ngDataReady&&this.ngDataReady.subscribe(()=>this.setValue(this.el.value))}setValue(g){/^[\d.]+$/.test(g)&&(g+=this.defaultUnit||"m");const S=this.formatter.toBytes(g,0),N=this.round(S);this.el.value=this.dimlessBinaryPerSecondPipe.transform(N),null!==S?(this.ngModelChange.emit(this.el.value),this.control.control.setValue(this.el.value)):(this.ngModelChange.emit(null),this.control.control.setValue(null))}round(g){if(null!==g&&0!==g){if(!A().isUndefined(this.minBytes)&&g<this.minBytes)return this.minBytes;if(!A().isUndefined(this.maxBytes)&&g>this.maxBytes)return this.maxBytes;if(!A().isUndefined(this.roundPower)){const S=Math.round(Math.log(g)/Math.log(this.roundPower));return Math.pow(this.roundPower,S)}}return g}onBlur(g){this.setValue(g)}static{this.\u0275fac=function(S){return new(S||F)(c.\u0275\u0275directiveInject(c.ElementRef),c.\u0275\u0275directiveInject(_.NgControl),c.\u0275\u0275directiveInject(z.w),c.\u0275\u0275directiveInject(ee.k))}}static{this.\u0275dir=c.\u0275\u0275defineDirective({type:F,selectors:[["","cdDimlessBinaryPerSecond",""]],hostBindings:function(S,N){1&S&&c.\u0275\u0275listener("blur",function(X){return N.onBlur(X.target.value)})},inputs:{ngDataReady:"ngDataReady",minBytes:"minBytes",maxBytes:"maxBytes",roundPower:"roundPower",defaultUnit:"defaultUnit"},outputs:{ngModelChange:"ngModelChange"}})}}return F})(),De=(()=>{class F{constructor(g,S){this.control=g,this.formatter=S}setValue(g){const S=this.formatter.toMilliseconds(g);this.control.control.setValue(`${S} ms`)}ngOnInit(){this.setValue(this.control.value),this.ngDataReady&&this.ngDataReady.subscribe(()=>this.setValue(this.control.value))}onUpdate(g){this.setValue(g)}static{this.\u0275fac=function(S){return new(S||F)(c.\u0275\u0275directiveInject(_.NgControl),c.\u0275\u0275directiveInject(ee.k))}}static{this.\u0275dir=c.\u0275\u0275defineDirective({type:F,selectors:[["","cdMilliseconds",""]],hostBindings:function(S,N){1&S&&c.\u0275\u0275listener("blur",function(X){return N.onUpdate(X.target.value)})},inputs:{ngDataReady:"ngDataReady"}})}}return F})(),G=(()=>{class F{constructor(g,S){this.formatter=g,this.ngControl=S}setValue(g){const S=this.formatter.toIops(g);this.ngControl.control.setValue(`${S} IOPS`)}ngOnInit(){this.setValue(this.ngControl.value),this.ngDataReady&&this.ngDataReady.subscribe(()=>this.setValue(this.ngControl.value))}onUpdate(g){this.setValue(g)}static{this.\u0275fac=function(S){return new(S||F)(c.\u0275\u0275directiveInject(ee.k),c.\u0275\u0275directiveInject(_.NgControl))}}static{this.\u0275dir=c.\u0275\u0275defineDirective({type:F,selectors:[["","cdIops",""]],hostBindings:function(S,N){1&S&&c.\u0275\u0275listener("blur",function(X){return N.onUpdate(X.target.value)})},inputs:{ngDataReady:"ngDataReady"}})}}return F})();var e=p(90476),Q=p(37966),U=p(3600);function Fe(F,x){if(1&F&&(c.\u0275\u0275elementContainerStart(0),c.\u0275\u0275element(1,"input",19),c.\u0275\u0275elementContainerEnd()),2&F){const g=c.\u0275\u0275nextContext().$implicit,S=c.\u0275\u0275nextContext(2);c.\u0275\u0275advance(),c.\u0275\u0275property("id",g.name)("name",g.name)("formControlName",g.name)("ngDataReady",S.ngDataReady)("invalid",S.form.get("configuration").controls[g.name].invalid&&S.form.get("configuration").controls[g.name].dirty)}}function te(F,x){if(1&F&&(c.\u0275\u0275elementContainerStart(0),c.\u0275\u0275element(1,"input",20),c.\u0275\u0275elementContainerEnd()),2&F){const g=c.\u0275\u0275nextContext().$implicit,S=c.\u0275\u0275nextContext(2);c.\u0275\u0275advance(),c.\u0275\u0275property("id",g.name)("name",g.name)("formControlName",g.name)("ngDataReady",S.ngDataReady)("invalid",S.form.get("configuration").controls[g.name].invalid&&S.form.get("configuration").controls[g.name].dirty)}}function T(F,x){if(1&F&&(c.\u0275\u0275elementContainerStart(0),c.\u0275\u0275element(1,"input",21),c.\u0275\u0275elementContainerEnd()),2&F){const g=c.\u0275\u0275nextContext().$implicit,S=c.\u0275\u0275nextContext(2);c.\u0275\u0275advance(),c.\u0275\u0275property("id",g.name)("name",g.name)("formControlName",g.name)("ngDataReady",S.ngDataReady)("invalid",S.form.get("configuration").controls[g.name].invalid&&S.form.get("configuration").controls[g.name].dirty)}}function Ge(F,x){1&F&&(c.\u0275\u0275namespaceSVG(),c.\u0275\u0275element(0,"svg",22))}function k(F,x){1&F&&(c.\u0275\u0275namespaceSVG(),c.\u0275\u0275element(0,"svg",24))}function I(F,x){if(1&F&&c.\u0275\u0275template(0,k,1,0,"svg",23),2&F){const g=c.\u0275\u0275nextContext().$implicit,S=c.\u0275\u0275nextContext(2);c.\u0275\u0275property("ngIf",S.form.get("configuration").get(g.name).disabled)}}function W(F,x){1&F&&(c.\u0275\u0275elementStart(0,"span",26),c.\u0275\u0275i18n(1,4),c.\u0275\u0275elementEnd())}function h(F,x){if(1&F&&c.\u0275\u0275template(0,W,2,0,"span",25),2&F){const g=c.\u0275\u0275nextContext().$implicit,S=c.\u0275\u0275nextContext(2),N=c.\u0275\u0275reference(1);c.\u0275\u0275property("ngIf",S.form.showError("configuration."+g.name,N,"min"))}}function K(F,x){if(1&F){const g=c.\u0275\u0275getCurrentView();c.\u0275\u0275elementStart(0,"div",12)(1,"cds-text-label",13),c.\u0275\u0275text(2),c.\u0275\u0275elementStart(3,"div",14),c.\u0275\u0275elementContainerStart(4,15),c.\u0275\u0275template(5,Fe,2,5,"ng-container",16)(6,te,2,5,"ng-container",16)(7,T,2,5,"ng-container",16),c.\u0275\u0275elementContainerEnd(),c.\u0275\u0275elementStart(8,"cds-icon-button",17),c.\u0275\u0275listener("click",function(){const N=c.\u0275\u0275restoreView(g).$implicit,m=c.\u0275\u0275nextContext(2);return c.\u0275\u0275resetView(m.reset(N.name))}),c.\u0275\u0275template(9,Ge,1,0,"svg",18)(10,I,1,1,"ng-template",null,1,c.\u0275\u0275templateRefExtractor),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(12,h,1,1,"ng-template",null,2,c.\u0275\u0275templateRefExtractor),c.\u0275\u0275elementEnd()()()}if(2&F){const g=x.$implicit,S=c.\u0275\u0275reference(11),N=c.\u0275\u0275reference(13),m=c.\u0275\u0275nextContext(2);c.\u0275\u0275advance(),c.\u0275\u0275property("helperText",g.description)("invalid",m.form.get("configuration").controls[g.name].invalid&&m.form.get("configuration").controls[g.name].dirty)("invalidText",N),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate1(" ",g.displayName," "),c.\u0275\u0275advance(2),c.\u0275\u0275property("ngSwitch",g.type),c.\u0275\u0275advance(),c.\u0275\u0275property("ngSwitchCase",m.configurationType.milliseconds),c.\u0275\u0275advance(),c.\u0275\u0275property("ngSwitchCase",m.configurationType.bps),c.\u0275\u0275advance(),c.\u0275\u0275property("ngSwitchCase",m.configurationType.iops),c.\u0275\u0275advance(2),c.\u0275\u0275property("ngIf",!m.form.get("configuration").get(g.name).disabled)("ngIfElse",S)}}function y(F,x){if(1&F){const g=c.\u0275\u0275getCurrentView();c.\u0275\u0275elementStart(0,"div")(1,"h5",7)(2,"legend",8),c.\u0275\u0275listener("click",function(){const N=c.\u0275\u0275restoreView(g).$implicit,m=c.\u0275\u0275nextContext();return c.\u0275\u0275resetView(m.toggleSectionVisibility(N.class))}),c.\u0275\u0275text(3),c.\u0275\u0275namespaceSVG(),c.\u0275\u0275element(4,"svg",9),c.\u0275\u0275elementEnd()(),c.\u0275\u0275namespaceHTML(),c.\u0275\u0275elementStart(5,"div",10),c.\u0275\u0275template(6,K,14,10,"div",11),c.\u0275\u0275elementEnd()()}if(2&F){const g=x.$implicit,S=c.\u0275\u0275nextContext();c.\u0275\u0275advance(3),c.\u0275\u0275textInterpolate1(" ",g.heading,"\xa0 "),c.\u0275\u0275advance(),c.\u0275\u0275property("cdsIcon",S.sectionVisibility[g.class]?S.icons.minusCircle:S.icons.addCircle)("size",S.icons.size20),c.\u0275\u0275advance(),c.\u0275\u0275classMap(g.class),c.\u0275\u0275property("hidden",!S.sectionVisibility[g.class]),c.\u0275\u0275advance(),c.\u0275\u0275property("ngForOf",g.options)}}let q=(()=>{class F{constructor(g,S){this.formatterService=g,this.rbdConfigurationService=S,this.initializeData=new Ee.ReplaySubject(1),this.changes=new c.EventEmitter,this.icons=O.FI,this.ngDataReady=new c.EventEmitter,this.configurationType=Z.T,this.sectionVisibility={}}ngOnInit(){const g=this.createConfigurationFormGroup();this.form.addControl("configuration",g),g.valueChanges.subscribe(()=>{this.changes.emit(this.getDirtyValues.bind(this))}),this.initializeData&&this.initializeData.subscribe(S=>{this.initialData=S.initialData;const N=S.sourceType;this.rbdConfigurationService.getWritableOptionFields().forEach(m=>{const X=S.initialData.filter(Ve=>Ve.name===m.name).pop();X&&X.source===N&&this.form.get(`configuration.${m.name}`).setValue(X.value)}),this.ngDataReady.emit()}),this.rbdConfigurationService.getWritableSections().forEach(S=>this.sectionVisibility[S.class]=!0)}getDirtyValues(g=!1,S){if(g&&!S)throw new Error("ProgrammingError: If local values shall be included, a proper localFieldType argument has to be provided, too");const N={};return this.rbdConfigurationService.getWritableOptionFields().forEach(m=>{const X=this.form.get("configuration").get(m.name);this.initialData&&this.initialData[m.name]===X.value||(X.dirty||g&&X.source===S)&&(N[m.name]=null===X.value?X.value:m.type===Z.T.bps?this.formatterService.toBytes(X.value):m.type===Z.T.milliseconds?this.formatterService.toMilliseconds(X.value):m.type===Z.T.iops?this.formatterService.toIops(X.value):X.value)}),N}createConfigurationFormGroup(){const g=new re.$({});return this.rbdConfigurationService.getWritableOptionFields().forEach(S=>{let N;if(S.type!==Z.T.milliseconds&&S.type!==Z.T.iops&&S.type!==Z.T.bps)throw new Error(`Type ${S.type} is unknown, you may need to add it to RbdConfiguration class`);{let m=0;A().forEach(this.initialData,X=>{X.name===S.name&&(m=X.value)}),N=new _.UntypedFormControl(m,_.Validators.min(0))}g.addControl(S.name,N)}),g}reset(g){const S=this.form.get("configuration").get(g);S.disabled?(S.setValue(S.previousValue||0),S.enable(),S.previousValue||S.markAsPristine()):(S.previousValue=S.value,S.setValue(null),S.markAsDirty(),S.disable())}isDisabled(g){return this.form.get("configuration").get(g).disabled}toggleSectionVisibility(g){this.sectionVisibility[g]=!this.sectionVisibility[g]}static{this.\u0275fac=function(S){return new(S||F)(c.\u0275\u0275directiveInject(ee.k),c.\u0275\u0275directiveInject(Te.Q))}}static{this.\u0275cmp=c.\u0275\u0275defineComponent({type:F,selectors:[["cd-rbd-configuration-form"]],inputs:{form:"form",initializeData:"initializeData"},outputs:{changes:"changes"},decls:5,vars:2,consts:()=>{let g,S;return g="RBD Configuration",S="The minimum value is 0.",[["cfgFormGroup",""],["resetIcon",""],["formError",""],g,S,[3,"formGroup"],[4,"ngFor","ngForOf"],[1,"cd-header"],[1,"collapsible",3,"click"],[3,"cdsIcon","size"],[3,"hidden"],["class","form-item",4,"ngFor","ngForOf"],[1,"form-item"],[3,"helperText","invalid","invalidText"],[1,"cds-input-group"],[3,"ngSwitch"],[4,"ngSwitchCase"],["kind","ghost","size","md","data-toggle","button",3,"click"],["cdsIcon","close","size","32","class","cds--btn__icon",4,"ngIf","ngIfElse"],["type","text","cdsText","","cdMilliseconds","",3,"id","name","formControlName","ngDataReady","invalid"],["type","text","cdsText","","defaultUnit","b","cdDimlessBinaryPerSecond","",3,"id","name","formControlName","ngDataReady","invalid"],["type","text","cdsText","","cdIops","",3,"id","name","formControlName","ngDataReady","invalid"],["cdsIcon","close","size","32",1,"cds--btn__icon"],["cdsIcon","reset","size","32",4,"ngIf"],["cdsIcon","reset","size","32"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"]]},template:function(S,N){1&S&&(c.\u0275\u0275elementStart(0,"fieldset",5,0)(2,"legend"),c.\u0275\u0275i18n(3,3),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(4,y,7,8,"div",6),c.\u0275\u0275elementEnd()),2&S&&(c.\u0275\u0275property("formGroup",N.form.get("configuration")),c.\u0275\u0275advance(4),c.\u0275\u0275property("ngForOf",N.rbdConfigurationService.sections))},dependencies:[C.NgForOf,C.NgIf,C.NgSwitch,C.NgSwitchCase,_.DefaultValueAccessor,_.NgControlStatus,_.NgControlStatusGroup,_.FormGroupDirective,_.FormControlName,se,De,G,e.S,Q.E,U.TextInputLabelComponent,U.TextInput,U.IconButton,U.IconDirective],styles:[".collapsible[_ngcontent-%COMP%]{cursor:pointer;user-select:none}"]})}}return F})()},15224:(at,Ce,p)=>{p.d(Ce,{k:()=>k});var c=p(87536),_=p(62847),v=p(6107);let A=(()=>{class I{transform(h){return{0:"global",1:"pool",2:"image"}[h]}static{this.\u0275fac=function(K){return new(K||I)}}static{this.\u0275pipe=c.\u0275\u0275definePipe({name:"rbdConfigurationSource",type:I,pure:!0})}}return I})();var Ee=p(12540),O=p(77241),re=p(91974),Z=p(19116),ee=p(7752),Te=p(25081);const C=["configurationSourceTpl"],z=["configurationValueTpl"],se=["poolConfTable"];function De(I,W){1&I&&(c.\u0275\u0275elementStart(0,"span"),c.\u0275\u0275i18n(1,3),c.\u0275\u0275elementEnd())}function G(I,W){1&I&&(c.\u0275\u0275elementStart(0,"strong"),c.\u0275\u0275i18n(1,4),c.\u0275\u0275elementEnd())}function e(I,W){1&I&&(c.\u0275\u0275elementStart(0,"strong"),c.\u0275\u0275i18n(1,5),c.\u0275\u0275elementEnd())}function Q(I,W){1&I&&(c.\u0275\u0275elementStart(0,"div",7),c.\u0275\u0275template(1,De,2,0,"span",8)(2,G,2,0,"strong",8)(3,e,2,0,"strong",8),c.\u0275\u0275elementEnd()),2&I&&(c.\u0275\u0275property("ngSwitch",W.data.value),c.\u0275\u0275advance(),c.\u0275\u0275property("ngSwitchCase","global"),c.\u0275\u0275advance(),c.\u0275\u0275property("ngSwitchCase","image"),c.\u0275\u0275advance(),c.\u0275\u0275property("ngSwitchCase","pool"))}function U(I,W){if(1&I&&(c.\u0275\u0275elementStart(0,"span"),c.\u0275\u0275text(1),c.\u0275\u0275pipe(2,"dimlessBinaryPerSecond"),c.\u0275\u0275elementEnd()),2&I){const h=c.\u0275\u0275nextContext().data.value;c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate(c.\u0275\u0275pipeBind1(2,1,h))}}function Fe(I,W){if(1&I&&(c.\u0275\u0275elementStart(0,"span"),c.\u0275\u0275text(1),c.\u0275\u0275pipe(2,"milliseconds"),c.\u0275\u0275elementEnd()),2&I){const h=c.\u0275\u0275nextContext().data.value;c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate(c.\u0275\u0275pipeBind1(2,1,h))}}function te(I,W){if(1&I&&(c.\u0275\u0275elementStart(0,"span"),c.\u0275\u0275text(1),c.\u0275\u0275pipe(2,"iops"),c.\u0275\u0275elementEnd()),2&I){const h=c.\u0275\u0275nextContext().data.value;c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate(c.\u0275\u0275pipeBind1(2,1,h))}}function T(I,W){if(1&I&&(c.\u0275\u0275elementStart(0,"span"),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&I){const h=c.\u0275\u0275nextContext().data.value;c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate(h)}}function Ge(I,W){if(1&I&&(c.\u0275\u0275elementStart(0,"div",7),c.\u0275\u0275template(1,U,3,3,"span",8)(2,Fe,3,3,"span",8)(3,te,3,3,"span",8)(4,T,2,1,"span",9),c.\u0275\u0275elementEnd()),2&I){const h=W.data.row,K=c.\u0275\u0275nextContext();c.\u0275\u0275property("ngSwitch",h.type),c.\u0275\u0275advance(),c.\u0275\u0275property("ngSwitchCase",K.typeField.bps),c.\u0275\u0275advance(),c.\u0275\u0275property("ngSwitchCase",K.typeField.milliseconds),c.\u0275\u0275advance(),c.\u0275\u0275property("ngSwitchCase",K.typeField.iops)}}let k=(()=>{class I{constructor(h,K){this.formatterService=h,this.rbdConfigurationService=K,this.sourceField=v.M,this.typeField=v.T}ngOnInit(){this.poolConfigurationColumns=[{prop:"displayName",name:"Name"},{prop:"description",name:"Description"},{prop:"name",name:"Key"},{prop:"source",name:"Source",cellTemplate:this.configurationSourceTpl,pipe:new A},{prop:"value",name:"Value",cellTemplate:this.configurationValueTpl}]}ngOnChanges(){this.data&&(this.data=this.data.filter(h=>this.rbdConfigurationService.getOptionFields().map(K=>K.name).includes(h.name)))}static{this.\u0275fac=function(K){return new(K||I)(c.\u0275\u0275directiveInject(Ee.k),c.\u0275\u0275directiveInject(O.Q))}}static{this.\u0275cmp=c.\u0275\u0275defineComponent({type:I,selectors:[["cd-rbd-configuration-table"]],viewQuery:function(K,y){if(1&K&&(c.\u0275\u0275viewQuery(C,7),c.\u0275\u0275viewQuery(z,7),c.\u0275\u0275viewQuery(se,7)),2&K){let q;c.\u0275\u0275queryRefresh(q=c.\u0275\u0275loadQuery())&&(y.configurationSourceTpl=q.first),c.\u0275\u0275queryRefresh(q=c.\u0275\u0275loadQuery())&&(y.configurationValueTpl=q.first),c.\u0275\u0275queryRefresh(q=c.\u0275\u0275loadQuery())&&(y.poolConfTable=q.first)}},inputs:{data:"data"},features:[c.\u0275\u0275NgOnChangesFeature],decls:6,vars:2,consts:()=>{let h,K,y;return h="Global",K="Image",y="Pool",[["poolConfTable",""],["configurationSourceTpl",""],["configurationValueTpl",""],h,K,y,["identifier","name",3,"data","columns"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"]]},template:function(K,y){1&K&&(c.\u0275\u0275element(0,"cd-table",6,0),c.\u0275\u0275template(2,Q,4,4,"ng-template",null,1,c.\u0275\u0275templateRefExtractor)(4,Ge,5,4,"ng-template",null,2,c.\u0275\u0275templateRefExtractor)),2&K&&c.\u0275\u0275property("data",y.data)("columns",y.poolConfigurationColumns)},dependencies:[re.NgSwitch,re.NgSwitchCase,re.NgSwitchDefault,_.O,Z.w,ee.f,Te.U]})}}return I})()},6872:(at,Ce,p)=>{p.d(Ce,{B:()=>se});var c=p(84857),v=p(36618),Ee=p(95631),re=p(50619),ee=p(80697),Te=p(15643),C=p(87536);let se=class it{constructor(G,e){this.http=G,this.timerService=e,this.REFRESH_INTERVAL=3e4,this.summaryDataSource=new Ee.BehaviorSubject(null),this.summaryData$=this.summaryDataSource.asObservable()}startPolling(){return this.timerService.get(()=>this.retrieveSummaryObservable(),this.REFRESH_INTERVAL).subscribe(this.retrieveSummaryObserver())}refresh(){return this.retrieveSummaryObservable().subscribe(this.retrieveSummaryObserver())}retrieveSummaryObservable(){return this.http.get("api/block/mirroring/summary")}retrieveSummaryObserver(){return G=>{this.summaryDataSource.next(G)}}subscribeSummary(G,e){return this.summaryData$.pipe((0,re.filter)(Q=>!!Q)).subscribe(G,e)}getPool(G){return this.http.get(`api/block/mirroring/pool/${G}`)}updatePool(G,e){return this.http.put(`api/block/mirroring/pool/${G}`,e,{observe:"response"})}getSiteName(){return this.http.get("api/block/mirroring/site_name")}setSiteName(G){return this.http.put("api/block/mirroring/site_name",{site_name:G},{observe:"response"})}createBootstrapToken(G){return this.http.post(`api/block/mirroring/pool/${G}/bootstrap/token`,{})}importBootstrapToken(G,e,Q){return this.http.post(`api/block/mirroring/pool/${G}/bootstrap/peer`,{direction:e,token:Q},{observe:"response"})}getPeer(G,e){return this.http.get(`api/block/mirroring/pool/${G}/peer/${e}`)}getPeerForPool(G){return this.http.get(`api/block/mirroring/pool/${G}/peer`)}addPeer(G,e){return this.http.post(`api/block/mirroring/pool/${G}/peer`,e,{observe:"response"})}updatePeer(G,e,Q){return this.http.put(`api/block/mirroring/pool/${G}/peer/${e}`,Q,{observe:"response"})}deletePeer(G,e){return this.http.delete(`api/block/mirroring/pool/${G}/peer/${e}`,{observe:"response"})}static{this.\u0275fac=function(e){return new(e||it)(C.\u0275\u0275inject(v.HttpClient),C.\u0275\u0275inject(Te.H))}}static{this.\u0275prov=C.\u0275\u0275defineInjectable({token:it,factory:it.\u0275fac,providedIn:"root"})}};(0,c.__decorate)([(0,c.__param)(0,ee.R),(0,c.__metadata)("design:type",Function),(0,c.__metadata)("design:paramtypes",[String]),(0,c.__metadata)("design:returntype",void 0)],se.prototype,"setSiteName",null),(0,c.__decorate)([(0,c.__param)(1,ee.R),(0,c.__param)(2,ee.R),(0,c.__metadata)("design:type",Function),(0,c.__metadata)("design:paramtypes",[String,String,String]),(0,c.__metadata)("design:returntype",void 0)],se.prototype,"importBootstrapToken",null),se=(0,c.__decorate)([ee.G,(0,c.__metadata)("design:paramtypes",[v.HttpClient,Te.H])],se)}}]);
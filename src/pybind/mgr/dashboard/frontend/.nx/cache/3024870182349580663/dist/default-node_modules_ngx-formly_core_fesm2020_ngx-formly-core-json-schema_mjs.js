(self.webpackChunkceph_dashboard=self.webpackChunkceph_dashboard||[]).push([["default-node_modules_ngx-formly_core_fesm2020_ngx-formly-core-json-schema_mjs"],{73323:(h,M,_)=>{_.r(M),_.d(M,{FormlyJsonschema:()=>x});var P=_(87536),E=_(53648),O=_(45451),w=_(50619);function y(o){return""===o||null==o}function A(o){return null!=o&&"object"==typeof o&&!Array.isArray(o)}function v(o){return Number.isInteger?Number.isInteger(o):"number"==typeof o&&Math.floor(o)===o}function I(o){return"object"==typeof o&&(o.hasOwnProperty("const")||o.enum&&1===o.enum.length)}function F(o){if(!o.fieldGroup)return(0,O.\u0275hasKey)(o)&&void 0!==(0,O.\u0275getFieldValue)(o)?1:0;const e=o.fieldGroup.reduce((i,n)=>F(n)+i,0);if(0===e&&(0,O.\u0275hasKey)(o)){const i=(0,O.\u0275getFieldValue)(o);if(null===i||void 0!==i&&(o.fieldArray&&Array.isArray(i)||!o.fieldArray&&A(i)))return 1}return e}class x{toFieldConfig(e,i){return this._toFieldConfig(e,{schema:e,...i||{}})}_toFieldConfig(e,{key:i,...n}){e=this.resolveSchema(e,n);const l=this.guessSchemaType(e);let r={type:l[0],defaultValue:e.default,props:{label:e.title,readonly:e.readOnly,description:e.description}};switch(null!=i&&(r.key=i),!n.ignoreDefault&&(e.readOnly||n.readOnly)&&(r.props.disabled=!0,n={...n,readOnly:!0}),n.resetOnHide&&(r.resetOnHide=!0),i&&n.strict&&this.addValidator(r,"type",(t,s)=>{const u=(0,O.\u0275getFieldValue)(s);if(null!=u)switch(r.type){case"string":return"string"==typeof u;case"integer":return v(u);case"number":return"number"==typeof u;case"object":return A(u);case"array":return Array.isArray(u)}return!0}),!1===n.shareFormControl&&(r.shareFormControl=!1),n.ignoreDefault&&delete r.defaultValue,this.addValidator(r,"type",{schemaType:l,expression:({value:t})=>{if(void 0===t||null===t&&-1!==l.indexOf("null"))return!0;switch(l[0]){case"null":return null===typeof t;case"string":return"string"==typeof t;case"integer":return v(t);case"number":return"number"==typeof t;case"object":return A(t);case"array":return Array.isArray(t)}return!0}}),r.type){case"number":case"integer":r.parsers=[t=>y(t)?void 0:Number(t)],e.hasOwnProperty("minimum")&&(r.props.min=e.minimum),e.hasOwnProperty("maximum")&&(r.props.max=e.maximum),e.hasOwnProperty("exclusiveMinimum")&&(r.props.exclusiveMinimum=e.exclusiveMinimum,this.addValidator(r,"exclusiveMinimum",({value:t})=>y(t)||t>e.exclusiveMinimum)),e.hasOwnProperty("exclusiveMaximum")&&(r.props.exclusiveMaximum=e.exclusiveMaximum,this.addValidator(r,"exclusiveMaximum",({value:t})=>y(t)||t<e.exclusiveMaximum)),e.hasOwnProperty("multipleOf")&&(r.props.step=e.multipleOf,this.addValidator(r,"multipleOf",({value:t})=>{if(y(t)||"number"!=typeof t||0===t||e.multipleOf<=0)return!0;const s=Math.pow(10,function b(o){if(!isFinite(o))return 0;let e=1,i=0;for(;Math.round(o*e)/e!==o;)e*=10,i++;return i}(e.multipleOf));return Math.round(t*s)%Math.round(e.multipleOf*s)==0}));break;case"string":r.parsers=[t=>(-1!==l.indexOf("null")?t=y(t)?null:t:r.props.required||(t=""===t?void 0:t),t)],["minLength","maxLength","pattern"].forEach(t=>{e.hasOwnProperty(t)&&(r.props[t]=e[t])});break;case"object":{r.fieldGroup||(r.fieldGroup=[]);const{propDeps:t,schemaDeps:s}=this.resolveDependencies(e);Object.keys(e.properties||{}).forEach(u=>{const a=Array.isArray(e.required)&&-1!==e.required.indexOf(u),d=this._toFieldConfig(e.properties[u],{...n,key:u,isOptional:n.isOptional||!a});if(r.fieldGroup.push(d),(a||t[u])&&(d.expressions={...d.expressions||{},"props.required":p=>{let m=p.parent;const f=p.fieldGroup&&null!=p.key?m.model:p.model;for(;null==m.key&&m.parent;)m=m.parent;const g=!(!m||!m.props)&&m.props.required;return!(!f&&!g)&&(!(!Array.isArray(e.required)||-1===e.required.indexOf(u))||t[u]&&p.model&&t[u].some(c=>!y(p.model[c])))}}),s[u]){const p=f=>f.hasOwnProperty("const")?f.const:f.enum[0],m=s[u].oneOf;m&&m.every(f=>f.properties&&f.properties[u]&&I(f.properties[u]))?m.forEach(f=>{const{[u]:g,...c}=f.properties;r.fieldGroup.push({...this._toFieldConfig({...f,properties:c},{...n,resetOnHide:!0}),expressions:{hide:C=>!C.model||p(g)!==C.model[u]}})}):r.fieldGroup.push({...this._toFieldConfig(s[u],n),expressions:{hide:f=>!f.model||y(f.model[u])}})}}),e.oneOf&&r.fieldGroup.push(this.resolveMultiSchema("oneOf",e.oneOf,{...n,shareFormControl:!1})),e.anyOf&&r.fieldGroup.push(this.resolveMultiSchema("anyOf",e.anyOf,n));break}case"array":e.hasOwnProperty("minItems")&&(r.props.minItems=e.minItems,this.addValidator(r,"minItems",(t,s)=>{const u=(0,O.\u0275getFieldValue)(s);return y(u)||u.length>=e.minItems}),!n.isOptional&&e.minItems>0&&void 0===r.defaultValue&&(r.defaultValue=Array.from(new Array(e.minItems)))),e.hasOwnProperty("maxItems")&&(r.props.maxItems=e.maxItems,this.addValidator(r,"maxItems",(t,s)=>{const u=(0,O.\u0275getFieldValue)(s);return y(u)||u.length<=e.maxItems})),e.hasOwnProperty("uniqueItems")&&(r.props.uniqueItems=e.uniqueItems,this.addValidator(r,"uniqueItems",(t,s)=>{const u=(0,O.\u0275getFieldValue)(s);return!(!y(u)&&e.uniqueItems)||Array.from(new Set(u.map(d=>JSON.stringify(d)))).length===u.length})),e.items&&!Array.isArray(e.items)&&(e.items=this.resolveSchema(e.items,n)),this.isEnum(e)||(r.fieldArray=t=>{if(!Array.isArray(e.items)){const d=e.items?this._toFieldConfig(e.items,n):{};return d.props&&(d.props.required=!0),d}const s=t.fieldGroup?t.fieldGroup.length:0,u=e.items[s]?e.items[s]:e.additionalItems,a=u?this._toFieldConfig(u,n):{};return a.props&&(a.props.required=!0),e.items[s]&&(a.props.removable=!1),a})}return e.hasOwnProperty("const")&&(r.props.const=e.const,this.addValidator(r,"const",({value:t})=>t===e.const),r.type||(r.defaultValue=e.const)),this.isEnum(e)&&(r.props.multiple="array"===r.type,r.type="enum",r.props.options=this.toEnumOptions(e)),e.oneOf&&!r.type&&(delete r.key,r.fieldGroup=[this.resolveMultiSchema("oneOf",e.oneOf,{...n,key:i,shareFormControl:!1})]),e.oneOf&&!r.type&&(delete r.key,r.fieldGroup=[this.resolveMultiSchema("oneOf",e.oneOf,{...n,key:i,shareFormControl:!1})]),e.widget?.formlyConfig&&(r=this.mergeFields(r,e.widget.formlyConfig)),r.templateOptions=r.props,n.map?n.map(r,e):r}resolveSchema(e,i){return e&&e.$ref&&(e=this.resolveDefinition(e,i)),e&&e.allOf&&(e=this.resolveAllOf(e,i)),e}resolveAllOf({allOf:e,...i},n){if(!e.length)throw Error(`allOf array can not be empty ${e}.`);return e.reduce((l,r)=>(r=this.resolveSchema(r,n),l.required&&r.required&&(l.required=[...l.required,...r.required]),r.uniqueItems&&(l.uniqueItems=r.uniqueItems),["maxLength","maximum","exclusiveMaximum","maxItems","maxProperties"].forEach(t=>{!y(l[t])&&!y(r[t])&&(l[t]=l[t]<r[t]?l[t]:r[t])}),["minLength","minimum","exclusiveMinimum","minItems","minProperties"].forEach(t=>{!y(l[t])&&!y(r[t])&&(l[t]=l[t]>r[t]?l[t]:r[t])}),(0,O.\u0275reverseDeepMerge)(l,r)),i)}resolveMultiSchema(e,i,n){return{type:"multischema",fieldGroup:[{type:"enum",defaultValue:-1,props:{multiple:"anyOf"===e,options:i.map((l,r)=>({label:l.title,value:r,disabled:l.readOnly}))},hooks:{onInit:l=>l.formControl.valueChanges.pipe((0,w.tap)(()=>l.options.detectChanges(l.parent)))}},{fieldGroup:i.map((l,r)=>({...this._toFieldConfig(l,{...n,resetOnHide:!0}),expressions:{hide:(t,s)=>{const u=t.parent.parent.fieldGroup[0].formControl;if(-1===u.value||s){let a=t.parent.fieldGroup.map((d,p)=>[d,p,this.isFieldValid(d,p,i,n)]).sort(([d,,p],[m,,f])=>{if(p!==f)return f?1:-1;const g=F(d),c=F(m);return g===c&&d.props.disabled===m.props.disabled?0:c>g?1:-1}).map(([,d])=>d);if("anyOf"===e){const d=a.filter(p=>F(t.parent.fieldGroup[p]));a=d.length>0?d:[a[0]||0]}a=a.length>0?a:[0],u.setValue("anyOf"===e?a:a[0])}return Array.isArray(u.value)?-1===u.value.indexOf(r):u.value!==r}}}))}]}}resolveDefinition(e,i){const[n,l]=e.$ref.split("#/");if(n)throw Error(`Remote schemas for ${e.$ref} not supported yet.`);const r=l?l.split("/").reduce((t,s)=>t?.hasOwnProperty(s)?t[s]:null,i.schema):null;if(!r)throw Error(`Cannot find a definition for ${e.$ref}.`);return r.$ref?this.resolveDefinition(r,i):{...r,...["title","description","default","widget"].reduce((t,s)=>(e.hasOwnProperty(s)&&(t[s]=e[s]),t),{})}}resolveDependencies(e){const i={},n={};return Object.keys(e.dependencies||{}).forEach(l=>{const r=e.dependencies[l];Array.isArray(r)?r.forEach(t=>{i[t]?i[t].push(l):i[t]=[l]}):n[l]=r}),{propDeps:i,schemaDeps:n}}guessSchemaType(e){const i=e?.type;return!i&&e?.properties?["object"]:Array.isArray(i)?1===i.length?i:2===i.length&&-1!==i.indexOf("null")?i.sort(n=>"null"==n?1:-1):i:i?[i]:[]}addValidator(e,i,n){e.validators=e.validators||{},e.validators[i]=n}isEnum(e){return!!e.enum||e.anyOf&&e.anyOf.every(I)||e.oneOf&&e.oneOf.every(I)||e.uniqueItems&&e.items&&!Array.isArray(e.items)&&this.isEnum(e.items)}toEnumOptions(e){if(e.enum)return e.enum.map(n=>({value:n,label:n}));const i=n=>{const l=n.hasOwnProperty("const")?n.const:n.enum[0],r={value:l,label:n.title||l};return n.readOnly&&(r.disabled=!0),r};return e.anyOf?e.anyOf.map(i):e.oneOf?e.oneOf.map(i):this.toEnumOptions(e.items)}isFieldValid(e,i,n,l){e._schemasFields||(Object.defineProperty(e,"_schemasFields",{enumerable:!1,writable:!0,configurable:!0}),e._schemasFields={});let r=e._schemasFields[i];const t=e.model?(0,O.\u0275clone)(e.model):e.fieldArray?[]:{};return r?(r.model=t,e.options.build(r)):r=e._schemasFields[i]=e.options.build({form:Array.isArray(t)?new E.FormArray([]):new E.FormGroup({}),fieldGroup:[this._toFieldConfig(n[i],{...l,resetOnHide:!0,ignoreDefault:!0,map:null,strict:!0})],model:t,options:{}}),r.form.valid}mergeFields(e,i){for(let n in i){const l="templateOptions"===n?"props":n;A(e[l])&&A(i[n])?e[l]=this.mergeFields(e[l],i[n]):null!=i[n]&&(e[l]=i[n])}return e}}x.\u0275fac=function(e){return new(e||x)},x.\u0275prov=P.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac,providedIn:"root"})}}]);
//# sourceMappingURL=default-node_modules_ngx-formly_core_fesm2020_ngx-formly-core-json-schema_mjs.js.map
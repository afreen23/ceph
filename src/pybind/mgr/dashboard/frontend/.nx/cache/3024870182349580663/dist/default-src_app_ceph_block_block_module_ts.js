(self.webpackChunkceph_dashboard=self.webpackChunkceph_dashboard||[]).push([["default-src_app_ceph_block_block_module_ts"],{11430:(Ut,fe,m)=>{m.r(fe),m.d(fe,{BlockModule:()=>Je,RoutedBlockModule:()=>Kt});var l=m(91974),r=m(53648),v=m(76218),P=m(77317),Ee=m(13421),M=m(54372),ae=m(1811),W=m(6955),J=m(93887),Ce=m(29841),S=m.n(Ce),K=m(95631),Q=m(84857),ce=m(36618),y=m(80697),e=m(87536);let U=class zt{constructor(n){this.http=n}listTargets(){return this.http.get("api/iscsi/target")}getTarget(n){return this.http.get(`api/iscsi/target/${n}`)}updateTarget(n,t){return this.http.put(`api/iscsi/target/${n}`,t,{observe:"response"})}status(){return this.http.get("ui-api/iscsi/status")}settings(){return this.http.get("ui-api/iscsi/settings")}version(){return this.http.get("ui-api/iscsi/version")}portals(){return this.http.get("ui-api/iscsi/portals")}createTarget(n){return this.http.post("api/iscsi/target",n,{observe:"response"})}deleteTarget(n){return this.http.delete(`api/iscsi/target/${n}`,{observe:"response"})}getDiscovery(){return this.http.get("api/iscsi/discoveryauth")}updateDiscovery(n){return this.http.put("api/iscsi/discoveryauth",n)}overview(){return this.http.get("ui-api/iscsi/overview")}static{this.\u0275fac=function(t){return new(t||zt)(e.\u0275\u0275inject(ce.HttpClient))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:zt,factory:zt.\u0275fac,providedIn:"root"})}};U=(0,Q.__decorate)([y.G,(0,Q.__metadata)("design:paramtypes",[ce.HttpClient])],U);var z=m(75180),Te=m(66668),Z=m(31345),F=m(46045),Ge=m(74902),V=m(58384),b=m(3687),H=m(48856),E=m(85481),q=m(77867),$=m(50813),se=m(69081),A=m(59781),f=m(90476),u=m(10142),h=m(78708),R=m(37966),d=m(3600);function He(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"option",8),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=n.$implicit;e.\u0275\u0275property("ngValue",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t)}}function Un(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"select",7),e.\u0275\u0275element(1,"option",8),e.\u0275\u0275template(2,He,2,2,"option",9),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("id",t.setting),e.\u0275\u0275propertyInterpolate("name",t.setting),e.\u0275\u0275property("formControlName",t.setting),e.\u0275\u0275advance(),e.\u0275\u0275property("ngValue",null),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",t.limits.values)}}function jn(i,n){if(1&i&&e.\u0275\u0275element(0,"input",12),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("formControlName",t.setting)}}function qn(i,n){if(1&i&&e.\u0275\u0275element(0,"input",13),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("formControlName",t.setting)}}function Qn(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"br"),e.\u0275\u0275elementStart(2,"div",14),e.\u0275\u0275element(3,"input",15),e.\u0275\u0275elementStart(4,"label",16),e.\u0275\u0275text(5,"Yes"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",14),e.\u0275\u0275element(7,"input",15),e.\u0275\u0275elementStart(8,"label",16),e.\u0275\u0275text(9,"No"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(3),e.\u0275\u0275property("id",t.setting+"True")("value",!0)("formControlName",t.setting),e.\u0275\u0275advance(),e.\u0275\u0275property("for",t.setting+"True"),e.\u0275\u0275advance(3),e.\u0275\u0275property("id",t.setting+"False")("value",!1)("formControlName",t.setting),e.\u0275\u0275advance(),e.\u0275\u0275property("for",t.setting+"False")}}function Yn(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275template(1,jn,1,1,"input",10)(2,qn,1,1,"input",11)(3,Qn,10,8,"ng-container",5),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","int"===t.limits.type),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","str"===t.limits.type),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","bool"===t.limits.type)}}function Wn(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span",17),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18n(2,0),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275i18nExp(t.limits.min),e.\u0275\u0275i18nApply(2)}}function Jn(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span",17),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18n(2,1),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275i18nExp(t.limits.max),e.\u0275\u0275i18nApply(2)}}class ke{ngOnInit(){const n=[];"min"in this.limits&&n.push(r.Validators.min(Number(this.limits.min))),"max"in this.limits&&n.push(r.Validators.max(Number(this.limits.max))),this.settingsForm.get(this.setting).setValidators(n)}static{this.\u0275fac=function(t){return new(t||ke)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ke,selectors:[["cd-iscsi-setting"]],inputs:{settingsForm:"settingsForm",formDir:"formDir",setting:"setting",limits:"limits"},decls:7,vars:7,consts:()=>{let n,t;return n=$localize`:␟8835b9e49a3348b0a2f2162c21118af1f4bee45a␟3918997869022270899:Must be greater than or equal to ${"\ufffd0\ufffd"}:INTERPOLATION:.`,t=$localize`:␟bbddac59563c8c126e3fe28691e4e247614fcbd1␟5607114880605224382:Must be less than or equal to ${"\ufffd0\ufffd"}:INTERPOLATION:.`,[n,t,[1,"form-group",3,"formGroup"],[1,"col-form-label",3,"for"],["class","form-control",3,"id","name","formControlName",4,"ngIf"],[4,"ngIf"],["class","invalid-feedback",4,"ngIf"],[1,"form-control",3,"id","name","formControlName"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","number","class","form-control",3,"formControlName",4,"ngIf"],["type","text","class","form-control",3,"formControlName",4,"ngIf"],["type","number",1,"form-control",3,"formControlName"],["type","text",1,"form-control",3,"formControlName"],[1,"custom-control","custom-radio","custom-control-inline"],["type","radio",1,"custom-control-input",3,"id","value","formControlName"],[1,"custom-control-label",3,"for"],[1,"invalid-feedback"]]},template:function(t,o){1&t&&(e.\u0275\u0275elementStart(0,"div",2)(1,"label",3),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,Un,3,5,"select",4)(4,Yn,4,3,"span",5)(5,Wn,3,1,"span",6)(6,Jn,3,1,"span",6),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275property("formGroup",o.settingsForm),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("for",o.setting),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(o.setting),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","enum"===o.limits.type),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","enum"!==o.limits.type),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.settingsForm.showError(o.setting,o.formDir,"min")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.settingsForm.showError(o.setting,o.formDir,"max")))},dependencies:[l.NgForOf,l.NgIf,r.NgSelectOption,r.\u0275NgSelectMultipleOption,r.DefaultValueAccessor,r.NumberValueAccessor,r.SelectControlValueAccessor,r.RadioControlValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.FormGroupDirective,r.FormControlName,f.S,u.a,h.C,R.E,d.Option]})}}var it=m(82680);function Zn(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",30),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd())}function eo(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span")(1,"legend",16),e.\u0275\u0275i18n(2,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",17)(4,"div",18)(5,"label",25),e.\u0275\u0275i18n(6,6),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(7,"input",26),e.\u0275\u0275template(8,Zn,2,0,"span",27),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(9,"div",17)(10,"div",18)(11,"label",28),e.\u0275\u0275i18n(12,7),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(13,"input",29),e.\u0275\u0275elementEnd()()()),2&i){const t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(9);e.\u0275\u0275advance(8),e.\u0275\u0275property("ngIf",t.settingsForm.showError("lun",o,"required"))}}function to(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"option",31),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"iscsiBackstore"),e.\u0275\u0275elementEnd()),2&i){const t=n.$implicit;e.\u0275\u0275property("value",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,2,t))}}function no(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",17)(1,"div",18),e.\u0275\u0275element(2,"cd-iscsi-setting",33),e.\u0275\u0275elementEnd()()),2&i){const t=n.$implicit,o=e.\u0275\u0275nextContext(2).$implicit,a=e.\u0275\u0275nextContext(),s=e.\u0275\u0275reference(9);e.\u0275\u0275advance(2),e.\u0275\u0275property("settingsForm",a.settingsForm)("formDir",s)("setting",t.key)("limits",a.getDiskControlLimits(o,t.key))}}function oo(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,no,3,4,"div",32),e.\u0275\u0275pipe(2,"keyvalue"),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit,o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(2,1,o.disk_default_controls[t]))}}function io(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,oo,3,3,"ng-container",15),e.\u0275\u0275elementContainerEnd()),2&i){const t=n.$implicit,o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.settingsForm.value.backstore===t)}}class at{constructor(n,t,o){this.activeModal=n,this.iscsiService=t,this.actionLabels=o}ngOnInit(){const n={backstore:new r.UntypedFormControl(this.imagesSettings[this.image].backstore),lun:new r.UntypedFormControl(this.imagesSettings[this.image].lun),wwn:new r.UntypedFormControl(this.imagesSettings[this.image].wwn)};S().forEach(this.backstores,t=>{const o=this.imagesSettings[this.image][t]||{};S().forIn(this.disk_default_controls[t],(a,s)=>{n[s]=new r.UntypedFormControl(o[s])})}),this.settingsForm=new V.$(n)}getDiskControlLimits(n,t){return this.disk_controls_limits?this.disk_controls_limits[n][t]:{type:"int"}}save(){const n=this.settingsForm.controls.backstore.value,t=this.settingsForm.controls.lun.value,o=this.settingsForm.controls.wwn.value,a={};S().forIn(this.settingsForm.controls,(s,_)=>{""!==s.value&&null!==s.value&&_ in this.disk_default_controls[this.settingsForm.value.backstore]&&(a[_]=s.value,S().forEach(this.backstores,c=>{if(c!==n){const p=this.imagesSettings[this.image][c]||{};_ in p&&(this.imagesSettings[this.image][c][_]=s.value)}}))}),this.imagesSettings[this.image].backstore=n,this.imagesSettings[this.image].lun=t,this.imagesSettings[this.image].wwn=o,this.imagesSettings[this.image][n]=a,this.imagesSettings={...this.imagesSettings},this.control.updateValueAndValidity({emitEvent:!1}),this.activeModal.close()}static{this.\u0275fac=function(t){return new(t||at)(e.\u0275\u0275directiveInject(P.NgbActiveModal),e.\u0275\u0275directiveInject(U),e.\u0275\u0275directiveInject(M.Ss))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:at,selectors:[["cd-iscsi-target-image-settings-modal"]],decls:25,vars:8,consts:()=>{let n,t,o,a,s,_,c,p;return n=$localize`:␟051dcc342cfa5c1eaf187a2001aaa162379a160c␟5479133824073842793:Configure`,t=$localize`:␟9e515f954730279c31d5301f02479666d6264e8b␟6408223950156931278:Changing these parameters from their default values is usually not necessary.`,o=$localize`:␟121cc5391cd2a5115bc2b3160379ee5b36cd7716␟4930506384627295710:Settings`,a=$localize`:␟69a47cbabcc51ca942606e1d8da0ec11f98a2690␟2699995524827665158:Backstore`,s=$localize`:␟4e2591df099ddac796cda401c5f282da779d45f2␟4164796296331721280:Identifier`,_=$localize`:␟62480a4859976427cf18fc8ef41d3a438eda0412␟2967517037057080886:lun`,c=$localize`:␟8afc9eb4405e0aa554b2ba14140ef790cdecc040␟4035337430291532334:wwn`,p=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,[["formDir","ngForm"],n,t,o,a,s,_,c,p,[3,"modalRef"],[1,"modal-title"],[1,"modal-content"],["name","settingsForm","novalidate","",1,"form",3,"formGroup"],[1,"modal-body"],[1,"alert-warning"],[4,"ngIf"],[1,"cd-header"],[1,"form-group","row"],[1,"col-sm-12"],[1,"col-form-label"],["id","backstore","name","backstore","formControlName","backstore",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"modal-footer"],[3,"submitActionEvent","form","submitText"],["for","lun",1,"col-form-label","required"],["type","number","id","lun","name","lun","formControlName","lun",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","wwn",1,"col-form-label"],["type","text","id","wwn","name","wwn","formControlName","wwn",1,"form-control"],[1,"invalid-feedback"],[3,"value"],["class","form-group row",4,"ngFor","ngForOf"],[3,"settingsForm","formDir","setting","limits"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-modal",9),e.\u0275\u0275elementContainerStart(1,10)(2),e.\u0275\u0275i18n(3,1),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275text(4,"\xa0 "),e.\u0275\u0275elementStart(5,"small"),e.\u0275\u0275text(6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(7,11),e.\u0275\u0275elementStart(8,"form",12,0)(10,"div",13)(11,"p",14),e.\u0275\u0275i18n(12,2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(13,eo,14,1,"span",15),e.\u0275\u0275elementStart(14,"legend",16),e.\u0275\u0275i18n(15,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div",17)(17,"div",18)(18,"label",19),e.\u0275\u0275i18n(19,4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"select",20),e.\u0275\u0275template(21,to,3,4,"option",21),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(22,io,2,1,"ng-container",22),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(23,"div",23)(24,"cd-form-button-panel",24),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.save())}),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()}2&t&&(e.\u0275\u0275property("modalRef",o.activeModal),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(o.image),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",o.settingsForm),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",o.api_version>=1),e.\u0275\u0275advance(8),e.\u0275\u0275property("ngForOf",o.backstores),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",o.backstores),e.\u0275\u0275advance(2),e.\u0275\u0275property("form",o.settingsForm)("submitText",o.actionLabels.UPDATE))},dependencies:[l.NgForOf,l.NgIf,r.\u0275NgNoValidate,r.NgSelectOption,r.\u0275NgSelectMultipleOption,r.DefaultValueAccessor,r.NumberValueAccessor,r.SelectControlValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.FormGroupDirective,r.FormControlName,se.z,A.e,f.S,u.a,h.C,R.E,d.Option,ke,l.KeyValuePipe,it.k]})}}function ao(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",12)(1,"div",13),e.\u0275\u0275element(2,"cd-iscsi-setting",14),e.\u0275\u0275elementEnd()()),2&i){const t=n.$implicit,o=e.\u0275\u0275nextContext(),a=e.\u0275\u0275reference(5);e.\u0275\u0275advance(2),e.\u0275\u0275property("settingsForm",o.settingsForm)("formDir",a)("setting",t.key)("limits",o.getTargetControlLimits(t.key))}}class st{constructor(n,t,o){this.activeModal=n,this.iscsiService=t,this.actionLabels=o}ngOnInit(){const n={};S().forIn(this.target_default_controls,(t,o)=>{n[o]=new r.UntypedFormControl(this.target_controls.value[o])}),this.settingsForm=new V.$(n)}save(){const n={};S().forIn(this.settingsForm.controls,(t,o)=>{""===t.value||null===t.value||(n[o]=t.value)}),this.target_controls.setValue(n),this.activeModal.close()}getTargetControlLimits(n){return this.target_controls_limits?this.target_controls_limits[n]:["Yes","No"].includes(this.target_default_controls[n])?{type:"bool"}:{type:"int"}}static{this.\u0275fac=function(t){return new(t||st)(e.\u0275\u0275directiveInject(P.NgbActiveModal),e.\u0275\u0275directiveInject(U),e.\u0275\u0275directiveInject(M.Ss))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:st,selectors:[["cd-iscsi-target-iqn-settings-modal"]],decls:13,vars:7,consts:()=>{let n,t;return n=$localize`:␟339878da255ab55447c43afef8d9b2f9753bf5f6␟8360107325291301836:Advanced Settings`,t=$localize`:␟9e515f954730279c31d5301f02479666d6264e8b␟6408223950156931278:Changing these parameters from their default values is usually not necessary.`,[["formDir","ngForm"],n,t,[3,"modalRef"],[1,"modal-title"],[1,"modal-content"],["name","settingsForm","novalidate","",3,"formGroup"],[1,"modal-body"],[1,"alert-warning"],["class","form-group row",4,"ngFor","ngForOf"],[1,"modal-footer"],[3,"submitActionEvent","form","submitText"],[1,"form-group","row"],[1,"col-sm-12"],[3,"settingsForm","formDir","setting","limits"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-modal",3),e.\u0275\u0275elementContainerStart(1,4),e.\u0275\u0275i18n(2,1),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(3,5),e.\u0275\u0275elementStart(4,"form",6,0)(6,"div",7)(7,"p",8),e.\u0275\u0275i18n(8,2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,ao,3,4,"div",9),e.\u0275\u0275pipe(10,"keyvalue"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"div",10)(12,"cd-form-button-panel",11),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.save())}),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()}2&t&&(e.\u0275\u0275property("modalRef",o.activeModal),e.\u0275\u0275advance(4),e.\u0275\u0275property("formGroup",o.settingsForm),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(10,5,o.settingsForm.controls)),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.settingsForm)("submitText",o.actionLabels.UPDATE))},dependencies:[l.NgForOf,r.\u0275NgNoValidate,r.NgControlStatusGroup,r.FormGroupDirective,se.z,A.e,h.C,R.E,ke,l.KeyValuePipe]})}}var so=m(92619),rt=m(50889),_n=m(12302),ro=m(70946),cn=m(56677),De=m(37353);function lo(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd())}function _o(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,9),e.\u0275\u0275elementEnd())}function co(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18n(2,10),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275element(3,"br"),e.\u0275\u0275elementContainerStart(4),e.\u0275\u0275i18n(5,11),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275element(6,"br"),e.\u0275\u0275elementStart(7,"a",95),e.\u0275\u0275i18n(8,12),e.\u0275\u0275elementEnd()())}function mo(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",96),e.\u0275\u0275i18n(1,13),e.\u0275\u0275elementEnd())}function po(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",97),e.\u0275\u0275element(2,"input",98),e.\u0275\u0275elementStart(3,"button",99),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t),s=a.$implicit,_=a.index,c=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(c.removePortal(_,s))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(4,"svg",75),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=n.$implicit,o=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("value",t),e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",o.icons.destroy)("size",o.icons.size16)}}function uo(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,14),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275i18nExp(t.minimum_gateways),e.\u0275\u0275i18nApply(1)}}function go(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",102),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit,o=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1("lun: ",o.imagesSettings[t].lun,"")}}function So(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275i18n(1,15),e.\u0275\u0275pipe(2,"iscsiBackstore"),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit,o=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(2,1,o.imagesSettings[t].backstore)),e.\u0275\u0275i18nApply(1)}}function fo(i,n){1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275i18n(1,16),e.\u0275\u0275elementContainerEnd())}function Eo(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",97),e.\u0275\u0275element(2,"input",98),e.\u0275\u0275template(3,go,2,1,"div",100),e.\u0275\u0275elementStart(4,"button",99),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit,s=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(s.imageSettingsModal(a))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(5,"svg",75),e.\u0275\u0275elementEnd(),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementStart(6,"button",99),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t),s=a.$implicit,_=a.index,c=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(c.removeImage(_,s))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(7,"svg",75),e.\u0275\u0275elementEnd()(),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementStart(8,"span",96),e.\u0275\u0275template(9,So,3,3,"ng-container",101)(10,fo,2,0,"ng-container",101),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=n.$implicit,o=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("value",t),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.api_version>=1),e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",o.icons.deepCheck)("size",o.icons.size16),e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",o.icons.destroy)("size",o.icons.size16),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",o.backstores.length>1),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.hasAdvancedSettings(o.imagesSettings[t][o.imagesSettings[t].backstore]))}}function Co(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,17),e.\u0275\u0275elementEnd())}function To(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,18),e.\u0275\u0275elementEnd())}function Fo(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,23),e.\u0275\u0275elementEnd())}function Mo(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,24),e.\u0275\u0275elementEnd())}function ho(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,25),e.\u0275\u0275elementEnd())}function Oo(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,26),e.\u0275\u0275elementEnd())}function Ro(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,27),e.\u0275\u0275elementEnd())}function Io(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,28),e.\u0275\u0275elementEnd())}function No(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,29),e.\u0275\u0275elementEnd())}function bo(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,30),e.\u0275\u0275elementEnd())}function Po(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",103)(1,"div",69)(2,"label",104),e.\u0275\u0275elementContainerStart(3),e.\u0275\u0275i18n(4,19),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",71),e.\u0275\u0275element(6,"input",105),e.\u0275\u0275template(7,Fo,2,0,"span",76)(8,Mo,2,0,"span",76),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(9,"div",69)(10,"label",106),e.\u0275\u0275elementContainerStart(11),e.\u0275\u0275i18n(12,20),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"div",71)(14,"div",72),e.\u0275\u0275element(15,"input",107)(16,"button",108)(17,"cd-copy-2-clipboard-button",109),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(18,ho,2,0,"span",76)(19,Oo,2,0,"span",76),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(20,"div",69)(21,"label",110),e.\u0275\u0275elementContainerStart(22),e.\u0275\u0275i18n(23,21),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"div",71),e.\u0275\u0275element(25,"input",111),e.\u0275\u0275template(26,Ro,2,0,"span",76)(27,Io,2,0,"span",76),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(28,"div",69)(29,"label",112),e.\u0275\u0275elementContainerStart(30),e.\u0275\u0275i18n(31,22),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(32,"div",71)(33,"div",72),e.\u0275\u0275element(34,"input",113)(35,"button",114)(36,"cd-copy-2-clipboard-button",115),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(37,No,2,0,"span",76)(38,bo,2,0,"span",76),e.\u0275\u0275elementEnd()()()),2&i){e.\u0275\u0275nextContext();const t=e.\u0275\u0275reference(2),o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",o.targetForm.showError("user",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.targetForm.showError("user",t,"pattern")),e.\u0275\u0275advance(10),e.\u0275\u0275property("ngIf",o.targetForm.showError("password",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.targetForm.showError("password",t,"pattern")),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",o.targetForm.showError("mutual_user",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.targetForm.showError("mutual_user",t,"pattern")),e.\u0275\u0275advance(10),e.\u0275\u0275property("ngIf",o.targetForm.showError("mutual_password",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.targetForm.showError("mutual_password",t,"pattern"))}}function Ao(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,40),e.\u0275\u0275elementEnd())}function vo(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,41),e.\u0275\u0275elementEnd())}function Do(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,42),e.\u0275\u0275elementEnd())}function Lo(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,43),e.\u0275\u0275elementEnd())}function yo(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,44),e.\u0275\u0275elementEnd())}function $o(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,45),e.\u0275\u0275elementEnd())}function Bo(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,46),e.\u0275\u0275elementEnd())}function Go(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,47),e.\u0275\u0275elementEnd())}function xo(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,48),e.\u0275\u0275elementEnd())}function wo(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,49),e.\u0275\u0275elementEnd())}function Vo(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,50),e.\u0275\u0275elementEnd())}function Ho(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",97),e.\u0275\u0275element(2,"input",98),e.\u0275\u0275elementStart(3,"button",99),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t),s=a.$implicit,_=a.index,c=e.\u0275\u0275nextContext(),p=c.$implicit,g=c.index,T=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(T.removeInitiatorImage(p,_,g,s))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(4,"svg",75),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=n.$implicit,o=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(2),e.\u0275\u0275property("value",t),e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",o.icons.destroy)("size",o.icons.size16)}}function ko(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275i18n(1,51),e.\u0275\u0275elementEnd())}function Ko(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",80)(1,"div",81)(2,"cd-select",136),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(3,"svg",75),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementContainerStart(4),e.\u0275\u0275i18n(5,52),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()()()),2&i){const t=e.\u0275\u0275nextContext(),o=t.$implicit,a=t.index,s=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(2),e.\u0275\u0275property("data",o.getValue("luns"))("options",s.imagesInitiatorSelections[a])("messages",s.messages.initiatorImage),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",s.icons.add)("size",s.icons.size16)}}function zo(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",120)(1,"div",67),e.\u0275\u0275elementContainerStart(2),e.\u0275\u0275i18n(3,33),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275text(4),e.\u0275\u0275elementStart(5,"button",121),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).index,s=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(s.removeInitiator(a))}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",68)(7,"div",69)(8,"label",122),e.\u0275\u0275i18n(9,34),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"div",71)(11,"input",123),e.\u0275\u0275listener("blur",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.updatedInitiatorSelector())}),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(12,Ao,2,0,"span",76)(13,vo,2,0,"span",76)(14,Do,2,0,"span",76),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerStart(15,103),e.\u0275\u0275elementStart(16,"div",69)(17,"label",124),e.\u0275\u0275i18n(18,35),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"div",71),e.\u0275\u0275element(20,"input",125),e.\u0275\u0275template(21,Lo,2,0,"span",76)(22,yo,2,0,"span",76),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(23,"div",69)(24,"label",126),e.\u0275\u0275i18n(25,36),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(26,"div",71)(27,"div",72),e.\u0275\u0275element(28,"input",127)(29,"button",128)(30,"cd-copy-2-clipboard-button",129),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(31,$o,2,0,"span",76)(32,Bo,2,0,"span",76),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(33,"div",69)(34,"label",130),e.\u0275\u0275elementContainerStart(35),e.\u0275\u0275i18n(36,37),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(37,"div",71),e.\u0275\u0275element(38,"input",131),e.\u0275\u0275template(39,Go,2,0,"span",76)(40,xo,2,0,"span",76),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(41,"div",69)(42,"label",132),e.\u0275\u0275i18n(43,38),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(44,"div",71)(45,"div",72),e.\u0275\u0275element(46,"input",133)(47,"button",128)(48,"cd-copy-2-clipboard-button",129),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(49,wo,2,0,"span",76)(50,Vo,2,0,"span",76),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementStart(51,"div",69)(52,"label",134),e.\u0275\u0275i18n(53,39),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(54,"div",71),e.\u0275\u0275template(55,Ho,5,3,"ng-container",79)(56,ko,2,0,"span",101)(57,Ko,6,5,"div",135),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=n.$implicit,o=n.index;e.\u0275\u0275nextContext(2);const a=e.\u0275\u0275reference(2);e.\u0275\u0275property("formGroup",t),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(": ",t.getValue("client_iqn")," "),e.\u0275\u0275advance(8),e.\u0275\u0275property("ngIf",t.showError("client_iqn",a,"notUnique")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("client_iqn",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("client_iqn",a,"pattern")),e.\u0275\u0275advance(6),e.\u0275\u0275property("id","user"+o),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("user",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("user",a,"pattern")),e.\u0275\u0275advance(6),e.\u0275\u0275property("id","password"+o),e.\u0275\u0275advance(),e.\u0275\u0275property("cdPasswordButton","password"+o),e.\u0275\u0275advance(),e.\u0275\u0275property("source","password"+o),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("password",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("password",a,"pattern")),e.\u0275\u0275advance(6),e.\u0275\u0275property("id","mutual_user"+o),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("mutual_user",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("mutual_user",a,"pattern")),e.\u0275\u0275advance(6),e.\u0275\u0275property("id","mutual_password"+o),e.\u0275\u0275advance(),e.\u0275\u0275property("cdPasswordButton","mutual_password"+o),e.\u0275\u0275advance(),e.\u0275\u0275property("source","mutual_password"+o),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("mutual_password",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.showError("mutual_password",a,"pattern")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",t.getValue("luns")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.getValue("cdIsInGroup")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!t.getValue("cdIsInGroup"))}}function Xo(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",96),e.\u0275\u0275i18n(1,53),e.\u0275\u0275elementEnd())}function Uo(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",69)(1,"label",116),e.\u0275\u0275i18n(2,31),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",117),e.\u0275\u0275template(4,zo,58,24,"div",118),e.\u0275\u0275elementStart(5,"div",80)(6,"div",81),e.\u0275\u0275template(7,Xo,2,0,"span",77),e.\u0275\u0275elementStart(8,"button",119),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).addInitiator(),e.\u0275\u0275resetView(!1)}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(9,"svg",75),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementContainerStart(10),e.\u0275\u0275i18n(11,32),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(12,"hr"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",t.initiators.controls),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",0===t.initiators.controls.length),e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",t.icons.add)("size",t.icons.size16)}}function jo(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",97),e.\u0275\u0275element(2,"input",98),e.\u0275\u0275elementStart(3,"button",99),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).index,s=e.\u0275\u0275nextContext(),_=s.$implicit,c=s.index,p=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(p.removeGroupInitiator(_,a,c))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(4,"svg",75),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=n.$implicit,o=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(2),e.\u0275\u0275property("value",t),e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",o.icons.destroy)("size",o.icons.size16)}}function qo(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",97),e.\u0275\u0275element(2,"input",98),e.\u0275\u0275elementStart(3,"button",99),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).index,s=e.\u0275\u0275nextContext(),_=s.$implicit,c=s.index,p=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(p.removeGroupDisk(_,a,c))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(4,"svg",75),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=n.$implicit,o=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(2),e.\u0275\u0275property("value",t),e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",o.icons.destroy)("size",o.icons.size16)}}function Qo(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",120)(1,"div",67),e.\u0275\u0275elementContainerStart(2),e.\u0275\u0275i18n(3,56),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275text(4),e.\u0275\u0275elementStart(5,"button",121),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).index,s=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(s.removeGroup(a))}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",68)(7,"div",69)(8,"label",138),e.\u0275\u0275i18n(9,57),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"div",71),e.\u0275\u0275element(11,"input",139),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(12,"div",69)(13,"label",140),e.\u0275\u0275elementContainerStart(14),e.\u0275\u0275i18n(15,58),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div",71),e.\u0275\u0275template(17,jo,5,3,"ng-container",79),e.\u0275\u0275elementStart(18,"div",80)(19,"div",81)(20,"cd-select",82),e.\u0275\u0275listener("selection",function(a){const s=e.\u0275\u0275restoreView(t).index,_=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(_.onGroupMemberSelection(a,s))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(21,"svg",75),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementContainerStart(22),e.\u0275\u0275i18n(23,59),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(24,"hr"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(25,"div",69)(26,"label",84),e.\u0275\u0275elementContainerStart(27),e.\u0275\u0275i18n(28,60),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(29,"div",71),e.\u0275\u0275template(30,qo,5,3,"ng-container",79),e.\u0275\u0275elementStart(31,"div",80)(32,"div",81)(33,"cd-select",136),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(34,"svg",75),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementContainerStart(35),e.\u0275\u0275i18n(36,61),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(37,"hr"),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=n.$implicit,o=n.index,a=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("formGroup",t),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(": ",t.getValue("group_id")," "),e.\u0275\u0275advance(13),e.\u0275\u0275property("ngForOf",t.getValue("members")),e.\u0275\u0275advance(3),e.\u0275\u0275property("data",t.getValue("members"))("options",a.groupMembersSelections[o])("messages",a.messages.groupInitiator),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",a.icons.add)("size",a.icons.size16),e.\u0275\u0275advance(9),e.\u0275\u0275property("ngForOf",t.getValue("disks")),e.\u0275\u0275advance(3),e.\u0275\u0275property("data",t.getValue("disks"))("options",a.groupDiskSelections[o])("messages",a.messages.initiatorImage),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",a.icons.add)("size",a.icons.size16)}}function Yo(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",96),e.\u0275\u0275i18n(1,62),e.\u0275\u0275elementEnd())}function Wo(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",69)(1,"label",116),e.\u0275\u0275i18n(2,54),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",137),e.\u0275\u0275template(4,Qo,38,14,"div",118),e.\u0275\u0275elementStart(5,"div",80)(6,"div",81),e.\u0275\u0275template(7,Yo,2,0,"span",77),e.\u0275\u0275elementStart(8,"button",119),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).addGroup(),e.\u0275\u0275resetView(!1)}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(9,"svg",75),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementContainerStart(10),e.\u0275\u0275i18n(11,55),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()()()()()}if(2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",t.groups.controls),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",0===t.groups.controls.length),e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",t.icons.add)("size",t.icons.size16)}}function Jo(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",64)(1,"form",65,0)(3,"div",66)(4,"div",67),e.\u0275\u0275i18n(5,1),e.\u0275\u0275pipe(6,"titlecase"),e.\u0275\u0275pipe(7,"upperFirst"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"div",68)(9,"div",69)(10,"label",70),e.\u0275\u0275i18n(11,2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"div",71)(13,"div",72),e.\u0275\u0275element(14,"input",73),e.\u0275\u0275elementStart(15,"button",74),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.targetSettingsModal())}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(16,"svg",75),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(17,lo,2,0,"span",76)(18,_o,2,0,"span",76)(19,co,9,0,"span",76)(20,mo,2,0,"span",77),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275element(21,"hr"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(22,"div",69)(23,"label",78),e.\u0275\u0275i18n(24,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(25,"div",71),e.\u0275\u0275template(26,po,5,3,"ng-container",79),e.\u0275\u0275elementStart(27,"div",80)(28,"div",81)(29,"cd-select",82),e.\u0275\u0275listener("selection",function(a){e.\u0275\u0275restoreView(t);const s=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(s.onPortalSelection(a))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(30,"svg",75),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementContainerStart(31),e.\u0275\u0275i18n(32,4),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(33,"input",83),e.\u0275\u0275template(34,uo,2,1,"span",76),e.\u0275\u0275element(35,"hr"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(36,"div",69)(37,"label",84),e.\u0275\u0275i18n(38,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(39,"div",71),e.\u0275\u0275template(40,Eo,11,8,"ng-container",79),e.\u0275\u0275element(41,"input",85),e.\u0275\u0275template(42,Co,2,0,"span",76)(43,To,2,0,"span",76),e.\u0275\u0275elementStart(44,"div",80)(45,"div",81)(46,"cd-select",82),e.\u0275\u0275listener("selection",function(a){e.\u0275\u0275restoreView(t);const s=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(s.onImageSelection(a))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(47,"svg",75),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementContainerStart(48),e.\u0275\u0275i18n(49,6),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(50,"hr"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(51,"div",69)(52,"div",86)(53,"div",87),e.\u0275\u0275element(54,"input",88),e.\u0275\u0275elementStart(55,"label",89),e.\u0275\u0275i18n(56,7),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(57,"hr"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(58,Po,39,8,"div",90)(59,Uo,13,4,"div",91)(60,Wo,12,4,"div",91),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(61,"div",92)(62,"cd-form-button-panel",93),e.\u0275\u0275pipe(63,"titlecase"),e.\u0275\u0275pipe(64,"upperFirst"),e.\u0275\u0275listener("submitActionEvent",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.submit())}),e.\u0275\u0275elementEnd()()()()()}if(2&i){const t=e.\u0275\u0275reference(2),o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("formGroup",o.targetForm),e.\u0275\u0275advance(6),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(6,29,o.action))(e.\u0275\u0275pipeBind1(7,31,o.resource)),e.\u0275\u0275i18nApply(5),e.\u0275\u0275advance(9),e.\u0275\u0275property("cdsIcon",o.icons.deepCheck)("size",o.icons.size16),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.targetForm.showError("target_iqn",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.targetForm.showError("target_iqn",t,"pattern")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.targetForm.showError("target_iqn",t,"iqn")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.hasAdvancedSettings(o.targetForm.getValue("target_controls"))),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",o.portals.value),e.\u0275\u0275advance(3),e.\u0275\u0275property("data",o.portals.value)("options",o.portalsSelections)("messages",o.messages.portals),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",o.icons.add)("size",o.icons.size16),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",o.targetForm.showError("portals",t,"minGateways")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",o.targetForm.getValue("disks")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",o.targetForm.showError("disks",t,"dupLunId")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.targetForm.showError("disks",t,"dupWwn")),e.\u0275\u0275advance(3),e.\u0275\u0275property("data",o.disks.value)("options",o.imagesSelections)("messages",o.messages.images),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",o.icons.add)("size",o.icons.size16),e.\u0275\u0275advance(11),e.\u0275\u0275property("ngIf",o.cephIscsiConfigVersion>10&&!o.targetForm.getValue("acl_enabled")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.targetForm.getValue("acl_enabled")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.targetForm.getValue("acl_enabled")),e.\u0275\u0275advance(2),e.\u0275\u0275property("form",o.targetForm)("submitText",e.\u0275\u0275pipeBind1(63,33,o.action)+" "+e.\u0275\u0275pipeBind1(64,35,o.resource))}}class Ke extends Ge.g{constructor(n,t,o,a,s,_,c){super(),this.iscsiService=n,this.modalService=t,this.rbdService=o,this.router=a,this.route=s,this.taskWrapper=_,this.actionLabels=c,this.api_version=0,this.minimum_gateways=1,this.icons=F.FI,this.isEdit=!1,this.portalsSelections=[],this.imagesInitiatorSelections=[],this.groupDiskSelections=[],this.groupMembersSelections=[],this.imagesSettings={},this.messages={portals:new Te.z({noOptions:$localize`There are no portals available.`}),images:new Te.z({noOptions:$localize`There are no images available.`}),initiatorImage:new Te.z({noOptions:$localize`There are no images available. Please make sure you add an image to the target.`}),groupInitiator:new Te.z({noOptions:$localize`There are no initiators available. Please make sure you add an initiator to the target.`})},this.IQN_REGEX=/^iqn\.(19|20)\d\d-(0[1-9]|1[0-2])\.\D{2,3}(\.[A-Za-z0-9-]+)+(:[A-Za-z0-9-\.]+)*$/,this.USER_REGEX=/^[\w\.:@_-]{8,64}$/,this.PASSWORD_REGEX=/^[\w@\-_\/]{12,16}$/,this.resource=$localize`target`}ngOnInit(){const n=new H.n(()=>{});n.pageInfo.limit=-1;const t=[this.iscsiService.listTargets(),this.rbdService.list(n.toParams()),this.iscsiService.portals(),this.iscsiService.settings(),this.iscsiService.version()];this.router.url.startsWith("/block/iscsi/targets/edit")&&(this.isEdit=!0,this.route.params.subscribe(o=>{this.target_iqn=decodeURIComponent(o.target_iqn),t.push(this.iscsiService.getTarget(this.target_iqn))})),this.action=this.isEdit?this.actionLabels.EDIT:this.actionLabels.CREATE,(0,K.forkJoin)(t).subscribe(o=>{const a=S()(o[0]).filter(_=>_.target_iqn!==this.target_iqn).flatMap(_=>_.disks).map(_=>`${_.pool}/${_.image}`).value();"api_version"in o[3]&&(this.api_version=o[3].api_version),this.minimum_gateways=o[3].config.minimum_gateways,this.target_default_controls=o[3].target_default_controls,this.target_controls_limits=o[3].target_controls_limits,this.disk_default_controls=o[3].disk_default_controls,this.disk_controls_limits=o[3].disk_controls_limits,this.backstores=o[3].backstores,this.default_backstore=o[3].default_backstore,this.unsupported_rbd_features=o[3].unsupported_rbd_features,this.required_rbd_features=o[3].required_rbd_features,this.imagesAll=S()(o[1]).flatMap(_=>_.value).filter(_=>{if(_.namespace)return!1;const c=`${_.pool_name}/${_.name}`;return!(-1!==a.indexOf(c)||0===this.getValidBackstores(_).length)}).value(),this.imagesSelections=this.imagesAll.map(_=>new Z.O(!1,`${_.pool_name}/${_.name}`,""));const s=[];o[2].forEach(_=>{_.ip_addresses.forEach(c=>{s.push(new Z.O(!1,_.name+":"+c,""))})}),this.portalsSelections=[...s],this.cephIscsiConfigVersion=o[4].ceph_iscsi_config_version,this.createForm(),o[5]&&this.resolveModel(o[5]),this.loadingReady()})}createForm(){if(this.targetForm=new V.$({target_iqn:new r.UntypedFormControl("iqn.2001-07.com.ceph:"+Date.now(),{validators:[r.Validators.required,r.Validators.pattern(this.IQN_REGEX)]}),target_controls:new r.UntypedFormControl({}),portals:new r.UntypedFormControl([],{validators:[b.xQ.custom("minGateways",n=>S().uniq(n.map(o=>o.split(":")[0])).length<Math.max(1,this.minimum_gateways))]}),disks:new r.UntypedFormControl([],{validators:[b.xQ.custom("dupLunId",n=>{const t=this.getLunIds(n);return t.length!==S().uniq(t).length}),b.xQ.custom("dupWwn",n=>{const t=this.getWwns(n);return t.length!==S().uniq(t).length})]}),initiators:new r.UntypedFormArray([]),groups:new r.UntypedFormArray([]),acl_enabled:new r.UntypedFormControl(!1)}),this.cephIscsiConfigVersion>10){const n=new V.$({user:new r.UntypedFormControl(""),password:new r.UntypedFormControl(""),mutual_user:new r.UntypedFormControl(""),mutual_password:new r.UntypedFormControl("")});this.setAuthValidator(n),this.targetForm.addControl("auth",n)}}resolveModel(n){this.targetForm.patchValue({target_iqn:n.target_iqn,target_controls:n.target_controls,acl_enabled:n.acl_enabled}),this.cephIscsiConfigVersion>10&&this.targetForm.patchValue({auth:n.auth});const t=[];S().forEach(n.portals,a=>{const s=`${a.host}:${a.ip}`;t.push(s)}),this.targetForm.patchValue({portals:t});const o=[];S().forEach(n.disks,a=>{const s=`${a.pool}/${a.image}`;o.push(s),this.imagesSettings[s]={backstore:a.backstore},this.imagesSettings[s][a.backstore]=a.controls,"lun"in a&&(this.imagesSettings[s].lun=a.lun),"wwn"in a&&(this.imagesSettings[s].wwn=a.wwn),this.onImageSelection({option:{name:s,selected:!0}})}),this.targetForm.patchValue({disks:o}),S().forEach(n.clients,a=>{const s=this.addInitiator();a.luns=S().map(a.luns,_=>`${_.pool}/${_.image}`),s.patchValue(a)}),n.groups.forEach((a,s)=>{const _=this.addGroup();a.disks=S().map(a.disks,c=>`${c.pool}/${c.image}`),_.patchValue(a),S().forEach(a.members,c=>{this.onGroupMemberSelection({option:new Z.O(!0,c,"")},s)})})}hasAdvancedSettings(n){return Object.values(n).length>0}get portals(){return this.targetForm.get("portals")}onPortalSelection(){this.portals.setValue(this.portals.value)}removePortal(n,t){return this.portalsSelections.forEach(o=>{o.name===t&&(o.selected=!1)}),this.portals.value.splice(n,1),this.portals.setValue(this.portals.value),!1}get disks(){return this.targetForm.get("disks")}removeImage(n,t){return this.imagesSelections.forEach(o=>{o.name===t&&(o.selected=!1)}),this.disks.value.splice(n,1),this.removeImageRefs(t),this.targetForm.get("disks").updateValueAndValidity({emitEvent:!1}),!1}removeImageRefs(n){this.initiators.controls.forEach(t=>{const o=t.value.luns.filter(a=>a!==n);t.get("luns").setValue(o)}),this.groups.controls.forEach(t=>{const o=t.value.disks.filter(a=>a!==n);t.get("disks").setValue(o)}),S().forEach(this.imagesInitiatorSelections,(t,o)=>{this.imagesInitiatorSelections[o]=t.filter(a=>a.name!==n)}),S().forEach(this.groupDiskSelections,(t,o)=>{this.groupDiskSelections[o]=t.filter(a=>a.name!==n)})}getDefaultBackstore(n){let t=this.default_backstore;const o=this.getImageById(n);return this.validFeatures(o,this.default_backstore)||this.backstores.forEach(a=>{a!==this.default_backstore&&this.validFeatures(o,a)&&(t=a)}),t}isLunIdInUse(n,t){const o=this.disks.value.filter(a=>a!==t);return this.getLunIds(o).includes(n)}getLunIds(n){return S().map(n,t=>this.imagesSettings[t].lun)}nextLunId(n){const t=this.disks.value.filter(s=>s!==n),o=this.getLunIds(t);let a=0;for(;o.includes(a);)a++;return a}getWwns(n){return S().map(n,o=>this.imagesSettings[o].wwn).filter(o=>S().isString(o)&&""!==o)}onImageSelection(n){const t=n.option;if(t.selected){if(this.imagesSettings[t.name])this.isLunIdInUse(this.imagesSettings[t.name].lun,t.name)&&(this.imagesSettings[t.name].lun=this.nextLunId(t.name));else{const o=this.getDefaultBackstore(t.name);this.imagesSettings[t.name]={backstore:o,lun:this.nextLunId(t.name)},this.imagesSettings[t.name][o]={}}S().forEach(this.imagesInitiatorSelections,(o,a)=>{o.push(new Z.O(!1,t.name,"")),this.imagesInitiatorSelections[a]=[...o]}),S().forEach(this.groupDiskSelections,(o,a)=>{o.push(new Z.O(!1,t.name,"")),this.groupDiskSelections[a]=[...o]})}else this.removeImageRefs(t.name);this.targetForm.get("disks").updateValueAndValidity({emitEvent:!1})}get initiators(){return this.targetForm.get("initiators")}addInitiator(){const n=new V.$({client_iqn:new r.UntypedFormControl("",{validators:[r.Validators.required,b.xQ.custom("notUnique",o=>{const a=this.initiators.controls.reduce(function(s,_){return s.concat(_.value.client_iqn)},[]);return a.indexOf(o)!==a.lastIndexOf(o)}),r.Validators.pattern(this.IQN_REGEX)]}),auth:new V.$({user:new r.UntypedFormControl(""),password:new r.UntypedFormControl(""),mutual_user:new r.UntypedFormControl(""),mutual_password:new r.UntypedFormControl("")}),luns:new r.UntypedFormControl([]),cdIsInGroup:new r.UntypedFormControl(!1)});this.setAuthValidator(n),this.initiators.push(n),S().forEach(this.groupMembersSelections,(o,a)=>{o.push(new Z.O(!1,"","")),this.groupMembersSelections[a]=[...o]});const t=S().map(this.targetForm.getValue("disks"),o=>new Z.O(!1,o,""));return this.imagesInitiatorSelections.push(t),n}setAuthValidator(n){b.xQ.validateIf(n.get("user"),()=>n.getValue("password")||n.getValue("mutual_user")||n.getValue("mutual_password"),[r.Validators.required],[r.Validators.pattern(this.USER_REGEX)],[n.get("password"),n.get("mutual_user"),n.get("mutual_password")]),b.xQ.validateIf(n.get("password"),()=>n.getValue("user")||n.getValue("mutual_user")||n.getValue("mutual_password"),[r.Validators.required],[r.Validators.pattern(this.PASSWORD_REGEX)],[n.get("user"),n.get("mutual_user"),n.get("mutual_password")]),b.xQ.validateIf(n.get("mutual_user"),()=>n.getValue("mutual_password"),[r.Validators.required],[r.Validators.pattern(this.USER_REGEX)],[n.get("user"),n.get("password"),n.get("mutual_password")]),b.xQ.validateIf(n.get("mutual_password"),()=>n.getValue("mutual_user"),[r.Validators.required],[r.Validators.pattern(this.PASSWORD_REGEX)],[n.get("user"),n.get("password"),n.get("mutual_user")])}removeInitiator(n){const t=this.initiators.value[n];this.initiators.removeAt(n),S().forEach(this.groupMembersSelections,(o,a)=>{o.splice(n,1),this.groupMembersSelections[a]=[...o]}),this.groups.controls.forEach(o=>{const a=o.value.members.filter(s=>s!==t.client_iqn);o.get("members").setValue(a)}),this.imagesInitiatorSelections.splice(n,1)}updatedInitiatorSelector(){this.initiators.controls.forEach(n=>{n.get("client_iqn").updateValueAndValidity({emitEvent:!1})}),S().forEach(this.groupMembersSelections,(n,t)=>{S().forEach(n,(o,a)=>{const s=o.name;o.name=this.initiators.controls[a].value.client_iqn,this.groups.controls.forEach(_=>{const c=_.value.members,p=c.indexOf(s);-1!==p&&(c[p]=o.name),_.get("members").setValue(c)})}),this.groupMembersSelections[t]=[...this.groupMembersSelections[t]]})}removeInitiatorImage(n,t,o,a){const s=n.getValue("luns");return s.splice(t,1),n.patchValue({luns:s}),this.imagesInitiatorSelections[o].forEach(_=>{_.name===a&&(_.selected=!1)}),!1}get groups(){return this.targetForm.get("groups")}addGroup(){const n=new V.$({group_id:new r.UntypedFormControl("",{validators:[r.Validators.required]}),members:new r.UntypedFormControl([]),disks:new r.UntypedFormControl([])});this.groups.push(n);const t=S().map(this.targetForm.getValue("disks"),a=>new Z.O(!1,a,""));this.groupDiskSelections.push(t);const o=S().map(this.initiators.value,a=>new Z.O(!1,a.client_iqn,"",!a.cdIsInGroup));return this.groupMembersSelections.push(o),n}removeGroup(n){this.groups.removeAt(n),this.groupMembersSelections[n].filter(o=>o.selected).forEach(o=>{o.selected=!1,this.onGroupMemberSelection({option:o},n)}),this.groupMembersSelections.splice(n,1),this.groupDiskSelections.splice(n,1)}onGroupMemberSelection(n,t){const o=n.option;let a=[];o.selected||(a=this.groupDiskSelections[t].filter(_=>_.selected).map(_=>_.name)),this.initiators.controls.forEach((s,_)=>{s.value.client_iqn===o.name&&(s.patchValue({luns:a}),s.get("cdIsInGroup").setValue(o.selected),S().forEach(this.groupMembersSelections,c=>{c[_].enabled=!o.selected}),this.imagesInitiatorSelections[_].forEach(c=>{c.selected=a.includes(c.name)}))})}removeGroupInitiator(n,t,o){const a=n.getValue("members")[t];n.getValue("members").splice(t,1),this.onGroupMemberSelection({option:new Z.O(!1,a,"")},o)}removeGroupDisk(n,t,o){const a=n.getValue("disks")[t];n.getValue("disks").splice(t,1),this.groupDiskSelections[o].forEach(s=>{s.name===a&&(s.selected=!1)}),this.groupDiskSelections[o]=[...this.groupDiskSelections[o]]}submit(){const n=S().cloneDeep(this.targetForm.value),t={target_iqn:this.targetForm.getValue("target_iqn"),target_controls:this.targetForm.getValue("target_controls"),acl_enabled:this.targetForm.getValue("acl_enabled"),portals:[],disks:[],clients:[],groups:[]};if(this.cephIscsiConfigVersion>10){const a=this.targetForm.get("auth");a.getValue("user")||a.get("user").setValue(""),a.getValue("password")||a.get("password").setValue(""),a.getValue("mutual_user")||a.get("mutual_user").setValue(""),a.getValue("mutual_password")||a.get("mutual_password").setValue("");const s=this.targetForm.getValue("acl_enabled");t.auth={user:s?"":a.getValue("user"),password:s?"":a.getValue("password"),mutual_user:s?"":a.getValue("mutual_user"),mutual_password:s?"":a.getValue("mutual_password")}}let o;n.disks.forEach(a=>{const s=a.split("/"),_=this.imagesSettings[a].backstore;t.disks.push({pool:s[0],image:s[1],backstore:_,controls:this.imagesSettings[a][_],lun:this.imagesSettings[a].lun,wwn:this.imagesSettings[a].wwn})}),n.portals.forEach(a=>{const s=a.indexOf(":");t.portals.push({host:a.substring(0,s),ip:a.substring(s+1)})}),t.acl_enabled&&(n.initiators.forEach(a=>{a.auth.user||(a.auth.user=""),a.auth.password||(a.auth.password=""),a.auth.mutual_user||(a.auth.mutual_user=""),a.auth.mutual_password||(a.auth.mutual_password=""),delete a.cdIsInGroup;const s=[];a.luns.forEach(_=>{const c=_.split("/");s.push({pool:c[0],image:c[1]})}),a.luns=s}),t.clients=n.initiators),t.acl_enabled&&(n.groups.forEach(a=>{const s=[];a.disks.forEach(_=>{const c=_.split("/");s.push({pool:c[0],image:c[1]})}),a.disks=s}),t.groups=n.groups),this.isEdit?(t.new_target_iqn=t.target_iqn,t.target_iqn=this.target_iqn,o=this.taskWrapper.wrapTaskAroundCall({task:new E.O("iscsi/target/edit",{target_iqn:t.target_iqn}),call:this.iscsiService.updateTarget(this.target_iqn,t)})):o=this.taskWrapper.wrapTaskAroundCall({task:new E.O("iscsi/target/create",{target_iqn:t.target_iqn}),call:this.iscsiService.createTarget(t)}),o.subscribe({error:()=>{this.targetForm.setErrors({cdSubmitButton:!0})},complete:()=>this.router.navigate(["/block/iscsi/targets"])})}targetSettingsModal(){const n={target_controls:this.targetForm.get("target_controls"),target_default_controls:this.target_default_controls,target_controls_limits:this.target_controls_limits};this.modalRef=this.modalService.show(st,n)}imageSettingsModal(n){const t={imagesSettings:this.imagesSettings,image:n,api_version:this.api_version,disk_default_controls:this.disk_default_controls,disk_controls_limits:this.disk_controls_limits,backstores:this.getValidBackstores(this.getImageById(n)),control:this.targetForm.get("disks")};this.modalRef=this.modalService.show(at,t)}validFeatures(n,t){const o=n.features,a=this.required_rbd_features[t],s=this.unsupported_rbd_features[t];return(o&a)===a&&!(o&s)}getImageById(n){return this.imagesAll.find(t=>n===`${t.pool_name}/${t.name}`)}getValidBackstores(n){return this.backstores.filter(t=>this.validFeatures(n,t))}static{this.\u0275fac=function(t){return new(t||Ke)(e.\u0275\u0275directiveInject(U),e.\u0275\u0275directiveInject(q.B),e.\u0275\u0275directiveInject(z.U),e.\u0275\u0275directiveInject(v.Router),e.\u0275\u0275directiveInject(v.ActivatedRoute),e.\u0275\u0275directiveInject($.a),e.\u0275\u0275directiveInject(M.Ss))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Ke,selectors:[["cd-iscsi-target-form"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:()=>{let n,t,o,a,s,_,c,p,g,T,C,I,D,G,w,ne,oe,ie,k,ge,N,Oe,Re,Ie,Ne,be,Pe,Ae,ve,B,Ze,et,tt,nt,ot,L,Tn,Fn,Mn,hn,On,Rn,In,Nn,bn,Pn,An,vn,Dn,Ln,yn,$n,Bn,Gn,xn,wn,Vn,Hn,kn,Kn,zn,Xn;return n=$localize`:form title␟fb127ea03835b3230f0ed981c7080e2ccb879621␟3346778808274133574:${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd1\ufffd"}:INTERPOLATION_1:`,t=$localize`:␟1406c2fb12a20c1528b19bcc5e24a6a2386167f3␟9099967630066046837:Target IQN`,o=$localize`:␟6990ad8d6182662e864495ac31c3758cda1c7a28␟4093869278527257288:Portals`,a=$localize`:␟6a3ac2b4137d723fd9878cd357c2012ff6c07973␟1710501367407910297:Add portal`,s=$localize`:␟b73f7f5060fb22a1e9ec462b1bb02493fa3ab866␟414887388288176527:Images`,_=$localize`:␟808038f912fdc7f0e03f82d4afd3bf9178527fc8␟8505033464202249845:Add image`,c=$localize`:␟66c5fb27f52e75b70ca4b670b9b15a2a51cf9543␟3201988817758584069:ACL authentication`,p=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,g=$localize`:␟5fe42339be910372fa689f559155631862d218e8␟6634500519731596063:IQN has wrong pattern.`,T=$localize`:␟050a7ff057d1e895357540406b6be5652b4d1c71␟342294605291224846:An IQN has the following notation 'iqn.$year-$month.$reversedAddress:$definedName'`,C=$localize`:␟c8ada4b53396d8366db00a435acc61d53d857047␟1060169226344940725:For example: iqn.2016-06.org.dashboard:storage:disk.sn-a8675309`,I=$localize`:␟e60c11e1b1dfbbeda577364b8de39ded2d796c5e␟4619188387782427495:More information`,D=$localize`:␟9b1aa85dfc6849196e64060db02c5410de69b7a1␟8917673582546787481:This target has modified advanced settings.`,G=$localize`:␟c3638c01b6c34066438909713ec96087c813fc7e␟7970492737765104046:At least ${"\ufffd0\ufffd"}:INTERPOLATION: gateways are required.`,w=$localize`:␟9aff25be088f0efe3eaaf62edf2bff41cc41a617␟1944260501025399900:Backstore: ${"\ufffd0\ufffd"}:INTERPOLATION:. `,ne=$localize`:␟e3484cae8b118c576ca2815bf9c9406c2eb2cae3␟4845735981980836298:This image has modified settings.`,oe=$localize`:␟1dff11e0820b6722ab240169f1232d70a54beaaa␟5090274954293186295:Duplicated LUN numbers.`,ie=$localize`:␟bf2dccf92ccff6e3b091792bf4205595406e1bfb␟4401850496814738651:Duplicated WWN.`,k=$localize`:␟e08a77594f3d89311cdf6da5090044270909c194␟2392488717875840729:User`,ge=$localize`:␟c32ef07f8803a223a83ed17024b38e8d82292407␟1431416938026210429:Password`,N=$localize`:␟ff40391de7a1944ea95091e4045cc34c4979b736␟2070274988518095909:Mutual User`,Oe=$localize`:␟0cf73dbebe99b737c4d288788182fc356e3c93d3␟3904643404211684919:Mutual Password`,Re=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,Ie=$localize`:␟137fbf154ecad4d580354db0858b76faea7e4686␟3803457758347001601:User names must have a length of 8 to 64 characters and can contain alphanumeric characters, '.', '@', '-', '_' or ':'.`,Ne=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,be=$localize`:␟361771c32dd2254d77fd3fbf006b008983fe5907␟3483324600798316784:Passwords must have a length of 12 to 16 characters and can contain alphanumeric characters, '@', '-', '_' or '/'.`,Pe=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,Ae=$localize`:␟137fbf154ecad4d580354db0858b76faea7e4686␟3803457758347001601:User names must have a length of 8 to 64 characters and can contain alphanumeric characters, '.', '@', '-', '_' or ':'.`,ve=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,B=$localize`:␟361771c32dd2254d77fd3fbf006b008983fe5907␟3483324600798316784:Passwords must have a length of 12 to 16 characters and can contain alphanumeric characters, '@', '-', '_' or '/'.`,Ze=$localize`:␟f494bd31f095f6dcc656ce87ec2dcf07a2e9b30c␟1458520862046965337:Initiators`,et=$localize`:␟d565e47726158e428ecdc952fc9233b9b7d7f049␟3791640154834395946:Add initiator`,tt=$localize`:␟e98239d8a6be1100119ff4b5630c822b82786740␟7391040346436232576:Initiator`,nt=$localize`:␟f2c5059d8cda15d8d03e2cce30f2d139623d9a91␟2829168764054066072:Client IQN`,ot=$localize`:␟e08a77594f3d89311cdf6da5090044270909c194␟2392488717875840729:User`,L=$localize`:␟c32ef07f8803a223a83ed17024b38e8d82292407␟1431416938026210429:Password`,Tn=$localize`:␟ff40391de7a1944ea95091e4045cc34c4979b736␟2070274988518095909:Mutual User`,Fn=$localize`:␟0cf73dbebe99b737c4d288788182fc356e3c93d3␟3904643404211684919:Mutual Password`,Mn=$localize`:␟b73f7f5060fb22a1e9ec462b1bb02493fa3ab866␟414887388288176527:Images`,hn=$localize`:␟107d5aabce23d900f0a80e6ddc1c10e29aa0bed8␟701614853586215948:Initiator IQN needs to be unique.`,On=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,Rn=$localize`:␟5fe42339be910372fa689f559155631862d218e8␟6634500519731596063:IQN has wrong pattern.`,In=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,Nn=$localize`:␟7e7cad911fa524e512d9744b16358b7ee6791385␟822668950098303431:User names must have a length of 8 to 64 characters and can contain alphanumeric characters, '.', '@', '-', '_' or ':'.`,bn=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,Pn=$localize`:␟e7f2c186d181206d0d2b1ff74819081a010f10bf␟6729734963576882093:Passwords must have a length of 12 to 16 characters and can contain alphanumeric characters, '@', '-', '_' or '/'.`,An=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,vn=$localize`:␟7e7cad911fa524e512d9744b16358b7ee6791385␟822668950098303431:User names must have a length of 8 to 64 characters and can contain alphanumeric characters, '.', '@', '-', '_' or ':'.`,Dn=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,Ln=$localize`:␟e7f2c186d181206d0d2b1ff74819081a010f10bf␟6729734963576882093:Passwords must have a length of 12 to 16 characters and can contain alphanumeric characters, '@', '-', '_' or '/'.`,yn=$localize`:␟5d1878d5fc761cbe9614bfd87047a740c82a6951␟4540684723296721500:Initiator belongs to a group. Images will be configure in the group.`,$n=$localize`:␟808038f912fdc7f0e03f82d4afd3bf9178527fc8␟8505033464202249845:Add image`,Bn=$localize`:␟c0de67b9d97fafbf200f9451e8388ee8128a56ac␟3993736677319608343:No items added.`,Gn=$localize`:␟c22ba03540aa3217da059f45e7eab138b51a96e2␟5944812089887969249:Groups`,xn=$localize`:␟3084948274cff4f56d0f431af47240e9cf02fcc7␟2765038467790743178:Add group`,wn=$localize`:␟4c90059afafb7e160384d9f512797c95bb95c6dc␟8623978917681527907:Group`,Vn=$localize`:␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,Hn=$localize`:␟f494bd31f095f6dcc656ce87ec2dcf07a2e9b30c␟1458520862046965337:Initiators`,kn=$localize`:␟d565e47726158e428ecdc952fc9233b9b7d7f049␟3791640154834395946:Add initiator`,Kn=$localize`:␟b73f7f5060fb22a1e9ec462b1bb02493fa3ab866␟414887388288176527:Images`,zn=$localize`:␟808038f912fdc7f0e03f82d4afd3bf9178527fc8␟8505033464202249845:Add image`,Xn=$localize`:␟c0de67b9d97fafbf200f9451e8388ee8128a56ac␟3993736677319608343:No items added.`,[["formDir","ngForm"],n,t,o,a,s,_,c,p,g,T,C,I,D,G,w,ne,oe,ie,k,ge,N,Oe,Re,Ie,Ne,be,Pe,Ae,ve,B,Ze,et,tt,nt,ot,L,Tn,Fn,Mn,hn,On,Rn,In,Nn,bn,Pn,An,vn,Dn,Ln,yn,$n,Bn,Gn,xn,wn,Vn,Hn,kn,Kn,zn,Xn,["class","cd-col-form",4,"cdFormLoading"],[1,"cd-col-form"],["name","targetForm","novalidate","",3,"formGroup"],[1,"card"],[1,"card-header"],[1,"card-body"],[1,"form-group","row"],["for","target_iqn",1,"cd-col-form-label","required"],[1,"cd-col-form-input"],[1,"input-group"],["type","text","id","target_iqn","name","target_iqn","formControlName","target_iqn","cdTrim","",1,"form-control"],["id","ecp-info-button","type","button",1,"btn","btn-light",3,"click"],[3,"cdsIcon","size"],["class","invalid-feedback",4,"ngIf"],["class","form-text text-muted",4,"ngIf"],["for","portals",1,"cd-col-form-label","required"],[4,"ngFor","ngForOf"],[1,"row"],[1,"col-md-12"],["elemClass","btn btn-light float-end",3,"selection","data","options","messages"],["type","hidden","id","portals","name","portals","formControlName","portals",1,"form-control"],["for","disks",1,"cd-col-form-label"],["type","hidden","id","disks","name","disks","formControlName","disks",1,"form-control"],[1,"cd-col-form-offset"],[1,"custom-control","custom-checkbox"],["type","checkbox","formControlName","acl_enabled","name","acl_enabled","id","acl_enabled",1,"custom-control-input"],["for","acl_enabled",1,"custom-control-label"],["formGroupName","auth",4,"ngIf"],["class","form-group row",4,"ngIf"],[1,"card-footer"],["wrappingClass","text-right",3,"submitActionEvent","form","submitText"],[1,"invalid-feedback"],["target","_blank","href","https://en.wikipedia.org/wiki/ISCSI#Addressing"],[1,"form-text","text-muted"],[1,"input-group","cd-mb"],["type","text","disabled","",1,"cd-form-control",3,"value"],["type","button",1,"btn","btn-light",3,"click"],["class","input-group-text",4,"ngIf"],[4,"ngIf"],[1,"input-group-text"],["formGroupName","auth"],["for","target_user",1,"cd-col-form-label"],["type","text","autocomplete","off","id","target_user","name","target_user","formControlName","user",1,"form-control"],["for","target_password",1,"cd-col-form-label"],["type","password","autocomplete","new-password","id","target_password","name","target_password","formControlName","password",1,"form-control"],["type","button","cdPasswordButton","target_password",1,"btn","btn-light"],["source","target_password"],["for","target_mutual_user",1,"cd-col-form-label"],["type","text","autocomplete","off","id","target_mutual_user","name","target_mutual_user","formControlName","mutual_user",1,"form-control"],["for","target_mutual_password",1,"cd-col-form-label"],["type","password","autocomplete","new-password","id","target_mutual_password","name","target_mutual_password","formControlName","mutual_password",1,"form-control"],["type","button","cdPasswordButton","target_mutual_password",1,"btn","btn-light"],["source","target_mutual_password"],["for","initiators",1,"cd-col-form-label"],["formArrayName","initiators",1,"cd-col-form-input"],["class","card mb-2",3,"formGroup",4,"ngFor","ngForOf"],[1,"btn","btn-light","float-end",3,"click"],[1,"card","mb-2",3,"formGroup"],["type","button",1,"btn-close","float-end",3,"click"],["for","client_iqn",1,"cd-col-form-label","required"],["type","text","formControlName","client_iqn","cdTrim","",1,"form-control",3,"blur"],["for","user",1,"cd-col-form-label"],["formControlName","user","autocomplete","off","type","text",1,"form-control",3,"id"],["for","password",1,"cd-col-form-label"],["formControlName","password","autocomplete","new-password","type","password",1,"form-control",3,"id"],["type","button",1,"btn","btn-light",3,"cdPasswordButton"],[3,"source"],["for","mutual_user",1,"cd-col-form-label"],["formControlName","mutual_user","autocomplete","off","type","text",1,"form-control",3,"id"],["for","mutual_password",1,"cd-col-form-label"],["formControlName","mutual_password","autocomplete","new-password","type","password",1,"form-control",3,"id"],["for","luns",1,"cd-col-form-label"],["class","row",4,"ngIf"],["elemClass","btn btn-light float-end",3,"data","options","messages"],["formArrayName","groups",1,"cd-col-form-input"],["for","group_id",1,"cd-col-form-label","required"],["type","text","formControlName","group_id",1,"form-control"],["for","members",1,"cd-col-form-label"]]},template:function(t,o){1&t&&e.\u0275\u0275template(0,Jo,65,37,"div",63),2&t&&e.\u0275\u0275property("cdFormLoading",o.loading)},dependencies:[l.NgForOf,l.NgIf,r.\u0275NgNoValidate,r.DefaultValueAccessor,r.CheckboxControlValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.FormGroupDirective,r.FormControlName,r.FormGroupName,r.FormArrayName,so.w,rt.N,A.e,_n.h,ro.c,cn.G,f.S,u.a,h.C,R.E,d.IconDirective,l.TitleCasePipe,it.k,De.r],styles:[".cd-mb[_ngcontent-%COMP%]{margin-bottom:10px}"]})}}var jt=m(25947),re=m(84821),j=m(62847),xe=m(2148),le=m(19380),Zo=m(47782),dn=m(91653),X=m(82254),Se=m(58510),qt=m(88285),ze=m(88701);function ei(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,6),e.\u0275\u0275elementEnd())}function ti(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,7),e.\u0275\u0275elementEnd())}function ni(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd())}function oi(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,9),e.\u0275\u0275elementEnd())}function ii(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,10),e.\u0275\u0275elementEnd())}function ai(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,11),e.\u0275\u0275elementEnd())}function si(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,12),e.\u0275\u0275elementEnd())}function ri(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,13),e.\u0275\u0275elementEnd())}class lt{constructor(n,t,o,a,s){this.authStorageService=n,this.activeModal=t,this.actionLabels=o,this.iscsiService=a,this.notificationService=s,this.USER_REGEX=/^[\w\.:@_-]{8,64}$/,this.PASSWORD_REGEX=/^[\w@\-_\/]{12,16}$/,this.permission=this.authStorageService.getPermissions().iscsi}ngOnInit(){this.hasPermission=this.permission.update,this.createForm(),this.iscsiService.getDiscovery().subscribe(n=>{this.discoveryForm.patchValue(n)})}createForm(){this.discoveryForm=new V.$({user:new r.UntypedFormControl({value:"",disabled:!this.hasPermission}),password:new r.UntypedFormControl({value:"",disabled:!this.hasPermission}),mutual_user:new r.UntypedFormControl({value:"",disabled:!this.hasPermission}),mutual_password:new r.UntypedFormControl({value:"",disabled:!this.hasPermission})}),b.xQ.validateIf(this.discoveryForm.get("user"),()=>this.discoveryForm.getValue("password")||this.discoveryForm.getValue("mutual_user")||this.discoveryForm.getValue("mutual_password"),[r.Validators.required],[r.Validators.pattern(this.USER_REGEX)],[this.discoveryForm.get("password"),this.discoveryForm.get("mutual_user"),this.discoveryForm.get("mutual_password")]),b.xQ.validateIf(this.discoveryForm.get("password"),()=>this.discoveryForm.getValue("user")||this.discoveryForm.getValue("mutual_user")||this.discoveryForm.getValue("mutual_password"),[r.Validators.required],[r.Validators.pattern(this.PASSWORD_REGEX)],[this.discoveryForm.get("user"),this.discoveryForm.get("mutual_user"),this.discoveryForm.get("mutual_password")]),b.xQ.validateIf(this.discoveryForm.get("mutual_user"),()=>this.discoveryForm.getValue("mutual_password"),[r.Validators.required],[r.Validators.pattern(this.USER_REGEX)],[this.discoveryForm.get("user"),this.discoveryForm.get("password"),this.discoveryForm.get("mutual_password")]),b.xQ.validateIf(this.discoveryForm.get("mutual_password"),()=>this.discoveryForm.getValue("mutual_user"),[r.Validators.required],[r.Validators.pattern(this.PASSWORD_REGEX)],[this.discoveryForm.get("user"),this.discoveryForm.get("password"),this.discoveryForm.get("mutual_user")])}submitAction(){this.iscsiService.updateDiscovery(this.discoveryForm.value).subscribe(()=>{this.notificationService.show(qt._.success,$localize`Updated discovery authentication`),this.activeModal.close()},()=>{this.discoveryForm.setErrors({cdSubmitButton:!0})})}static{this.\u0275fac=function(t){return new(t||lt)(e.\u0275\u0275directiveInject(X.v),e.\u0275\u0275directiveInject(P.NgbActiveModal),e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(U),e.\u0275\u0275directiveInject(ze.J))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:lt,selectors:[["cd-iscsi-target-discovery-modal"]],decls:44,vars:13,consts:()=>{let n,t,o,a,s,_,c,p,g,T,C,I,D;return n=$localize`:␟6803e31b7395d94934e091a49a9524026b59b018␟696197579544771576:Discovery Authentication`,t=$localize`:␟e08a77594f3d89311cdf6da5090044270909c194␟2392488717875840729:User`,o=$localize`:␟c32ef07f8803a223a83ed17024b38e8d82292407␟1431416938026210429:Password`,a=$localize`:␟ff40391de7a1944ea95091e4045cc34c4979b736␟2070274988518095909:Mutual User`,s=$localize`:␟0cf73dbebe99b737c4d288788182fc356e3c93d3␟3904643404211684919:Mutual Password`,_=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,c=$localize`:␟f717bad2da5944a2567a52f971ccc6806db85805␟6191728806822774464:User names must have a length of 8 to 64 characters and can contain alphanumeric characters, '.', '@', '-', '_' or ':'.`,p=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,g=$localize`:␟001e1836299d8d3b84eaebe2fa051325beab3f00␟2767784636073464786:Passwords must have a length of 12 to 16 characters and can contain alphanumeric characters, '@', '-', '_' or '/'.`,T=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,C=$localize`:␟f717bad2da5944a2567a52f971ccc6806db85805␟6191728806822774464:User names must have a length of 8 to 64 characters and can contain alphanumeric characters, '.', '@', '-', '_' or ':'.`,I=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,D=$localize`:␟001e1836299d8d3b84eaebe2fa051325beab3f00␟2767784636073464786:Passwords must have a length of 12 to 16 characters and can contain alphanumeric characters, '@', '-', '_' or '/'.`,[["formDir","ngForm"],n,t,o,a,s,_,c,p,g,T,C,I,D,[3,"modalRef"],[1,"modal-title"],[1,"modal-content"],["name","discoveryForm","novalidate","",3,"formGroup"],[1,"modal-body"],[1,"form-group","row"],["for","user",1,"cd-col-form-label"],[1,"cd-col-form-input"],["id","user","formControlName","user","type","text","autocomplete","off",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","password",1,"cd-col-form-label"],[1,"input-group"],["id","password","formControlName","password","type","password","autocomplete","new-password",1,"form-control"],["type","button","cdPasswordButton","password",1,"btn","btn-light"],["source","password"],["for","mutual_user",1,"cd-col-form-label"],["id","mutual_user","formControlName","mutual_user","type","text","autocomplete","off",1,"form-control"],["for","mutual_password",1,"cd-col-form-label"],["id","mutual_password","formControlName","mutual_password","type","password","autocomplete","new-password",1,"form-control"],["type","button","cdPasswordButton","mutual_password",1,"btn","btn-light"],["source","mutual_password"],[1,"modal-footer"],[3,"submitActionEvent","form","showSubmit","submitText"],[1,"invalid-feedback"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-modal",14),e.\u0275\u0275elementContainerStart(1,15),e.\u0275\u0275i18n(2,1),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(3,16),e.\u0275\u0275elementStart(4,"form",17,0)(6,"div",18)(7,"div",19)(8,"label",20),e.\u0275\u0275i18n(9,2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"div",21),e.\u0275\u0275element(11,"input",22),e.\u0275\u0275template(12,ei,2,0,"span",23)(13,ti,2,0,"span",23),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(14,"div",19)(15,"label",24),e.\u0275\u0275i18n(16,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"div",21)(18,"div",25),e.\u0275\u0275element(19,"input",26)(20,"button",27)(21,"cd-copy-2-clipboard-button",28),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(22,ni,2,0,"span",23)(23,oi,2,0,"span",23),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(24,"div",19)(25,"label",29),e.\u0275\u0275elementContainerStart(26),e.\u0275\u0275i18n(27,4),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(28,"div",21),e.\u0275\u0275element(29,"input",30),e.\u0275\u0275template(30,ii,2,0,"span",23)(31,ai,2,0,"span",23),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(32,"div",19)(33,"label",31),e.\u0275\u0275i18n(34,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(35,"div",21)(36,"div",25),e.\u0275\u0275element(37,"input",32)(38,"button",33)(39,"cd-copy-2-clipboard-button",34),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(40,si,2,0,"span",23)(41,ri,2,0,"span",23),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(42,"div",35)(43,"cd-form-button-panel",36),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.submitAction())}),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()}if(2&t){const a=e.\u0275\u0275reference(5);e.\u0275\u0275property("modalRef",o.activeModal),e.\u0275\u0275advance(4),e.\u0275\u0275property("formGroup",o.discoveryForm),e.\u0275\u0275advance(8),e.\u0275\u0275property("ngIf",o.discoveryForm.showError("user",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.discoveryForm.showError("user",a,"pattern")),e.\u0275\u0275advance(9),e.\u0275\u0275property("ngIf",o.discoveryForm.showError("password",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.discoveryForm.showError("password",a,"pattern")),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",o.discoveryForm.showError("mutual_user",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.discoveryForm.showError("mutual_user",a,"pattern")),e.\u0275\u0275advance(9),e.\u0275\u0275property("ngIf",o.discoveryForm.showError("mutual_password",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.discoveryForm.showError("mutual_password",a,"pattern")),e.\u0275\u0275advance(2),e.\u0275\u0275property("form",o.discoveryForm)("showSubmit",o.hasPermission)("submitText",o.actionLabels.SUBMIT)}},dependencies:[l.NgIf,r.\u0275NgNoValidate,r.DefaultValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.FormGroupDirective,r.FormControlName,se.z,rt.N,A.e,_n.h,f.S,u.a,h.C,R.E]})}}var _e=m(94254),we=m(92805),li=m(87837),de=m(32295),Qt=m(45843);class Xe{static{this.\u0275fac=function(t){return new(t||Xe)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Xe,selectors:[["cd-iscsi-tabs"]],decls:7,vars:0,consts:()=>{let n,t;return n=$localize`:␟e95ae009d0bdb45fcc656e8b65248cf7396080d5␟2614607010577950577:Overview`,t=$localize`:␟bbd2045d5c37e4bb39a3c0fb62ea1ddf70a12838␟2603620551566373483:Targets`,[n,t,[1,"nav","nav-tabs"],[1,"nav-item"],["routerLink","/block/iscsi/overview","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link"],["routerLink","/block/iscsi/targets","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link"]]},template:function(t,o){1&t&&(e.\u0275\u0275elementStart(0,"ul",2)(1,"li",3)(2,"a",4),e.\u0275\u0275i18n(3,0),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"li",3)(5,"a",5),e.\u0275\u0275i18n(6,1),e.\u0275\u0275elementEnd()()())},dependencies:[v.RouterLink,v.RouterLinkActive]})}}var _i=m(91822),ci=m(30540);const di=["highlightTpl"],mi=["detailTable"],pi=["treeNodeTemplate"],ui=()=>["logged_in"],gi=()=>["logged_out"],Si=(i,n)=>({"badge-success":i,"badge-danger":n});function fi(i,n){if(1&i&&(e.\u0275\u0275text(0),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(1,"svg",9),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementStart(2,"span"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(4," \xa0 "),e.\u0275\u0275elementStart(5,"span",10),e.\u0275\u0275text(6),e.\u0275\u0275elementEnd()),2&i){const t=n.$implicit,o=e.\u0275\u0275nextContext();e.\u0275\u0275textInterpolate1(" ",null==t||null==t.data?null:t.data.cdIcon," "),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",null==t||null==t.data?null:t.data.cdIcon)("size",o.icons.size16),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(null==t?null:t.name),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction2(8,Si,e.\u0275\u0275pureFunction0(6,ui).includes(null==t?null:t.status),e.\u0275\u0275pureFunction0(7,gi).includes(null==t?null:t.status))),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",null==t?null:t.status," ")}}function Ei(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",11)(1,"legend"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"cd-table",12,3),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.title),e.\u0275\u0275advance(),e.\u0275\u0275property("data",t.data)("columns",t.columns)("limit",0)}}function Ci(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t)}}function Ti(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"strong"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t)}}function Fi(i,n){if(1&i&&e.\u0275\u0275template(0,Ci,2,1,"span",13)(1,Ti,2,1,"strong",13),2&i){const t=n.data.row;e.\u0275\u0275property("ngIf",void 0===t.default||t.default===t.current),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",void 0!==t.default&&t.default!==t.current)}}class _t{set content(n){this.detailTable=n,n&&n.updateColumns()}constructor(n,t,o){this.iscsiBackstorePipe=n,this.booleanTextPipe=t,this.treeViewService=o,this.icons=F.FI,this.metadata={},this.nodes=[]}ngOnInit(){this.columns=[{prop:"displayName",name:$localize`Name`,flexGrow:1,cellTemplate:this.highlightTpl},{prop:"current",name:$localize`Current`,flexGrow:1,cellTemplate:this.highlightTpl},{prop:"default",name:$localize`Default`,flexGrow:1,cellTemplate:this.highlightTpl}]}ngOnChanges(){this.selection&&(this.selectedItem=this.selection,this.generateTree()),this.data=void 0}generateTree(){const n=S().cloneDeep(this.selectedItem.target_controls);this.cephIscsiConfigVersion>10&&S().extend(n,S().cloneDeep(this.selectedItem.auth)),this.metadata={root:n};const t={target:{expanded:S().join(this.selectedItem.cdExecuting?[F.FI.large,F.FI.spinner,F.FI.spin]:[F.FI.large,F.FI.bullseye]," ")},initiators:{expanded:S().join([F.FI.large,F.FI.user]," "),leaf:S().join([F.FI.user]," ")},groups:{expanded:S().join([F.FI.large,F.FI.users]," "),leaf:S().join([F.FI.users]," ")},disks:{expanded:S().join([F.FI.large,F.FI.disk]," "),leaf:S().join([F.FI.disk]," ")},portals:{expanded:S().join([F.FI.large,F.FI.server]," "),leaf:S().join([F.FI.server]," ")}},o=[];S().forEach(this.selectedItem.disks,c=>{const p="disk_"+c.pool+"_"+c.image;this.metadata[p]={controls:c.controls,backstore:c.backstore},["wwn","lun"].forEach(g=>{g in c&&(this.metadata[p][g]=c[g])}),o.push({id:p,name:`${c.pool}/${c.image}`,label:`${c.pool}/${c.image}`,value:{cdIcon:t.disks.leaf}})});const a=[];S().forEach(this.selectedItem.portals,c=>{a.push({label:this.labelTpl,labelContext:{name:`${c.host}:${c.ip}`,cdIcon:t.portals.leaf},value:{name:`${c.host}:${c.ip}`,cdIcon:t.portals.leaf}})});const s=[];S().forEach(this.selectedItem.clients,c=>{const p=S().cloneDeep(c.auth);c.info&&(S().extend(p,c.info),delete p.state,S().forEach(Object.keys(c.info.state),C=>{p[C.toLowerCase()]=c.info.state[C]})),this.metadata["client_"+c.client_iqn]=p;const g=[];c.luns.forEach(C=>{g.push({label:this.labelTpl,labelContext:{name:`${C.pool}/${C.image}`,cdIcon:t.disks.leaf},value:{name:`${C.pool}/${C.image}`,cdIcon:t.disks.leaf},id:"disk_"+C.pool+"_"+C.image})});let T="";c.info&&(T=Object.keys(c.info.state).includes("LOGGED_IN")?"logged_in":"logged_out"),s.push({label:this.labelTpl,labelContext:{name:c.client_iqn,status:T,cdIcon:t.initiators.leaf},value:{name:c.client_iqn,status:T,cdIcon:t.initiators.leaf},id:"client_"+c.client_iqn,children:g})});const _=[];S().forEach(this.selectedItem.groups,c=>{const p=[];c.disks.forEach(T=>{p.push({label:this.labelTpl,labelContext:{name:`${T.pool}/${T.image}`,cdIcon:t.disks.leaf},value:{name:`${T.pool}/${T.image}`,cdIcon:t.disks.leaf},id:"disk_"+T.pool+"_"+T.image})});const g=[];c.members.forEach(T=>{g.push({label:this.labelTpl,labelContext:{name:T},value:{name:T},id:"client_"+T})}),_.push({label:this.labelTpl,labelContext:{name:c.group_id,cdIcon:t.groups.leaf},value:{name:c.group_id,cdIcon:t.groups.leaf},children:[{label:this.labelTpl,labelContext:{name:"Disks",cdIcon:t.disks.expanded},value:{name:"Disks",cdIcon:t.disks.expanded},children:p},{label:this.labelTpl,labelContext:{name:"Initiators",cdIcon:t.initiators.expanded},value:{name:"Initiators",cdIcon:t.initiators.expanded},children:g}]})}),this.nodes=[{id:"root",label:this.labelTpl,labelContext:{name:this.selectedItem.target_iqn,cdIcon:t.target.expanded},value:{name:this.selectedItem.target_iqn,cdIcon:t.target.expanded},expanded:!0,children:[{label:this.labelTpl,labelContext:{name:"Disks",cdIcon:t.disks.expanded},value:{name:"Disks",cdIcon:t.disks.expanded},expanded:!0,children:o},{label:this.labelTpl,labelContext:{name:"Portals",cdIcon:t.portals.expanded},value:{name:"Portals",cdIcon:t.portals.expanded},expanded:!0,children:a},{label:this.labelTpl,labelContext:{name:"Initiators",cdIcon:t.initiators.expanded},value:{name:"Initiators",cdIcon:t.initiators.expanded},expanded:!0,children:s},{label:this.labelTpl,labelContext:{name:"Groups",cdIcon:t.groups.expanded},value:{name:"Groups",cdIcon:t.groups.expanded},expanded:!0,children:_}]}]}format(n){return"boolean"==typeof n?this.booleanTextPipe.transform(n):n}onNodeSelected(n){if(n.id){this.title=n?.value?.name;const t=this.metadata[n.id]||{};"root"===n.id?(this.detailTable?.toggleColumn({prop:"default",isHidden:!0}),this.data=S().map(this.settings.target_default_controls,(o,a)=>({displayName:a,default:o=this.format(o),current:S().isUndefined(t[a])?o:this.format(t[a])})),this.cephIscsiConfigVersion>10&&["user","password","mutual_user","mutual_password"].forEach(o=>{this.data.push({displayName:o,default:null,current:t[o]})})):n.id.toString().startsWith("disk_")?(this.detailTable?.toggleColumn({prop:"default",isHidden:!0}),this.data=S().map(this.settings.disk_default_controls[t.backstore],(o,a)=>({displayName:a,default:o=this.format(o),current:S().isUndefined(t.controls[a])?o:this.format(t.controls[a])})),this.data.push({displayName:"backstore",default:this.iscsiBackstorePipe.transform(this.settings.default_backstore),current:this.iscsiBackstorePipe.transform(t.backstore)}),["wwn","lun"].forEach(o=>{o in t&&this.data.push({displayName:o,default:void 0,current:t[o]})})):(this.detailTable?.toggleColumn({prop:"default",isHidden:!1}),this.data=S().map(t,(o,a)=>({displayName:a,default:void 0,current:this.format(o)})))}else this.data=void 0;this.detailTable?.updateColumns()}static{this.\u0275fac=function(t){return new(t||_t)(e.\u0275\u0275directiveInject(it.k),e.\u0275\u0275directiveInject(_i.s),e.\u0275\u0275directiveInject(ci.X))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:_t,selectors:[["cd-iscsi-target-details"]],viewQuery:function(t,o){if(1&t&&(e.\u0275\u0275viewQuery(di,7),e.\u0275\u0275viewQuery(mi,5),e.\u0275\u0275viewQuery(pi,7)),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.highlightTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.content=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.labelTpl=a.first)}},inputs:{selection:"selection",settings:"settings",cephIscsiConfigVersion:"cephIscsiConfigVersion"},features:[e.\u0275\u0275NgOnChangesFeature],decls:11,vars:2,consts:()=>{let n;return n=$localize`:␟a674ab267d1934bf395f87ca1503fd474296893f␟4234733805678000262:iSCSI Topology`,[["tree",""],["treeNodeTemplate",""],["highlightTpl",""],["detailTable",""],n,[1,"row"],[1,"col-6","card-tree"],[3,"select","tree"],["class","col-6 metadata",4,"ngIf"],[3,"cdsIcon","size"],[1,"badge",3,"ngClass"],[1,"col-6","metadata"],["columnMode","flex",3,"data","columns","limit"],[4,"ngIf"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",5)(1,"div",6)(2,"legend"),e.\u0275\u0275i18n(3,4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"cds-tree-view",7,0),e.\u0275\u0275listener("select",function(_){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onNodeSelected(_))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(6,fi,7,11,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,Ei,5,4,"div",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,Fi,2,2,"ng-template",null,2,e.\u0275\u0275templateRefExtractor)}2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275property("tree",o.nodes),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",o.data))},dependencies:[l.NgClass,l.NgIf,j.O,d.TreeViewComponent,d.IconDirective],styles:[".card-tree[_ngcontent-%COMP%]{height:50vh;overflow-y:auto}"]})}}function Mi(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"br"),e.\u0275\u0275elementStart(2,"span"),e.\u0275\u0275i18n(3,2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"pre"),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(t.status)}}function hi(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"cd-alert-panel",6),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18nStart(2,1),e.\u0275\u0275element(3,"cd-doc",7),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275template(4,Mi,6,1,"ng-container",8),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",t.status)}}function Oi(i,n){if(1&i&&e.\u0275\u0275element(0,"cd-iscsi-target-details",15),2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("cephIscsiConfigVersion",t.cephIscsiConfigVersion)("selection",t.expandedRow)("settings",t.settings)}}function Ri(i,n){1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Oi,1,3,"cd-iscsi-target-details",14),e.\u0275\u0275elementContainerEnd())}function Ii(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-table",9,0),e.\u0275\u0275listener("fetchData",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.getTargets())})("setExpandedRow",function(a){e.\u0275\u0275restoreView(t);const s=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(s.setExpandedRow(a))})("updateSelection",function(a){e.\u0275\u0275restoreView(t);const s=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(s.updateSelection(a))}),e.\u0275\u0275elementStart(2,"div",10),e.\u0275\u0275element(3,"cd-table-actions",11),e.\u0275\u0275elementStart(4,"button",12),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.configureDiscoveryAuth())}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(5,"svg",13),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementContainerStart(6),e.\u0275\u0275i18n(7,3),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(8,Ri,2,0,"ng-container",8),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("data",t.targets)("columns",t.columns)("hasDetails",!0)("autoReload",!1)("status",t.tableStatus),e.\u0275\u0275advance(3),e.\u0275\u0275property("permission",t.permission)("selection",t.selection)("tableActions",t.tableActions),e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",t.icons.key)("size",t.icons.size16),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",t.expandedRow)}}class ct extends jt.D{constructor(n,t,o,a,s,_,c,p,g){super(g),this.authStorageService=n,this.iscsiService=t,this.joinPipe=o,this.taskListService=a,this.notAvailablePipe=s,this.modalService=_,this.taskWrapper=c,this.actionLabels=p,this.ngZone=g,this.available=void 0,this.selection=new le.y,this.targets=[],this.icons=F.FI,this.builders={"iscsi/target/create":T=>({target_iqn:T.target_iqn})},this.permission=this.authStorageService.getPermissions().iscsi,this.tableActions=[{permission:"create",icon:F.FI.add,routerLink:()=>"/block/iscsi/targets/create",name:this.actionLabels.CREATE},{permission:"update",icon:F.FI.edit,routerLink:()=>`/block/iscsi/targets/edit/${this.selection.first().target_iqn}`,name:this.actionLabels.EDIT,disable:()=>this.getEditDisableDesc()},{permission:"delete",icon:F.FI.destroy,click:()=>this.deleteIscsiTargetModal(),name:this.actionLabels.DELETE,disable:()=>this.getDeleteDisableDesc()}]}ngOnInit(){this.columns=[{name:$localize`Target`,prop:"target_iqn",flexGrow:2,cellTransformation:xe.x.executing},{name:$localize`Portals`,prop:"cdPortals",pipe:this.joinPipe,flexGrow:2},{name:$localize`Images`,prop:"cdImages",pipe:this.joinPipe,flexGrow:2},{name:$localize`# Sessions`,prop:"info.num_sessions",pipe:this.notAvailablePipe,flexGrow:1}],this.iscsiService.status().subscribe(n=>{this.available=n.available,n.available||(this.status=n.message)})}getTargets(){this.available&&(this.setTableRefreshTimeout(),this.iscsiService.version().subscribe(n=>{this.cephIscsiConfigVersion=n.ceph_iscsi_config_version}),this.taskListService.init(()=>this.iscsiService.listTargets(),n=>this.prepareResponse(n),n=>this.targets=n,()=>this.onFetchError(),this.taskFilter,this.itemFilter,this.builders),this.iscsiService.settings().subscribe(n=>{this.settings=n}))}ngOnDestroy(){this.summaryDataSubscription&&this.summaryDataSubscription.unsubscribe()}getEditDisableDesc(){const n=this.selection.first();return n&&n?.cdExecuting?n.cdExecuting:n&&S().isUndefined(n?.info)?$localize`Unavailable gateway(s)`:!n}getDeleteDisableDesc(){const n=this.selection.first();return n?.cdExecuting?n.cdExecuting:n&&S().isUndefined(n?.info)?$localize`Unavailable gateway(s)`:n&&n?.info?.num_sessions?$localize`Target has active sessions`:!n}prepareResponse(n){return n.forEach(t=>{t.cdPortals=t.portals.map(o=>`${o.host}:${o.ip}`),t.cdImages=t.disks.map(o=>`${o.pool}/${o.image}`)}),n}onFetchError(){this.table.reset()}itemFilter(n,t){return n.target_iqn===t.metadata.target_iqn}taskFilter(n){return["iscsi/target/create","iscsi/target/edit","iscsi/target/delete"].includes(n.name)}updateSelection(n){this.selection=n}deleteIscsiTargetModal(){const n=this.selection.first().target_iqn;this.modalRef=this.modalService.show(re.D,{itemDescription:$localize`iSCSI target`,itemNames:[n],submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new E.O("iscsi/target/delete",{target_iqn:n}),call:this.iscsiService.deleteTarget(n)})})}configureDiscoveryAuth(){this.modalService.show(lt)}static{this.\u0275fac=function(t){return new(t||ct)(e.\u0275\u0275directiveInject(X.v),e.\u0275\u0275directiveInject(U),e.\u0275\u0275directiveInject(Zo.r),e.\u0275\u0275directiveInject(Se.D),e.\u0275\u0275directiveInject(dn.z),e.\u0275\u0275directiveInject(_e.V),e.\u0275\u0275directiveInject($.a),e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(e.NgZone))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ct,selectors:[["cd-iscsi-target-list"]],viewQuery:function(t,o){if(1&t&&e.\u0275\u0275viewQuery(j.O,5),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.table=a.first)}},features:[e.\u0275\u0275ProvidersFeature([Se.D]),e.\u0275\u0275InheritDefinitionFeature],decls:3,vars:2,consts:()=>{let n,t,o,a;return n=$localize`:␟332227f088a4877b3c11f5fb3ae8bc812c470fae␟406380496911957581:iSCSI Targets not available`,t=$localize`:␟5cf1371d34802d29acee0677feadbda607ae8dc5␟8089153351977663690:Please consult the ${"\ufffd#3\ufffd"}:START_TAG_CD_DOC:${"\ufffd/#3\ufffd"}:CLOSE_TAG_CD_DOC: on how to configure and enable the iSCSI Targets management functionality.`,o=$localize`:␟3b301d0044f62c92af0da53d7aaca52a436a547d␟383572930609025836:Available information:`,a=$localize`:␟8414a5cb9d71cc1b21b10e4a9d1f2dad558f3361␟129814798024179889:Discovery authentication`,[["table",""],t,o,a,["type","info","title",n,4,"ngIf"],["columnMode","flex","identifier","target_iqn","forceIdentifier","true","selectionType","single",3,"data","columns","hasDetails","autoReload","status","fetchData","setExpandedRow","updateSelection",4,"ngIf"],["type","info","title",n],["section","iscsi"],[4,"ngIf"],["columnMode","flex","identifier","target_iqn","forceIdentifier","true","selectionType","single",3,"fetchData","setExpandedRow","updateSelection","data","columns","hasDetails","autoReload","status"],[1,"table-actions"],[1,"btn-group",3,"permission","selection","tableActions"],["type","button",1,"btn","btn-light",3,"click"],[3,"cdsIcon","size"],[3,"cephIscsiConfigVersion","selection","settings",4,"cdTableDetail"],[3,"cephIscsiConfigVersion","selection","settings"]]},template:function(t,o){1&t&&(e.\u0275\u0275element(0,"cd-iscsi-tabs"),e.\u0275\u0275template(1,hi,5,1,"cd-alert-panel",4)(2,Ii,9,11,"cd-table",5)),2&t&&(e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!1===o.available),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!0===o.available))},dependencies:[l.NgIf,we.m,li.C,j.O,de.j,Qt.N,f.S,d.IconDirective,Xe,_t]})}}var Yt=m(18457),Ni=m(5661),bi=m(39113);const Pi=["iscsiSparklineTpl"],Ai=["iscsiPerSecondTpl"],vi=["iscsiRelativeDateTpl"];function Di(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"cd-sparkline",9),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(),o=t.data.row,a=t.data.value;e.\u0275\u0275advance(),e.\u0275\u0275property("data",a)("isBinary",o.cdIsBinary)}}function Li(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",10),e.\u0275\u0275text(1," n/a "),e.\u0275\u0275elementEnd())}function yi(i,n){if(1&i&&e.\u0275\u0275template(0,Di,2,2,"span",7)(1,Li,2,0,"span",8),2&i){const t=n.data.row;e.\u0275\u0275property("ngIf","user:rbd"===t.backstore),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","user:rbd"!==t.backstore)}}function $i(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t," /s ")}}function Bi(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",10),e.\u0275\u0275text(1," n/a "),e.\u0275\u0275elementEnd())}function Gi(i,n){if(1&i&&e.\u0275\u0275template(0,$i,2,1,"span",7)(1,Bi,2,0,"span",8),2&i){const t=n.data.row;e.\u0275\u0275property("ngIf","user:rbd"===t.backstore),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","user:rbd"!==t.backstore)}}function xi(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"relativeDate"),e.\u0275\u0275pipe(3,"notAvailable"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,3,e.\u0275\u0275pipeBind1(2,1,t))," ")}}function wi(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",10),e.\u0275\u0275text(1," n/a "),e.\u0275\u0275elementEnd())}function Vi(i,n){if(1&i&&e.\u0275\u0275template(0,xi,4,5,"span",7)(1,wi,2,0,"span",8),2&i){const t=n.data.row;e.\u0275\u0275property("ngIf","user:rbd"===t.backstore),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","user:rbd"!==t.backstore)}}class dt{constructor(n,t,o){this.iscsiService=n,this.dimlessPipe=t,this.iscsiBackstorePipe=o,this.gateways=[],this.images=[]}ngOnInit(){this.gatewaysColumns=[{name:$localize`Name`,prop:"name"},{name:$localize`State`,prop:"state",flexGrow:1,cellTransformation:xe.x.badge,customTemplateConfig:{map:{up:{class:"badge-success"},down:{class:"badge-danger"}}}},{name:$localize`# Targets`,prop:"num_targets"},{name:$localize`# Sessions`,prop:"num_sessions"}],this.imagesColumns=[{name:$localize`Pool`,prop:"pool"},{name:$localize`Image`,prop:"image"},{name:$localize`Backstore`,prop:"backstore",pipe:this.iscsiBackstorePipe},{name:$localize`Read Bytes`,prop:"stats_history.rd_bytes",cellTemplate:this.iscsiSparklineTpl},{name:$localize`Write Bytes`,prop:"stats_history.wr_bytes",cellTemplate:this.iscsiSparklineTpl},{name:$localize`Read Ops`,prop:"stats.rd",pipe:this.dimlessPipe,cellTemplate:this.iscsiPerSecondTpl},{name:$localize`Write Ops`,prop:"stats.wr",pipe:this.dimlessPipe,cellTemplate:this.iscsiPerSecondTpl},{name:$localize`A/O Since`,prop:"optimized_since",cellTemplate:this.iscsiRelativeDateTpl}]}refresh(){this.iscsiService.overview().subscribe(n=>{this.gateways=n.gateways,this.images=n.images,this.images.map(t=>(t.stats_history&&(t.stats_history.rd_bytes=t.stats_history.rd_bytes.map(o=>o[1]),t.stats_history.wr_bytes=t.stats_history.wr_bytes.map(o=>o[1])),t.cdIsBinary=!0,t))})}static{this.\u0275fac=function(t){return new(t||dt)(e.\u0275\u0275directiveInject(U),e.\u0275\u0275directiveInject(Yt.u),e.\u0275\u0275directiveInject(it.k))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:dt,selectors:[["cd-iscsi"]],viewQuery:function(t,o){if(1&t&&(e.\u0275\u0275viewQuery(Pi,7),e.\u0275\u0275viewQuery(Ai,7),e.\u0275\u0275viewQuery(vi,7)),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.iscsiSparklineTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.iscsiPerSecondTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.iscsiRelativeDateTpl=a.first)}},decls:15,vars:4,consts:()=>{let n,t;return n=$localize`:␟8a9910cd114c1deb9af74f6f99b4173403965bf2␟5130480165747305341:Gateways`,t=$localize`:␟b73f7f5060fb22a1e9ec462b1bb02493fa3ab866␟414887388288176527:Images`,[["iscsiSparklineTpl",""],["iscsiPerSecondTpl",""],["iscsiRelativeDateTpl",""],n,t,[3,"fetchData","data","columns"],[3,"data","columns"],[4,"ngIf"],["class","text-muted",4,"ngIf"],[3,"data","isBinary"],[1,"text-muted"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275element(0,"cd-iscsi-tabs"),e.\u0275\u0275elementStart(1,"legend"),e.\u0275\u0275i18n(2,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div")(4,"cd-table",5),e.\u0275\u0275listener("fetchData",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.refresh())}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"legend"),e.\u0275\u0275i18n(6,4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div"),e.\u0275\u0275element(8,"cd-table",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,yi,2,2,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)(11,Gi,2,2,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)(13,Vi,2,2,"ng-template",null,2,e.\u0275\u0275templateRefExtractor)}2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275property("data",o.gateways)("columns",o.gatewaysColumns),e.\u0275\u0275advance(4),e.\u0275\u0275property("data",o.images)("columns",o.imagesColumns))},dependencies:[l.NgIf,Ni.B,j.O,Xe,bi.D,dn.z]})}}var Hi={elem:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:32,height:32},content:[{elem:"path",attrs:{d:"M2 26H30V28H2zM25.4 9c.8-.8.8-2 0-2.8 0 0 0 0 0 0l-3.6-3.6c-.8-.8-2-.8-2.8 0 0 0 0 0 0 0l-15 15V24h6.4L25.4 9zM20.4 4L24 7.6l-3 3L17.4 7 20.4 4zM6 22v-3.6l10-10 3.6 3.6-10 10H6z"}}],name:"edit",size:32},ki={elem:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:32,height:32},content:[{elem:"path",attrs:{d:"M13 24L4 15 5.414 13.586 13 21.171 26.586 7.586 28 9 13 24z"}}],name:"checkmark",size:32},mn=m(66568),Ki={elem:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:16,height:16},content:[{elem:"path",attrs:{d:"M30 24L26 24 26 20 24 20 24 24 20 24 20 26 24 26 24 30 26 30 26 26 30 26 30 24z"}},{elem:"path",attrs:{d:"M16,28H8V4h8v6a2.0058,2.0058,0,0,0,2,2h6v4h2V10a.9092.9092,0,0,0-.3-.7l-7-7A.9087.9087,0,0,0,18,2H8A2.0058,2.0058,0,0,0,6,4V28a2.0058,2.0058,0,0,0,2,2h8ZM18,4.4,23.6,10H18Z"}}],name:"document--add",size:16},zi={elem:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:16,height:16},content:[{elem:"path",attrs:{d:"M28 19L14.83 19 17.41 16.41 16 15 11 20 16 25 17.41 23.59 14.83 21 28 21 28 19z"}},{elem:"path",attrs:{d:"M24,14V10a1,1,0,0,0-.29-.71l-7-7A1,1,0,0,0,16,2H6A2,2,0,0,0,4,4V28a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V26H22v2H6V4h8v6a2,2,0,0,0,2,2h6v2Zm-8-4V4.41L21.59,10Z"}}],name:"document--import",size:16};class mt{constructor(n){this.iconService=n,this.iconService.registerAll([Hi,ki,mn.A,Ki,zi])}static{this.\u0275fac=function(t){return new(t||mt)(e.\u0275\u0275inject(d.IconService))}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:mt})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[l.CommonModule,J.G,P.NgbNavModule,v.RouterModule,r.FormsModule,r.ReactiveFormsModule,P.NgbProgressbarModule,P.NgbTooltipModule,d.ModalModule,d.InputModule,d.CheckboxModule,d.SelectModule,d.GridModule,d.ButtonModule,d.IconModule]})}}var me=m(6872),Fe=m(50619),Xi=m(35141),Le=m(23603),Me=m(51862);function Ui(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",28),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd())}function ji(i,n){if(1&i&&e.\u0275\u0275template(0,Ui,2,0,"span",21),2&i){const t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.createBootstrapForm.showError("siteName",o,"required"))}}function qi(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"cds-checkbox",29),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&i){const t=n.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275property("id",t.name)("name",t.name)("formControlName",t.name),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t.name," ")}}function Qi(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",28),e.\u0275\u0275i18n(1,9),e.\u0275\u0275elementEnd())}class pt extends d.BaseModal{constructor(n,t,o,a){super(),this.rbdMirroringService=n,this.taskWrapper=t,this.changeDetectorRef=o,this.siteName=a,this.pools=[],this.createForm()}ngAfterViewInit(){this.changeDetectorRef.detectChanges()}createForm(){this.createBootstrapForm=new V.$({siteName:new r.UntypedFormControl("",{validators:[r.Validators.required]}),pools:new r.UntypedFormGroup({},{validators:[this.validatePools()]}),token:new r.UntypedFormControl("",{})})}ngOnInit(){this.createBootstrapForm.get("siteName").setValue(this.siteName),this.rbdMirroringService.getSiteName().subscribe(n=>{this.createBootstrapForm.get("siteName").setValue(n.site_name)}),this.subs=this.rbdMirroringService.subscribeSummary(n=>{const t=n.content_data.pools;this.pools=t.reduce((a,s)=>(a.push({name:s.name,mirror_mode:s.mirror_mode}),a),[]);const o=this.createBootstrapForm.get("pools");S().each(this.pools,a=>{const s=a.name,_="disabled"===a.mirror_mode,c=o.controls[s];c?_&&c.disabled?c.enable():!_&&c.enabled&&(c.disable(),c.setValue(!0)):o.addControl(s,new r.UntypedFormControl({value:!_,disabled:!_}))})})}ngOnDestroy(){this.subs&&this.subs.unsubscribe()}validatePools(){return n=>{let t=0;return S().each(n.controls,o=>{!0===o.value&&++t}),t>0?null:{requirePool:!0}}}generate(){this.createBootstrapForm.get("token").setValue("");let n="";const t=[],o=this.createBootstrapForm.get("pools");S().each(o.controls,(p,g)=>{!0===p.value&&(n=g,p.disabled||t.push(g))});const a={mirror_mode:"image"},s=(0,K.concat)(this.rbdMirroringService.setSiteName(this.createBootstrapForm.getValue("siteName")),(0,K.forkJoin)(t.map(p=>this.rbdMirroringService.updatePool(p,a))),this.rbdMirroringService.createBootstrapToken(n).pipe((0,Fe.tap)(p=>this.createBootstrapForm.get("token").setValue(p.token)))).pipe((0,Fe.last)()),_=()=>{this.rbdMirroringService.refresh(),this.createBootstrapForm.setErrors({cdSubmitButton:!0})};this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/mirroring/bootstrap/create",{}),call:s}).subscribe({error:_,complete:_})}static{this.\u0275fac=function(t){return new(t||pt)(e.\u0275\u0275directiveInject(me.B),e.\u0275\u0275directiveInject($.a),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject("siteName",8))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:pt,selectors:[["cd-bootstrap-create-modal"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:31,vars:11,consts:()=>{let n,t,o,a,s,_,c,p,g,T;return n=$localize`:␟2fecea01ce1d44114ee45144eff6d47a5016a74f␟5451140586403689891:Name...`,t=$localize`:␟ff785f5596aef34a93b9b4d1023e95c62eef5740␟2219690728897166230:Generated token...`,o=$localize`:␟ecbc084370a732fc3cde1966a60af78d71424ab4␟4645993115976933405:Create Bootstrap Token`,a=$localize`:␟3697435b9e13d0a2c965313452270b8a1dc7ef79␟7009247958534636956:To create a bootstrap token which can be imported by a peer site cluster, provide the local site's name, select which pools will have mirroring enabled, and click  ${"\ufffd#10\ufffd"}:START_TAG_KBD:Generate${"\ufffd/#10\ufffd"}:CLOSE_TAG_KBD:.`,s=$localize`:␟6df0ff53e6a314a451b9bda1b195718ebd413981␟6761572531032499616:Site Name ${"\ufffd#14\ufffd\ufffd/#14\ufffd"}:TAG_INPUT:`,_=$localize`:␟92899fa68e8ca108912163ff58edc8540e453787␟8231861638104479971:Pools`,c=$localize`:␟1b258b258b4cc475ceb2871305b61756b0134f4a␟5193539160604294602:Generate`,p=$localize`:␟309ae62fc7f92bf7e7fe2915d70157703f212447␟1646362174796450942:Token ${"\ufffd#28\ufffd"}:START_TAG_TEXTAREA:          ${"\ufffd/#28\ufffd"}:CLOSE_TAG_TEXTAREA:`,g=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,T=$localize`:␟8c2a1dc72cffaf7ab3dc5599bf77b0a7fcad2b20␟7972613560172284866:At least one pool is required.`,[["formDir","ngForm"],["siteNameError",""],o,a,s,_,c,p,g,T,["size","md",3,"overlaySelected","open","hasScrollingContent"],[3,"closeSelect"],["cdsModalHeaderHeading",""],["cdsModalContent",""],["name","createBootstrapForm","novalidate","",1,"form",3,"formGroup"],[1,"form-item"],["for","siteName","cdRequiredField","Site Name",3,"invalid","invalidText"],["cdsText","","placeholder",n,"id","siteName","name","siteName","formControlName","siteName","autofocus","",3,"invalid"],["formGroupName","pools",1,"form-item"],["for","pools",1,"cds--label"],[4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],[3,"submitAction","form"],[1,"form-item","mt-2"],["for","token"],["cdsTextArea","","placeholder",t,"id","token","formControlName","token","cols","200","rows","5","readonly",""],["source","token"],["cancelText","Close",3,"backAction","showSubmit","modalForm"],[1,"invalid-feedback"],[3,"id","name","formControlName"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-modal",10),e.\u0275\u0275listener("overlaySelected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(1,"cds-modal-header",11),e.\u0275\u0275listener("closeSelect",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(2,"h3",12),e.\u0275\u0275i18n(3,2),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"section",13)(5,"form",14,0)(7,"p"),e.\u0275\u0275elementContainerStart(8),e.\u0275\u0275i18nStart(9,3),e.\u0275\u0275element(10,"kbd"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"div",15)(12,"cds-text-label",16),e.\u0275\u0275i18nStart(13,4),e.\u0275\u0275element(14,"input",17),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(15,ji,1,1,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"div",18)(18,"fieldset")(19,"label",19),e.\u0275\u0275i18n(20,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(21,qi,3,4,"ng-container",20),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(22,Qi,2,0,"span",21),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(23,"cd-submit-button",22),e.\u0275\u0275listener("submitAction",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.generate())}),e.\u0275\u0275i18n(24,6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(25,"div",23)(26,"cds-textarea-label",24),e.\u0275\u0275i18nStart(27,7),e.\u0275\u0275element(28,"textarea",25),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(29,"cd-copy-2-clipboard-button",26),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(30,"cd-form-button-panel",27),e.\u0275\u0275listener("backAction",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementEnd()()}if(2&t){const a=e.\u0275\u0275reference(6),s=e.\u0275\u0275reference(16);e.\u0275\u0275property("open",o.open)("hasScrollingContent",!0),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",o.createBootstrapForm),e.\u0275\u0275advance(7),e.\u0275\u0275property("invalid",!o.createBootstrapForm.controls.siteName.valid&&(o.createBootstrapForm.controls.siteName.dirty||o.createBootstrapForm.controls.siteName.touched))("invalidText",s),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",!o.createBootstrapForm.controls.siteName.valid&&(o.createBootstrapForm.controls.siteName.dirty||o.createBootstrapForm.controls.siteName.touched)),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngForOf",o.pools),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.createBootstrapForm.showError("pools",a,"requirePool")),e.\u0275\u0275advance(),e.\u0275\u0275property("form",o.createBootstrapForm),e.\u0275\u0275advance(7),e.\u0275\u0275property("showSubmit",!1)("modalForm",!0)}},dependencies:[l.NgForOf,l.NgIf,Xi._,rt.N,A.e,Le.B,f.S,R.E,Me.P,r.\u0275NgNoValidate,r.DefaultValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.FormGroupDirective,r.FormControlName,r.FormGroupName,d.Modal,d.ModalHeader,d.ModalContent,d.ModalHeaderHeading,d.TextareaLabelComponent,d.TextInputLabelComponent,d.TextInput,d.TextArea,d.Checkbox],styles:[".form-group.ng-invalid[_ngcontent-%COMP%]   .invalid-feedback[_ngcontent-%COMP%]{display:block}"]})}}function Yi(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",29),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd())}function Wi(i,n){if(1&i&&e.\u0275\u0275template(0,Yi,2,0,"span",25),2&i){const t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.importBootstrapForm.showError("siteName",o,"required"))}}function Ji(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"option",30),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=n.$implicit;e.\u0275\u0275property("value",t.key),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t.desc)}}function Zi(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"cds-checkbox",31),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&i){const t=n.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275property("id",t.name)("name",t.name)("formControlName",t.name),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t.name," ")}}function ea(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",29),e.\u0275\u0275i18n(1,9),e.\u0275\u0275elementEnd())}function ta(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",29),e.\u0275\u0275i18n(1,10),e.\u0275\u0275elementEnd())}function na(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",29),e.\u0275\u0275i18n(1,11),e.\u0275\u0275elementEnd())}function oa(i,n){if(1&i&&e.\u0275\u0275template(0,ta,2,0,"span",25)(1,na,2,0,"span",25),2&i){const t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.importBootstrapForm.showError("token",o,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.importBootstrapForm.showError("token",o,"invalidToken"))}}class ut extends d.BaseModal{constructor(n,t,o,a){super(),this.actionLabels=n,this.rbdMirroringService=t,this.taskWrapper=o,this.siteName=a,this.pools=[],this.directions=[{key:"rx-tx",desc:"Bidirectional"},{key:"rx",desc:"Unidirectional (receive-only)"}],this.createForm()}createForm(){this.importBootstrapForm=new V.$({siteName:new r.UntypedFormControl("",{validators:[r.Validators.required]}),direction:new r.UntypedFormControl("rx-tx",{}),pools:new r.UntypedFormGroup({},{validators:[this.validatePools()]}),token:new r.UntypedFormControl("",{validators:[r.Validators.required,this.validateToken()]})})}ngOnInit(){this.rbdMirroringService.getSiteName().subscribe(n=>{this.importBootstrapForm.get("siteName").setValue(n.site_name)}),this.subs=this.rbdMirroringService.subscribeSummary(n=>{const t=n.content_data.pools;this.pools=t.reduce((a,s)=>(a.push({name:s.name,mirror_mode:s.mirror_mode}),a),[]);const o=this.importBootstrapForm.get("pools");S().each(this.pools,a=>{const s=a.name,_="disabled"===a.mirror_mode,c=o.controls[s];c?_&&c.disabled?c.enable():!_&&c.enabled&&(c.disable(),c.setValue(!0)):o.addControl(s,new r.UntypedFormControl({value:!_,disabled:!_}))})})}ngOnDestroy(){this.subs&&this.subs.unsubscribe()}validatePools(){return n=>{let t=0;return S().each(n.controls,o=>{!0===o.value&&++t}),t>0?null:{requirePool:!0}}}validateToken(){return n=>{try{if(JSON.parse(atob(n.value)))return null}catch{}return{invalidToken:!0}}}import(){const n=[],t=[],o=this.importBootstrapForm.get("pools");S().each(o.controls,(p,g)=>{!0===p.value&&(n.push(g),p.disabled||t.push(g))});const a={mirror_mode:"image"};let s=(0,K.concat)(this.rbdMirroringService.setSiteName(this.importBootstrapForm.getValue("siteName")),(0,K.forkJoin)(t.map(p=>this.rbdMirroringService.updatePool(p,a))));s=n.reduce((p,g)=>(0,K.concat)(p,this.rbdMirroringService.importBootstrapToken(g,this.importBootstrapForm.getValue("direction"),this.importBootstrapForm.getValue("token"))),s).pipe((0,Fe.last)());const _=()=>{this.rbdMirroringService.refresh(),this.importBootstrapForm.setErrors({cdSubmitButton:!0})};this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/mirroring/bootstrap/import",{}),call:s}).subscribe({error:_,complete:()=>{_(),this.closeModal()}})}static{this.\u0275fac=function(t){return new(t||ut)(e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(me.B),e.\u0275\u0275directiveInject($.a),e.\u0275\u0275directiveInject("siteName",8))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ut,selectors:[["cd-bootstrap-import-modal"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:33,vars:14,consts:()=>{let n,t,o,a,s,_,c,p,g,T,C;return n=$localize`:␟2fecea01ce1d44114ee45144eff6d47a5016a74f␟5451140586403689891:Name...`,t=$localize`:␟ff785f5596aef34a93b9b4d1023e95c62eef5740␟2219690728897166230:Generated token...`,o=$localize`:␟5467a6bb0e7fade6def7499400d5e2a7d8d3da20␟4130053543590533787:Import Bootstrap Token`,a=$localize`:␟7c9fad635c7ee80f6e4de5828c95c7f198d9151e␟7223058862730022209:To import a bootstrap token which was created by a peer site cluster, provide the local site's name, select which pools will have mirroring enabled, provide the generated token, and click ${"\ufffd#10\ufffd"}:START_TAG_KBD:Import${"\ufffd/#10\ufffd"}:CLOSE_TAG_KBD:.`,s=$localize`:␟6df0ff53e6a314a451b9bda1b195718ebd413981␟6761572531032499616:Site Name ${"\ufffd#14\ufffd\ufffd/#14\ufffd"}:TAG_INPUT:`,_=$localize`:␟92899fa68e8ca108912163ff58edc8540e453787␟8231861638104479971:Pools`,c=$localize`:␟309ae62fc7f92bf7e7fe2915d70157703f212447␟1646362174796450942:Token ${"\ufffd#29\ufffd"}:START_TAG_TEXTAREA:          ${"\ufffd/#29\ufffd"}:CLOSE_TAG_TEXTAREA:`,p=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,g=$localize`:␟8c2a1dc72cffaf7ab3dc5599bf77b0a7fcad2b20␟7972613560172284866:At least one pool is required.`,T=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,C=$localize`:␟9761484679958da8d12841a4efa5964d33fae575␟2384592179404220850:The token is invalid.`,[["formDir","ngForm"],["siteNameError",""],["tokenError",""],o,a,s,_,c,p,g,T,C,["size","md",3,"overlaySelected","open"],[3,"closeSelect"],["cdsModalHeaderHeading",""],["cdsModalContent",""],["name","importBootstrapForm","novalidate","",1,"form",3,"formGroup"],[1,"form-item"],["for","siteName","cdRequiredField","Site Name",3,"invalid","invalidText"],["cdsText","","placeholder",n,"id","siteName","name","siteName","formControlName","siteName","autofocus","",3,"invalid"],["label","Direction","for","direction","name","direction","id","direction","formControlName","direction"],[3,"value",4,"ngFor","ngForOf"],["formGroupName","pools",1,"form-item"],["for","pools",1,"cds--label"],[4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],["for","token","cdRequiredField","Token",3,"invalid","invalidText"],["cdsTextArea","","placeholder",t,"id","token","formControlName","token","cols","200","rows","5",3,"invalid"],[3,"submitActionEvent","form","submitText","modalForm"],[1,"invalid-feedback"],[3,"value"],[3,"id","name","formControlName"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-modal",12),e.\u0275\u0275listener("overlaySelected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(1,"cds-modal-header",13),e.\u0275\u0275listener("closeSelect",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(2,"h3",14),e.\u0275\u0275i18n(3,3),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"section",15)(5,"form",16,0)(7,"p"),e.\u0275\u0275elementContainerStart(8),e.\u0275\u0275i18nStart(9,4),e.\u0275\u0275element(10,"kbd"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"div",17)(12,"cds-text-label",18),e.\u0275\u0275i18nStart(13,5),e.\u0275\u0275element(14,"input",19),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(15,Wi,1,1,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"div",17)(18,"cds-select",20),e.\u0275\u0275template(19,Ji,2,2,"option",21),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(20,"div",22)(21,"fieldset")(22,"label",23),e.\u0275\u0275i18n(23,6),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(24,Zi,3,4,"ng-container",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(25,ea,2,0,"span",25),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(26,"div",17)(27,"cds-textarea-label",26),e.\u0275\u0275i18nStart(28,7),e.\u0275\u0275element(29,"textarea",27),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(30,oa,2,2,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(32,"cd-form-button-panel",28),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.import())}),e.\u0275\u0275elementEnd()()}if(2&t){const a=e.\u0275\u0275reference(6),s=e.\u0275\u0275reference(16),_=e.\u0275\u0275reference(31);e.\u0275\u0275property("open",o.open),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",o.importBootstrapForm),e.\u0275\u0275advance(7),e.\u0275\u0275property("invalid",!o.importBootstrapForm.controls.siteName.valid&&o.importBootstrapForm.controls.siteName.dirty)("invalidText",s),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",!o.importBootstrapForm.controls.siteName.valid&&o.importBootstrapForm.controls.siteName.dirty),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",o.directions),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",o.pools),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.importBootstrapForm.showError("pools",a,"requirePool")),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.importBootstrapForm.controls.token.invalid&&o.importBootstrapForm.controls.token.dirty)("invalidText",_),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.importBootstrapForm.controls.token.invalid&&o.importBootstrapForm.controls.token.dirty),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.importBootstrapForm)("submitText",o.actionLabels.SUBMIT)("modalForm",!0)}},dependencies:[l.NgForOf,l.NgIf,A.e,Le.B,f.S,R.E,Me.P,r.\u0275NgNoValidate,r.NgSelectOption,r.\u0275NgSelectMultipleOption,r.DefaultValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.FormGroupDirective,r.FormControlName,r.FormGroupName,d.Modal,d.ModalHeader,d.ModalContent,d.ModalHeaderHeading,d.TextareaLabelComponent,d.TextInputLabelComponent,d.TextInput,d.TextArea,d.Checkbox,d.Select,d.Option]})}}var pe=m(2243),ia=m(16748);class Ve{transform(n){return"warning"===n?"badge badge-warning":"error"===n?"badge badge-danger":"success"===n?"badge badge-success":"badge badge-info"}static{this.\u0275fac=function(t){return new(t||Ve)}}static{this.\u0275pipe=e.\u0275\u0275definePipe({name:"mirrorHealthColor",type:Ve,pure:!0})}}const aa=["healthTmpl"];function sa(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span",2),e.\u0275\u0275pipe(1,"mirrorHealthColor"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()),2&i){const t=n.data.row,o=n.data.value;e.\u0275\u0275property("ngClass",e.\u0275\u0275pipeBind1(1,2,t.health_color)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(o)}}class gt{constructor(n,t){this.rbdMirroringService=n,this.cephShortVersionPipe=t,this.tableStatus=new pe.m}ngOnInit(){this.columns=[{prop:"instance_id",name:$localize`Instance`,flexGrow:2},{prop:"id",name:$localize`ID`,flexGrow:2},{prop:"server_hostname",name:$localize`Hostname`,flexGrow:2},{prop:"version",name:$localize`Version`,pipe:this.cephShortVersionPipe,flexGrow:2},{prop:"health",name:$localize`Health`,cellTemplate:this.healthTmpl,flexGrow:1}],this.subs=this.rbdMirroringService.subscribeSummary(n=>{this.data=n.content_data.daemons,this.tableStatus=new pe.m(n.status)})}ngOnDestroy(){this.subs.unsubscribe()}refresh(){this.rbdMirroringService.refresh()}static{this.\u0275fac=function(t){return new(t||gt)(e.\u0275\u0275directiveInject(me.B),e.\u0275\u0275directiveInject(ia.Z))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:gt,selectors:[["cd-mirroring-daemons"]],viewQuery:function(t,o){if(1&t&&e.\u0275\u0275viewQuery(aa,7),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.healthTmpl=a.first)}},decls:3,vars:4,consts:[["healthTmpl",""],["columnMode","flex",3,"fetchData","data","columns","autoReload","status"],[3,"ngClass"]],template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-table",1),e.\u0275\u0275listener("fetchData",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.refresh())}),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(1,sa,3,4,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)}2&t&&e.\u0275\u0275property("data",o.data)("columns",o.columns)("autoReload",-1)("status",o.tableStatus)},dependencies:[l.NgClass,j.O,Ve]})}}var Wt=m(62988);const ra=["stateTmpl"],la=["syncTmpl"],_a=["progressTmpl"],ca=["entriesBehindPrimaryTpl"];function da(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-table",14),e.\u0275\u0275listener("fetchData",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.refresh())}),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("data",t.image_error.data)("columns",t.image_error.columns)("autoReload",-1)("status",t.tableStatus)}}function ma(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-table",14),e.\u0275\u0275listener("fetchData",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.refresh())}),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("data",t.image_syncing.data)("columns",t.image_syncing.columns)("autoReload",-1)("status",t.tableStatus)}}function pa(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-table",14),e.\u0275\u0275listener("fetchData",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.refresh())}),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("data",t.image_ready.data)("columns",t.image_ready.columns)("autoReload",-1)("status",t.tableStatus)}}function ua(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span",15),e.\u0275\u0275pipe(1,"mirrorHealthColor"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()),2&i){const t=n.data.row,o=n.data.value;e.\u0275\u0275property("ngClass",e.\u0275\u0275pipeBind1(1,2,t.state_color)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(o)}}function ga(i,n){1&i&&e.\u0275\u0275element(0,"div")}function Sa(i,n){if(1&i&&e.\u0275\u0275element(0,"ngb-progressbar",19),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275property("value",t)("showValue",!0)}}function fa(i,n){if(1&i&&(e.\u0275\u0275template(0,ga,1,0,"div",16),e.\u0275\u0275elementStart(1,"div",17),e.\u0275\u0275template(2,Sa,1,2,"ngb-progressbar",18),e.\u0275\u0275elementEnd()),2&i){const t=n.data.row;e.\u0275\u0275property("ngIf","Replaying"===t.state),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf","Replaying"===t.state)}}function Ea(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t," ")}}function Ca(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",21),e.\u0275\u0275text(1,"-"),e.\u0275\u0275elementEnd())}function Ta(i,n){if(1&i&&e.\u0275\u0275template(0,Ea,2,1,"span",16)(1,Ca,2,0,"span",20),2&i){const t=n.data.row;e.\u0275\u0275property("ngIf","journal"===t.mirror_mode),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","snapshot"===t.mirror_mode)}}class St{constructor(n){this.rbdMirroringService=n,this.image_error={data:[],columns:{}},this.image_syncing={data:[],columns:{}},this.image_ready={data:[],columns:{}},this.tableStatus=new pe.m}ngOnInit(){this.image_error.columns=[{prop:"pool_name",name:$localize`Pool`,flexGrow:2},{prop:"name",name:$localize`Image`,flexGrow:2},{prop:"state",name:$localize`State`,cellTemplate:this.stateTmpl,flexGrow:1},{prop:"description",name:$localize`Issue`,flexGrow:4}],this.image_syncing.columns=[{prop:"pool_name",name:$localize`Pool`,flexGrow:2},{prop:"name",name:$localize`Image`,flexGrow:2},{prop:"state",name:$localize`State`,cellTemplate:this.stateTmpl,flexGrow:1},{prop:"syncing_percent",name:$localize`Progress`,cellTemplate:this.progressTmpl,flexGrow:2},{prop:"bytes_per_second",name:$localize`Bytes per second`,flexGrow:2},{prop:"entries_behind_primary",name:$localize`Entries behind primary`,cellTemplate:this.entriesBehindPrimaryTpl,flexGrow:2}],this.image_ready.columns=[{prop:"pool_name",name:$localize`Pool`,flexGrow:2},{prop:"name",name:$localize`Image`,flexGrow:2},{prop:"state",name:$localize`State`,cellTemplate:this.stateTmpl,flexGrow:1},{prop:"description",name:$localize`Description`,flexGrow:4}],this.subs=this.rbdMirroringService.subscribeSummary(n=>{this.image_error.data=n.content_data.image_error,this.image_syncing.data=n.content_data.image_syncing,this.image_ready.data=n.content_data.image_ready,this.tableStatus=new pe.m(n.status)})}ngOnDestroy(){this.subs.unsubscribe()}refresh(){this.rbdMirroringService.refresh()}static{this.\u0275fac=function(t){return new(t||St)(e.\u0275\u0275directiveInject(me.B))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:St,selectors:[["cd-mirroring-images"]],viewQuery:function(t,o){if(1&t&&(e.\u0275\u0275viewQuery(ra,7),e.\u0275\u0275viewQuery(la,7),e.\u0275\u0275viewQuery(_a,7),e.\u0275\u0275viewQuery(ca,7)),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.stateTmpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.syncTmpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.progressTmpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.entriesBehindPrimaryTpl=a.first)}},decls:21,vars:4,consts:()=>{let n,t,o;return n=$localize`:␟5fff1ed5231ffc496de3559de0f9dda453a77ff3␟5286124415242572625:Issues (${"\ufffd0\ufffd"}:INTERPOLATION:)`,t=$localize`:␟63798fe08b82a44c54ecbd1b247aa788616d5da0␟7278007401355007972:Syncing (${"\ufffd0\ufffd"}:INTERPOLATION:)`,o=$localize`:␟df2c799e97eec4849a24598fac0de4673b9af849␟3872275816315562585:Ready (${"\ufffd0\ufffd"}:INTERPOLATION:)`,[["nav","ngbNav"],["stateTmpl",""],["progressTmpl",""],["entriesBehindPrimaryTpl",""],n,t,o,["ngbNav","","cdStatefulTab","image-list",1,"nav-tabs"],["ngbNavItem","issues"],["ngbNavLink",""],["ngbNavContent",""],["ngbNavItem","syncing"],["ngbNavItem","ready"],[3,"ngbNavOutlet"],["columnMode","flex",3,"fetchData","data","columns","autoReload","status"],[3,"ngClass"],[4,"ngIf"],[1,"w-100","h-100","d-flex","justify-content-center","align-items-center"],["type","info","class","w-100",3,"value","showValue",4,"ngIf"],["type","info",1,"w-100",3,"value","showValue"],["ngbTooltip","Not available with mirroring snapshot mode",4,"ngIf"],["ngbTooltip","Not available with mirroring snapshot mode"]]},template:function(t,o){if(1&t&&(e.\u0275\u0275elementStart(0,"nav",7,0),e.\u0275\u0275elementContainerStart(2,8),e.\u0275\u0275elementStart(3,"a",9),e.\u0275\u0275i18n(4,4),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,da,1,4,"ng-template",10),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(6,11),e.\u0275\u0275elementStart(7,"a",9),e.\u0275\u0275i18n(8,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,ma,1,4,"ng-template",10),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(10,12),e.\u0275\u0275elementStart(11,"a",9),e.\u0275\u0275i18n(12,6),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(13,pa,1,4,"ng-template",10),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(14,"div",13),e.\u0275\u0275template(15,ua,3,4,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)(17,fa,3,2,"ng-template",null,2,e.\u0275\u0275templateRefExtractor)(19,Ta,2,2,"ng-template",null,3,e.\u0275\u0275templateRefExtractor)),2&t){const a=e.\u0275\u0275reference(1);e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(o.image_error.data.length),e.\u0275\u0275i18nApply(4),e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(o.image_syncing.data.length),e.\u0275\u0275i18nApply(8),e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(o.image_ready.data.length),e.\u0275\u0275i18nApply(12),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngbNavOutlet",a)}},dependencies:[l.NgClass,l.NgIf,j.O,Wt.B,P.NgbNavContent,P.NgbNav,P.NgbNavItem,P.NgbNavLink,P.NgbNavLinkBase,P.NgbNavOutlet,P.NgbProgressbar,P.NgbTooltip,Ve]})}}class Fa{}function Ma(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",33),e.\u0275\u0275i18n(1,11),e.\u0275\u0275elementEnd())}function ha(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",33),e.\u0275\u0275i18n(1,12),e.\u0275\u0275elementEnd())}function Oa(i,n){if(1&i&&e.\u0275\u0275template(0,Ma,2,0,"span",32)(1,ha,2,0,"span",32),2&i){const t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.editPeerForm.showError("clusterName",o,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.editPeerForm.showError("clusterName",o,"invalidClusterName"))}}function Ra(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",33),e.\u0275\u0275i18n(1,13),e.\u0275\u0275elementEnd())}function Ia(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",33),e.\u0275\u0275i18n(1,14),e.\u0275\u0275elementEnd())}function Na(i,n){if(1&i&&e.\u0275\u0275template(0,Ra,2,0,"span",32)(1,Ia,2,0,"span",32),2&i){const t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.editPeerForm.showError("clientID",o,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.editPeerForm.showError("clientID",o,"invalidClientID"))}}function ba(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",33),e.\u0275\u0275i18n(1,15),e.\u0275\u0275elementEnd())}function Pa(i,n){if(1&i&&e.\u0275\u0275template(0,ba,2,0,"span",32),2&i){const t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.editPeerForm.showError("monAddr",o,"invalidMonAddr"))}}function Aa(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",33),e.\u0275\u0275i18n(1,16),e.\u0275\u0275elementEnd())}function va(i,n){if(1&i&&e.\u0275\u0275template(0,Aa,2,0,"span",32),2&i){const t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.editPeerForm.showError("key",o,"invalidKey"))}}class ft extends d.BaseModal{constructor(n,t,o,a,s="",_=""){super(),this.actionLabels=n,this.rbdMirroringService=t,this.taskWrapper=o,this.poolName=a,this.peerUUID=s,this.mode=_,this.bsConfig={containerClass:"theme-default"},this.createForm()}createForm(){this.editPeerForm=new V.$({clusterName:new r.UntypedFormControl("",{validators:[r.Validators.required,this.validateClusterName]}),clientID:new r.UntypedFormControl("",{validators:[r.Validators.required,this.validateClientID]}),monAddr:new r.UntypedFormControl("",{validators:[this.validateMonAddr]}),key:new r.UntypedFormControl("",{validators:[this.validateKey]})})}ngOnInit(){this.pattern=`${this.poolName}/${this.peerUUID}`,"edit"===this.mode&&this.rbdMirroringService.getPeer(this.poolName,this.peerUUID).subscribe(n=>{this.setResponse(n)})}validateClusterName(n){if(!n.value.match(/^[\w\-_]*$/))return{invalidClusterName:{value:n.value}}}validateClientID(n){if(!n.value.match(/^(?!client\.)[\w\-_.]*$/))return{invalidClientID:{value:n.value}}}validateMonAddr(n){if(!n.value.match(/^[,; ]*([\w.\-_\[\]]+(:[\d]+)?[,; ]*)*$/))return{invalidMonAddr:{value:n.value}}}validateKey(n){try{if(""===n.value||atob(n.value))return null}catch{}return{invalidKey:{value:n.value}}}setResponse(n){this.response=n,this.editPeerForm.get("clusterName").setValue(n.cluster_name),this.editPeerForm.get("clientID").setValue(n.client_id),this.editPeerForm.get("monAddr").setValue(n.mon_host),this.editPeerForm.get("key").setValue(n.key)}update(){const n=new Fa;let t;n.cluster_name=this.editPeerForm.getValue("clusterName"),n.client_id=this.editPeerForm.getValue("clientID"),n.mon_host=this.editPeerForm.getValue("monAddr"),n.key=this.editPeerForm.getValue("key"),t="edit"===this.mode?this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/mirroring/peer/edit",{pool_name:this.poolName}),call:this.rbdMirroringService.updatePeer(this.poolName,this.peerUUID,n)}):this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/mirroring/peer/add",{pool_name:this.poolName}),call:this.rbdMirroringService.addPeer(this.poolName,n)}),t.subscribe({error:()=>this.editPeerForm.setErrors({cdSubmitButton:!0}),complete:()=>{this.rbdMirroringService.refresh(),this.closeModal()}})}static{this.\u0275fac=function(t){return new(t||ft)(e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(me.B),e.\u0275\u0275directiveInject($.a),e.\u0275\u0275directiveInject("poolName"),e.\u0275\u0275directiveInject("peerUUID",8),e.\u0275\u0275directiveInject("mode",8))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ft,selectors:[["cd-pool-edit-peer-modal"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:37,vars:21,consts:()=>{let n,t,o,a,s,_,c,p,g,T,C,I,D,G,w,ne,oe,ie;return n=$localize`:␟2fecea01ce1d44114ee45144eff6d47a5016a74f␟5451140586403689891:Name...`,t=$localize`:␟7539188a568c3d553cbde1bacaf32310c4264e24␟2229794677672311753:CephX ID...`,o=$localize`:␟fa28eeed2b4bd4ccbe6e9349a1c2b3cb1c5de70a␟7458522866753335106:Comma-delimited addresses...`,a=$localize`:␟f53434bcb95bd86f1df9c8e22966f757614fc4ad␟5337220475614495124:Base64-encoded key...`,s=$localize`:␟4ddcb416c1c0aa1f54acf5beef1de81813e76fa6␟5057118102059517518:{VAR_SELECT, select, edit {Edit} other {Add}}`,s=e.\u0275\u0275i18nPostprocess(s,{VAR_SELECT:"\ufffd0\ufffd"}),_=$localize`:␟6ca18c994967298f844d73fae69b9d4469a2c7a2␟1870873375689662645: ${s}:ICU: pool mirror peer `,c=$localize`:␟4ddcb416c1c0aa1f54acf5beef1de81813e76fa6␟5057118102059517518:{VAR_SELECT, select, edit {Edit} other {Add}}`,c=e.\u0275\u0275i18nPostprocess(c,{VAR_SELECT:"\ufffd0\ufffd"}),p=$localize`:␟0ae8339a5fee5ecec931a3d2d564308cebf61f26␟7260236545107835892:${c}:ICU: the pool mirror peer attributes for pool ${"[\ufffd#10\ufffd|\ufffd#11\ufffd]"}:START_TAG_KBD:${"\ufffd1\ufffd"}:INTERPOLATION:${"[\ufffd/#10\ufffd|\ufffd/#11\ufffd]"}:CLOSE_TAG_KBD: and click ${"[\ufffd#10\ufffd|\ufffd#11\ufffd]"}:START_TAG_KBD:Submit${"[\ufffd/#10\ufffd|\ufffd/#11\ufffd]"}:CLOSE_TAG_KBD:.`,p=e.\u0275\u0275i18nPostprocess(p),g=$localize`:␟7ad8b11fa374b19bc974f8045658e3dfc137176a␟6846620205646165880:Cluster Name ${"\ufffd#15\ufffd\ufffd/#15\ufffd"}:TAG_INPUT:`,T=$localize`:␟2e4824c5e5fd986b7dd8a9c203111d24183956c9␟6276997521300906972:CephX ID ${"\ufffd#21\ufffd\ufffd/#21\ufffd"}:TAG_INPUT:`,C=$localize`:␟cb6c6e3012cfccac38f9e8e0cd19439fef9e237d␟3066034092300162577:Monitor Addresses ${"\ufffd#27\ufffd\ufffd/#27\ufffd"}:TAG_INPUT:`,I=$localize`:␟338429615ba1b689dfddfa8f28c6985256298899␟5976436956938618016:CephX Key ${"\ufffd#33\ufffd\ufffd/#33\ufffd"}:TAG_INPUT:`,D=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,G=$localize`:␟b631721fc56cb7fb1cbd07b802a487c5753f6a2d␟7676453378151263120:The cluster name is not valid.`,w=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,ne=$localize`:␟a1c45b594b0fba22fc64e80c793a7ffe005fdb0e␟7023083013631288341:The CephX ID is not valid.`,oe=$localize`:␟dc016c82fd85848d5c1b2fd0e8469ee2027d9c16␟6590812369230617068:The monitory address is not valid.`,ie=$localize`:␟4cd83164cd4f66b4abc2863f9ce6f599d789e4ca␟1941784345057787005:CephX key must be base64 encoded.`,[["formDir","ngForm"],["clusterNameError",""],["clientIDError",""],["monAddrError",""],["keyError",""],_,p,g,T,C,I,D,G,w,ne,oe,ie,["size","md",3,"overlaySelected","open","hasScrollingContent"],[3,"closeSelect"],["cdsModalHeaderHeading",""],["cdsModalContent",""],["name","editPeerForm","novalidate","",1,"form",3,"formGroup"],[1,"form-item"],["for","clusterName","cdRequiredField","Cluster Name",3,"invalid","invalidText"],["cdsText","","type","text","placeholder",n,"id","clusterName","name","clusterName","formControlName","clusterName","autofocus","",3,"invalid"],["for","clientID","cdRequiredField","CephX ID",3,"invalid","invalidText"],["cdsText","","type","text","placeholder",t,"id","clientID","name","clientID","formControlName","clientID",3,"invalid"],["for","monAddr",3,"invalid","invalidText"],["cdsText","","type","text","placeholder",o,"id","monAddr","name","monAddr","formControlName","monAddr",3,"invalid"],["for","key",3,"invalid","invalidText"],["cdsText","","type","text","placeholder",a,"id","key","name","key","formControlName","key",3,"invalid"],[3,"submitActionEvent","form","submitText","modalForm"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-modal",17),e.\u0275\u0275listener("overlaySelected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(1,"cds-modal-header",18),e.\u0275\u0275listener("closeSelect",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(2,"h3",19),e.\u0275\u0275i18n(3,5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"section",20)(5,"form",21,0)(7,"p")(8,"span"),e.\u0275\u0275i18nStart(9,6),e.\u0275\u0275element(10,"kbd")(11,"kbd"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(12,"div",22)(13,"cds-text-label",23),e.\u0275\u0275i18nStart(14,7),e.\u0275\u0275element(15,"input",24),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(16,Oa,2,2,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"div",22)(19,"cds-text-label",25),e.\u0275\u0275i18nStart(20,8),e.\u0275\u0275element(21,"input",26),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(22,Na,2,2,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"div",22)(25,"cds-text-label",27),e.\u0275\u0275i18nStart(26,9),e.\u0275\u0275element(27,"input",28),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(28,Pa,1,1,"ng-template",null,3,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(30,"div",22)(31,"cds-text-label",29),e.\u0275\u0275i18nStart(32,10),e.\u0275\u0275element(33,"input",30),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(34,va,1,1,"ng-template",null,4,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(36,"cd-form-button-panel",31),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.update())}),e.\u0275\u0275elementEnd()()}if(2&t){const a=e.\u0275\u0275reference(17),s=e.\u0275\u0275reference(23),_=e.\u0275\u0275reference(29),c=e.\u0275\u0275reference(35);e.\u0275\u0275property("open",o.open)("hasScrollingContent",!0),e.\u0275\u0275advance(3),e.\u0275\u0275i18nExp(o.mode),e.\u0275\u0275i18nApply(3),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",o.editPeerForm),e.\u0275\u0275advance(6),e.\u0275\u0275i18nExp(o.mode)(o.poolName),e.\u0275\u0275i18nApply(9),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.editPeerForm.controls.clusterName.invalid&&o.editPeerForm.controls.clusterName.dirty)("invalidText",a),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.editPeerForm.controls.clusterName.invalid&&o.editPeerForm.controls.clusterName.dirty),e.\u0275\u0275advance(4),e.\u0275\u0275property("invalid",o.editPeerForm.controls.clientID.invalid&&o.editPeerForm.controls.clientID.dirty)("invalidText",s),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.editPeerForm.controls.clientID.invalid&&o.editPeerForm.controls.clientID.dirty),e.\u0275\u0275advance(4),e.\u0275\u0275property("invalid",o.editPeerForm.controls.monAddr.invalid&&o.editPeerForm.controls.monAddr.dirty)("invalidText",_),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.editPeerForm.controls.monAddr.invalid&&o.editPeerForm.controls.monAddr.dirty),e.\u0275\u0275advance(4),e.\u0275\u0275property("invalid",o.editPeerForm.controls.key.invalid&&o.editPeerForm.controls.key.dirty)("invalidText",c),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.editPeerForm.controls.key.invalid&&o.editPeerForm.controls.key.dirty),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.editPeerForm)("submitText",o.actionLabels.SUBMIT)("modalForm",!0)}},dependencies:[l.NgIf,A.e,Le.B,f.S,R.E,Me.P,r.\u0275NgNoValidate,r.DefaultValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.FormGroupDirective,r.FormControlName,d.Modal,d.ModalHeader,d.ModalContent,d.ModalHeaderHeading,d.TextInputLabelComponent,d.TextInput]})}}var Jt=m(22453);const Da=["healthTmpl"],La=["localTmpl"],ya=["remoteTmpl"];function $a(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span",8),e.\u0275\u0275pipe(1,"mirrorHealthColor"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()),2&i){const t=n.data.row,o=n.data.value;e.\u0275\u0275property("ngClass",e.\u0275\u0275pipeBind1(1,2,t.health_color)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(o)}}function Ba(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",9),e.\u0275\u0275i18n(1,3),e.\u0275\u0275elementEnd())}function Ga(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",10),e.\u0275\u0275i18n(1,4),e.\u0275\u0275elementEnd())}class Et{constructor(n,t,o,a,s){this.authStorageService=n,this.rbdMirroringService=t,this.modalService=o,this.taskWrapper=a,this.router=s,this.selection=new le.y,this.tableStatus=new pe.m,this.data=[],this.permission=this.authStorageService.getPermissions().rbdMirroring;const _={permission:"update",icon:F.FI.edit,click:()=>this.editModeModal(),name:$localize`Edit Mode`,canBePrimary:()=>!0},c={permission:"create",icon:F.FI.add,name:$localize`Add Peer`,click:()=>this.editPeersModal("add"),disable:()=>!this.selection.first()||"disabled"===this.selection.first().mirror_mode,visible:()=>!this.getPeerUUID(),canBePrimary:()=>!1},p={permission:"update",icon:F.FI.exchange,name:$localize`Edit Peer`,click:()=>this.editPeersModal("edit"),visible:()=>!!this.getPeerUUID()},g={permission:"delete",icon:F.FI.destroy,name:$localize`Delete Peer`,click:()=>this.deletePeersModal(),visible:()=>!!this.getPeerUUID()};this.tableActions=[_,c,p,g]}ngOnInit(){this.columns=[{prop:"name",name:$localize`Name`,flexGrow:2},{prop:"mirror_mode",name:$localize`Mode`,flexGrow:2},{prop:"leader_id",name:$localize`Leader`,flexGrow:2},{prop:"image_local_count",name:$localize`# Local`,headerTemplate:this.localTmpl,flexGrow:2},{prop:"image_remote_count",name:$localize`# Remote`,headerTemplate:this.remoteTmpl,flexGrow:2},{prop:"health",name:$localize`Health`,cellTemplate:this.healthTmpl,flexGrow:1}],this.subs=this.rbdMirroringService.subscribeSummary(n=>{this.data=n.content_data.pools,this.tableStatus=new pe.m(n.status)})}ngOnDestroy(){this.subs.unsubscribe()}refresh(){this.rbdMirroringService.refresh()}editModeModal(){this.router.navigate(["/block/mirroring",{outlets:{modal:[M.Qp.EDIT,this.selection.first().name]}}])}editPeersModal(n){const t={poolName:this.selection.first().name,mode:n};"edit"===n&&(t.peerUUID=this.getPeerUUID()),this.modalService.show(ft,t)}deletePeersModal(){const n=this.selection.first().name,t=this.getPeerUUID();this.modalService.show(re.D,{impact:Jt.r.high,itemDescription:$localize`mirror peer`,itemNames:[`${n} (${t})`],submitActionObservable:()=>new K.Observable(o=>{this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/mirroring/peer/delete",{pool_name:n}),call:this.rbdMirroringService.deletePeer(n,t)}).subscribe({error:a=>o.error(a),complete:()=>{this.rbdMirroringService.refresh(),o.complete()}})})})}getPeerUUID(){const n=this.selection.first(),t=this.data.find(o=>n&&n.name===o.name);if(t&&t.peer_uuids)return t.peer_uuids[0]}updateSelection(n){this.selection=n}static{this.\u0275fac=function(t){return new(t||Et)(e.\u0275\u0275directiveInject(X.v),e.\u0275\u0275directiveInject(me.B),e.\u0275\u0275directiveInject(_e.V),e.\u0275\u0275directiveInject($.a),e.\u0275\u0275directiveInject(v.Router))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Et,selectors:[["cd-mirroring-pools"]],viewQuery:function(t,o){if(1&t&&(e.\u0275\u0275viewQuery(Da,7),e.\u0275\u0275viewQuery(La,7),e.\u0275\u0275viewQuery(ya,7)),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.healthTmpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.localTmpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.remoteTmpl=a.first)}},decls:9,vars:7,consts:()=>{let n,t,o,a;return n=$localize`:␟b7bcbd37f90178c56db5dad67ecc2b9be5ecd1e3␟1072031601182811536:Local image count`,t=$localize`:␟7acaab450312114059ced9e3737798ee9aa738b1␟8517494870558773093:# Local`,o=$localize`:␟059b3a4d8bdadf1fd4d07c1c2df7898f539139db␟6244870042586497251:Remote image count`,a=$localize`:␟7a3ffd88868135c44be3994263bb8e49d8358884␟4953753699491987394:# Remote`,[["healthTmpl",""],["localTmpl",""],["remoteTmpl",""],t,a,["columnMode","flex","identifier","name","forceIdentifier","true","selectionType","single",3,"fetchData","updateSelection","data","columns","autoReload","status"],[1,"table-actions",3,"permission","selection","tableActions"],["name","modal"],[3,"ngClass"],["ngbTooltip",n],["ngbTooltip",o]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-table",5),e.\u0275\u0275listener("fetchData",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.refresh())})("updateSelection",function(_){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.updateSelection(_))}),e.\u0275\u0275element(1,"cd-table-actions",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(2,$a,3,4,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)(4,Ba,2,0,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)(6,Ga,2,0,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275element(8,"router-outlet",7)}2&t&&(e.\u0275\u0275property("data",o.data)("columns",o.columns)("autoReload",-1)("status",o.tableStatus),e.\u0275\u0275advance(),e.\u0275\u0275property("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[l.NgClass,j.O,de.j,v.RouterOutlet,P.NgbTooltip,Ve]})}}const wa=()=>({md:4});function Va(i,n){if(1&i&&(e.\u0275\u0275i18nStart(0,1,1),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(1,"svg",21),e.\u0275\u0275i18nEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",t.icons.edit)("size",t.icons.size32)}}function Ha(i,n){if(1&i&&(e.\u0275\u0275i18nStart(0,1,2),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(1,"svg",21),e.\u0275\u0275i18nEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",t.icons.check)("size",t.icons.size32)}}function ka(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"button",22),e.\u0275\u0275listener("click",function(a){const s=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275resetView(s.click(a))}),e.\u0275\u0275elementStart(2,"span"),e.\u0275\u0275i18n(3,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(4,"svg",23),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=n.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275property("cdsButton",t.buttonKind)("title",t.name)("disabled",t.disable())("preserveFragment",t.preserveFragment?"":null),e.\u0275\u0275attribute("aria-label",t.name)("data-testid",t.name),e.\u0275\u0275advance(2),e.\u0275\u0275i18nExp(t.name),e.\u0275\u0275i18nApply(3),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",t.icon)}}class Ct{constructor(n,t,o,a){this.authStorageService=n,this.rbdMirroringService=t,this.modalService=o,this.taskWrapper=a,this.selection=new le.y,this.peersExist=!0,this.subs=new K.Subscription,this.editing=!1,this.icons=F.FI,this.permission=this.authStorageService.getPermissions().rbdMirroring;const s={permission:"update",icon:"document--add",click:()=>this.createBootstrapModal(),name:$localize`Create Bootstrap Token`,canBePrimary:()=>!0,disable:()=>!1,buttonKind:"primary"},_={permission:"update",icon:"document--import",click:()=>this.importBootstrapModal(),name:$localize`Import Bootstrap Token`,disable:()=>!1,buttonKind:"tertiary"};this.tableActions=[s,_]}ngOnInit(){this.createForm(),this.subs.add(this.rbdMirroringService.startPolling()),this.subs.add(this.rbdMirroringService.subscribeSummary(n=>{this.status=n.content_data.status,this.peersExist=!!n.content_data.pools.find(t=>t.peer_uuids.length>0)})),this.rbdMirroringService.getSiteName().subscribe(n=>{this.siteName=n.site_name,this.rbdmirroringForm.get("siteName").setValue(this.siteName)})}createForm(){this.rbdmirroringForm=new V.$({siteName:new r.UntypedFormControl({value:"",disabled:!0})})}ngOnDestroy(){this.subs.unsubscribe()}updateSiteName(){this.editing&&this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/mirroring/site_name/edit",{}),call:this.rbdMirroringService.setSiteName(this.rbdmirroringForm.getValue("siteName"))}).subscribe({complete:()=>{this.rbdMirroringService.refresh()}}),this.editing=!this.editing}createBootstrapModal(){const n={siteName:this.siteName};this.modalRef=this.modalService.show(pt,n)}importBootstrapModal(){const n={siteName:this.siteName};this.modalRef=this.modalService.show(ut,n)}static{this.\u0275fac=function(t){return new(t||Ct)(e.\u0275\u0275directiveInject(X.v),e.\u0275\u0275directiveInject(me.B),e.\u0275\u0275directiveInject(_e.V),e.\u0275\u0275directiveInject($.a))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Ct,selectors:[["cd-mirroring"]],decls:32,vars:10,consts:()=>{let n,t,o,a,s;return n=$localize`:␟2eaa15a6ff9b17f3dd836ea51153a75dd60483b4␟3205802822617101057:Site Name ${"\ufffd#6\ufffd"}:START_TAG_DIV:${"\ufffd#7\ufffd\ufffd/#7\ufffd"}:TAG_INPUT:${"\ufffd#8\ufffd"}:START_TAG_CDS_ICON_BUTTON:${"\ufffd*9:1\ufffd\ufffd#1:1\ufffd"}:START_TAG__SVG_SVG:${"[\ufffd/#1:1\ufffd\ufffd/*9:1\ufffd|\ufffd/#1:2\ufffd\ufffd/*10:2\ufffd]"}:CLOSE_TAG__SVG_SVG:${"\ufffd*10:2\ufffd\ufffd#1:2\ufffd"}:START_TAG__SVG_SVG_1:${"[\ufffd/#1:1\ufffd\ufffd/*9:1\ufffd|\ufffd/#1:2\ufffd\ufffd/*10:2\ufffd]"}:CLOSE_TAG__SVG_SVG:${"\ufffd/#8\ufffd"}:CLOSE_TAG_CDS_ICON_BUTTON:${"\ufffd#11\ufffd"}:START_TAG_CD_COPY_2_CLIPBOARD_BUTTON:${"\ufffd/#11\ufffd"}:CLOSE_TAG_CD_COPY_2_CLIPBOARD_BUTTON:${"\ufffd/#6\ufffd"}:CLOSE_TAG_DIV:`,n=e.\u0275\u0275i18nPostprocess(n),t=$localize`:␟9e24f9e2d42104ffc01599db4d566d1cc518f9e6␟1419569261746199221:Daemons`,o=$localize`:␟92899fa68e8ca108912163ff58edc8540e453787␟8231861638104479971:Pools`,a=$localize`:␟b73f7f5060fb22a1e9ec462b1bb02493fa3ab866␟414887388288176527:Images`,s=$localize`:␟1a917d3b8e59675fbe48de9dbd52455b202ac2da␟254778467676559833:${"\ufffd0\ufffd"}:INTERPOLATION:`,[["formDir","ngForm"],n,t,o,a,s,["name","rbdmirroringForm","novalidate","",3,"formGroup"],[1,"form-item"],["cdsCol","",1,"d-flex",3,"columnNumbers"],["for","siteName"],[1,"cds-input-group"],["type","text","id","siteName","name","siteName","formControlName","siteName","cdsText",""],["kind","ghost","size","md",3,"click","title"],["class","cds--btn__icon",3,"cdsIcon","size",4,"ngIf"],[3,"source","byId"],["cdsCol","{md:5}"],[1,"d-flex","flex-row-reverse","gap-3"],[4,"ngFor","ngForOf"],[1,"row"],[1,"col-sm-6"],[1,"col-md-12"],[1,"cds--btn__icon",3,"cdsIcon","size"],["type","button",3,"click","cdsButton","title","disabled","preserveFragment"],["size","16",1,"cds--btn__icon",3,"cdsIcon"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"form",6,0)(2,"div",7)(3,"div",8)(4,"cds-text-label",9),e.\u0275\u0275i18nStart(5,1),e.\u0275\u0275elementStart(6,"div",10),e.\u0275\u0275element(7,"input",11),e.\u0275\u0275elementStart(8,"cds-icon-button",12),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.updateSiteName())}),e.\u0275\u0275template(9,Va,2,2,"svg",13)(10,Ha,2,2,"svg",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(11,"cd-copy-2-clipboard-button",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(12,"div",15)(13,"div",16),e.\u0275\u0275template(14,ka,5,8,"ng-container",17),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(15,"div",18)(16,"div",19)(17,"legend"),e.\u0275\u0275i18n(18,2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"div"),e.\u0275\u0275element(20,"cd-mirroring-daemons"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(21,"div",19)(22,"legend"),e.\u0275\u0275i18n(23,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"div"),e.\u0275\u0275element(25,"cd-mirroring-pools"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(26,"div",18)(27,"div",20)(28,"legend"),e.\u0275\u0275i18n(29,4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(30,"div"),e.\u0275\u0275element(31,"cd-mirroring-images"),e.\u0275\u0275elementEnd()()()}2&t&&(e.\u0275\u0275property("formGroup",o.rbdmirroringForm),e.\u0275\u0275advance(3),e.\u0275\u0275property("columnNumbers",e.\u0275\u0275pureFunction0(9,wa)),e.\u0275\u0275advance(4),e.\u0275\u0275attribute("disabled",!o.editing||null),e.\u0275\u0275advance(),e.\u0275\u0275property("title",o.editing?"Save":"Edit"),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!o.editing),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.editing),e.\u0275\u0275advance(),e.\u0275\u0275property("source",o.siteName)("byId",!1),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",o.tableActions))},dependencies:[l.NgForOf,l.NgIf,rt.N,f.S,R.E,r.\u0275NgNoValidate,r.DefaultValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.FormGroupDirective,r.FormControlName,d.TextInputLabelComponent,d.TextInput,d.ColumnDirective,d.Button,d.IconButton,d.IconDirective,gt,St,Et]})}}class Ka{}function za(i,n){if(1&i&&(e.\u0275\u0275i18nStart(0,4,1),e.\u0275\u0275element(1,"option",15),e.\u0275\u0275i18nEnd()),2&i){const t=n.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275property("value",t.id),e.\u0275\u0275i18nExp(t.name),e.\u0275\u0275i18nApply(0)}}function Xa(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",17),e.\u0275\u0275i18n(1,5),e.\u0275\u0275elementEnd())}function Ua(i,n){if(1&i&&e.\u0275\u0275template(0,Xa,2,0,"span",16),2&i){const t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.editModeForm.showError("mirrorMode",o,"cannotDisable"))}}class Tt extends d.BaseModal{constructor(n,t,o,a,s){super(),this.actionLabels=n,this.rbdMirroringService=t,this.taskWrapper=o,this.route=a,this.location=s,this.open=!1,this.bsConfig={containerClass:"theme-default"},this.peerExists=!1,this.mirrorModes=[{id:"disabled",name:$localize`Disabled`},{id:"pool",name:$localize`Pool`},{id:"image",name:$localize`Image`}],this.createForm()}createForm(){this.editModeForm=new V.$({mirrorMode:new r.UntypedFormControl("",{validators:[r.Validators.required,this.validateMode.bind(this)]})})}ngOnInit(){this.open="modal"===this.route.outlet,this.route.params.subscribe(n=>{this.poolName=n.pool_name}),this.pattern=`${this.poolName}`,this.rbdMirroringService.getPool(this.poolName).subscribe(n=>{this.setResponse(n)}),this.subs=this.rbdMirroringService.subscribeSummary(n=>{this.peerExists=!1;const o=n.content_data.pools.find(a=>this.poolName===a.name);this.peerExists=o&&o.peer_uuids.length})}ngOnDestroy(){this.subs.unsubscribe()}validateMode(n){return"disabled"===n.value&&this.peerExists?{cannotDisable:{value:n.value}}:null}setResponse(n){this.editModeForm.get("mirrorMode").setValue(n.mirror_mode)}update(){const n=new Ka;n.mirror_mode=this.editModeForm.getValue("mirrorMode"),this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/mirroring/pool/edit",{pool_name:this.poolName}),call:this.rbdMirroringService.updatePool(this.poolName,n)}).subscribe({error:()=>this.editModeForm.setErrors({cdSubmitButton:!0}),complete:()=>{this.rbdMirroringService.refresh(),this.location.back()}})}closeModal(){this.location.back()}static{this.\u0275fac=function(t){return new(t||Tt)(e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(me.B),e.\u0275\u0275directiveInject($.a),e.\u0275\u0275directiveInject(v.ActivatedRoute),e.\u0275\u0275directiveInject(l.Location))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Tt,selectors:[["cd-pool-edit-mode-modal"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:19,vars:9,consts:()=>{let n,t,o,a;return n=$localize`:␟4057c56d63a7e9b140b1d01871a9229a5f30eb27␟5225960534299296541:Edit pool mirror mode`,t=$localize`:␟45e3aea5fd68bb473c50a4fe9644e6bb164e0cdf␟8790076979965465120:To edit the mirror mode for pool  ${"[\ufffd#10\ufffd|\ufffd#11\ufffd]"}:START_TAG_KBD:${"\ufffd0\ufffd"}:INTERPOLATION:${"[\ufffd/#10\ufffd|\ufffd/#11\ufffd]"}:CLOSE_TAG_KBD:, select a new mode from the list and click  ${"[\ufffd#10\ufffd|\ufffd#11\ufffd]"}:START_TAG_KBD:Update${"[\ufffd/#10\ufffd|\ufffd/#11\ufffd]"}:CLOSE_TAG_KBD:.`,t=e.\u0275\u0275i18nPostprocess(t),o=$localize`:␟d48a6b9ff312bbb060d108320e8725f00224a304␟5413800589269782199:${"\ufffd*15:1\ufffd\ufffd#1:1\ufffd"}:START_TAG_OPTION:${"\ufffd0:1\ufffd"}:INTERPOLATION:${"\ufffd/#1:1\ufffd\ufffd/*15:1\ufffd"}:CLOSE_TAG_OPTION:`,a=$localize`:␟32ca348ef926b0a6a7a780b8b64c3a8239895cec␟7393113340385537982:Peer clusters must be removed prior to disabling mirror.`,[["formDir","ngForm"],["mirrorModeError",""],n,t,o,a,["size","md",3,"overlaySelected","open"],[3,"closeSelect"],["cdsModalHeaderHeading",""],["cdsModalContent",""],["name","editModeForm","novalidate","",1,"form",3,"formGroup"],[1,"form-item"],["label","Mode","for","mirrorMode","formControlName","mirrorMode","name","mirrorMode","id","mirrorMode","cdRequiredField","Mode",3,"invalid","invalidText"],[3,"value",4,"ngFor","ngForOf"],[3,"submitActionEvent","form","submitText","modalForm"],[3,"value"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-modal",6),e.\u0275\u0275listener("overlaySelected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(1,"cds-modal-header",7),e.\u0275\u0275listener("closeSelect",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(2,"h3",8),e.\u0275\u0275i18n(3,2),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"section",9)(5,"form",10,0)(7,"p"),e.\u0275\u0275elementContainerStart(8),e.\u0275\u0275i18nStart(9,3),e.\u0275\u0275element(10,"kbd")(11,"kbd"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"div",11)(13,"cds-select",12),e.\u0275\u0275i18nStart(14,4),e.\u0275\u0275template(15,za,2,2,"option",13),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(16,Ua,1,1,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(18,"cd-form-button-panel",14),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.update())}),e.\u0275\u0275elementEnd()()}if(2&t){const a=e.\u0275\u0275reference(17);e.\u0275\u0275property("open",o.open),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",o.editModeForm),e.\u0275\u0275advance(6),e.\u0275\u0275i18nExp(o.poolName),e.\u0275\u0275i18nApply(9),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.editModeForm.controls.mirrorMode.invalid&&o.editModeForm.controls.mirrorMode.dirty)("invalidText",a),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",o.mirrorModes),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.editModeForm)("submitText",o.actionLabels.UPDATE)("modalForm",!0)}},dependencies:[l.NgForOf,l.NgIf,A.e,R.E,Me.P,r.\u0275NgNoValidate,r.NgSelectOption,r.\u0275NgSelectMultipleOption,r.NgControlStatus,r.NgControlStatusGroup,r.FormGroupDirective,r.FormControlName,d.Modal,d.ModalHeader,d.ModalContent,d.ModalHeaderHeading,d.Select,d.Option]})}}var je,i,nn,Ue=m(59870),Zt=m(6107),x=m(65218),ye=m(73651),en=m(12540);class ja{}(i=je||(je={}))[i.V1=1]="V1",i[i.V2=2]="V2";class qa{constructor(){this.features=[]}}class Qa{constructor(){this.features=[]}}class Ya{}class Wa extends Ya{constructor(){super(...arguments),this.features=[]}}class tn{constructor(){this.features=[],this.remove_scheduling=!1}}!function(i){i.editing="editing",i.cloning="cloning",i.copying="copying"}(nn||(nn={}));const ee={moveToTrash:$localize`Move an image to the trash. Images, even ones actively in-use by clones, can be moved to the trash and deleted at a later time.`,delete:$localize`Delete an rbd image (including all data blocks). If the image has snapshots, this fails and nothing is deleted.`,copy:$localize`Copy the content of a source image into the newly created destination image`,flatten:$localize`If the image is a clone, copy all shared blocks from the parent snapshot and make the child independent of the parent, severing the link between parent snap and child. `,enableMirroring:$localize`Mirroring needs to be enabled on the image to perform this action`,clonedSnapshot:$localize`This RBD has cloned snapshots. Please delete related RBDs before deleting this RBD`,secondayImageDelete:$localize`The image cannot be deleted as it is secondary`,primaryImageResync:$localize`Primary RBD images cannot be resynced`,invalidNameDisable:$localize`This RBD image has an invalid name and can't be managed by ceph.`,removingStatus:$localize`Action not possible for an RBD in status 'Removing'`,journalTooltipText:$localize`'Ensures reliable replication by logging changes before updating the image, but doubles write time, impacting performance. Not recommended for high-speed data processing tasks.`,snapshotTooltipText:$localize`This mode replicates RBD images between clusters using snapshots, efficiently copying data changes but requiring complete delta syncing during failover. Ideal for less demanding tasks due to its less granular approach compared to journaling.`};var Ja=m(55472),ue=m(64333),Za=m(95131),es=m(42865),ts=m(45413);const ns=()=>({md:4});function os(i,n){if(1&i&&(e.\u0275\u0275i18nStart(0,8,1),e.\u0275\u0275element(1,"div"),e.\u0275\u0275i18nEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275i18nExp(t.copyMessage),e.\u0275\u0275i18nApply(0)}}function is(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",49)(1,"cds-text-label",72),e.\u0275\u0275i18nStart(2,16),e.\u0275\u0275pipe(3,"titlecase"),e.\u0275\u0275element(4,"input",73),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(3,1,t.action)),e.\u0275\u0275i18nApply(2)}}function as(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18n(2,17),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd())}function ss(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18n(2,18),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd())}function rs(i,n){if(1&i&&e.\u0275\u0275template(0,as,3,0,"span",47)(1,ss,3,0,"span",47),2&i){e.\u0275\u0275nextContext();const t=e.\u0275\u0275reference(2),o=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngIf",o.rbdForm.showError("name",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.rbdForm.showError("name",t,"pattern"))}}function ls(i,n){1&i&&(e.\u0275\u0275elementStart(0,"cds-text-label",74),e.\u0275\u0275i18nStart(1,19),e.\u0275\u0275element(2,"input",75),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd())}function _s(i,n){1&i&&(e.\u0275\u0275elementStart(0,"option",68),e.\u0275\u0275i18n(1,20),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function cs(i,n){1&i&&(e.\u0275\u0275elementStart(0,"option",68),e.\u0275\u0275i18n(1,21),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function ds(i,n){1&i&&(e.\u0275\u0275elementStart(0,"option",68),e.\u0275\u0275i18n(1,22),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function ms(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"option",78),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=n.$implicit;e.\u0275\u0275property("value",t.pool_name),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t.pool_name)}}function ps(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"cds-select",76),e.\u0275\u0275template(1,_s,2,1,"option",77)(2,cs,2,1,"option",77)(3,ds,2,1,"option",77)(4,ms,2,2,"option",66),e.\u0275\u0275elementEnd()),2&i){e.\u0275\u0275nextContext();const t=e.\u0275\u0275reference(20),o=e.\u0275\u0275nextContext();e.\u0275\u0275property("invalid",!o.rbdForm.controls.pool.valid&&o.rbdForm.controls.pool.dirty)("invalidText",t),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null===o.pools),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null!==o.pools&&0===o.pools.length),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null!==o.pools&&o.pools.length>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",o.pools)}}function us(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,23),e.\u0275\u0275elementEnd())}function gs(i,n){if(1&i&&e.\u0275\u0275template(0,us,2,0,"span",79),2&i){e.\u0275\u0275nextContext();const t=e.\u0275\u0275reference(2),o=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngIf",o.rbdForm.showError("pool",t,"required"))}}function Ss(i,n){1&i&&(e.\u0275\u0275elementStart(0,"cd-alert-panel",81),e.\u0275\u0275text(1,"Mirroring can not be disabled on "),e.\u0275\u0275elementStart(2,"b"),e.\u0275\u0275text(3,"\xa0Pool\xa0"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(4," mirror mode. You need to change the mirror mode to enable this option. "),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("showTitle",!1)}function fs(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-alert-panel",82),e.\u0275\u0275listener("action",function(a){e.\u0275\u0275restoreView(t);const s=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(s.onAlertAction(a))}),e.\u0275\u0275text(1," You need to set\xa0"),e.\u0275\u0275elementStart(2,"b"),e.\u0275\u0275text(3,"mirror mode"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(4,"\xa0in the selected pool to enable mirroring. "),e.\u0275\u0275elementEnd()}2&i&&e.\u0275\u0275property("showTitle",!1)}function Es(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-radio",85),e.\u0275\u0275listener("change",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.setExclusiveLock())}),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"titlecase"),e.\u0275\u0275elementStart(3,"cd-helper"),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd()()}if(2&i){const t=n.$implicit,o=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("value",t.value)("id",t.value)("disabled",o.shouldDisable(t.value)),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,5,t.value)," "),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",t.text," ")}}function Cs(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-alert-panel",82),e.\u0275\u0275listener("action",function(a){e.\u0275\u0275restoreView(t);const s=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(s.onAlertAction(a))}),e.\u0275\u0275i18nStart(1,24),e.\u0275\u0275element(2,"b"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd()}2&i&&e.\u0275\u0275property("showTitle",!1)}function Ts(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",49)(1,"cds-radio-group",83),e.\u0275\u0275template(2,Es,5,7,"cds-radio",84),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,Cs,3,1,"cd-alert-panel",57),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t.mirroringOptions),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","pool"===t.currentPoolMirrorMode&&"editing"!==t.mode)}}function Fs(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,26),e.\u0275\u0275elementEnd())}function Ms(i,n){if(1&i&&e.\u0275\u0275template(0,Fs,2,0,"span",79),2&i){e.\u0275\u0275nextContext(2);const t=e.\u0275\u0275reference(2),o=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngIf",o.rbdForm.showError("schedule",t,"required"))}}function hs(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",49)(1,"cds-text-label",86),e.\u0275\u0275i18nStart(2,25),e.\u0275\u0275element(3,"input",87),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(4,Ms,1,1,"ng-template",null,6,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275reference(5),o=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("invalid",!o.rbdForm.controls.schedule.valid&&o.rbdForm.controls.schedule.dirty)("invalidText",t),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!1===o.peerConfigured||null)("invalid",!o.rbdForm.controls.schedule.valid&&o.rbdForm.controls.schedule.dirty)}}function Os(i,n){1&i&&(e.\u0275\u0275i18nStart(0,27,1),e.\u0275\u0275elementStart(1,"cd-helper"),e.\u0275\u0275element(2,"span"),e.\u0275\u0275elementEnd(),e.\u0275\u0275i18nEnd())}function Rs(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",49)(1,"cds-checkbox",88),e.\u0275\u0275listener("change",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.onUseDataPoolChange())}),e.\u0275\u0275i18nStart(2,27),e.\u0275\u0275element(3,"cd-help-text"),e.\u0275\u0275template(4,Os,3,0,"cd-helper",47),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",t.allDataPools.length<=1&&"editing"!==t.mode)}}function Is(i,n){1&i&&(e.\u0275\u0275elementStart(0,"option",68),e.\u0275\u0275i18n(1,28),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function Ns(i,n){1&i&&(e.\u0275\u0275elementStart(0,"option",68),e.\u0275\u0275i18n(1,29),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function bs(i,n){1&i&&(e.\u0275\u0275elementStart(0,"option",68),e.\u0275\u0275i18n(1,30),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function Ps(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"option",78),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=n.$implicit;e.\u0275\u0275property("value",t.pool_name),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t.pool_name)}}function As(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"cds-select",90),e.\u0275\u0275template(1,Is,2,1,"option",77)(2,Ns,2,1,"option",77)(3,bs,2,1,"option",77)(4,Ps,2,2,"option",66),e.\u0275\u0275elementEnd()),2&i){e.\u0275\u0275nextContext();const t=e.\u0275\u0275reference(3),o=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("invalid",!o.rbdForm.controls.dataPool.valid&&o.rbdForm.controls.dataPool.dirty)("invalidText",t),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null===o.dataPools),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null!==o.dataPools&&0===o.dataPools.length),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null!==o.dataPools&&o.dataPools.length>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",o.dataPools)}}function vs(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,31),e.\u0275\u0275elementEnd())}function Ds(i,n){if(1&i&&e.\u0275\u0275template(0,vs,2,0,"span",79),2&i){e.\u0275\u0275nextContext(2);const t=e.\u0275\u0275reference(2),o=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngIf",o.rbdForm.showError("dataPool",t,"required"))}}function Ls(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",49),e.\u0275\u0275template(1,As,5,6,"cds-select",89)(2,Ds,1,1,"ng-template",null,7,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","editing"!==t.mode&&t.poolPermission.read)}}function ys(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",49)(1,"cds-select",91)(2,"option",68),e.\u0275\u0275i18n(3,32),e.\u0275\u0275elementEnd()()()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275property("skeleton",!0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngValue",null))}function $s(i,n){1&i&&(e.\u0275\u0275elementStart(0,"option",68),e.\u0275\u0275i18n(1,33),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function Bs(i,n){1&i&&(e.\u0275\u0275elementStart(0,"option",68),e.\u0275\u0275i18n(1,34),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function Gs(i,n){1&i&&(e.\u0275\u0275elementStart(0,"option",68),e.\u0275\u0275i18n(1,35),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function xs(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"option",78),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=n.$implicit;e.\u0275\u0275property("value",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t)}}function ws(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"cds-select",92),e.\u0275\u0275template(1,$s,2,1,"option",77)(2,Bs,2,1,"option",77)(3,Gs,2,1,"option",77)(4,xs,2,2,"option",66),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null===t.namespaces),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null!==t.namespaces&&0===t.namespaces.length),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null!==t.namespaces&&t.namespaces.length>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",t.namespaces)}}function Vs(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,36),e.\u0275\u0275elementEnd())}function Hs(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,37),e.\u0275\u0275elementEnd())}function ks(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,38),e.\u0275\u0275elementEnd())}function Ks(i,n){if(1&i&&e.\u0275\u0275template(0,Vs,2,0,"span",79)(1,Hs,2,0,"span",79)(2,ks,2,0,"span",79),2&i){e.\u0275\u0275nextContext();const t=e.\u0275\u0275reference(2),o=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngIf",o.rbdForm.showError("size",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.rbdForm.showError("size",t,"invalidSizeObject")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.rbdForm.showError("size",t,"pattern"))}}function zs(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"cd-help-text"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t.helperText," ")}}function Xs(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"cd-alert-panel",95),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275property("showTitle",!1),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t.helperHtml," ")}}function Us(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"cds-checkbox",93),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"titlecase"),e.\u0275\u0275template(4,zs,2,1,"cd-help-text",47)(5,Xs,2,2,"cd-alert-panel",94),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&i){const t=n.$implicit,o=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("id",t.key)("name",t.key)("formControlName",t.key),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,6,t.key)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",t.helperText),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.helperHtml&&!1===o.rbdForm.getValue(t.key))}}function js(i,n){if(1&i&&(e.\u0275\u0275i18nStart(0,14,1),e.\u0275\u0275element(1,"option",78),e.\u0275\u0275i18nEnd()),2&i){const t=n.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275property("value",t),e.\u0275\u0275i18nExp(t),e.\u0275\u0275i18nApply(0)}}function qs(i,n){if(1&i&&(e.\u0275\u0275i18nStart(0,15,1),e.\u0275\u0275element(1,"option",78),e.\u0275\u0275i18nEnd()),2&i){const t=n.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275property("value",t),e.\u0275\u0275i18nExp(t),e.\u0275\u0275i18nApply(0)}}function Qs(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,39),e.\u0275\u0275elementEnd())}function Ys(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,40),e.\u0275\u0275elementEnd())}function Ws(i,n){if(1&i&&e.\u0275\u0275template(0,Qs,2,0,"span",79)(1,Ys,2,0,"span",79),2&i){e.\u0275\u0275nextContext();const t=e.\u0275\u0275reference(2),o=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngIf",o.rbdForm.showError("stripingUnit",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.rbdForm.showError("stripingUnit",t,"invalidStripingUnit"))}}function Js(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,41),e.\u0275\u0275elementEnd())}function Zs(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",80),e.\u0275\u0275i18n(1,42),e.\u0275\u0275elementEnd())}function er(i,n){if(1&i&&e.\u0275\u0275template(0,Js,2,0,"span",79)(1,Zs,2,0,"span",79),2&i){e.\u0275\u0275nextContext();const t=e.\u0275\u0275reference(2),o=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngIf",o.rbdForm.showError("stripingCount",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.rbdForm.showError("stripingCount",t,"min"))}}function tr(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"form",45,0)(3,"div",46),e.\u0275\u0275i18nStart(4,8),e.\u0275\u0275pipe(5,"titlecase"),e.\u0275\u0275pipe(6,"upperFirst"),e.\u0275\u0275elementStart(7,"cd-help-text"),e.\u0275\u0275template(8,os,2,1,"div",47),e.\u0275\u0275elementEnd(),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,is,5,3,"div",48),e.\u0275\u0275elementStart(10,"div",49)(11,"cds-text-label",50),e.\u0275\u0275i18nStart(12,9),e.\u0275\u0275element(13,"input",51),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(14,rs,2,2,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div",52),e.\u0275\u0275listener("change",function(a){e.\u0275\u0275restoreView(t);const s=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(s.onPoolChange(a.target.value))}),e.\u0275\u0275template(17,ls,3,0,"cds-text-label",53)(18,ps,5,6,"cds-select",54)(19,gs,1,1,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"div",49)(22,"cds-checkbox",55),e.\u0275\u0275listener("checkedChange",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.setMirrorMode())}),e.\u0275\u0275i18nStart(23,10),e.\u0275\u0275element(24,"cd-help-text"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(25,Ss,5,1,"cd-alert-panel",56)(26,fs,5,1,"cd-alert-panel",57),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(27,Ts,4,2,"div",48)(28,hs,6,4,"div",48)(29,Rs,5,1,"div",48)(30,Ls,4,1,"div",48)(31,ys,4,2,"div",48),e.\u0275\u0275elementStart(32,"div",49),e.\u0275\u0275template(33,ws,5,4,"cds-select",58),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(34,"div",49)(35,"cds-text-label",59),e.\u0275\u0275i18nStart(36,11),e.\u0275\u0275element(37,"input",60),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(38,Ks,3,3,"ng-template",null,3,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(40,"cd-form-advanced-fieldset")(41,"div",61)(42,"fieldset")(43,"label",62),e.\u0275\u0275i18n(44,12),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(45,Us,6,8,"ng-container",63),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(46,"legend",64),e.\u0275\u0275i18n(47,13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(48,"div",49)(49,"cds-select",65),e.\u0275\u0275i18nStart(50,14),e.\u0275\u0275template(51,js,2,2,"option",66),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(52,"div",49)(53,"cds-select",67),e.\u0275\u0275i18nStart(54,15),e.\u0275\u0275element(55,"option",68),e.\u0275\u0275template(56,qs,2,2,"option",66),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(57,Ws,2,2,"ng-template",null,4,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(59,"div",49),e.\u0275\u0275element(60,"cds-number",69),e.\u0275\u0275template(61,er,2,2,"ng-template",null,5,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(63,"cd-rbd-configuration-form",70),e.\u0275\u0275listener("changes",function(a){e.\u0275\u0275restoreView(t);const s=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(s.getDirtyConfigurationValues=a)}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(64,"cd-form-button-panel",71),e.\u0275\u0275pipe(65,"titlecase"),e.\u0275\u0275pipe(66,"upperFirst"),e.\u0275\u0275listener("submitActionEvent",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.submit())}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=e.\u0275\u0275reference(2),o=e.\u0275\u0275reference(15),a=e.\u0275\u0275reference(39),s=e.\u0275\u0275reference(58),_=e.\u0275\u0275reference(62),c=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("formGroup",c.rbdForm),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf","Copy"===c.action),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(5,35,c.action))(e.\u0275\u0275pipeBind1(6,37,c.resource)),e.\u0275\u0275i18nApply(4),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",c.rbdForm.getValue("parent")),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",!c.rbdForm.controls.name.valid&&c.rbdForm.controls.name.dirty)("invalidText",o),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",!c.rbdForm.controls.name.valid&&c.rbdForm.controls.name.dirty),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf","editing"===c.mode||!c.poolPermission.read),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","editing"!==c.mode&&c.poolPermission.read),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",c.showMirrorDisableMessage),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","disabled"===c.currentPoolMirrorMode),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",c.mirroring&&"disabled"!==c.currentPoolMirrorMode),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","snapshot"===c.rbdForm.getValue("mirroringMode")&&c.mirroring),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",c.allDataPools.length>1||"editing"===c.mode),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",c.rbdForm.getValue("useDataPool")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","editing"!==c.mode&&c.rbdForm.getValue("pool")&&null===c.namespaces),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf","editing"===c.mode&&c.rbdForm.getValue("namespace")||"editing"!==c.mode&&(c.namespaces&&c.namespaces.length>0||!c.poolPermission.read)),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",!c.rbdForm.controls.size.valid&&c.rbdForm.controls.size.dirty)("invalidText",a),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",!c.rbdForm.controls.size.valid&&c.rbdForm.controls.size.dirty),e.\u0275\u0275advance(8),e.\u0275\u0275property("ngForOf",c.featuresList),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",c.objectSizes),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",!c.rbdForm.controls.stripingUnit.valid&&c.rbdForm.controls.stripingUnit.dirty)("invalidText",s),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngValue",null),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",c.objectSizes),e.\u0275\u0275advance(4),e.\u0275\u0275property("min",1)("invalid",!c.rbdForm.controls.stripingCount.valid&&c.rbdForm.controls.stripingCount.dirty)("invalidText",_)("required",!0),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",c.rbdForm)("initializeData",c.initializeConfigData),e.\u0275\u0275advance(),e.\u0275\u0275property("form",t)("submitText",e.\u0275\u0275pipeBind1(65,39,c.action)+" "+e.\u0275\u0275pipeBind1(66,41,c.resource))}}class he extends Ge.g{constructor(n,t,o,a,s,_,c,p,g,T){super(),this.authStorageService=n,this.route=t,this.poolService=o,this.rbdService=a,this.formatter=s,this.taskWrapper=_,this.dimlessBinaryPipe=c,this.actionLabels=p,this.router=g,this.rbdMirroringService=T,this.namespaces=[],this.namespacesByPoolCache={},this.pools=null,this.allPools=null,this.dataPools=null,this.allDataPools=[],this.featuresList=[],this.initializeConfigData=new K.ReplaySubject(1),this.peerConfigured=!1,this.advancedEnabled=!1,this.rbdFormMode=nn,this.defaultObjectSize="4 MiB",this.mirroringOptions=[{value:"journal",text:ee.journalTooltipText},{value:"snapshot",text:ee.snapshotTooltipText}],this.mirroring=!1,this.currentPoolName="",this.currentPoolMirrorMode="",this.copyMessage=ee.copy,this.objectSizes=["4 KiB","8 KiB","16 KiB","32 KiB","64 KiB","128 KiB","256 KiB","512 KiB","1 MiB","2 MiB","4 MiB","8 MiB","16 MiB","32 MiB"],this.defaultStripingUnit="4 MiB",this.defaultStripingCount=1,this.rbdImage=new K.ReplaySubject(1),this.icons=F.FI,this.currentImageMirrorMode="",this.showMirrorDisableMessage=!1,this.routerUrl=this.router.url,this.poolPermission=this.authStorageService.getPermissions().pool,this.resource=$localize`Image`,this.features={"deep-flatten":{desc:$localize`Deep flatten`,requires:null,allowEnable:!1,allowDisable:!0,helperHtml:$localize`Feature can be disabled but can't be re-enabled later`,helperText:$localize`Speeds up the process of deleting a clone by removing the dependency on the parent image.`},layering:{desc:$localize`Layering`,requires:null,allowEnable:!1,allowDisable:!1,helperHtml:$localize`Feature flag can't be manipulated after the image is created. Disabling this option will also disable the Protect and Clone actions on Snapshot`,helperText:$localize`Allows the creation of snapshots and clones of an image.`},"exclusive-lock":{desc:$localize`Exclusive lock`,requires:null,allowEnable:!0,allowDisable:!0,helperText:$localize`Ensures that only one client can write to the image at a time.`},"object-map":{desc:$localize`Object map (requires exclusive-lock)`,requires:"exclusive-lock",allowEnable:!0,allowDisable:!0,initDisabled:!0,helperText:$localize`Tracks which objects actually exist (have data stored on a device). Enabling object map support speeds up I/O operations for cloning, importing and exporting a sparsely populated image, and deleting.`},"fast-diff":{desc:$localize`Fast diff (interlocked with object-map)`,requires:"object-map",allowEnable:!0,allowDisable:!0,interlockedWith:"object-map",initDisabled:!0,helperText:$localize`Speeds up the process of comparing two images.`}},this.featuresList=this.objToArray(this.features),this.createForm()}objToArray(n){return S().map(n,(t,o)=>Object.assign(t,{key:o}))}createForm(){this.rbdForm=new V.$({parent:new r.UntypedFormControl(""),name:new r.UntypedFormControl("",{validators:[r.Validators.required,r.Validators.pattern(/^[^@/]+?$/)]}),pool:new r.UntypedFormControl(null,{validators:[r.Validators.required]}),namespace:new r.UntypedFormControl(null),useDataPool:new r.UntypedFormControl(!1),dataPool:new r.UntypedFormControl(null),size:new r.UntypedFormControl(null,{updateOn:"blur"}),obj_size:new r.UntypedFormControl(this.defaultObjectSize),features:new V.$(this.featuresList.reduce((n,t)=>(n[t.key]=new r.UntypedFormControl({value:!1,disabled:!!t.initDisabled}),n),{})),mirroring:new r.UntypedFormControl(!1),schedule:new r.UntypedFormControl("",{validators:[r.Validators.pattern(/^([0-9]+)d|([0-9]+)h|([0-9]+)m$/),b.xQ.requiredIf({mirroringMode:"snapshot",mirroring:!0})]}),mirroringMode:new r.UntypedFormControl(""),stripingUnit:new r.UntypedFormControl(this.defaultStripingUnit),stripingCount:new r.UntypedFormControl(this.defaultStripingCount,{updateOn:"blur"})},this.validateRbdForm(this.formatter))}disableForEdit(){this.rbdForm.get("parent").disable(),this.rbdForm.get("pool").disable(),this.rbdForm.get("namespace").disable(),this.rbdForm.get("useDataPool").disable(),this.rbdForm.get("dataPool").disable(),this.rbdForm.get("obj_size").disable(),this.rbdForm.get("stripingUnit").disable(),this.rbdForm.get("stripingCount").disable(),this.rbdImage.subscribe(n=>{n.image_format===je.V1?(this.rbdForm.get("deep-flatten").disable(),this.rbdForm.get("layering").disable(),this.rbdForm.get("exclusive-lock").disable()):(this.rbdForm.get("deep-flatten").value||this.rbdForm.get("deep-flatten").disable(),this.rbdForm.get("layering").disable())})}disableForClone(){this.rbdForm.get("parent").disable(),this.rbdForm.get("size").disable()}disableForCopy(){this.rbdForm.get("parent").disable(),this.rbdForm.get("size").disable()}ngOnInit(){this.prepareFormForAction(),this.gatherNeededData().subscribe(this.handleExternalData.bind(this))}setExclusiveLock(){this.mirroring&&"journal"===this.rbdForm.get("mirroringMode").value?(this.rbdForm.get("exclusive-lock").setValue(!0),this.rbdForm.get("exclusive-lock").disable()):this.rbdForm.get("exclusive-lock").enable()}setMirrorMode(){this.mirroring=!this.mirroring,this.mirroring&&this.rbdForm.get("mirroringMode").setValue(this.mirroringOptions[0].value),this.setExclusiveLock(),this.checkPeersConfigured()}checkPeersConfigured(n){var t=n||this.rbdForm.get("pool").value;this.rbdMirroringService.getPeerForPool(t).subscribe(o=>{o.length>0&&(this.peerConfigured=!0)})}setPoolMirrorMode(){this.currentPoolName=this.mode===this.rbdFormMode.editing?this.response?.pool_name:this.rbdForm.getValue("pool"),this.currentPoolName?(this.rbdMirroringService.refresh(),this.rbdMirroringService.subscribeSummary(n=>{const t=n.content_data.pools.find(o=>o.name===this.currentPoolName);this.currentPoolMirrorMode=t.mirror_mode,this.mode===this.rbdFormMode.editing?("pool"===this.currentPoolMirrorMode?this.showMirrorDisableMessage=!0:this.showMirrorDisableMessage=!1,"image"!==this.currentPoolMirrorMode&&(this.rbdForm.get("mirroring").disable(),this.rbdForm.get("mirroringMode").disable())):"disabled"===t.mirror_mode?(this.mirroring=!1,this.rbdForm.get("mirroring").setValue(this.mirroring),this.rbdForm.get("mirroring").disable()):(this.mirroring=!0,this.rbdForm.get("mirroring").enable(),this.rbdForm.get("mirroring").setValue(this.mirroring),this.rbdForm.get("mirroringMode").setValue(this.mirroringOptions[0].value))})):this.mode!==this.rbdFormMode.editing&&this.rbdForm.get("mirroring").disable(),this.setExclusiveLock()}prepareFormForAction(){const n=this.routerUrl;n.startsWith("/block/rbd/edit")?(this.mode=this.rbdFormMode.editing,this.action=this.actionLabels.EDIT,this.disableForEdit()):n.startsWith("/block/rbd/clone")?(this.mode=this.rbdFormMode.cloning,this.disableForClone(),this.action=this.actionLabels.CLONE):n.startsWith("/block/rbd/copy")?(this.mode=this.rbdFormMode.copying,this.action=this.actionLabels.COPY,this.disableForCopy()):this.action=this.actionLabels.CREATE,S().each(this.features,t=>{this.rbdForm.get("features").get(t.key).valueChanges.subscribe(o=>this.featureFormUpdate(t.key,o))})}gatherNeededData(){const n={};return this.mode?this.route.params.subscribe(t=>{const o=x.J.fromString(decodeURIComponent(t.image_spec));t.snap&&(this.snapName=decodeURIComponent(t.snap)),n.rbd=this.rbdService.get(o),this.checkPeersConfigured(o.poolName)}):n.defaultFeatures=this.rbdService.defaultFeatures(),this.mode!==this.rbdFormMode.editing&&this.poolPermission.read&&(n.pools=this.poolService.list(["pool_name","type","flags_names","application_metadata"])),(0,K.forkJoin)(n)}handleExternalData(n){if(this.handlePoolData(n.pools),this.setPoolMirrorMode(),n.defaultFeatures&&this.setFeatures(n.defaultFeatures),n.rbd){const t=n.rbd;this.setResponse(t,this.snapName),this.rbdImage.next(t)}this.loadingReady()}handlePoolData(n){if(!n)return;const t=[],o=[];for(const a of n)this.rbdService.isRBDPool(a)&&("replicated"===a.type?(t.push(a),o.push(a)):"erasure"===a.type&&-1!==a.flags_names.indexOf("ec_overwrites")&&o.push(a));if(this.pools=t,this.allPools=t,this.dataPools=o,this.allDataPools=o,this.pools.length>=1){const s=this.pools.map(_=>_.pool_name).includes("rbd")?"rbd":this.pools[0].pool_name;this.rbdForm.get("pool").setValue(s),this.onPoolChange(s)}this.allDataPools.length<=1&&this.rbdForm.get("useDataPool").disable()}onPoolChange(n){const t=this.rbdForm.get("dataPool");t.value===n&&t.setValue(null),this.dataPools=this.allDataPools?this.allDataPools.filter(o=>o.pool_name!==n):[],this.namespaces=null,n in this.namespacesByPoolCache?this.namespaces=this.namespacesByPoolCache[n]:this.rbdService.listNamespaces(n).subscribe(o=>{o=o.map(a=>a.namespace),this.namespacesByPoolCache[n]=o,this.namespaces=o}),this.rbdForm.get("namespace").setValue(null)}onUseDataPoolChange(){this.rbdForm.getValue("useDataPool")||(this.rbdForm.get("dataPool").setValue(null),this.onDataPoolChange(null))}onDataPoolChange(n){const t=this.allPools.filter(o=>o.pool_name!==n);this.rbdForm.getValue("pool")===n&&this.rbdForm.get("pool").setValue(null),this.pools=t}validateRbdForm(n){return t=>{const o=t.get("useDataPool"),a=t.get("dataPool");let s=null;o.value&&null==a.value&&(s={required:!0}),a.setErrors(s);const _=t.get("size"),c=t.get("obj_size"),p=n.toBytes(null!=c.value?c.value:this.defaultObjectSize),g=t.get("stripingCount"),T=null!=g.value?g.value:this.defaultStripingCount;let C=null;if(null===_.value)C={required:!0};else{T*p>=n.toBytes(_.value)&&(C={invalidSizeObject:!0})}_.setErrors(C);const I=t.get("stripingUnit");let D=null;null===I.value&&null!==g.value?D={required:!0}:null!==I.value&&n.toBytes(I.value)>p&&(D={invalidStripingUnit:!0}),I.setErrors(D);let G=null;return null===g.value&&null!==I.value?G={required:!0}:T<1&&(G={min:!0}),g.setErrors(G),null}}deepBoxCheck(n,t){this.getDependentChildFeatures(n).forEach(a=>{const s=this.rbdForm.get(a.key);t?s.enable({emitEvent:!1}):(s.disable({emitEvent:!1}),s.setValue(!1,{emitEvent:!1}),this.deepBoxCheck(a.key,t));const _=this.rbdForm.get("features");this.mode===this.rbdFormMode.editing&&_.get(a.key).enabled&&(-1!==this.response.features_name.indexOf(a.key)&&!a.allowDisable||-1===this.response.features_name.indexOf(a.key)&&!a.allowEnable)&&_.get(a.key).disable()})}getDependentChildFeatures(n){return S().filter(this.features,t=>t.requires===n)||[]}interlockCheck(n,t){const o=this.featuresList.find(a=>a.key===n);if(this.response){const a=null!=o.interlockedWith,s=this.featuresList.find(c=>c.interlockedWith===o.key),_=!!this.response.features_name.find(c=>c===o.key);if(a){if(_!==!!this.response.features_name.find(p=>p===o.interlockedWith))return}else if(s&&!!this.response.features_name.find(p=>p===s.key)!==_)return}t?S().filter(this.features,a=>a.interlockedWith===n).forEach(a=>this.rbdForm.get(a.key).setValue(!0,{emitEvent:!1})):o.interlockedWith&&this.rbdForm.get("features").get(o.interlockedWith).setValue(!1)}featureFormUpdate(n,t){if(t){const o=this.features[n].requires;if(o&&!this.rbdForm.getValue(o))return void this.rbdForm.get(`features.${n}`).setValue(!1)}this.deepBoxCheck(n,t),this.interlockCheck(n,t)}setFeatures(n){const t=this.rbdForm.get("features");S().forIn(this.features,o=>{-1!==n.indexOf(o.key)&&t.get(o.key).setValue(!0),this.featureFormUpdate(o.key,t.get(o.key).value)})}setResponse(n,t){this.response=n;const o=new x.J(n.pool_name,n.namespace,n.name).toString();if(this.mode===this.rbdFormMode.cloning)this.rbdForm.get("parent").setValue(`${o}@${t}`);else if(this.mode===this.rbdFormMode.copying)t?this.rbdForm.get("parent").setValue(`${o}@${t}`):this.rbdForm.get("parent").setValue(`${o}`);else if(n.parent){const a=n.parent;this.rbdForm.get("parent").setValue(`${a.pool_name}/${a.image_name}@${a.snap_name}`)}this.mode===this.rbdFormMode.editing&&(this.rbdForm.get("name").setValue(n.name),"snapshot"===n?.mirror_mode||n.features_name.includes("journaling")?(this.mirroring=!0,this.rbdForm.get("mirroring").setValue(this.mirroring),this.rbdForm.get("mirroringMode").setValue(n?.mirror_mode),this.currentImageMirrorMode=n?.mirror_mode,this.rbdForm.get("schedule").setValue(n?.schedule_interval)):(this.mirroring=!1,this.rbdForm.get("mirroring").setValue(this.mirroring)),this.setPoolMirrorMode()),this.rbdForm.get("pool").setValue(n.pool_name),this.onPoolChange(n.pool_name),this.rbdForm.get("namespace").setValue(n.namespace),n.data_pool&&(this.rbdForm.get("useDataPool").setValue(!0),this.rbdForm.get("dataPool").setValue(n.data_pool)),this.rbdForm.get("size").setValue(this.dimlessBinaryPipe.transform(n.size)),this.rbdForm.get("obj_size").setValue(this.dimlessBinaryPipe.transform(n.obj_size)),this.setFeatures(n.features_name),this.rbdForm.get("stripingUnit").setValue(this.dimlessBinaryPipe.transform(n.stripe_unit)),this.rbdForm.get("stripingCount").setValue(n.stripe_count),this.initializeConfigData.next({initialData:this.response.configuration,sourceType:Zt.M.image})}createRequest(){const n=new Wa;return n.pool_name=this.rbdForm.getValue("pool"),n.namespace=this.rbdForm.getValue("namespace"),n.name=this.rbdForm.getValue("name"),n.schedule_interval=this.rbdForm.getValue("schedule"),n.size=this.formatter.toBytes(this.rbdForm.getValue("size")),this.addObjectSizeAndStripingToRequest(n),n.configuration=this.getDirtyConfigurationValues(),this.mirroring&&"image"===this.currentPoolMirrorMode&&(n.mirror_mode=this.rbdForm.getValue("mirroringMode")),n}addObjectSizeAndStripingToRequest(n){n.obj_size=this.formatter.toBytes(this.rbdForm.getValue("obj_size")),S().forIn(this.features,t=>{this.rbdForm.getValue(t.key)&&n.features.push(t.key)}),this.mirroring&&"journal"===this.rbdForm.getValue("mirroringMode")&&n.features.push("journaling"),n.stripe_unit=this.formatter.toBytes(this.rbdForm.getValue("stripingUnit")),n.stripe_count=this.rbdForm.getValue("stripingCount"),n.data_pool=this.rbdForm.getValue("dataPool")}createAction(){const n=this.createRequest();return this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/create",{pool_name:n.pool_name,namespace:n.namespace,image_name:n.name,schedule_interval:n.schedule_interval,start_time:n.start_time,mirror_mode:n.mirror_mode}),call:this.rbdService.create(n)})}editRequest(){const n=new tn;if(n.name=this.rbdForm.getValue("name"),n.schedule_interval=this.rbdForm.getValue("schedule"),n.enable_mirror=this.mirroring,n.size=this.formatter.toBytes(this.rbdForm.getValue("size")),S().forIn(this.features,t=>{this.rbdForm.getValue(t.key)&&n.features.push(t.key)}),n.enable_mirror)n.image_mirror_mode=this.currentImageMirrorMode,"journal"===this.rbdForm.getValue("mirroringMode")&&(n.mirror_mode="journal",n.features.push("journaling")),"image"===this.currentPoolMirrorMode&&(n.mirror_mode=this.rbdForm.getValue("mirroringMode"));else{const t=n.features.indexOf("journaling",0);t>-1&&n.features.splice(t,1)}return n.configuration=this.getDirtyConfigurationValues(),n}cloneRequest(){const n=new qa;return n.child_pool_name=this.rbdForm.getValue("pool"),n.child_namespace=this.rbdForm.getValue("namespace"),n.child_image_name=this.rbdForm.getValue("name"),this.addObjectSizeAndStripingToRequest(n),n.configuration=this.getDirtyConfigurationValues(!0,Zt.M.image),n}editAction(){const n=new x.J(this.response.pool_name,this.response.namespace,this.response.name);return this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/edit",{image_spec:n.toString()}),call:this.rbdService.update(n,this.editRequest())})}cloneAction(){const n=this.cloneRequest(),t=new x.J(this.response.pool_name,this.response.namespace,this.response.name);return this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/clone",{parent_image_spec:t.toString(),parent_snap_name:this.snapName,child_pool_name:n.child_pool_name,child_namespace:n.child_namespace,child_image_name:n.child_image_name}),call:this.rbdService.cloneSnapshot(t,this.snapName,n)})}copyRequest(){const n=new Qa;return this.snapName&&(n.snapshot_name=this.snapName),n.dest_pool_name=this.rbdForm.getValue("pool"),n.dest_namespace=this.rbdForm.getValue("namespace"),n.dest_image_name=this.rbdForm.getValue("name"),this.addObjectSizeAndStripingToRequest(n),n.configuration=this.getDirtyConfigurationValues(!0,Zt.M.image),n}copyAction(){const n=this.copyRequest(),t=new x.J(this.response.pool_name,this.response.namespace,this.response.name);return this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/copy",{src_image_spec:t.toString(),dest_pool_name:n.dest_pool_name,dest_namespace:n.dest_namespace,dest_image_name:n.dest_image_name}),call:this.rbdService.copy(t,n)})}shouldDisable(n){return"pool"===this.currentPoolMirrorMode&&"snapshot"===n||null}submit(){this.mode||this.rbdImage.next("create"),this.rbdImage.pipe((0,Fe.first)(),(0,Fe.switchMap)(()=>this.mode===this.rbdFormMode.editing?this.editAction():this.mode===this.rbdFormMode.cloning?this.cloneAction():this.mode===this.rbdFormMode.copying?this.copyAction():this.createAction())).subscribe(()=>{},()=>this.rbdForm.setErrors({cdSubmitButton:!0}),()=>this.router.navigate(["/block/rbd"]))}onAlertAction(){this.router.navigate(["/block/mirroring",{outlets:{modal:["edit",this.rbdForm.getValue("pool")]}}])}static{this.\u0275fac=function(t){return new(t||he)(e.\u0275\u0275directiveInject(X.v),e.\u0275\u0275directiveInject(v.ActivatedRoute),e.\u0275\u0275directiveInject(Ue.m),e.\u0275\u0275directiveInject(z.U),e.\u0275\u0275directiveInject(en.k),e.\u0275\u0275directiveInject($.a),e.\u0275\u0275directiveInject(ye.l),e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(v.Router),e.\u0275\u0275directiveInject(me.B))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:he,selectors:[["cd-rbd-form"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:3,consts:()=>{let n,t,o,a,s,_,c,p,g,T,C,I,D,G,w,ne,oe,ie,k,ge,N,Oe,Re,Ie,Ne,be,Pe,Ae,ve,B,Ze,et,tt,nt,ot;return n=$localize`:form title␟60962caf881591083ba27a802f9fc5d441af3202␟3661042287735871706:${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd1\ufffd"}:INTERPOLATION_1: ${"\ufffd#7\ufffd"}:START_TAG_CD_HELP_TEXT:${"\ufffd*8:1\ufffd\ufffd#1:1\ufffd"}:START_TAG_DIV:${"\ufffd0:1\ufffd"}:INTERPOLATION_2: ${"\ufffd/#1:1\ufffd\ufffd/*8:1\ufffd"}:CLOSE_TAG_DIV:${"\ufffd/#7\ufffd"}:CLOSE_TAG_CD_HELP_TEXT:`,t=$localize`:␟29645d4f82a29e8ee4c0cd5e5fbdce60159f73ba␟7630652246532918874:Name ${"\ufffd#13\ufffd\ufffd/#13\ufffd"}:TAG_INPUT:`,o=$localize`:␟21527174887e55714022ff1b204e0783aee30e31␟5112237507403717392:Mirroring ${"\ufffd#24\ufffd"}:START_TAG_CD_HELP_TEXT:Allow data to be asynchronously mirrored between two Ceph clusters${"\ufffd/#24\ufffd"}:CLOSE_TAG_CD_HELP_TEXT:`,a=$localize`:␟87bfaa2c5a9162484a5758fb4793ff3dbfc476c3␟292150574471534249:Size ${"\ufffd#37\ufffd\ufffd/#37\ufffd"}:TAG_INPUT:`,s=$localize`:␟6cdb1fea93d77c07950c0c76c6e0ad79ebbef084␟6599364831830861985:Features`,_=$localize`:␟3562a3778695a5f9c0445660e35301f0a39aaf73␟8401117767373393091:Striping`,c=$localize`:␟0442b1c55f1908c10a879e2f70a3c32122878207␟4953938033733251075:${"\ufffd*51:1\ufffd\ufffd#1:1\ufffd"}:START_TAG_OPTION:${"\ufffd0:1\ufffd"}:INTERPOLATION:${"\ufffd/#1:1\ufffd\ufffd/*51:1\ufffd"}:CLOSE_TAG_OPTION:`,p=$localize`:␟34b6143e14e7fe00345c0823f6e6aa7553df20c9␟4185254032403664259:${"\ufffd#55\ufffd"}:START_TAG_OPTION:-- Select stripe unit --${"[\ufffd/#55\ufffd|\ufffd/#1:1\ufffd\ufffd/*56:1\ufffd]"}:CLOSE_TAG_OPTION:${"\ufffd*56:1\ufffd\ufffd#1:1\ufffd"}:START_TAG_OPTION_1:${"\ufffd0:1\ufffd"}:INTERPOLATION:${"[\ufffd/#55\ufffd|\ufffd/#1:1\ufffd\ufffd/*56:1\ufffd]"}:CLOSE_TAG_OPTION:`,p=e.\u0275\u0275i18nPostprocess(p),g=$localize`:␟c1ffc9dd73bfa3c5827193793433e0dc432130e5␟7385927738885000865:${"\ufffd0\ufffd"}:INTERPOLATION: from ${"\ufffd#4\ufffd\ufffd/#4\ufffd"}:TAG_INPUT:`,T=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,C=$localize`:␟0e9ecf29a4fa5b057bd8052e0d801b3fde6a30bf␟905598583984240707:'/' and '@' are not allowed.`,I=$localize`:␟5a770ea510b878c3e4e2191bcadaa13582f156dc␟7145708704215053983:Pool ${"\ufffd#2\ufffd\ufffd/#2\ufffd"}:TAG_INPUT:`,D=$localize`:␟94516fa213706c67ce5a5b5765681d7fb032033a␟3894950702316166331:Loading...`,G=$localize`:␟be7ae8d347aaeb5c3df28d82365bc6b84f576f43␟5376852313208156123:-- No block pools available --`,w=$localize`:␟ef83ec9c304a89d45650e580dcdc2978c37b3a83␟7859304693598053124:-- Select a pool --`,ne=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,oe=$localize`:␟435c6a37d2733e8ed510576c179078b3d5eff410␟8880066705454148593: You need to set mode as ${"\ufffd#2\ufffd"}:START_BOLD_TEXT:Image${"\ufffd/#2\ufffd"}:CLOSE_BOLD_TEXT: in the selected pool to enable snapshot mirroring. `,ie=$localize`:␟51de58d8d8ca7e86bd14d9869b42a1f008a1de83␟6326140651505513596:Schedule Interval ${"\ufffd#3\ufffd\ufffd/#3\ufffd"}:TAG_INPUT:`,k=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,ge=$localize`:␟362abec1f996c38518789453e0d29336a4930fd9␟1627940511809832869: Use a dedicated data pool ${"\ufffd#3\ufffd"}:START_TAG_CD_HELP_TEXT:Use a dedicated pool to store the image data. If not selected, the image data will be stored in the same pool as the image metadata. ${"\ufffd/#3\ufffd"}:CLOSE_TAG_CD_HELP_TEXT:${"\ufffd*4:1\ufffd\ufffd#1:1\ufffd"}:START_TAG_CD_HELPER:${"\ufffd#2:1\ufffd"}:START_TAG_SPAN:You need more than one pool with the rbd application label use to use a dedicated data pool.${"\ufffd/#2:1\ufffd"}:CLOSE_TAG_SPAN:${"\ufffd/#1:1\ufffd\ufffd/*4:1\ufffd"}:CLOSE_TAG_CD_HELPER:`,N=$localize`:␟94516fa213706c67ce5a5b5765681d7fb032033a␟3894950702316166331:Loading...`,Oe=$localize`:␟151c80ea931037cd92e854442927f8a0f6ae7795␟7896082652291310983:-- No data pools available --`,Re=$localize`:␟8b5296673ed322c73a71eb53e81f9ae7d20d2dd2␟3442251447509329132:-- Select a data pool --`,Ie=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,Ne=$localize`:␟94516fa213706c67ce5a5b5765681d7fb032033a␟3894950702316166331:Loading...`,be=$localize`:␟94516fa213706c67ce5a5b5765681d7fb032033a␟3894950702316166331:Loading...`,Pe=$localize`:␟d649904466254d13df1fbf2d255f0bbc6553d213␟9096215332780695499:-- No namespaces available --`,Ae=$localize`:␟e22d7bb4d2d561e0832ee0b9a3da2468a080c4f0␟5599601174257443416:-- Select a namespace --`,ve=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,B=$localize`:␟0a88bbee20570aaf9615332fb27020627044874d␟5328556463084038907:You have to increase the size.`,Ze=$localize`:␟25db023269cd62168393b201f615ec90e07f3df8␟4749416028992272245:Size must be a number or in a valid format. eg: 5 GiB`,et=$localize`:␟8d32c5c54c8581c774a7f467fbd4e329b15a74fa␟3075270917188041328:This field is required because stripe count is defined!`,tt=$localize`:␟6bbf9040be7c5491d4a03f2185708f43a6582a3b␟6153477700535402202:Stripe unit is greater than object size.`,nt=$localize`:␟baa74031990c5370008ba622d0a250f0929097f4␟7722186069234753681:This field is required because stripe unit is defined!`,ot=$localize`:␟cd2ada6d5ecbd5cbf89eae0a1f5326efedac0dbc␟3849256548364425655:Stripe count must be greater than 0.`,[["formDir","ngForm"],["nameError",""],["poolError",""],["sizeError",""],["stripingUnitError",""],["stripingCountError",""],["scheduleError",""],["dataPoolError",""],n,t,o,a,s,_,c,p,g,T,C,I,D,G,w,ne,oe,ie,k,ge,N,Oe,Re,Ie,Ne,be,Pe,Ae,ve,B,Ze,et,tt,nt,ot,["cdsCol","",3,"columnNumbers"],[4,"cdFormLoading"],["name","rbdForm","novalidate","",3,"formGroup"],[1,"form-header"],[4,"ngIf"],["class","form-item",4,"ngIf"],[1,"form-item"],["for","name","cdRequiredField","Name",3,"invalid","invalidText"],["cdsText","","type","text","placeholder","Name...","id","name","name","name","formControlName","name","autofocus","",3,"invalid"],[1,"form-item",3,"change"],["for","pool",4,"ngIf"],["label","Pool","for","pool","name","pool","id","pool","formControlName","pool","cdRequiredField","Pool",3,"invalid","invalidText",4,"ngIf"],["id","mirroring","name","mirroring","formControlName","mirroring",3,"checkedChange"],["spacingClass","mt-2","type","info",3,"showTitle",4,"ngIf"],["type","info","spacingClass","mt-2","actionName","Set mode",3,"showTitle","action",4,"ngIf"],["label","Namespace","helperText","Namespace allows you to logically group RBD images within your Ceph Cluster.Choosing a namespace makes it easier to locate and manage related RBD images efficiently","for","namespace","name","namespace","id","namespace","formControlName","namespace",4,"ngIf"],["for","size","cdRequiredField","Size",3,"invalid","invalidText"],["cdsText","","type","text","placeholder","e.g., 10GiB","id","size","name","size","formControlName","size","defaultUnit","GiB","cdDimlessBinary","",3,"invalid"],["formGroupName","features",1,"form-item"],["for","features",1,"cds--label"],[4,"ngFor","ngForOf"],[1,"cd-header"],["for","obj_size","label","Object size","helperText","Objects in the Ceph Storage Cluster have a maximum configurable size (e.g., 2MB, 4MB, etc.). The object size should be large enough to accommodate many stripe units, and should be a multiple of the stripe unit.","id","obj_size","name","obj_size","formControlName","obj_size"],[3,"value",4,"ngFor","ngForOf"],["for","stripingUnit","label","Stripe unit","helperText","Stripes have a configurable unit size (e.g., 64kb). The Ceph Client divides the data it will write to objects into equally sized stripe units, except for the last stripe unit. A stripe width, should be a fraction of the Object Size so that an object may contain many stripe units","id","stripingUnit","name","stripingUnit","formControlName","stripingUnit","cdRequiredField","Striping Unit",3,"invalid","invalidText"],[3,"ngValue"],["for","stripingCount","label","Stripe count","helperText","The Ceph Client writes a sequence of stripe units over a series of objects determined by the stripe count. The series of objects is called an object set. After the Ceph Client writes to the last object in the object set, it returns to the first object in the object set.","id","stripingCount","name","stripingCount","formControlName","stripingCount","cdRequiredField","Striping Count",3,"min","invalid","invalidText","required"],[3,"changes","form","initializeData"],["wrappingClass","text-right",3,"submitActionEvent","form","submitText"],["for","parent"],["cdsText","","type","text","id","parent","name","parent","formControlName","parent","autofocus",""],["for","pool"],["cdsText","","type","text","placeholder","Pool name...","id","pool","name","pool","formControlName","pool"],["label","Pool","for","pool","name","pool","id","pool","formControlName","pool","cdRequiredField","Pool",3,"invalid","invalidText"],[3,"ngValue",4,"ngIf"],[3,"value"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"],["spacingClass","mt-2","type","info",3,"showTitle"],["type","info","spacingClass","mt-2","actionName","Set mode",3,"action","showTitle"],["formControlName","mirroringMode","name","mirroringMode"],[3,"value","id","disabled","change",4,"ngFor","ngForOf"],[3,"change","value","id","disabled"],["for","schedule","helperText","Create Mirror-Snapshots automatically on a periodic basis. The interval can be specified in days, hours, or minutes using d, h, m suffix respectively. To create mirror snapshots, you must import or create and have available peers to mirror","cdRequiredField","Schedule Interval",3,"invalid","invalidText"],["cdsText","","type","text","placeholder","e.g., 12h or 1d or 10m","id","schedule","name","schedule","formControlName","schedule",3,"disabled","invalid"],["id","useDataPool","name","useDataPool","formControlName","useDataPool",3,"change"],["label","Data pool","helperText","Dedicated pool that stores the object-data of the RBD","for","dataPool","name","dataPool","id","dataPool","formControlName","dataPool","cdRequiredField","Data pool",3,"invalid","invalidText",4,"ngIf"],["label","Data pool","helperText","Dedicated pool that stores the object-data of the RBD","for","dataPool","name","dataPool","id","dataPool","formControlName","dataPool","cdRequiredField","Data pool",3,"invalid","invalidText"],["label","Namespace","for","namespace","name","namespace","id","namespace","formControlName","namespace",3,"skeleton"],["label","Namespace","helperText","Namespace allows you to logically group RBD images within your Ceph Cluster.Choosing a namespace makes it easier to locate and manage related RBD images efficiently","for","namespace","name","namespace","id","namespace","formControlName","namespace"],[1,"spacing-03",3,"id","name","formControlName"],["type","warning","spacingClass","mt-2",3,"showTitle",4,"ngIf"],["type","warning","spacingClass","mt-2",3,"showTitle"]]},template:function(t,o){1&t&&(e.\u0275\u0275elementStart(0,"div",43),e.\u0275\u0275template(1,tr,67,43,"ng-container",44),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275property("columnNumbers",e.\u0275\u0275pureFunction0(2,ns)),e.\u0275\u0275advance(),e.\u0275\u0275property("cdFormLoading",o.loading))},dependencies:[l.NgForOf,l.NgIf,r.\u0275NgNoValidate,r.NgSelectOption,r.\u0275NgSelectMultipleOption,r.DefaultValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.RequiredValidator,r.FormGroupDirective,r.FormControlName,r.FormGroupName,Ja.m,we.m,A.e,ue.O,Za.e,Le.B,es.Y,cn.G,f.S,R.E,Me.P,d.TextInputLabelComponent,d.TextInput,d.ColumnDirective,d.Checkbox,d.Radio,d.RadioGroup,d.Select,d.Option,d.NumberComponent,ts.c,l.TitleCasePipe,De.r]})}}var pn=m(3912),on=m(34177),nr=m(54980),an=m(2361),or=m(89939),$e=m.n(or),Ft=m(43808),ir=m(41861);function ar(i,n){1&i&&(e.\u0275\u0275elementStart(0,"cd-alert-panel",17)(1,"span"),e.\u0275\u0275i18n(2,4),e.\u0275\u0275elementEnd()())}function sr(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",20),e.\u0275\u0275i18n(1,5),e.\u0275\u0275elementEnd())}function rr(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",20),e.\u0275\u0275i18n(1,6),e.\u0275\u0275elementEnd())}function lr(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",13),e.\u0275\u0275element(1,"cd-date-time-picker",18),e.\u0275\u0275template(2,sr,2,0,"span",19)(3,rr,2,0,"span",19),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(6);e.\u0275\u0275advance(),e.\u0275\u0275property("control",t.moveForm.get("expiresAt")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.moveForm.showError("expiresAt",o,"format")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.moveForm.showError("expiresAt",o,"expired"))}}class Mt extends d.BaseModal{constructor(n,t,o,a,s,_,c,p){super(),this.rbdService=n,this.actionLabels=t,this.fb=o,this.taskWrapper=a,this.poolName=s,this.namespace=_,this.imageName=c,this.hasSnapshots=p,this.setExpirationDate=!1,this.createForm()}createForm(){this.moveForm=this.fb.group({expiresAt:["",[b.xQ.custom("format",n=>!(""===n||$e()(n,"YYYY-MM-DD HH:mm:ss").isValid())),b.xQ.custom("expired",n=>$e()().isAfter(n))]],setExpiry:[!1]})}ngOnInit(){this.imageSpec=new x.J(this.poolName,this.namespace,this.imageName),this.imageSpecStr=this.imageSpec.toString(),this.pattern=`${this.poolName}/${this.imageName}`}moveImage(){let n=0;const t=this.moveForm.getValue("expiresAt");t&&(n=$e()(t,"YYYY-MM-DD HH:mm:ss").diff($e()(),"seconds",!0)),n<0&&(n=0),this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/trash/move",{image_spec:this.imageSpecStr}),call:this.rbdService.moveTrash(this.imageSpec,n)}).subscribe({complete:()=>{this.closeModal()}})}toggleExpiration(){this.setExpirationDate=!this.setExpirationDate,this.setExpirationDate||(this.moveForm.get("expiresAt").setValue(""),this.moveForm.get("expiresAt").markAsPristine(),this.moveForm.get("expiresAt").updateValueAndValidity())}static{this.\u0275fac=function(t){return new(t||Mt)(e.\u0275\u0275directiveInject(z.U),e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(Ft.$),e.\u0275\u0275directiveInject($.a),e.\u0275\u0275directiveInject("poolName"),e.\u0275\u0275directiveInject("namespace"),e.\u0275\u0275directiveInject("imageName"),e.\u0275\u0275directiveInject("hasSnapshots"))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Mt,selectors:[["cd-rbd-trash-move-modal"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:17,vars:8,consts:()=>{let n,t,o,a,s,_,c;return n=$localize`:␟f0b5d789d42c0e69348e5fe0037fcbf5b5fbbdcc␟875646211293044587:Move an image to trash`,t=$localize`:␟29de4da0c7907d7c8fabd85df7f6a4e018d57fca␟9123886223877998388:To move ${"[\ufffd#10\ufffd|\ufffd#11\ufffd]"}:START_TAG_KBD:${"\ufffd0\ufffd"}:INTERPOLATION:${"[\ufffd/#10\ufffd|\ufffd/#11\ufffd]"}:CLOSE_TAG_KBD: to trash, click ${"[\ufffd#10\ufffd|\ufffd#11\ufffd]"}:START_TAG_KBD:Move${"[\ufffd/#10\ufffd|\ufffd/#11\ufffd]"}:CLOSE_TAG_KBD:. Optionally, you can pick an expiration date.`,t=e.\u0275\u0275i18nPostprocess(t),o=$localize`:␟40b1adac63add22d1f260b8326184f2dd22f08e8␟4176045547810256581:Set expiration date`,a=$localize`:␟df51194aeafd4963498aa58ea33b40268ef39faa␟5469777266073052221:This image contains snapshot(s), which will prevent it from being removed after moved to trash.`,s=$localize`:␟88f27d390844aad53b4240360e928156c5f0d326␟3332964840072616237:Protection expires at`,_=$localize`:␟a1506e5f2ca22cad14502ec7a20fb6113ace145d␟6926771993782935943:Wrong date format. Please use "YYYY-MM-DD HH:mm:ss".`,c=$localize`:␟aa7ea0bb7495281e0b3258467ac7d90a1e44a1a1␟7478191432394227909:Protection has already expired. Please pick a future date or leave it empty.`,[["formDir","ngForm"],n,t,o,a,_,c,["size","sm",3,"overlaySelected","open"],[3,"closeSelect"],["cdsModalHeaderHeading",""],["cdsModalContent",""],["name","moveForm","novalidate","",1,"form",3,"formGroup"],["type","warning","spacingClass","mb-2",4,"ngIf"],[1,"form-item"],["formControlName","setExpiry","id","setExpiry","name","setExpiry","modal-primary-focus","",3,"checkedChange"],["class","form-item",4,"ngIf"],[3,"submitActionEvent","form","submitText","modalForm"],["type","warning","spacingClass","mb-2"],["name",s,3,"control"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-modal",7),e.\u0275\u0275listener("overlaySelected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(1,"cds-modal-header",8),e.\u0275\u0275listener("closeSelect",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(2,"h3",9),e.\u0275\u0275i18n(3,1),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"section",10)(5,"form",11,0),e.\u0275\u0275template(7,ar,3,0,"cd-alert-panel",12),e.\u0275\u0275elementStart(8,"p"),e.\u0275\u0275i18nStart(9,2),e.\u0275\u0275element(10,"kbd")(11,"kbd"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"div",13)(13,"cds-checkbox",14),e.\u0275\u0275listener("checkedChange",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.toggleExpiration())}),e.\u0275\u0275i18n(14,3),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(15,lr,4,3,"div",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(16,"cd-form-button-panel",16),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.moveImage())}),e.\u0275\u0275elementEnd()()}2&t&&(e.\u0275\u0275property("open",o.open),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",o.moveForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",o.hasSnapshots),e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(o.imageSpecStr),e.\u0275\u0275i18nApply(9),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",o.setExpirationDate),e.\u0275\u0275advance(),e.\u0275\u0275property("form",o.moveForm)("submitText",o.actionLabels.MOVE)("modalForm",!0))},dependencies:[l.NgIf,r.\u0275NgNoValidate,r.NgControlStatus,r.NgControlStatusGroup,r.FormGroupDirective,r.FormControlName,we.m,ir.P,A.e,R.E,d.Checkbox,d.Modal,d.ModalHeader,d.ModalContent,d.ModalHeaderHeading]})}}var _r=m(68316),ht=m(1505),un=m(32609),sn=m(12959),qe=m(71138),cr=m(63882),gn=m(60977);function dr(i,n){if(1&i&&(e.\u0275\u0275i18nStart(0,3,1),e.\u0275\u0275elementStart(1,"span"),e.\u0275\u0275element(2,"b"),e.\u0275\u0275elementEnd(),e.\u0275\u0275i18nEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275i18nExp(t.imageName),e.\u0275\u0275i18nApply(0)}}function mr(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",18),e.\u0275\u0275i18n(1,4),e.\u0275\u0275elementEnd())}function pr(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",18),e.\u0275\u0275i18n(1,5),e.\u0275\u0275elementEnd())}function ur(i,n){if(1&i&&e.\u0275\u0275template(0,mr,2,0,"span",17)(1,pr,2,0,"span",17),2&i){const t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(8);e.\u0275\u0275property("ngIf",t.snapshotForm.showError("snapshotName",o,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.snapshotForm.showError("snapshotName",o,"pattern"))}}function gr(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",12)(1,"cds-checkbox",20),e.\u0275\u0275listener("checkedChange",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.onMirrorCheckBoxChange())}),e.\u0275\u0275i18n(2,6),e.\u0275\u0275elementEnd()()}if(2&i){const t=n.ngIf;e.\u0275\u0275advance(),e.\u0275\u0275attribute("disabled",!t.length>0||null)}}function Sr(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,gr,3,1,"div",19),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(2,1,t.peerConfigured$))}}class Ot extends d.BaseModal{constructor(n,t,o,a,s,_,c,p="",g="",T="",C=""){super(),this.cdsModalService=n,this.rbdService=t,this.taskManagerService=o,this.notificationService=a,this.actionLabels=s,this.rbdMirrorService=_,this.poolName=c,this.namespace=p,this.imageName=g,this.mirroring=T,this.snapName=C,this.editing=!1,this.onSubmit=new K.Subject,this.action=this.actionLabels.CREATE,this.resource=$localize`RBD Snapshot`,this.createForm()}createForm(){this.snapshotForm=new V.$({snapshotName:new r.UntypedFormControl("",{validators:[r.Validators.required,r.Validators.pattern(/^(?!\.)[^/@]+$/)]}),mirrorImageSnapshot:new r.UntypedFormControl(!1,{})})}ngOnInit(){this.peerConfigured$=this.rbdMirrorService.getPeerForPool(this.poolName)}setSnapName(n){this.snapName=n,this.snapshotForm.get("snapshotName").setValue(n)}onMirrorCheckBoxChange(){!0===this.snapshotForm.getValue("mirrorImageSnapshot")?(this.snapshotForm.get("snapshotName").setValue(""),this.snapshotForm.get("snapshotName").clearValidators()):(this.snapshotForm.get("snapshotName").setValue(this.snapName),this.snapshotForm.get("snapshotName").setValidators([r.Validators.required]),this.snapshotForm.get("snapshotName").updateValueAndValidity())}setEditing(n=!0){this.editing=n,this.action=this.editing?this.actionLabels.RENAME:this.actionLabels.CREATE}editAction(){const n=this.snapshotForm.getValue("snapshotName"),t=new x.J(this.poolName,this.namespace,this.imageName),o=new E.O;o.name="rbd/snap/edit",o.metadata={image_spec:t.toString(),snapshot_name:n},this.rbdService.renameSnapshot(t,this.snapName,n).toPromise().then(()=>{this.taskManagerService.subscribe(o.name,o.metadata,a=>{this.notificationService.notifyTask(a)}),this.cdsModalService.dismissAll(),this.onSubmit.next(this.snapName)}).catch(()=>{this.snapshotForm.setErrors({cdSubmitButton:!0})})}createAction(){const n=this.snapshotForm.getValue("snapshotName"),t=this.snapshotForm.getValue("mirrorImageSnapshot"),o=new x.J(this.poolName,this.namespace,this.imageName),a=new E.O;a.name="rbd/snap/create",a.metadata={image_spec:o.toString(),snapshot_name:n},this.rbdService.createSnapshot(o,n,t).toPromise().then(()=>{this.taskManagerService.subscribe(a.name,a.metadata,s=>{this.notificationService.notifyTask(s)}),this.cdsModalService.dismissAll(),this.onSubmit.next(n)}).catch(()=>{this.snapshotForm.setErrors({cdSubmitButton:!0})})}submit(){this.editing?this.editAction():this.createAction()}static{this.\u0275fac=function(t){return new(t||Ot)(e.\u0275\u0275directiveInject(_e.V),e.\u0275\u0275directiveInject(z.U),e.\u0275\u0275directiveInject(gn.C),e.\u0275\u0275directiveInject(ze.J),e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(me.B),e.\u0275\u0275directiveInject("poolName"),e.\u0275\u0275directiveInject("namespace",8),e.\u0275\u0275directiveInject("imageName",8),e.\u0275\u0275directiveInject("mirroring",8),e.\u0275\u0275directiveInject("snapName",8))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Ot,selectors:[["cd-rbd-snapshot-form-modal"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:20,vars:21,consts:()=>{let n,t,o,a,s,_;return n=$localize`:␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,t=$localize`:␟fb127ea03835b3230f0ed981c7080e2ccb879621␟3346778808274133574:${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd1\ufffd"}:INTERPOLATION_1:`,o=$localize`:␟1620a7ef44ca7545d201b422db46138963edfc7c␟5306606438605485512:${"\ufffd#12\ufffd\ufffd/#12\ufffd"}:TAG_INPUT:${"\ufffd*13:1\ufffd\ufffd#1:1\ufffd"}:START_TAG_SPAN: Snapshot mode is enabled on image ${"\ufffd#2:1\ufffd"}:START_BOLD_TEXT:${"\ufffd0:1\ufffd"}:INTERPOLATION:${"\ufffd/#2:1\ufffd"}:CLOSE_BOLD_TEXT:: snapshot names are auto generated${"\ufffd/#1:1\ufffd\ufffd/*13:1\ufffd"}:CLOSE_TAG_SPAN:`,a=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,s=$localize`:␟03b51e08feeb9be612c451133e01e6fab09f0ed4␟3845163630628759546:The snapshot name cannot start with "." and cannot contain "/" and "@".`,_=$localize`:␟0274fbf8af432c8fa45a131be6d04b29d3f8c878␟4739036998595298140:Mirror Image Snapshot `,[["formDir","ngForm"],["snapshotError",""],t,o,a,s,_,["size","md",3,"overalSelected","open"],[3,"closeSelect"],["cdsModalHeaderHeading",""],["cdsModalContent",""],["name","snapshotForm","novalidate","",3,"formGroup"],[1,"form-item"],["label",n,"for","snapshotName","cdRequiredField","Name",3,"invalid","invalidText"],["cdsText","","type","text","placeholder","Snapshot name...","id","snapshotName","name","snapshotName","formControlName","snapshotName","autofocus","",3,"invalid"],[4,"ngIf"],[3,"submitActionEvent","form","submitText","modalForm"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"],["class","form-item",4,"ngIf"],["id","mirrorImageSnapshot","formControlName","mirrorImageSnapshot","name","mirrorImageSnapshot",3,"checkedChange"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-modal",7),e.\u0275\u0275listener("overalSelected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(1,"cds-modal-header",8),e.\u0275\u0275listener("closeSelect",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(2,"h3",9),e.\u0275\u0275i18n(3,2),e.\u0275\u0275pipe(4,"titlecase"),e.\u0275\u0275pipe(5,"upperFirst"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"section",10)(7,"form",11,0)(9,"div",12)(10,"cds-text-label",13),e.\u0275\u0275i18nStart(11,3),e.\u0275\u0275element(12,"input",14),e.\u0275\u0275template(13,dr,3,1,"span",15),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(14,ur,2,2,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(16,Sr,3,3,"ng-container",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(17,"cd-form-button-panel",16),e.\u0275\u0275pipe(18,"titlecase"),e.\u0275\u0275pipe(19,"upperFirst"),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.submit())}),e.\u0275\u0275elementEnd()()}if(2&t){const a=e.\u0275\u0275reference(15);e.\u0275\u0275property("open",o.open),e.\u0275\u0275advance(5),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(4,13,o.action))(e.\u0275\u0275pipeBind1(5,15,o.resource)),e.\u0275\u0275i18nApply(3),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",o.snapshotForm),e.\u0275\u0275advance(3),e.\u0275\u0275property("invalid",o.snapshotForm.controls.snapshotName.invalid&&o.snapshotForm.controls.snapshotName.dirty)("invalidText",a),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.snapshotForm.controls.snapshotName.invalid&&o.snapshotForm.controls.snapshotName.dirty),e.\u0275\u0275attribute("disabled","snapshot"===o.mirroring&&!0===o.snapshotForm.getValue("mirrorImageSnapshot")||null),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","snapshot"===o.mirroring&&!0===o.snapshotForm.getValue("mirrorImageSnapshot")||null),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf","snapshot"===o.mirroring),e.\u0275\u0275advance(),e.\u0275\u0275property("form",o.snapshotForm)("submitText",e.\u0275\u0275pipeBind1(18,17,o.action)+" "+e.\u0275\u0275pipeBind1(19,19,o.resource))("modalForm",!0)}},dependencies:[l.NgIf,r.\u0275NgNoValidate,r.DefaultValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.FormGroupDirective,r.FormControlName,A.e,Le.B,f.S,R.E,Me.P,d.TextInputLabelComponent,d.TextInput,d.Checkbox,d.Modal,d.ModalHeader,d.ModalContent,d.ModalHeaderHeading,l.AsyncPipe,l.TitleCasePipe,De.r]})}}class fr{constructor(n,t,o){this.featuresName=t,this.cloneFormatVersion=1,o.cloneFormatVersion().subscribe(a=>{this.cloneFormatVersion=a}),this.create={permission:"create",icon:F.FI.add,name:n.CREATE},this.rename={permission:"update",icon:F.FI.edit,name:n.RENAME,disable:a=>this.disableForMirrorSnapshot(a)||!a.hasSingleSelection},this.protect={permission:"update",icon:F.FI.lock,visible:a=>a.hasSingleSelection&&!a.first().is_protected,name:n.PROTECT,disable:a=>this.disableForMirrorSnapshot(a)||this.getProtectDisableDesc(a,this.featuresName)},this.unprotect={permission:"update",icon:F.FI.unlock,visible:a=>a.hasSingleSelection&&a.first().is_protected,name:n.UNPROTECT,disable:a=>this.disableForMirrorSnapshot(a)},this.clone={permission:"create",canBePrimary:a=>a.hasSingleSelection,disable:a=>this.getCloneDisableDesc(a)||this.disableForMirrorSnapshot(a),icon:F.FI.clone,name:n.CLONE},this.copy={permission:"create",canBePrimary:a=>a.hasSingleSelection,disable:a=>!a.hasSingleSelection||a.first().cdExecuting||this.disableForMirrorSnapshot(a),icon:F.FI.copy,name:n.COPY},this.rollback={permission:"update",icon:F.FI.undo,name:n.ROLLBACK,disable:a=>this.disableForMirrorSnapshot(a)||!a.hasSingleSelection},this.deleteSnap={permission:"delete",icon:F.FI.destroy,disable:a=>{const s=a.first();return!a.hasSingleSelection||s.cdExecuting||s.is_protected||this.disableForMirrorSnapshot(a)},name:n.DELETE},this.ordering=[this.create,this.rename,this.protect,this.unprotect,this.clone,this.copy,this.rollback,this.deleteSnap]}getProtectDisableDesc(n,t){return!(n.hasSingleSelection&&!n.first().cdExecuting)||!t?.includes("layering")&&$localize`The layering feature needs to be enabled on parent image`}getCloneDisableDesc(n){return!(n.hasSingleSelection&&!n.first().cdExecuting)||1===this.cloneFormatVersion&&!n.first().is_protected&&$localize`Snapshot must be protected in order to clone.`}disableForMirrorSnapshot(n){return n.hasSingleSelection&&"snapshot"===n.first().mirror_mode&&n.first().name.includes(".mirror.")}}class Er{}const Cr=["nameTpl"],Tr=["rollbackTpl"];function Fr(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275i18n(1,1),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementStart(2,"strong"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(4,".\n")),2&i){const t=n.$implicit;e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",t.snapName,"")}}class Rt{constructor(n,t,o,a,s,_,c,p,g,T,C){this.authStorageService=n,this.dimlessBinaryPipe=t,this.cdDatePipe=o,this.rbdService=a,this.taskManagerService=s,this.notificationService=_,this.summaryService=c,this.taskListService=p,this.actionLabels=g,this.cdr=T,this.cdsModalService=C,this.snapshots=[],this.selection=new le.y,this.builders={"rbd/snap/create":I=>{const D=new Er;return D.name=I.snapshot_name,D}},this.permission=this.authStorageService.getPermissions().rbdImage}ngOnInit(){this.columns=[{name:$localize`Name`,prop:"name",cellTransformation:xe.x.executing,flexGrow:2},{name:$localize`Size`,prop:"size",flexGrow:1,cellClass:"text-right",pipe:this.dimlessBinaryPipe},{name:$localize`Used`,prop:"disk_usage",flexGrow:1,cellClass:"text-right",pipe:this.dimlessBinaryPipe},{name:$localize`State`,prop:"is_protected",flexGrow:1,cellTransformation:xe.x.badge,customTemplateConfig:{map:{true:{value:$localize`PROTECTED`,class:"badge-success"},false:{value:$localize`UNPROTECTED`,class:"badge-info"}}}},{name:$localize`Created`,prop:"timestamp",flexGrow:1,pipe:this.cdDatePipe}],this.imageSpec=new x.J(this.poolName,this.namespace,this.rbdName),this.rbdTableActions=new fr(this.actionLabels,this.featuresName,this.rbdService),this.rbdTableActions.create.click=()=>this.openCreateSnapshotModal(),this.rbdTableActions.rename.click=()=>this.openEditSnapshotModal(),this.rbdTableActions.protect.click=()=>this.toggleProtection(),this.rbdTableActions.unprotect.click=()=>this.toggleProtection();const n=()=>this.selection.first()&&`${this.imageSpec.toStringEncoded()}/${encodeURIComponent(this.selection.first().name)}`;this.rbdTableActions.clone.routerLink=()=>`/block/rbd/clone/${n()}`,this.rbdTableActions.copy.routerLink=()=>`/block/rbd/copy/${n()}`,this.rbdTableActions.rollback.click=()=>this.rollbackModal(),this.rbdTableActions.deleteSnap.click=()=>this.deleteSnapshotModal(),this.tableActions=this.rbdTableActions.ordering;this.taskListService.init(()=>(0,K.of)(this.snapshots),null,a=>{un.c.updateChanged(this,{data:a})&&(this.cdr.detectChanges(),this.data=[...this.data])},()=>{un.c.updateChanged(this,{data:this.snapshots})&&(this.cdr.detectChanges(),this.data=[...this.data])},a=>["rbd/snap/create","rbd/snap/delete","rbd/snap/edit","rbd/snap/rollback"].includes(a.name)&&this.imageSpec.toString()===a.metadata.image_spec,(a,s)=>a.name===s.metadata.snapshot_name,this.builders)}ngOnChanges(){this.columns&&(this.imageSpec=new x.J(this.poolName,this.namespace,this.rbdName),this.rbdTableActions&&(this.rbdTableActions.featuresName=this.featuresName),this.taskListService.fetch())}openSnapshotModal(n,t=null){const o={poolName:this.poolName,imageName:this.rbdName,namespace:this.namespace,mirroring:this.mirroring};this.modalRef=this.cdsModalService.show(Ot,o),t?this.modalRef.setEditing():t=`${this.rbdName}_${$e()().toISOString(!0)}`,this.modalRef.setSnapName(t),this.modalRef.onSubmit.subscribe(a=>{const s=new sn.G;s.name=n,s.metadata={image_spec:this.imageSpec.toString(),snapshot_name:a},this.summaryService.addRunningTask(s)})}openCreateSnapshotModal(){this.openSnapshotModal("rbd/snap/create")}openEditSnapshotModal(){this.openSnapshotModal("rbd/snap/edit",this.selection.first().name)}toggleProtection(){const n=this.selection.first().name,t=this.selection.first().is_protected,o=new E.O;o.name="rbd/snap/edit";const a=new x.J(this.poolName,this.namespace,this.rbdName);o.metadata={image_spec:a.toString(),snapshot_name:n},this.rbdService.protectSnapshot(a,n,!t).toPromise().then(()=>{const s=new sn.G;s.name=o.name,s.metadata=o.metadata,this.summaryService.addRunningTask(s),this.taskManagerService.subscribe(o.name,o.metadata,_=>{this.notificationService.notifyTask(_)})})}_asyncTask(n,t,o){const a=new E.O;a.name=t,a.metadata={image_spec:new x.J(this.poolName,this.namespace,this.rbdName).toString(),snapshot_name:o};const s=new x.J(this.poolName,this.namespace,this.rbdName);this.rbdService[n](s,o).toPromise().then(()=>{const _=new sn.G;_.name=a.name,_.metadata=a.metadata,this.summaryService.addRunningTask(_),this.cdsModalService.dismissAll(),this.taskManagerService.subscribe(_.name,_.metadata,c=>{this.notificationService.notifyTask(c)})}).catch(()=>{this.cdsModalService.stopLoadingSpinner(this.modalRef.snapshotForm)})}rollbackModal(){const n=this.selection.selected[0].name,t=new x.J(this.poolName,this.namespace,this.rbdName).toString(),o={titleText:$localize`RBD snapshot rollback`,buttonText:$localize`Rollback`,bodyTpl:this.rollbackTpl,bodyData:{snapName:`${t}@${n}`},onSubmit:()=>{this._asyncTask("rollbackSnapshot","rbd/snap/rollback",n)}};this.modalRef=this.cdsModalService.show(on.M,o)}deleteSnapshotModal(){const n=this.selection.selected[0].name;this.modalRef=this.cdsModalService.show(re.D,{impact:Jt.r.high,itemDescription:$localize`RBD snapshot`,itemNames:[n],submitAction:()=>this._asyncTask("deleteSnapshot","rbd/snap/delete",n)})}updateSelection(n){this.selection=n}static{this.\u0275fac=function(t){return new(t||Rt)(e.\u0275\u0275directiveInject(X.v),e.\u0275\u0275directiveInject(ye.l),e.\u0275\u0275directiveInject(qe.Q),e.\u0275\u0275directiveInject(z.U),e.\u0275\u0275directiveInject(gn.C),e.\u0275\u0275directiveInject(ze.J),e.\u0275\u0275directiveInject(cr.E),e.\u0275\u0275directiveInject(Se.D),e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(_e.V))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Rt,selectors:[["cd-rbd-snapshot-list"]],viewQuery:function(t,o){if(1&t&&(e.\u0275\u0275viewQuery(Cr,5),e.\u0275\u0275viewQuery(Tr,7)),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.nameTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.rollbackTpl=a.first)}},inputs:{snapshots:"snapshots",featuresName:"featuresName",poolName:"poolName",namespace:"namespace",mirroring:"mirroring",primary:"primary",rbdName:"rbdName"},features:[e.\u0275\u0275ProvidersFeature([Se.D]),e.\u0275\u0275NgOnChangesFeature],decls:4,vars:5,consts:()=>{let n;return n=$localize`:␟5c5331983af566d4ac6a1024d15a3511786a4aa6␟4319929422702564786:You are about to rollback`,[["rollbackTpl",""],n,["columnMode","flex","selectionType","single",3,"updateSelection","data","columns"],[1,"table-actions",3,"permission","selection","tableActions"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-table",2),e.\u0275\u0275listener("updateSelection",function(_){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.updateSelection(_))}),e.\u0275\u0275element(1,"cd-table-actions",3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(2,Fr,5,1,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)}2&t&&(e.\u0275\u0275property("data",o.data)("columns",o.columns),e.\u0275\u0275advance(),e.\u0275\u0275property("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[j.O,de.j],changeDetection:0})}}var Mr=m(15224),hr=m(76139);const Or=["poolConfigurationSourceTpl"];function Rr(i,n){1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275i18nStart(1,4),e.\u0275\u0275element(2,"strong"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementContainerEnd())}function Ir(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span")(1,"span",46),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()()),2&i){const t=n.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t)}}function Nr(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span")(1,"span",47),e.\u0275\u0275i18n(2,25),e.\u0275\u0275elementEnd()()),2&i){e.\u0275\u0275nextContext(3);const t=e.\u0275\u0275reference(1);e.\u0275\u0275advance(),e.\u0275\u0275property("ngbTooltip",t)}}function br(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"dimlessBinary"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.selection.disk_usage)," ")}}function Pr(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span")(1,"span",47),e.\u0275\u0275i18n(2,26),e.\u0275\u0275elementEnd()()),2&i){e.\u0275\u0275nextContext(3);const t=e.\u0275\u0275reference(1);e.\u0275\u0275advance(),e.\u0275\u0275property("ngbTooltip",t)}}function Ar(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"dimlessBinary"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.selection.total_disk_usage)," ")}}function vr(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1("/",t.selection.parent.pool_namespace,"")}}function Dr(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275template(2,vr,2,1,"span",30),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t.selection.parent.pool_name),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.selection.parent.pool_namespace),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate2("/",t.selection.parent.image_name,"@",t.selection.parent.snap_name,"")}}function Lr(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1,"-"),e.\u0275\u0275elementEnd())}function yr(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"table",39)(1,"tbody")(2,"tr",40)(3,"td",41),e.\u0275\u0275i18n(4,9),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"td",42),e.\u0275\u0275text(6),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(7,"tr",40)(8,"td",43),e.\u0275\u0275i18n(9,10),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"td"),e.\u0275\u0275text(11),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(12,"tr",40)(13,"td",44),e.\u0275\u0275i18n(14,11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"td"),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"empty"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(18,"tr",40)(19,"td",44),e.\u0275\u0275i18n(20,12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"td"),e.\u0275\u0275text(22),e.\u0275\u0275pipe(23,"cdDate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(24,"tr",40)(25,"td",44),e.\u0275\u0275i18n(26,13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(27,"td"),e.\u0275\u0275text(28),e.\u0275\u0275pipe(29,"dimlessBinary"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(30,"tr",40)(31,"td",44),e.\u0275\u0275i18n(32,14),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(33,"td"),e.\u0275\u0275text(34),e.\u0275\u0275pipe(35,"dimless"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(36,"tr",40)(37,"td",44),e.\u0275\u0275i18n(38,15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(39,"td"),e.\u0275\u0275text(40),e.\u0275\u0275pipe(41,"dimlessBinary"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(42,"tr",40)(43,"td",44),e.\u0275\u0275i18n(44,16),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(45,"td"),e.\u0275\u0275template(46,Ir,3,1,"span",45),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(47,"tr",40)(48,"td",44),e.\u0275\u0275i18n(49,17),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(50,"td"),e.\u0275\u0275template(51,Nr,3,1,"span",30)(52,br,3,3,"span",30),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(53,"tr",40)(54,"td",44),e.\u0275\u0275i18n(55,18),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(56,"td"),e.\u0275\u0275template(57,Pr,3,1,"span",30)(58,Ar,3,3,"span",30),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(59,"tr",40)(60,"td",44),e.\u0275\u0275i18n(61,19),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(62,"td"),e.\u0275\u0275text(63),e.\u0275\u0275pipe(64,"dimlessBinary"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(65,"tr",40)(66,"td",44),e.\u0275\u0275i18n(67,20),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(68,"td"),e.\u0275\u0275text(69),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(70,"tr",40)(71,"td",44),e.\u0275\u0275i18n(72,21),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(73,"td"),e.\u0275\u0275template(74,Dr,4,4,"span",30)(75,Lr,2,0,"span",30),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(76,"tr",40)(77,"td",44),e.\u0275\u0275i18n(78,22),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(79,"td"),e.\u0275\u0275text(80),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(81,"tr",40)(82,"td",44),e.\u0275\u0275i18n(83,23),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(84,"td"),e.\u0275\u0275text(85),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(86,"tr",40)(87,"td",44),e.\u0275\u0275i18n(88,24),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(89,"td"),e.\u0275\u0275text(90),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(t.selection.name),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(t.selection.pool_name),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,19,t.selection.data_pool)),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(23,21,t.selection.timestamp)),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(29,23,t.selection.size)),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(35,25,t.selection.num_objs)),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(41,27,t.selection.obj_size)),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",t.selection.features_name),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",-1===(null==t.selection.features_name?null:t.selection.features_name.indexOf("fast-diff"))),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",-1!==(null==t.selection.features_name?null:t.selection.features_name.indexOf("fast-diff"))),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",-1===(null==t.selection.features_name?null:t.selection.features_name.indexOf("fast-diff"))),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",-1!==(null==t.selection.features_name?null:t.selection.features_name.indexOf("fast-diff"))),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(64,29,t.selection.stripe_unit)),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(t.selection.stripe_count),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",t.selection.parent),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!t.selection.parent),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(t.selection.block_name_prefix),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(t.selection.order),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(t.selection.image_format)}}function $r(i,n){if(1&i&&e.\u0275\u0275element(0,"cd-rbd-snapshot-list",48),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("snapshots",t.selection.snapshots)("featuresName",t.selection.features_name)("poolName",t.selection.pool_name)("primary",t.selection.primary)("namespace",t.selection.namespace)("mirroring",t.selection.mirror_mode)("rbdName",t.selection.name)}}function Br(i,n){if(1&i&&e.\u0275\u0275element(0,"cd-rbd-configuration-table",49),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("data",t.selection.configuration)}}function Gr(i,n){if(1&i&&e.\u0275\u0275element(0,"cd-grafana",50),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("grafanaPath",t.rbdDashboardUrl)("type","metrics")}}function xr(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"nav",31,2),e.\u0275\u0275elementContainerStart(3,32),e.\u0275\u0275elementStart(4,"a",33),e.\u0275\u0275i18n(5,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(6,yr,91,31,"ng-template",34),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(7,35),e.\u0275\u0275elementStart(8,"a",33),e.\u0275\u0275i18n(9,6),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(10,$r,1,7,"ng-template",34),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(11,36),e.\u0275\u0275elementStart(12,"a",33),e.\u0275\u0275i18n(13,7),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(14,Br,1,1,"ng-template",34),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(15,37),e.\u0275\u0275elementStart(16,"a",33),e.\u0275\u0275i18n(17,8),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(18,Gr,1,2,"ng-template",34),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(19,"div",38),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275reference(2);e.\u0275\u0275advance(19),e.\u0275\u0275property("ngbNavOutlet",t)}}function wr(i,n){1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"cd-alert-panel",51),e.\u0275\u0275i18n(2,27),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd())}function Vr(i,n){1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"strong",53),e.\u0275\u0275i18n(2,28),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd())}function Hr(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",54),e.\u0275\u0275i18n(1,29),e.\u0275\u0275elementEnd())}function kr(i,n){if(1&i&&e.\u0275\u0275template(0,Vr,3,0,"ng-container",52)(1,Hr,2,0,"ng-template",null,3,e.\u0275\u0275templateRefExtractor),2&i){const t=n.data.value,o=e.\u0275\u0275reference(2);e.\u0275\u0275property("ngIf",+t)("ngIfElse",o)}}class It{ngOnChanges(){this.selection&&(this.rbdDashboardUrl=`rbd-details?var-pool=${this.selection.pool_name}&var-image=${this.selection.name}`)}static{this.\u0275fac=function(t){return new(t||It)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:It,selectors:[["cd-rbd-details"]],viewQuery:function(t,o){if(1&t&&(e.\u0275\u0275viewQuery(Or,7),e.\u0275\u0275viewQuery(P.NgbNav,7)),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.poolConfigurationSourceTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.nav=a.first)}},inputs:{selection:"selection",images:"images"},features:[e.\u0275\u0275NgOnChangesFeature],decls:6,vars:2,consts:()=>{let n,t,o,a,s,_,c,p,g,T,C,I,D,G,w,ne,oe,ie,k,ge,N,Oe,Re,Ie,Ne,be,Pe,Ae,ve;return n=$localize`:␟0f6e8f6094b180eaf1f11bc0ffe383f1cdcd059e␟6020859631108226316:Only available for RBD images with ${"\ufffd#2\ufffd"}:START_TAG_STRONG:fast-diff${"\ufffd/#2\ufffd"}:CLOSE_TAG_STRONG: enabled`,t=$localize`:␟4f8b2bb476981727ab34ed40fde1218361f92c45␟5028777105388019087:Details`,o=$localize`:␟f21b1d17b6c5042bb5805516eee37fde33739dd8␟633791246656795624:Snapshots`,a=$localize`:␟4a41f824a35ba01d5bd7be61aa06b3e8145209d0␟3008420115644088420:Configuration`,s=$localize`:␟3cc9c2ae277393b3946b38c088dabff671b1ee1b␟1322586333669103999:Performance`,_=$localize`:␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,c=$localize`:␟e70fcca5a99575cffef3ff8cbd5e69f06ffd0f1c␟7101197021456818771:Pool`,p=$localize`:␟03cc5b14b0a20d075e9009ff021f4f1660ba348a␟6723409555790866872:Data Pool`,g=$localize`:␟1b051734b0ee9021991c91b3ed4e81c244322462␟4207916966377787111:Created`,T=$localize`:␟7faaaa08f56427999f3be41df1093ce4089bbd75␟45739481977493163:Size`,C=$localize`:␟afdb601c16162f2c798b16a2920955f1cc6a20aa␟7531602241051125940:Objects`,I=$localize`:␟ceac8e132384322ec778ba760875a6c6897d3e42␟1194977199378511591:Object size`,D=$localize`:␟6cdb1fea93d77c07950c0c76c6e0ad79ebbef084␟6599364831830861985:Features`,G=$localize`:␟0a65771c9a73b9aa609d592fc96a64801a8f40bd␟178418048502923560:Provisioned`,w=$localize`:␟e5c009342a4e8381f64341d0bb61c2e4685f5a4b␟7638291694671392137:Total provisioned`,ne=$localize`:␟7f6bf8a43ae415f527ac961ea62471b983aaa97b␟1800097309964848809:Striping unit`,oe=$localize`:␟db710e8a8f011923f2d15d713fbae49c38b02b26␟687809034918250111:Striping count`,ie=$localize`:␟3a4c2a9e76634ff14a60d52a718296f722d47c67␟8621797738551294959:Parent`,k=$localize`:␟6a209e68d78ffc2cc9c53d2e76158624efab71ad␟4007496790154046990:Block name prefix`,ge=$localize`:␟5704ec2049d007c5f5fb495a5d8b607e68d58081␟220550782947016929:Order`,N=$localize`:␟984cb6ad70f150a401b4daf841bd3cd957412699␟3794302445743744096:Format Version`,Oe=$localize`:␟84a36cb75660b736773fe36ffa3d54f0f0fe363e␟6811901802533648897:N/A`,Re=$localize`:␟84a36cb75660b736773fe36ffa3d54f0f0fe363e␟6811901802533648897:N/A`,Ie=$localize`:␟9d133466c6f54db7f6d1327ef8baa3068c7b8ae3␟2739698594663437434:RBD details`,Ne=$localize`:␟935bb9cb0e4340fc74d33caa3b70d9d143fcad87␟6907626059040112763:Information can not be displayed for RBD in status 'Removing'.`,be=$localize`:␟58e58f1a8786da9031a05e6770c5dafce82badf5␟1742222667041334221:This setting overrides the global value`,Pe=$localize`:␟a5f9ba9bb9faa8284bcadb1cdbc6aaf969e9c4bb␟3012906865384504293:Image`,Ae=$localize`:␟36b46714164964c6258b08ed0a25f57d8a950f92␟6985012125929874856:This is the global value. No value for this option has been set for this image.`,ve=$localize`:␟5decb3917d46a9ac6e5813699801becb7c3c1455␟3437679369074503203:Global`,[["usageNotAvailableTooltipTpl",""],["poolConfigurationSourceTpl",""],["nav","ngbNav"],["global",""],n,t,o,a,s,_,c,p,g,T,C,I,D,G,w,ne,oe,ie,k,ge,N,Oe,Re,Ne,Pe,ve,[4,"ngIf"],["ngbNav","","cdStatefulTab","rbd-details",1,"nav-tabs"],["ngbNavItem","details"],["ngbNavLink",""],["ngbNavContent",""],["ngbNavItem","snapshots"],["ngbNavItem","configuration"],["ngbNavItem","performance"],[3,"ngbNavOutlet"],["data-testid","rbd-details-table",1,"cds--data-table--sort","cds--data-table--no-border","cds--data-table","cds--data-table--md"],["cdstablerow",""],["cdstabledata","",1,"bold","w-25"],[1,"w-75"],["cdstabledata","",1,"bold"],[1,"bold"],[4,"ngFor","ngForOf"],[1,"badge","badge-dark","me-2"],["placement","top",1,"form-text","text-muted",3,"ngbTooltip"],[3,"snapshots","featuresName","poolName","primary","namespace","mirroring","rbdName"],[3,"data"],["title",Ie,"uid","YhCYGcuZz","grafanaStyle","one",3,"grafanaPath","type"],["type","warning"],[4,"ngIf","ngIfElse"],["ngbTooltip",be],["ngbTooltip",Ae]]},template:function(t,o){1&t&&e.\u0275\u0275template(0,Rr,3,0,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)(2,xr,20,1,"ng-container",30)(3,wr,3,0,"ng-container",30)(4,kr,3,2,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),2&t&&(e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",o.selection&&"REMOVING"!==o.selection.source),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.selection&&"REMOVING"===o.selection.source))},dependencies:[l.NgForOf,l.NgIf,P.NgbNavContent,P.NgbNav,P.NgbNavItem,P.NgbNavLink,P.NgbNavLinkBase,P.NgbNavOutlet,P.NgbTooltip,ht.c,we.m,Wt.B,Rt,Mr.k,ye.l,Yt.u,qe.Q,hr.y]})}}const Nt=()=>({exact:!0});function Kr(i,n){1&i&&(e.\u0275\u0275elementStart(0,"li",5)(1,"a",10),e.\u0275\u0275i18n(2,3),e.\u0275\u0275elementEnd()()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275property("routerLinkActiveOptions",e.\u0275\u0275pureFunction0(1,Nt)))}class Be{constructor(n){this.authStorageService=n,this.grafanaPermission=this.authStorageService.getPermissions().grafana}static{this.\u0275fac=function(t){return new(t||Be)(e.\u0275\u0275directiveInject(X.v))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Be,selectors:[["cd-rbd-tabs"]],decls:11,vars:7,consts:()=>{let n,t,o,a;return n=$localize`:␟b73f7f5060fb22a1e9ec462b1bb02493fa3ab866␟414887388288176527:Images`,t=$localize`:␟c3a7e364a88ea4673199dfa98bc73e6dbe09dfac␟7060498773332878646:Namespaces`,o=$localize`:␟aba82bfd8e177d35b76cad7cd43941f8e5e5acac␟3418677553313974490:Trash`,a=$localize`:␟5e7f4b1ca49e8d217bd0e12c6f7d6b6a2ade2c18␟4352555506458562289:Overall Performance`,[n,t,o,a,[1,"nav","nav-tabs"],[1,"nav-item"],["routerLink","/block/rbd","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link",3,"routerLinkActiveOptions"],["routerLink","/block/rbd/namespaces","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link",3,"routerLinkActiveOptions"],["routerLink","/block/rbd/trash","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link",3,"routerLinkActiveOptions"],["class","nav-item",4,"ngIf"],["routerLink","/block/rbd/performance","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link",3,"routerLinkActiveOptions"]]},template:function(t,o){1&t&&(e.\u0275\u0275elementStart(0,"ul",4)(1,"li",5)(2,"a",6),e.\u0275\u0275i18n(3,0),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"li",5)(5,"a",7),e.\u0275\u0275i18n(6,1),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(7,"li",5)(8,"a",8),e.\u0275\u0275i18n(9,2),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(10,Kr,3,2,"li",9),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLinkActiveOptions",e.\u0275\u0275pureFunction0(4,Nt)),e.\u0275\u0275advance(3),e.\u0275\u0275property("routerLinkActiveOptions",e.\u0275\u0275pureFunction0(5,Nt)),e.\u0275\u0275advance(3),e.\u0275\u0275property("routerLinkActiveOptions",e.\u0275\u0275pureFunction0(6,Nt)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",o.grafanaPermission.read))},dependencies:[l.NgIf,v.RouterLink,v.RouterLinkActive]})}}const zr=["usageTpl"],Xr=["parentTpl"],Ur=["nameTpl"],jr=["ScheduleTpl"],qr=["mirroringTpl"],Qr=["flattenTpl"],Yr=["deleteTpl"],Wr=["removingStatTpl"],Jr=["forcePromoteConfirmation"],Zr=["usedTmpl"],el=["totalUsedTmpl"],tl=["imageUsageTpl"],nl=(i,n)=>[i,n];function ol(i,n){if(1&i&&e.\u0275\u0275element(0,"cd-rbd-details",20),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("selection",t.expandedRow)}}function il(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(2).data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1("/",t.pool_namespace,"")}}function al(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275template(2,il,2,1,"span",21),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t.pool_name),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.pool_namespace),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate2("/",t.image_name,"@",t.snap_name,"")}}function sl(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1,"-"),e.\u0275\u0275elementEnd())}function rl(i,n){if(1&i&&e.\u0275\u0275template(0,al,4,4,"span",21)(1,sl,2,0,"span",21),2&i){const t=n.data.value;e.\u0275\u0275property("ngIf",t),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!t)}}function ll(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span",24),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t[0])}}function _l(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span",24),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t[1])}}function cl(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",24),e.\u0275\u0275i18n(1,12),e.\u0275\u0275elementEnd())}function dl(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",24),e.\u0275\u0275i18n(1,13),e.\u0275\u0275elementEnd())}function ml(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span",24),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t)}}function pl(i,n){if(1&i&&(e.\u0275\u0275template(0,ll,2,1,"span",22),e.\u0275\u0275text(1,"\xa0 "),e.\u0275\u0275template(2,_l,2,1,"span",23),e.\u0275\u0275text(3,"\xa0 "),e.\u0275\u0275template(4,cl,2,0,"span",23)(5,dl,2,0,"span",23)(6,ml,2,1,"ng-template",null,10,e.\u0275\u0275templateRefExtractor)),2&i){const t=n.data.value,o=n.data.row,a=e.\u0275\u0275reference(7);e.\u0275\u0275property("ngIf",3===(null==t?null:t.length))("ngIfElse",a),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",3===(null==t?null:t.length)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!0===(null==o?null:o.primary)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!1===(null==o?null:o.primary))}}function ul(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span",24),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"cdDate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,t[2]))}}function gl(i,n){if(1&i&&e.\u0275\u0275template(0,ul,3,3,"span",23),2&i){const t=n.data.value;e.\u0275\u0275property("ngIf",3===(null==t?null:t.length))}}function Sl(i,n){if(1&i&&(e.\u0275\u0275text(0," You are about to flatten "),e.\u0275\u0275elementStart(1,"strong"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(3,". "),e.\u0275\u0275element(4,"br")(5,"br"),e.\u0275\u0275text(6," All blocks will be copied from parent "),e.\u0275\u0275elementStart(7,"strong"),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(9," to child "),e.\u0275\u0275elementStart(10,"strong"),e.\u0275\u0275text(11),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(12,".\n")),2&i){const t=n.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.child),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(t.parent),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(t.child)}}function fl(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"li"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=n.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t)}}function El(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"span"),e.\u0275\u0275i18n(2,15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"ul"),e.\u0275\u0275template(4,fl,2,1,"li",27),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext(2).snapshots;e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",t)}}function Cl(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",26)(1,"span"),e.\u0275\u0275i18n(2,14),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"br"),e.\u0275\u0275template(4,El,5,1,"ng-container",21),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().snapshots;e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",t.length>0)}}function Tl(i,n){if(1&i&&e.\u0275\u0275template(0,Cl,5,1,"div",25),2&i){const t=n.hasSnapshots;e.\u0275\u0275property("ngIf",t)}}function Fl(i,n){if(1&i&&e.\u0275\u0275element(0,"i",29),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction2(1,nl,t.icons.spinner,t.icons.spin))}}function Ml(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span",29),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(),o=t.data.column,a=t.data.row;e.\u0275\u0275property("ngClass",null!=o&&null!=o.customTemplateConfig&&o.customTemplateConfig.executingClass?o.customTemplateConfig.executingClass:"text-muted italic"),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" (",a.cdExecuting,") ")}}function hl(i,n){if(1&i&&(e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(0,"svg",31)),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("cdsIcon",t.icons.warning)("size",t.icons.size16)}}function Ol(i,n){if(1&i&&(e.\u0275\u0275template(0,Fl,1,4,"i",28),e.\u0275\u0275elementStart(1,"span",29),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,Ml,2,2,"span",28)(4,hl,1,2,"svg",30)),2&i){const t=n.data.column,o=n.data.value,a=n.data.row;e.\u0275\u0275property("ngIf",a.cdExecuting),e.\u0275\u0275advance(),e.\u0275\u0275property("ngClass",null==t||null==t.customTemplateConfig?null:t.customTemplateConfig.valueClass),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",o," "),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",a.cdExecuting),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",a.source&&"REMOVING"===a.source)}}function Rl(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"cd-alert-panel",32),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(2,"div",33),e.\u0275\u0275i18nStart(3,16),e.\u0275\u0275element(4,"strong"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t.errorMessage)}}function Il(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span",35)(1,"span"),e.\u0275\u0275text(2,"-"),e.\u0275\u0275elementEnd()()),2&i){e.\u0275\u0275nextContext(2);const t=e.\u0275\u0275reference(22);e.\u0275\u0275property("ngbTooltip",t)}}function Nl(i,n){if(1&i&&e.\u0275\u0275element(0,"cd-usage-bar",37),2&i){const t=e.\u0275\u0275nextContext(2).data.row;e.\u0275\u0275property("total",t.size)("used",t.disk_usage)("title",t.name)}}function bl(i,n){if(1&i&&e.\u0275\u0275template(0,Nl,1,3,"cd-usage-bar",36),2&i){const t=e.\u0275\u0275nextContext().data.row;e.\u0275\u0275property("ngIf",t)}}function Pl(i,n){if(1&i&&e.\u0275\u0275template(0,Il,3,1,"span",34)(1,bl,1,1,"ng-template",null,11,e.\u0275\u0275templateRefExtractor),2&i){const t=n.data.row,o=e.\u0275\u0275reference(2);e.\u0275\u0275property("ngIf",t.features_name&&(!t.features_name.includes("fast-diff")||"snapshot"===t.mirror_mode))("ngIfElse",o)}}function Al(i,n){1&i&&e.\u0275\u0275element(0,"div",38),2&i&&e.\u0275\u0275property("innerHtml","Only available for RBD images with <strong>fast-diff</strong> enabled and without snapshot mirroring",e.\u0275\u0275sanitizeHtml)}class bt extends jt.D{createRbdFromTaskImageSpec(n){const t=x.J.fromString(n);return this.createRbdFromTask(t.poolName,t.namespace,t.imageName)}createRbdFromTask(n,t,o){const a=new ja;return a.id="-1",a.unique_id="-1",a.name=o,a.namespace=t,a.pool_name=n,a.image_format=je.V2,a}constructor(n,t,o,a,s,_,c,p,g){super(),this.authStorageService=n,this.rbdService=t,this.dimlessBinaryPipe=o,this.dimlessPipe=a,this.taskWrapper=s,this.taskListService=_,this.urlBuilder=c,this.actionLabels=p,this.cdsModalService=g,this.tableStatus=new pn.F("ghost"),this.selection=new le.y,this.icons=F.FI,this.count=0,this.tableContext=null,this.builders={"rbd/create":N=>this.createRbdFromTask(N.pool_name,N.namespace,N.image_name),"rbd/delete":N=>this.createRbdFromTaskImageSpec(N.image_spec),"rbd/clone":N=>this.createRbdFromTask(N.child_pool_name,N.child_namespace,N.child_image_name),"rbd/copy":N=>this.createRbdFromTask(N.dest_pool_name,N.dest_namespace,N.dest_image_name)},this.permission=this.authStorageService.getPermissions().rbdImage;const T=()=>this.selection.first()&&new x.J(this.selection.first().pool_name,this.selection.first().namespace,this.selection.first().name).toStringEncoded(),C={permission:"create",icon:F.FI.add,routerLink:()=>this.urlBuilder.getCreate(),canBePrimary:N=>!N.hasSingleSelection,name:this.actionLabels.CREATE},I={permission:"update",icon:F.FI.edit,routerLink:()=>this.urlBuilder.getEdit(T()),name:this.actionLabels.EDIT,disable:N=>this.getRemovingStatusDesc(N)||this.getInvalidNameDisable(N)},D={permission:"delete",icon:F.FI.destroy,click:()=>this.deleteRbdModal(),name:this.actionLabels.DELETE,title:ee.delete,disable:N=>this.getDeleteDisableDesc(N)},G={permission:"delete",icon:F.FI.trash,title:ee.moveToTrash,click:()=>this.trashRbdModal(),name:this.actionLabels.TRASH,disable:N=>this.getRemovingStatusDesc(N)||this.getInvalidNameDisable(N)||N.first().image_format===je.V1},w={permission:"update",icon:F.FI.refresh,click:()=>this.resyncRbdModal(),name:this.actionLabels.RESYNC,disable:N=>this.getResyncDisableDesc(N)},ne={permission:"create",canBePrimary:N=>N.hasSingleSelection,disable:N=>this.getRemovingStatusDesc(N)||this.getInvalidNameDisable(N)||!!N.first().cdExecuting,icon:F.FI.copy,routerLink:()=>`/block/rbd/copy/${T()}`,name:this.actionLabels.COPY,title:ee.copy},oe={permission:"update",disable:N=>this.getRemovingStatusDesc(N)||this.getInvalidNameDisable(N)||N.first().cdExecuting||!N.first().parent,icon:F.FI.flatten,click:()=>this.flattenRbdModal(),name:this.actionLabels.FLATTEN,title:ee.flatten},ie={permission:"update",icon:F.FI.edit,click:()=>this.removeSchedulingModal(),name:this.actionLabels.REMOVE_SCHEDULING,disable:N=>this.getRemovingStatusDesc(N)||this.getInvalidNameDisable(N)||void 0===N.first().schedule_info},k={permission:"update",icon:F.FI.edit,click:()=>this.actionPrimary(!0),name:this.actionLabels.PROMOTE,visible:()=>null!=this.selection.first()&&!this.selection.first().primary,disable:()=>"Disabled"===this.selection.first().mirror_mode?ee.enableMirroring:""},ge={permission:"update",icon:F.FI.edit,click:()=>this.actionPrimary(!1),name:this.actionLabels.DEMOTE,visible:()=>null!=this.selection.first()&&this.selection.first().primary,disable:()=>"Disabled"===this.selection.first().mirror_mode?ee.enableMirroring:""};this.tableActions=[C,I,ne,oe,w,ie,k,ge,G,D]}ngOnInit(){this.columns=[{name:$localize`Name`,prop:"name",flexGrow:2,cellTemplate:this.removingStatTpl},{name:$localize`Pool`,prop:"pool_name",flexGrow:2},{name:$localize`Namespace`,prop:"namespace",flexGrow:2},{name:$localize`Size`,prop:"size",flexGrow:1,cellClass:"text-right",sortable:!1,pipe:this.dimlessBinaryPipe},{name:$localize`Usage`,prop:"usage",cellTemplate:this.imageUsageTpl,flexGrow:1.5},{name:$localize`Objects`,prop:"num_objs",flexGrow:1,cellClass:"text-right",sortable:!1,pipe:this.dimlessPipe},{name:$localize`Object size`,prop:"obj_size",flexGrow:1,cellClass:"text-right",sortable:!1,pipe:this.dimlessBinaryPipe},{name:$localize`Parent`,prop:"parent",flexGrow:2,sortable:!1,cellTemplate:this.parentTpl},{name:$localize`Mirroring`,prop:"mirror_mode",flexGrow:3,sortable:!1,cellTemplate:this.mirroringTpl},{name:$localize`Next Scheduled Snapshot`,prop:"mirror_mode",flexGrow:3,sortable:!1,cellTemplate:this.ScheduleTpl}];this.taskListService.init(o=>this.getRbdImages(o),o=>this.prepareResponse(o),o=>this.images=o,()=>this.onFetchError(),o=>["rbd/clone","rbd/copy","rbd/create","rbd/delete","rbd/edit","rbd/flatten","rbd/trash/move"].includes(o.name),(o,a)=>{let s;switch(a.name){case"rbd/copy":s=new x.J(a.metadata.dest_pool_name,a.metadata.dest_namespace,a.metadata.dest_image_name).toString();break;case"rbd/clone":s=new x.J(a.metadata.child_pool_name,a.metadata.child_namespace,a.metadata.child_image_name).toString();break;case"rbd/create":s=new x.J(a.metadata.pool_name,a.metadata.namespace,a.metadata.image_name).toString();break;default:s=a.metadata.image_spec}return s===new x.J(o.pool_name,o.namespace,o.name).toString()},this.builders)}onFetchError(){this.table.reset(),this.tableStatus=new pn.F("danger")}getRbdImages(n){return null!==n&&(this.tableContext=n),null==this.tableContext&&(this.tableContext=new H.n(()=>{})),this.rbdService.list(this.tableContext?.toParams())}prepareResponse(n){let t=[];return n.forEach(o=>{t=t.concat(o.value)}),t.forEach(o=>{if(void 0!==o.schedule_info){let a=[];const s="scheduled";let _=+new Date(o.schedule_info.schedule_time);const c=(new Date).getTimezoneOffset();_=(_+6e4*Math.abs(c))/1e3,a.push(o.mirror_mode,s,_),o.mirror_mode=a,a=[]}}),t.length>0?this.count=nr.Z.getCount(n[0]):this.count=0,t}updateSelection(n){this.selection=n}deleteRbdModal(){const n=this.selection.first().pool_name,t=this.selection.first().namespace,o=this.selection.first().name,a=new x.J(n,t,o);this.cdsModalService.show(re.D,{impact:Jt.r.high,itemDescription:"RBD",itemNames:[a.imageName],bodyTemplate:this.deleteTpl,bodyContext:{hasSnapshots:this.hasSnapshots(),snapshots:this.listProtectedSnapshots()},submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/delete",{image_spec:a.toString()}),call:this.rbdService.delete(a)})})}resyncRbdModal(){const n=this.selection.first().pool_name,t=this.selection.first().namespace,o=this.selection.first().name,a=new x.J(n,t,o);this.cdsModalService.show(re.D,{itemDescription:"RBD",itemNames:[a],actionDescription:"resync",submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/edit",{image_spec:a.toString()}),call:this.rbdService.update(a,{resync:!0})})})}trashRbdModal(){const n={poolName:this.selection.first().pool_name,namespace:this.selection.first().namespace,imageName:this.selection.first().name,hasSnapshots:this.hasSnapshots()};this.cdsModalService.show(Mt,n)}flattenRbd(n){this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/flatten",{image_spec:n.toString()}),call:this.rbdService.flatten(n)}).subscribe({complete:()=>{this.cdsModalService.dismissAll()}})}flattenRbdModal(){const n=this.selection.first().pool_name,t=this.selection.first().namespace,o=this.selection.first().name,a=this.selection.first().parent,s=new x.J(a.pool_name,a.pool_namespace,a.image_name),_=new x.J(n,t,o),c={titleText:"RBD flatten",buttonText:"Flatten",bodyTpl:this.flattenTpl,bodyData:{parent:`${s}@${a.snap_name}`,child:_.toString()},onSubmit:()=>{this.flattenRbd(_)}};this.cdsModalService.show(on.M,c)}editRequest(){const n=new tn;return n.remove_scheduling=!n.remove_scheduling,n}removeSchedulingModal(){const n=this.selection.first().name,t=new x.J(this.selection.first().pool_name,this.selection.first().namespace,this.selection.first().name);this.cdsModalService.show(re.D,{actionDescription:"remove scheduling on",itemDescription:$localize`image`,itemNames:[`${n}`],submitActionObservable:()=>new K.Observable(o=>{this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/edit",{image_spec:t.toString()}),call:this.rbdService.update(t,this.editRequest())}).subscribe({error:a=>o.error(a),complete:()=>{this.cdsModalService.dismissAll()}})})})}actionPrimary(n){const t=new tn;t.primary=n,t.features=null;const o=new x.J(this.selection.first().pool_name,this.selection.first().namespace,this.selection.first().name);this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/edit",{image_spec:o.toString()}),call:this.rbdService.update(o,t)}).subscribe(()=>{},a=>{a.preventDefault(),n&&(this.errorMessage=a.error.detail.replace(/\[.*?\]\s*/,""),t.force=!0,this.cdsModalService.show(on.M,{titleText:$localize`Warning`,buttonText:$localize`Enforce`,warning:!0,bodyTpl:this.forcePromoteConfirmation,onSubmit:()=>{this.rbdService.update(o,t).subscribe(()=>{this.cdsModalService.dismissAll()},()=>{this.cdsModalService.dismissAll()})}}))})}hasSnapshots(){return(this.selection.first().snapshots||[]).length>0}hasClonedSnapshots(n){return(n.snapshots||[]).some(o=>o.children&&o.children.length>0)}listProtectedSnapshots(){return this.selection.first().snapshots.reduce((o,a)=>(a.is_protected&&o.push(a.name),o),[])}getDeleteDisableDesc(n){const t=n.first();return t&&this.hasClonedSnapshots(t)?ee.clonedSnapshot:t&&!1===t.primary?ee.secondayImageDelete:this.getInvalidNameDisable(n)||this.hasClonedSnapshots(n.first())||!1===t.primary}getResyncDisableDesc(n){const t=n.first();return t&&this.imageIsPrimary(t)?ee.primaryImageResync:this.getInvalidNameDisable(n)}imageIsPrimary(n){return n.primary}getInvalidNameDisable(n){return n.first()?.name?.match(/[@/]/)?ee.invalidNameDisable:!n.first()||!n.hasSingleSelection}getRemovingStatusDesc(n){return"REMOVING"===n.first()?.source&&ee.removingStatus}static{this.\u0275fac=function(t){return new(t||bt)(e.\u0275\u0275directiveInject(X.v),e.\u0275\u0275directiveInject(z.U),e.\u0275\u0275directiveInject(ye.l),e.\u0275\u0275directiveInject(Yt.u),e.\u0275\u0275directiveInject($.a),e.\u0275\u0275directiveInject(Se.D),e.\u0275\u0275directiveInject(an.E),e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(_e.V))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:bt,selectors:[["cd-rbd-list"]],viewQuery:function(t,o){if(1&t&&(e.\u0275\u0275viewQuery(j.O,7),e.\u0275\u0275viewQuery(zr,5),e.\u0275\u0275viewQuery(Xr,7),e.\u0275\u0275viewQuery(Ur,5),e.\u0275\u0275viewQuery(jr,7),e.\u0275\u0275viewQuery(qr,7),e.\u0275\u0275viewQuery(Qr,7),e.\u0275\u0275viewQuery(Yr,7),e.\u0275\u0275viewQuery(Wr,7),e.\u0275\u0275viewQuery(Jr,7),e.\u0275\u0275viewQuery(Zr,7),e.\u0275\u0275viewQuery(el,7),e.\u0275\u0275viewQuery(tl,7)),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.table=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.usageTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.parentTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.nameTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.ScheduleTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.mirroringTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.flattenTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.deleteTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.removingStatTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.forcePromoteConfirmation=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.usedTmpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.totalUsedTmpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.imageUsageTpl=a.first)}},features:[e.\u0275\u0275ProvidersFeature([Se.D,{provide:an.E,useValue:new an.E("block/rbd")}]),e.\u0275\u0275InheritDefinitionFeature],decls:23,vars:12,consts:()=>{let n,t,o,a,s,_;return n=$localize`:␟15671184234f834e314c40d34c3c0eb5c1e33e99␟6966257120197587982:primary`,t=$localize`:␟d71f8be8ce8ea687594f60743e85fc779970876b␟2093410769944345568:secondary`,o=$localize`:␟c9f1026c1235f4d76ace47449e806efd181ab332␟6216813477472533999:Deleting this image will also delete all its snapshots.`,a=$localize`:␟55f864597e84d9bf88769e1fbfda1d64452430c9␟7253619115563450917:The following snapshots are currently protected and will be removed:`,s=$localize`:␟2e362ec498c4c9112dc47a3cb7d7250ca8e71790␟8252859511015934313:RBD in status 'Removing'`,_=$localize`:␟0c609add8ca113d92adfe964b29a92bf94148882␟2807106004342267637:${"\ufffd#4\ufffd"}:START_TAG_STRONG: Do you want to force the operation? ${"\ufffd/#4\ufffd"}:CLOSE_TAG_STRONG:`,[["table",""],["parentTpl",""],["mirroringTpl",""],["ScheduleTpl",""],["flattenTpl",""],["deleteTpl",""],["removingStatTpl",""],["forcePromoteConfirmation",""],["imageUsageTpl",""],["usageTooltip",""],["probb",""],["usageBar",""],n,t,o,a,_,["columnMode","flex","identifier","unique_id","forceIdentifier","true","selectionType","single",3,"fetchData","setExpandedRow","updateSelection","data","columns","searchableObjects","serverSide","count","hasDetails","status","maxLimit","autoReload"],[1,"table-actions",3,"permission","selection","tableActions"],[3,"selection",4,"cdTableDetail"],[3,"selection"],[4,"ngIf"],["class","badge badge-info",4,"ngIf","ngIfElse"],["class","badge badge-info",4,"ngIf"],[1,"badge","badge-info"],["class","alert alert-warning","role","alert",4,"ngIf"],["role","alert",1,"alert","alert-warning"],[4,"ngFor","ngForOf"],[3,"ngClass",4,"ngIf"],[3,"ngClass"],["title",s,"class","cds-warning-color",3,"cdsIcon","size",4,"ngIf"],["title",s,1,"cds-warning-color",3,"cdsIcon","size"],["type","warning"],[1,"m-4"],[3,"ngbTooltip",4,"ngIf","ngIfElse"],[3,"ngbTooltip"],["decimals","2",3,"total","used","title",4,"ngIf"],["decimals","2",3,"total","used","title"],[3,"innerHtml"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275element(0,"cd-rbd-tabs"),e.\u0275\u0275elementStart(1,"cd-table",17,0),e.\u0275\u0275listener("fetchData",function(_){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.taskListService.fetch(_))})("setExpandedRow",function(_){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.setExpandedRow(_))})("updateSelection",function(_){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.updateSelection(_))}),e.\u0275\u0275element(3,"cd-table-actions",18),e.\u0275\u0275template(4,ol,1,1,"cd-rbd-details",19),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,rl,2,2,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)(7,pl,8,5,"ng-template",null,2,e.\u0275\u0275templateRefExtractor)(9,gl,1,1,"ng-template",null,3,e.\u0275\u0275templateRefExtractor)(11,Sl,13,3,"ng-template",null,4,e.\u0275\u0275templateRefExtractor)(13,Tl,1,1,"ng-template",null,5,e.\u0275\u0275templateRefExtractor)(15,Ol,5,5,"ng-template",null,6,e.\u0275\u0275templateRefExtractor)(17,Rl,5,1,"ng-template",null,7,e.\u0275\u0275templateRefExtractor)(19,Pl,3,2,"ng-template",null,8,e.\u0275\u0275templateRefExtractor)(21,Al,1,1,"ng-template",null,9,e.\u0275\u0275templateRefExtractor)}2&t&&(e.\u0275\u0275advance(),e.\u0275\u0275property("data",o.images)("columns",o.columns)("searchableObjects",!0)("serverSide",!0)("count",o.count)("hasDetails",!0)("status",o.tableStatus)("maxLimit",25)("autoReload",-1),e.\u0275\u0275advance(2),e.\u0275\u0275property("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[l.NgClass,l.NgForOf,l.NgIf,P.NgbTooltip,_r.o,we.m,j.O,de.j,Qt.N,d.IconDirective,It,Be,qe.Q],styles:[".warn[_ngcontent-%COMP%]{color:#d48200}"]})}}function Dl(i,n){1&i&&(e.\u0275\u0275i18nStart(0,5,1),e.\u0275\u0275element(1,"option",22),e.\u0275\u0275i18nEnd()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275property("ngValue",null))}function Ll(i,n){1&i&&(e.\u0275\u0275i18nStart(0,5,2),e.\u0275\u0275element(1,"option",22),e.\u0275\u0275i18nEnd()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275property("ngValue",null))}function yl(i,n){1&i&&(e.\u0275\u0275i18nStart(0,5,3),e.\u0275\u0275element(1,"option",22),e.\u0275\u0275i18nEnd()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275property("ngValue",null))}function $l(i,n){if(1&i&&(e.\u0275\u0275i18nStart(0,5,4),e.\u0275\u0275element(1,"option",23),e.\u0275\u0275i18nEnd()),2&i){const t=n.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275property("value",t.pool_name),e.\u0275\u0275i18nExp(t.pool_name),e.\u0275\u0275i18nApply(0)}}function Bl(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"cds-select",19),e.\u0275\u0275i18nStart(1,5),e.\u0275\u0275template(2,Dl,2,1,"option",20)(3,Ll,2,1,"option",20)(4,yl,2,1,"option",20)(5,$l,2,2,"option",21),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(10);e.\u0275\u0275property("invalid",t.namespaceForm.controls.pool.invalid&&t.namespaceForm.controls.pool.dirty)("invalidText",o),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",null===t.pools),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null!==t.pools&&0===t.pools.length),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null!==t.pools&&t.pools.length>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",t.pools)}}function Gl(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",25),e.\u0275\u0275i18n(1,6),e.\u0275\u0275elementEnd())}function xl(i,n){if(1&i&&e.\u0275\u0275template(0,Gl,2,0,"span",24),2&i){const t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.namespaceForm.showError("pool",o,"required"))}}function wl(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",25),e.\u0275\u0275i18n(1,7),e.\u0275\u0275elementEnd())}function Vl(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",25),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd())}function Hl(i,n){if(1&i&&e.\u0275\u0275template(0,wl,2,0,"span",24)(1,Vl,2,0,"span",24),2&i){const t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(6);e.\u0275\u0275property("ngIf",t.namespaceForm.showError("namespace",o,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.namespaceForm.showError("namespace",o,"namespaceExists"))}}class Pt extends d.BaseModal{constructor(n,t,o,a,s,_){super(),this.actionLabels=n,this.authStorageService=t,this.notificationService=o,this.poolService=a,this.rbdService=s,this.modalService=_,this.pools=null,this.editing=!1,this.onSubmit=new K.Subject,this.poolPermission=this.authStorageService.getPermissions().pool,this.createForm()}createForm(){this.namespaceForm=new V.$({pool:new r.UntypedFormControl(""),namespace:new r.UntypedFormControl("")},this.validator(),this.asyncValidator())}validator(){return n=>{const t=n.get("pool"),o=n.get("namespace");let a=null;t.value||(a={required:!0}),t.setErrors(a);let s=null;return o.value||(s={required:!0}),o.setErrors(s),null}}asyncValidator(){return n=>new Promise(t=>{const o=n.get("pool"),a=n.get("namespace");this.rbdService.listNamespaces(o.value).subscribe(s=>{if(s.some(_=>_.namespace===a.value)){const _={namespaceExists:!0};a.setErrors(_),t(_)}else t(null)})})}ngOnInit(){this.poolPermission.read&&this.poolService.list(["pool_name","type","application_metadata"]).then(n=>{const t=[];for(const o of n)this.rbdService.isRBDPool(o)&&"replicated"===o.type&&t.push(o);if(this.pools=t,1===this.pools.length){const o=this.pools[0].pool_name;this.namespaceForm.get("pool").setValue(o)}})}submit(){const n=this.namespaceForm.getValue("pool"),t=this.namespaceForm.getValue("namespace"),o=new E.O;o.name="rbd/namespace/create",o.metadata={pool:n,namespace:t},this.rbdService.createNamespace(n,t).toPromise().then(()=>{this.modalService.destroy(),this.notificationService.show(qt._.success,$localize`Created namespace '${n}/${t}'`),this.onSubmit.next()}).catch(()=>{this.namespaceForm.setErrors({cdSubmitButton:!0})})}static{this.\u0275fac=function(t){return new(t||Pt)(e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(X.v),e.\u0275\u0275directiveInject(ze.J),e.\u0275\u0275directiveInject(Ue.m),e.\u0275\u0275directiveInject(z.U),e.\u0275\u0275directiveInject(d.ModalService))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Pt,selectors:[["cd-rbd-namespace-form-modal"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:18,vars:10,consts:()=>{let n,t,o,a,s,_;return n=$localize`:␟2f653b9da30427811c4723bde845f195ee5b76e6␟7612300699873104241: Create Namespace `,t=$localize`:␟657d1282882639b24623891a28fc8efee6e79794␟9044490407357067056:Namespace ${"\ufffd#14\ufffd\ufffd/#14\ufffd"}:TAG_INPUT:`,o=$localize`:␟f0acabfef190a269d8ba370cd72aab31c641e08c␟8995904351657418493:${"\ufffd*2:1\ufffd\ufffd#1:1\ufffd"}:START_TAG_OPTION:Loading...${"[\ufffd/#1:1\ufffd\ufffd/*2:1\ufffd|\ufffd/#1:2\ufffd\ufffd/*3:2\ufffd|\ufffd/#1:3\ufffd\ufffd/*4:3\ufffd|\ufffd/#1:4\ufffd\ufffd/*5:4\ufffd]"}:CLOSE_TAG_OPTION:${"\ufffd*3:2\ufffd\ufffd#1:2\ufffd"}:START_TAG_OPTION_1:-- No rbd pools available --${"[\ufffd/#1:1\ufffd\ufffd/*2:1\ufffd|\ufffd/#1:2\ufffd\ufffd/*3:2\ufffd|\ufffd/#1:3\ufffd\ufffd/*4:3\ufffd|\ufffd/#1:4\ufffd\ufffd/*5:4\ufffd]"}:CLOSE_TAG_OPTION:${"\ufffd*4:3\ufffd\ufffd#1:3\ufffd"}:START_TAG_OPTION_2:-- Select a pool --${"[\ufffd/#1:1\ufffd\ufffd/*2:1\ufffd|\ufffd/#1:2\ufffd\ufffd/*3:2\ufffd|\ufffd/#1:3\ufffd\ufffd/*4:3\ufffd|\ufffd/#1:4\ufffd\ufffd/*5:4\ufffd]"}:CLOSE_TAG_OPTION:${"\ufffd*5:4\ufffd\ufffd#1:4\ufffd"}:START_TAG_OPTION_3:${"\ufffd0:4\ufffd"}:INTERPOLATION:${"[\ufffd/#1:1\ufffd\ufffd/*2:1\ufffd|\ufffd/#1:2\ufffd\ufffd/*3:2\ufffd|\ufffd/#1:3\ufffd\ufffd/*4:3\ufffd|\ufffd/#1:4\ufffd\ufffd/*5:4\ufffd]"}:CLOSE_TAG_OPTION:`,o=e.\u0275\u0275i18nPostprocess(o),a=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,s=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,_=$localize`:␟7ef102389b17e38d78dd3c66cf6dded31d0e4270␟2176864336573847798:The namespace already exists.`,[["formDir","ngForm"],["poolError",""],["namespaceError",""],n,t,o,a,s,_,["size","md",3,"overlaySelected","open","hasScrollingContent"],[3,"closeSelect"],["cdsModalHeaderHeading",""],["cdsModalContent",""],["name","namespaceForm","novalidate","",3,"formGroup"],[1,"form-item"],["label","Pool","for","pool","formControlName","pool","name","pool","id","pool","cdRequiredField","Pool","modal-primary-focus","",3,"invalid","invalidText",4,"ngIf"],["label","Name","for","namespace","cdRequiredField","Namespace",3,"invalid","invalidText"],["cdsText","","type","text","placeholder","Namespace name...","id","namespace","name","namespace","formControlName","namespace","autofocus","",3,"invalid"],[3,"submitActionEvent","form","submitText","modalForm"],["label","Pool","for","pool","formControlName","pool","name","pool","id","pool","cdRequiredField","Pool","modal-primary-focus","",3,"invalid","invalidText"],[3,"ngValue",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[3,"ngValue"],[3,"value"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-modal",9),e.\u0275\u0275listener("overlaySelected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(1,"cds-modal-header",10),e.\u0275\u0275listener("closeSelect",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(2,"h3",11),e.\u0275\u0275i18n(3,3),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"section",12)(5,"form",13,0)(7,"div",14),e.\u0275\u0275template(8,Bl,6,6,"cds-select",15)(9,xl,1,1,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"div",14)(12,"cds-text-label",16),e.\u0275\u0275i18nStart(13,4),e.\u0275\u0275element(14,"input",17),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(15,Hl,2,2,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(17,"cd-form-button-panel",18),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.submit())}),e.\u0275\u0275elementEnd()()}if(2&t){const a=e.\u0275\u0275reference(16);e.\u0275\u0275property("open",o.open)("hasScrollingContent",!0),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",o.namespaceForm),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",o.poolPermission.read),e.\u0275\u0275advance(4),e.\u0275\u0275property("invalid",o.namespaceForm.controls.namespace.invalid&&o.namespaceForm.controls.namespace.dirty)("invalidText",a),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.namespaceForm.controls.namespace.invalid&&o.namespaceForm.controls.namespace.dirty),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.namespaceForm)("submitText",o.actionLabels.CREATE)("modalForm",!0)}},dependencies:[l.NgForOf,l.NgIf,r.\u0275NgNoValidate,r.NgSelectOption,r.\u0275NgSelectMultipleOption,r.DefaultValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.FormGroupDirective,r.FormControlName,A.e,Le.B,f.S,R.E,Me.P,d.TextInputLabelComponent,d.TextInput,d.Select,d.Option,d.Modal,d.ModalHeader,d.ModalContent,d.ModalHeaderHeading]})}}class At{constructor(n,t,o,a,s,_){this.authStorageService=n,this.rbdService=t,this.poolService=o,this.notificationService=a,this.actionLabels=s,this.cdsModalService=_,this.selection=new le.y,this.permission=this.authStorageService.getPermissions().rbdImage;const c={permission:"create",icon:F.FI.add,click:()=>this.createModal(),name:this.actionLabels.CREATE},p={permission:"delete",icon:F.FI.destroy,click:()=>this.deleteModal(),name:this.actionLabels.DELETE,disable:()=>this.getDeleteDisableDesc()};this.tableActions=[c,p]}ngOnInit(){this.columns=[{name:$localize`Namespace`,prop:"namespace",flexGrow:1},{name:$localize`Pool`,prop:"pool",flexGrow:1},{name:$localize`Total images`,prop:"num_images",flexGrow:1}],this.refresh()}refresh(){this.poolService.list(["pool_name","type","application_metadata"]).then(n=>{n=n.filter(o=>this.rbdService.isRBDPool(o)&&"replicated"===o.type);const t=[];n.forEach(o=>{t.push(this.rbdService.listNamespaces(o.pool_name))}),t.length>0?(0,K.forkJoin)(t).subscribe(o=>{const a=[];for(let s=0;s<o.length;s++){const _=o[s],c=n[s].pool_name;_.forEach(p=>{a.push({id:`${c}/${p.namespace}`,pool:c,namespace:p.namespace,num_images:p.num_images})})}this.namespaces=a}):this.namespaces=[]})}updateSelection(n){this.selection=n}createModal(){this.cdsModalService.show(Pt).onSubmit?.subscribe(()=>this.refresh())}deleteModal(){const n=this.selection.first().pool,t=this.selection.first().namespace,o=this.cdsModalService.show(re.D,{itemDescription:"Namespace",itemNames:[`${n}/${t}`],submitAction:()=>this.rbdService.deleteNamespace(n,t).subscribe(()=>{this.notificationService.show(qt._.success,$localize`Deleted namespace '${n}/${t}'`),this.cdsModalService.dismissAll(),this.refresh()},()=>{this.cdsModalService.stopLoadingSpinner(o.deletionForm)})})}getDeleteDisableDesc(){return this.selection.first()?.num_images>0?$localize`Namespace contains images`:!this.selection?.first()}static{this.\u0275fac=function(t){return new(t||At)(e.\u0275\u0275directiveInject(X.v),e.\u0275\u0275directiveInject(z.U),e.\u0275\u0275directiveInject(Ue.m),e.\u0275\u0275directiveInject(ze.J),e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(_e.V))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:At,selectors:[["cd-rbd-namespace-list"]],features:[e.\u0275\u0275ProvidersFeature([Se.D])],decls:4,vars:5,consts:[["columnMode","flex","identifier","id","forceIdentifier","true","selectionType","single",3,"fetchData","updateSelection","data","columns"],[1,"table-actions"],[1,"btn-group",3,"permission","selection","tableActions"]],template:function(t,o){1&t&&(e.\u0275\u0275element(0,"cd-rbd-tabs"),e.\u0275\u0275elementStart(1,"cd-table",0),e.\u0275\u0275listener("fetchData",function(){return o.refresh()})("updateSelection",function(s){return o.updateSelection(s)}),e.\u0275\u0275elementStart(2,"div",1),e.\u0275\u0275element(3,"cd-table-actions",2),e.\u0275\u0275elementEnd()()),2&t&&(e.\u0275\u0275advance(),e.\u0275\u0275property("data",o.namespaces)("columns",o.columns),e.\u0275\u0275advance(2),e.\u0275\u0275property("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[j.O,de.j,Be]})}}class vt{static{this.\u0275fac=function(t){return new(t||vt)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:vt,selectors:[["cd-rbd-performance"]],decls:2,vars:2,consts:()=>{let n;return n=$localize`:␟656c9b074bbd3a26186f7ce54ba309a3f0bbfd2f␟6298915973855995368:RBD overview`,[["title",n,"uid","41FrpeUiz","grafanaStyle","two",3,"grafanaPath","type"]]},template:function(t,o){1&t&&e.\u0275\u0275element(0,"cd-rbd-tabs")(1,"cd-grafana",0),2&t&&(e.\u0275\u0275advance(),e.\u0275\u0275property("grafanaPath","rbd-overview?")("type","metrics"))},dependencies:[ht.c,Be]})}}var kl=m(29130);function Kl(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"option",15),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=n.$implicit;e.\u0275\u0275property("value",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t)}}function zl(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"cds-select",12)(1,"option",13),e.\u0275\u0275i18n(2,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,Kl,2,2,"option",14),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.pools)}}class Dt extends d.BaseModal{constructor(n,t,o,a,s,_){super(),this.authStorageService=n,this.rbdService=t,this.actionLabels=o,this.fb=a,this.poolService=s,this.taskWrapper=_,this.poolPermission=this.authStorageService.getPermissions().pool}createForm(){this.purgeForm=this.fb.group({poolName:""})}ngOnInit(){this.poolPermission.read&&this.poolService.list(["pool_name","application_metadata"]).then(n=>{this.pools=n.filter(t=>t.application_metadata.includes("rbd")).map(t=>t.pool_name)}),this.createForm()}purge(){const n=this.purgeForm.getValue("poolName")||"";this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/trash/purge",{pool_name:n}),call:this.rbdService.purgeTrash(n)}).subscribe({error:()=>{this.purgeForm.setErrors({cdSubmitButton:!0})},complete:()=>{this.closeModal()}})}static{this.\u0275fac=function(t){return new(t||Dt)(e.\u0275\u0275directiveInject(X.v),e.\u0275\u0275directiveInject(z.U),e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(Ft.$),e.\u0275\u0275directiveInject(Ue.m),e.\u0275\u0275directiveInject($.a))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Dt,selectors:[["cd-rbd-trash-purge-modal"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:14,vars:7,consts:()=>{let n,t,o;return n=$localize`:␟49c0408946a6d67185947f455f15cc201d0d78e6␟2025285675896024439:Purge Trash`,t=$localize`:␟ca8efb2ea101c26430f53d42608113def842c840␟477643651670320253:To purge, select  ${"[\ufffd#9\ufffd|\ufffd#10\ufffd]"}:START_TAG_KBD:All${"[\ufffd/#9\ufffd|\ufffd/#10\ufffd]"}:CLOSE_TAG_KBD:  or one pool and click  ${"[\ufffd#9\ufffd|\ufffd#10\ufffd]"}:START_TAG_KBD:Purge${"[\ufffd/#9\ufffd|\ufffd/#10\ufffd]"}:CLOSE_TAG_KBD:. `,t=e.\u0275\u0275i18nPostprocess(t),o=$localize`:␟dfc3c34e182ea73c5d784ff7c8135f087992dac1␟1616102757855967475:All`,[["formDir","ngForm"],n,t,o,["size","md",3,"overlaySelected","open","hasScrollingContent"],[3,"closeSelect"],["cdsModalHeaderHeading",""],["cdsModalContent",""],["name","purgeForm","novalidate","",1,"form",3,"formGroup"],[1,"form-item"],["label","Pool","for","poolName","id","poolName","formControlName","poolName",4,"ngIf"],[3,"submitActionEvent","form","submitText","modalForm"],["label","Pool","for","poolName","id","poolName","formControlName","poolName"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-modal",4),e.\u0275\u0275listener("overlaySelected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(1,"cds-modal-header",5),e.\u0275\u0275listener("closeSelect",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(2,"h3",6),e.\u0275\u0275i18n(3,1),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"section",7)(5,"form",8,0)(7,"p"),e.\u0275\u0275i18nStart(8,2),e.\u0275\u0275element(9,"kbd")(10,"kbd"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"div",9),e.\u0275\u0275template(12,zl,4,1,"cds-select",10),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(13,"cd-form-button-panel",11),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.purge())}),e.\u0275\u0275elementEnd()()}2&t&&(e.\u0275\u0275property("open",!0)("hasScrollingContent",!0),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",o.purgeForm),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",o.poolPermission.read),e.\u0275\u0275advance(),e.\u0275\u0275property("form",o.purgeForm)("submitText",o.actionLabels.PURGE)("modalForm",!0))},dependencies:[l.NgForOf,l.NgIf,r.\u0275NgNoValidate,r.NgSelectOption,r.\u0275NgSelectMultipleOption,r.NgControlStatus,r.NgControlStatusGroup,r.FormGroupDirective,r.FormControlName,A.e,R.E,d.Select,d.Option,d.Modal,d.ModalHeader,d.ModalContent,d.ModalHeaderHeading]})}}class Lt extends d.BaseModal{constructor(n,t,o,a,s,_,c,p,g=""){super(),this.rbdService=n,this.actionLabels=t,this.fb=o,this.taskWrapper=a,this.poolName=s,this.namespace=_,this.imageName=c,this.imageId=p,this.imageSpec=g}ngOnInit(){this.imageSpec=new x.J(this.poolName,this.namespace,this.imageName).toString(),this.restoreForm=this.fb.group({name:this.imageName})}restore(){const n=this.restoreForm.getValue("name"),t=new x.J(this.poolName,this.namespace,this.imageId);this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/trash/restore",{image_id_spec:t.toString(),new_image_name:n}),call:this.rbdService.restoreTrash(t,n)}).subscribe({error:()=>{this.restoreForm.setErrors({cdSubmitButton:!0})},complete:()=>{this.closeModal()}})}static{this.\u0275fac=function(t){return new(t||Lt)(e.\u0275\u0275directiveInject(z.U),e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(Ft.$),e.\u0275\u0275directiveInject($.a),e.\u0275\u0275directiveInject("poolName"),e.\u0275\u0275directiveInject("namespace"),e.\u0275\u0275directiveInject("imageName"),e.\u0275\u0275directiveInject("imageId"),e.\u0275\u0275directiveInject("imageSpec",8))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Lt,selectors:[["cd-rbd-trash-restore-modal"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:16,vars:8,consts:()=>{let n,t,o;return n=$localize`:␟b0e7c7ed1d51a0c205c815048bc9f79e24ee6db2␟5911856861458705446:Restore Image`,t=$localize`:␟ad2c445961fd9919f72e16c4e1baec8d13a5d769␟8048356505347961877:To restore  ${"[\ufffd#9\ufffd|\ufffd#10\ufffd]"}:START_TAG_KBD:${"\ufffd0\ufffd"}:INTERPOLATION:@${"\ufffd1\ufffd"}:INTERPOLATION_1:${"[\ufffd/#9\ufffd|\ufffd/#10\ufffd]"}:CLOSE_TAG_KBD:,  type the image's new name and click  ${"[\ufffd#9\ufffd|\ufffd#10\ufffd]"}:START_TAG_KBD:Restore${"[\ufffd/#9\ufffd|\ufffd/#10\ufffd]"}:CLOSE_TAG_KBD:.`,t=e.\u0275\u0275i18nPostprocess(t),o=$localize`:␟29645d4f82a29e8ee4c0cd5e5fbdce60159f73ba␟7630652246532918874:Name ${"\ufffd#14\ufffd\ufffd/#14\ufffd"}:TAG_INPUT:`,[["formDir","ngForm"],n,t,o,["size","sm",3,"overlaySelected","open"],[3,"closeSelect"],["cdsModalHeaderHeading",""],["cdsModalContent",""],["name","restoreForm","novalidate","",1,"form",3,"formGroup"],[1,"form-item"],["for","name","invalidText","The field is required","cdRequiredField","Name",3,"invalid"],["cdsText","","name","name","id","name","formControlName","name","autocomplete","off","autofocus",""],[3,"submitActionEvent","form","submitText","modalForm"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cds-modal",4),e.\u0275\u0275listener("overlaySelected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(1,"cds-modal-header",5),e.\u0275\u0275listener("closeSelect",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.closeModal())}),e.\u0275\u0275elementStart(2,"h3",6),e.\u0275\u0275i18n(3,1),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"section",7)(5,"form",8,0)(7,"p"),e.\u0275\u0275i18nStart(8,2),e.\u0275\u0275element(9,"kbd")(10,"kbd"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"div",9)(12,"cds-text-label",10),e.\u0275\u0275i18nStart(13,3),e.\u0275\u0275element(14,"input",11),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(15,"cd-form-button-panel",12),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.restore())}),e.\u0275\u0275elementEnd()()}if(2&t){const a=e.\u0275\u0275reference(6);e.\u0275\u0275property("open",o.open),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",o.restoreForm),e.\u0275\u0275advance(5),e.\u0275\u0275i18nExp(o.imageSpec)(o.imageId),e.\u0275\u0275i18nApply(8),e.\u0275\u0275advance(2),e.\u0275\u0275property("invalid",o.restoreForm.showError("name",a,"required")),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.restoreForm)("submitText",o.actionLabels.RESTORE)("modalForm",!0)}},dependencies:[r.\u0275NgNoValidate,r.DefaultValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.FormGroupDirective,r.FormControlName,A.e,Le.B,f.S,R.E,Me.P,d.TextInputLabelComponent,d.TextInput,d.Modal,d.ModalHeader,d.ModalContent,d.ModalHeaderHeading]})}}const Xl=["expiresTpl"],Ul=["deleteTpl"];function jl(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",10),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.purgeModal())}),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18n(2,2),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(3,"svg",11),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("disabled",t.disablePurgeBtn)}}function ql(i,n){1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275i18n(1,3),e.\u0275\u0275elementContainerEnd())}function Ql(i,n){1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275i18n(1,4),e.\u0275\u0275elementContainerEnd())}function Yl(i,n){if(1&i&&(e.\u0275\u0275template(0,ql,2,0,"ng-container",12)(1,Ql,2,0,"ng-container",12),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"cdDate")),2&i){const t=n.data.row,o=n.data.value;e.\u0275\u0275property("ngIf",t.cdIsExpired),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!t.cdIsExpired),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,3,o),"\n")}}function Wl(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"p",14)(1,"strong"),e.\u0275\u0275elementContainerStart(2),e.\u0275\u0275i18n(3,5),e.\u0275\u0275pipe(4,"cdDate"),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext().expiresAt;e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(4,1,t)),e.\u0275\u0275i18nApply(3)}}function Jl(i,n){if(1&i&&e.\u0275\u0275template(0,Wl,5,3,"p",13),2&i){const t=n.isExpired;e.\u0275\u0275property("ngIf",!t)}}class yt{constructor(n,t,o,a,s,_,c){this.authStorageService=n,this.rbdService=t,this.modalService=o,this.cdDatePipe=a,this.taskListService=s,this.taskWrapper=_,this.actionLabels=c,this.icons=F.FI,this.executingTasks=[],this.selection=new le.y,this.tableStatus=new pe.m,this.disablePurgeBtn=!0,this.permission=this.authStorageService.getPermissions().rbdImage;const p={permission:"update",icon:F.FI.undo,click:()=>this.restoreModal(),name:this.actionLabels.RESTORE},g={permission:"delete",icon:F.FI.destroy,click:()=>this.deleteModal(),name:this.actionLabels.DELETE};this.tableActions=[p,g]}ngOnInit(){this.columns=[{name:$localize`ID`,prop:"id",flexGrow:1,cellTransformation:xe.x.executing},{name:$localize`Name`,prop:"name",flexGrow:1},{name:$localize`Pool`,prop:"pool_name",flexGrow:1},{name:$localize`Namespace`,prop:"namespace",flexGrow:1},{name:$localize`Status`,prop:"deferment_end_time",flexGrow:1,cellTemplate:this.expiresTpl},{name:$localize`Deleted At`,prop:"deletion_time",flexGrow:1,pipe:this.cdDatePipe}];this.taskListService.init(()=>this.rbdService.listTrash(),o=>this.prepareResponse(o),o=>this.images=o,()=>this.onFetchError(),o=>["rbd/trash/remove","rbd/trash/restore"].includes(o.name),(o,a)=>new x.J(o.pool_name,o.namespace,o.id).toString()===a.metadata.image_id_spec,void 0)}prepareResponse(n){let t=[];const o={};let a;if(n.forEach(s=>{S().isUndefined(o[s.status])&&(o[s.status]=[]),o[s.status].push(s.pool_name),t=t.concat(s.value),this.disablePurgeBtn=!t.length}),o[3]?a=3:o[1]?a=1:o[2]&&(a=2),a){const s=(o[a].length>1?"pools ":"pool ")+o[a].join();this.tableStatus=new pe.m(a,s)}else this.tableStatus=new pe.m;return t.forEach(s=>{s.cdIsExpired=$e()().isAfter(s.deferment_end_time)}),t}onFetchError(){this.table.reset(),this.tableStatus=new pe.m(kl.k.ValueException)}updateSelection(n){this.selection=n}restoreModal(){const n={poolName:this.selection.first().pool_name,namespace:this.selection.first().namespace,imageName:this.selection.first().name,imageId:this.selection.first().id};this.modalRef=this.modalService.show(Lt,n)}deleteModal(){const n=this.selection.first().pool_name,t=this.selection.first().namespace,o=this.selection.first().id,a=this.selection.first().deferment_end_time,s=$e()().isAfter(a),_=new x.J(n,t,o);this.modalRef=this.modalService.show(re.D,{itemDescription:"RBD",itemNames:[_],bodyTemplate:this.deleteTpl,bodyContext:{expiresAt:a,isExpired:s},submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new E.O("rbd/trash/remove",{image_id_spec:_.toString()}),call:this.rbdService.removeTrash(_,!0)})})}purgeModal(){this.modalService.show(Dt)}static{this.\u0275fac=function(t){return new(t||yt)(e.\u0275\u0275directiveInject(X.v),e.\u0275\u0275directiveInject(z.U),e.\u0275\u0275directiveInject(_e.V),e.\u0275\u0275directiveInject(qe.Q),e.\u0275\u0275directiveInject(Se.D),e.\u0275\u0275directiveInject($.a),e.\u0275\u0275directiveInject(M.Ss))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:yt,selectors:[["cd-rbd-trash-list"]],viewQuery:function(t,o){if(1&t&&(e.\u0275\u0275viewQuery(j.O,7),e.\u0275\u0275viewQuery(Xl,7),e.\u0275\u0275viewQuery(Ul,7)),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.table=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.expiresTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.deleteTpl=a.first)}},features:[e.\u0275\u0275ProvidersFeature([Se.D])],decls:9,vars:8,consts:()=>{let n,t,o,a;return n=$localize`:␟49c0408946a6d67185947f455f15cc201d0d78e6␟2025285675896024439:Purge Trash`,t=$localize`:␟5c96a761dc55a21882c132c929583a424c9b8cf4␟5741682642200313706:Expired at`,o=$localize`:␟661041e3fcff4d3e75c561e038ca2504cf2cc643␟4824267839944614379:Protected until`,a=$localize`:␟0ee3b2322a1d3277f7e3fdb8a5141ac42bcf350b␟2131659442404981779:This image is protected until ${"\ufffd0\ufffd"}:INTERPOLATION:.`,[["expiresTpl",""],["deleteTpl",""],n,t,o,a,["columnMode","flex","identifier","id","forceIdentifier","true","selectionType","single",3,"fetchData","updateSelection","data","columns","status","autoReload"],[1,"table-actions"],[1,"btn-group",3,"permission","selection","tableActions"],["cdsButton","tertiary","type","button",3,"disabled","click",4,"ngIf"],["cdsButton","tertiary","type","button",3,"click","disabled"],["cdsIcon","close","size","16",1,"cds--btn__icon"],[4,"ngIf"],["class","text-danger",4,"ngIf"],[1,"text-danger"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275element(0,"cd-rbd-tabs"),e.\u0275\u0275elementStart(1,"cd-table",6),e.\u0275\u0275listener("fetchData",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.taskListService.fetch())})("updateSelection",function(_){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.updateSelection(_))}),e.\u0275\u0275elementStart(2,"div",7),e.\u0275\u0275element(3,"cd-table-actions",8),e.\u0275\u0275template(4,jl,4,1,"button",9),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(5,Yl,4,5,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)(7,Jl,1,1,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)}2&t&&(e.\u0275\u0275advance(),e.\u0275\u0275property("data",o.images)("columns",o.columns)("status",o.tableStatus)("autoReload",-1),e.\u0275\u0275advance(2),e.\u0275\u0275property("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.permission.delete))},dependencies:[l.NgIf,j.O,de.j,f.S,d.Button,d.IconDirective,Be,qe.Q]})}}const Y="api/nvmeof",Sn="ui-api/nvmeof";class te{constructor(n){this.http=n}formatGwGroupsList(n,t=!1){return n[0].reduce((o,a)=>(t&&a?.spec?.group&&a?.service_name?o.push({content:a.spec.group,serviceName:a.service_name}):a?.spec?.group&&o.push({content:a.spec.group}),o),[])}listGatewayGroups(){return this.http.get(`${Y}/gateway/group`)}listGateways(){return this.http.get(`${Y}/gateway`)}listSubsystems(n){return this.http.get(`${Y}/subsystem?gw_group=${n}`)}getSubsystem(n,t){return this.http.get(`${Y}/subsystem/${n}?gw_group=${t}`)}createSubsystem(n){return this.http.post(`${Y}/subsystem`,n,{observe:"response"})}deleteSubsystem(n,t){return this.http.delete(`${Y}/subsystem/${n}?gw_group=${t}`,{observe:"response"})}isSubsystemPresent(n,t){return this.getSubsystem(n,t).pipe((0,Fe.mapTo)(!0),(0,Fe.catchError)(o=>(o?.preventDefault(),(0,K.of)(!1))))}getInitiators(n,t){return this.http.get(`${Y}/subsystem/${n}/host?gw_group=${t}`)}addInitiators(n,t){return this.http.post(`${Sn}/subsystem/${n}/host`,t,{observe:"response"})}removeInitiators(n,t){return this.http.delete(`${Sn}/subsystem/${n}/host/${t.host_nqn}/${t.gw_group}`,{observe:"response"})}listListeners(n,t){return this.http.get(`${Y}/subsystem/${n}/listener?gw_group=${t}`)}createListener(n,t){return this.http.post(`${Y}/subsystem/${n}/listener`,t,{observe:"response"})}deleteListener(n,t,o,a,s){return this.http.delete(`${Y}/subsystem/${n}/listener/${o}/${a}`,{observe:"response",params:{gw_group:t,trsvcid:s,force:"true"}})}listNamespaces(n,t){return this.http.get(`${Y}/subsystem/${n}/namespace?gw_group=${t}`)}getNamespace(n,t,o){return this.http.get(`${Y}/subsystem/${n}/namespace/${t}?gw_group=${o}`)}createNamespace(n,t){return this.http.post(`${Y}/subsystem/${n}/namespace`,t,{observe:"response"})}updateNamespace(n,t,o){return this.http.patch(`${Y}/subsystem/${n}/namespace/${t}`,o,{observe:"response"})}deleteNamespace(n,t,o){return this.http.delete(`${Y}/subsystem/${n}/namespace/${t}?gw_group=${o}`,{observe:"response"})}static{this.\u0275fac=function(t){return new(t||te)(e.\u0275\u0275inject(ce.HttpClient))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:te,factory:te.\u0275fac,providedIn:"root"})}}var e_=m(28886);class Qe{static{this.\u0275fac=function(t){return new(t||Qe)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Qe,selectors:[["cd-nvmeof-tabs"]],decls:7,vars:0,consts:()=>{let n,t;return n=$localize`:␟409b6a23ac5c8302cbe2868c58d14eb425d72ddd␟7646178196301854210:Subsystems`,t=$localize`:␟8a9910cd114c1deb9af74f6f99b4173403965bf2␟5130480165747305341:Gateways`,[n,t,[1,"nav","nav-tabs"],[1,"nav-item"],["routerLink","/block/nvmeof/subsystems","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link"],["routerLink","/block/nvmeof/gateways","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-link"]]},template:function(t,o){1&t&&(e.\u0275\u0275elementStart(0,"ul",2)(1,"li",3)(2,"a",4),e.\u0275\u0275i18n(3,0),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"li",3)(5,"a",5),e.\u0275\u0275i18n(6,1),e.\u0275\u0275elementEnd()()())},dependencies:[v.RouterLink,v.RouterLinkActive]})}}var t_=m(45757);const n_=["statusTpl"],o_=()=>({md:4});function i_(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span",11),e.\u0275\u0275pipe(1,"pipeFunction"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()),2&i){const t=n.data.row,o=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngClass",e.\u0275\u0275pipeBind2(1,2,t,o.getStatusClass)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",t.status_desc," ")}}function a_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"legend"),e.\u0275\u0275i18nStart(1,4),e.\u0275\u0275element(2,"cd-help-text"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd())}function s_(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275template(0,a_,3,0,"legend",12),e.\u0275\u0275elementStart(1,"div")(2,"cd-table",13),e.\u0275\u0275listener("fetchData",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.getGateways())}),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngIf",t.selectedTab===t.Tabs.gateways),e.\u0275\u0275advance(2),e.\u0275\u0275property("data",t.gateways)("columns",t.gatewayColumns)}}function r_(i,n){if(1&i&&e.\u0275\u0275element(0,"cd-grafana",14),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate1("grafanaPath","ceph-nvme-of-gateways-overview?var-group=",t.selectedGatewayGroup,"&var-gateway=All"),e.\u0275\u0275property("type","metrics")}}function l_(i,n){if(1&i&&e.\u0275\u0275element(0,"cd-grafana",15),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate1("grafanaPath","ceph-nvme-of-gateways-performance?var-group=",t.selectedGatewayGroup,""),e.\u0275\u0275property("type","metrics")}}var rn;!function(i){i[i.gateways=0]="gateways",i[i.overview=1]="overview"}(rn||(rn={}));const fn=$localize`Enter group name`;class $t{onSelected(n){this.selectedTab=n}get Tabs(){return rn}constructor(n,t,o){this.nvmeofService=n,this.cephServiceService=t,this.actionLabels=o,this.gateways=[],this.selection=new le.y,this.gwGroups=[],this.groupService=null,this.selectedGatewayGroup=null,this.gwGroupsEmpty=!1,this.gwGroupPlaceholder=fn}ngOnInit(){this.setGatewayGroups(),this.gatewayColumns=[{name:$localize`Gateway ID`,prop:"id"},{name:$localize`Hostname`,prop:"hostname"},{name:$localize`Status`,prop:"status_desc",cellTemplate:this.statusTpl}]}getStatusClass(n){return S().get({"-1":"badge-danger",0:"badge-warning",1:"badge-success"},n.status,"badge-dark")}getGateways(){this.cephServiceService.getDaemons(this.groupService).subscribe(n=>{this.gateways=n.length?n.map(t=>({id:`client.${t.daemon_name}`,hostname:t.hostname,status_desc:t.status_desc,status:t.status})):[]})}onGroupSelection(n){n.selected=!0,this.groupService=n.serviceName,this.selectedGatewayGroup=n.content,this.getGateways()}onGroupClear(){this.groupService=null,this.getGateways()}setGatewayGroups(){this.nvmeofService.listGatewayGroups().subscribe(n=>{this.gwGroups=n?.[0]?.length?this.nvmeofService.formatGwGroupsList(n,!0):[],!this.groupService&&this.gwGroups.length?(this.onGroupSelection(this.gwGroups[0]),this.gwGroupsEmpty=!1,this.gwGroupPlaceholder=fn):(this.gwGroupsEmpty=!0,this.gwGroupPlaceholder=$localize`No groups available`)})}static{this.\u0275fac=function(t){return new(t||$t)(e.\u0275\u0275directiveInject(te),e.\u0275\u0275directiveInject(e_.t),e.\u0275\u0275directiveInject(M.Ss))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:$t,selectors:[["cd-nvmeof-gateway"]],viewQuery:function(t,o){if(1&t&&e.\u0275\u0275viewQuery(n_,7),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.statusTpl=a.first)}},decls:16,vars:9,consts:()=>{let n,t,o,a,s,_,c;return n=$localize`:␟cf378a96424886fda41c2c758e3996513692cd54␟1642060004963745883:Selected Gateway Group`,t=$localize`:␟8a9910cd114c1deb9af74f6f99b4173403965bf2␟5130480165747305341:Gateways`,o=$localize`:␟e95ae009d0bdb45fcc656e8b65248cf7396080d5␟2614607010577950577:Overview`,a=$localize`:␟3cc9c2ae277393b3946b38c088dabff671b1ee1b␟1322586333669103999:Performance`,s=$localize`:␟f550d8f29f67e387d33901243d1b7148bb712b79␟7655430968803085527: Gateways ${"\ufffd#2\ufffd"}:START_TAG_CD_HELP_TEXT: Ceph NVMe-oF gateways provide Ceph Block Device storage through NVMe/TCP. For VMware clients the NVMe/TCP volumes display as VMFS Datastores. For Linux clients the NVMe/TCP volumes display as as block devices. ${"\ufffd/#2\ufffd"}:CLOSE_TAG_CD_HELP_TEXT:`,_=$localize`:␟88d52a108e372081c5e122c5b369aac3ec904146␟7575824742596203372:Gateway overview`,c=$localize`:␟9517e7f935e73e6889dda20c0fa0408465c18f2e␟6191822238507425805:Gateway performance`,[["statusTpl",""],["gateways_content",""],["overview_content",""],["performance_content",""],s,["cdsCol","",1,"pb-3",3,"columnNumbers"],["type","single","label",n,3,"selected","clear","placeholder","items","disabled"],["type","contained","followFocus","true","isNavigation","true",3,"cacheActive"],["heading",t,3,"selected","tabContent"],["heading",o,3,"selected","tabContent"],["heading",a,3,"selected","tabContent"],[1,"badge",3,"ngClass"],[4,"ngIf"],[3,"fetchData","data","columns"],["title",_,"uid","feeuv1dno43r4ddjhjssdd","grafanaStyle","three",3,"grafanaPath","type"],["title",c,"uid","feeuv1dno43r4deed","grafanaStyle","three",3,"grafanaPath","type"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275element(0,"cd-nvmeof-tabs"),e.\u0275\u0275elementStart(1,"div",5)(2,"cds-combo-box",6),e.\u0275\u0275listener("selected",function(_){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onGroupSelection(_))})("clear",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onGroupClear())}),e.\u0275\u0275element(3,"cds-dropdown-list"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(4,i_,3,5,"ng-template",null,0,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(6,"cds-tabs",7)(7,"cds-tab",8),e.\u0275\u0275listener("selected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onSelected(o.Tabs.gateways))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"cds-tab",9),e.\u0275\u0275listener("selected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onSelected(o.Tabs.overview))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"cds-tab",10),e.\u0275\u0275listener("selected",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onSelected(o.Tabs.overview))}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(10,s_,3,3,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)(12,r_,1,3,"ng-template",null,2,e.\u0275\u0275templateRefExtractor)(14,l_,1,3,"ng-template",null,3,e.\u0275\u0275templateRefExtractor)}if(2&t){const a=e.\u0275\u0275reference(11),s=e.\u0275\u0275reference(13),_=e.\u0275\u0275reference(15);e.\u0275\u0275advance(),e.\u0275\u0275property("columnNumbers",e.\u0275\u0275pureFunction0(8,o_)),e.\u0275\u0275advance(),e.\u0275\u0275property("placeholder",o.gwGroupPlaceholder)("items",o.gwGroups)("disabled",o.gwGroupsEmpty),e.\u0275\u0275advance(4),e.\u0275\u0275property("cacheActive",!1),e.\u0275\u0275advance(),e.\u0275\u0275property("tabContent",a),e.\u0275\u0275advance(),e.\u0275\u0275property("tabContent",s),e.\u0275\u0275advance(),e.\u0275\u0275property("tabContent",_)}},dependencies:[l.NgClass,l.NgIf,ht.c,ue.O,j.O,d.ColumnDirective,d.ComboBox,d.DropdownList,d.Tabs,d.Tab,Qe,t_.N]})}}var __=m(37823);class Bt{constructor(n,t,o,a,s,_){this.actionLabels=n,this.modalService=t,this.authStorageService=o,this.taskWrapper=a,this.nvmeofService=s,this.router=_,this.selection=new le.y,this.permission=this.authStorageService.getPermissions().nvmeof}ngOnInit(){this.listenerColumns=[{name:$localize`Host`,prop:"host_name"},{name:$localize`Transport`,prop:"trtype"},{name:$localize`Address`,prop:"full_addr",cellTransformation:xe.x.copy}],this.tableActions=[{name:this.actionLabels.CREATE,permission:"create",icon:F.FI.add,click:()=>this.router.navigate(["block/nvmeof/subsystems",{outlets:{modal:[M.Qp.CREATE,this.subsystemNQN,"listener"]}}],{queryParams:{group:this.group}}),canBePrimary:n=>!n.hasSelection},{name:this.actionLabels.DELETE,permission:"delete",icon:F.FI.destroy,click:()=>this.deleteListenerModal()}]}updateSelection(n){this.selection=n}listListeners(){this.nvmeofService.listListeners(this.subsystemNQN,this.group).subscribe(n=>{this.listeners=n.map((t,o)=>(t.id=o,t.full_addr=`${t.traddr}:${t.trsvcid}`,t))})}deleteListenerModal(){const n=this.selection.first();this.modalService.show(re.D,{itemDescription:$localize`Listener`,actionDescription:"delete",infoMessage:$localize`This action will delete listener despite any active connections.`,itemNames:[$localize`listener`+` ${n.host_name} (${n.traddr}:${n.trsvcid})`],submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new E.O("nvmeof/listener/delete",{nqn:this.subsystemNQN,host_name:n.host_name}),call:this.nvmeofService.deleteListener(this.subsystemNQN,this.group,n.host_name,n.traddr,n.trsvcid)})})}static{this.\u0275fac=function(t){return new(t||Bt)(e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(_e.V),e.\u0275\u0275directiveInject(X.v),e.\u0275\u0275directiveInject($.a),e.\u0275\u0275directiveInject(te),e.\u0275\u0275directiveInject(v.Router))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Bt,selectors:[["cd-nvmeof-listeners-list"]],inputs:{subsystemNQN:"subsystemNQN",group:"group"},decls:6,vars:5,consts:[["columnMode","flex","identifier","id","forceIdentifier","true","selectionType","single",3,"fetchData","updateSelection","data","columns"],[1,"table-actions"],[1,"btn-group",3,"permission","selection","tableActions"]],template:function(t,o){1&t&&(e.\u0275\u0275elementStart(0,"legend")(1,"cd-help-text"),e.\u0275\u0275text(2," A listener defines the IP address and port on the gateway that is used to process NVMe/TCP admin and I/O commands to a subsystem. "),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(3,"cd-table",0),e.\u0275\u0275listener("fetchData",function(){return o.listListeners()})("updateSelection",function(s){return o.updateSelection(s)}),e.\u0275\u0275elementStart(4,"div",1),e.\u0275\u0275element(5,"cd-table-actions",2),e.\u0275\u0275elementEnd()()),2&t&&(e.\u0275\u0275advance(3),e.\u0275\u0275property("data",o.listeners)("columns",o.listenerColumns),e.\u0275\u0275advance(2),e.\u0275\u0275property("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[ue.O,j.O,de.j]})}}var d_=m(25081),m_=m(49658);const En="block/nvmeof/subsystems";class Gt{constructor(n,t,o,a,s,_,c,p,g){this.actionLabels=n,this.router=t,this.modalService=o,this.authStorageService=a,this.taskWrapper=s,this.nvmeofService=_,this.dimlessBinaryPipe=c,this.mbPerSecondPipe=p,this.iopsPipe=g,this.selection=new le.y,this.permission=this.authStorageService.getPermissions().nvmeof}ngOnInit(){this.namespacesColumns=[{name:$localize`ID`,prop:"nsid"},{name:$localize`Bdev Name`,prop:"bdev_name"},{name:$localize`Pool `,prop:"rbd_pool_name",flexGrow:2},{name:$localize`Image`,prop:"rbd_image_name",flexGrow:3},{name:$localize`Image Size`,prop:"rbd_image_size",pipe:this.dimlessBinaryPipe},{name:$localize`Block Size`,prop:"block_size",pipe:this.dimlessBinaryPipe},{name:$localize`IOPS`,prop:"rw_ios_per_second",sortable:!1,pipe:this.iopsPipe,flexGrow:1.5},{name:$localize`R/W Throughput`,prop:"rw_mbytes_per_second",sortable:!1,pipe:this.mbPerSecondPipe,flexGrow:1.5},{name:$localize`Read Throughput`,prop:"r_mbytes_per_second",sortable:!1,pipe:this.mbPerSecondPipe,flexGrow:1.5},{name:$localize`Write Throughput`,prop:"w_mbytes_per_second",sortable:!1,pipe:this.mbPerSecondPipe,flexGrow:1.5},{name:$localize`Load Balancing Group`,prop:"load_balancing_group",flexGrow:1.5}],this.tableActions=[{name:this.actionLabels.CREATE,permission:"create",icon:F.FI.add,click:()=>this.router.navigate([En,{outlets:{modal:[M.Qp.CREATE,this.subsystemNQN,"namespace"]}}],{queryParams:{group:this.group}}),canBePrimary:n=>!n.hasSelection},{name:this.actionLabels.EDIT,permission:"update",icon:F.FI.edit,click:()=>this.router.navigate([En,{outlets:{modal:[M.Qp.EDIT,this.subsystemNQN,"namespace",this.selection.first().nsid]}}],{queryParams:{group:this.group}})},{name:this.actionLabels.DELETE,permission:"delete",icon:F.FI.destroy,click:()=>this.deleteNamespaceModal()}]}updateSelection(n){this.selection=n}listNamespaces(){this.nvmeofService.listNamespaces(this.subsystemNQN,this.group).subscribe(n=>{this.namespaces=n})}deleteNamespaceModal(){const n=this.selection.first();this.modalService.show(re.D,{itemDescription:"Namespace",itemNames:[n.nsid],actionDescription:"delete",submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new E.O("nvmeof/namespace/delete",{nqn:this.subsystemNQN,nsid:n.nsid}),call:this.nvmeofService.deleteNamespace(this.subsystemNQN,n.nsid,this.group)})})}static{this.\u0275fac=function(t){return new(t||Gt)(e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(v.Router),e.\u0275\u0275directiveInject(_e.V),e.\u0275\u0275directiveInject(X.v),e.\u0275\u0275directiveInject($.a),e.\u0275\u0275directiveInject(te),e.\u0275\u0275directiveInject(ye.l),e.\u0275\u0275directiveInject(m_.n),e.\u0275\u0275directiveInject(d_.U))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Gt,selectors:[["cd-nvmeof-namespaces-list"]],inputs:{subsystemNQN:"subsystemNQN",group:"group"},decls:6,vars:5,consts:[["columnMode","flex","selectionType","single",3,"fetchData","updateSelection","data","columns"],[1,"table-actions"],[1,"btn-group",3,"permission","selection","tableActions"]],template:function(t,o){1&t&&(e.\u0275\u0275elementStart(0,"legend")(1,"cd-help-text"),e.\u0275\u0275text(2," An NVMe namespace is a quantity of non-volatile storage that can be formatted into logical blocks and presented to a host as a standard block device. "),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(3,"cd-table",0),e.\u0275\u0275listener("fetchData",function(){return o.listNamespaces()})("updateSelection",function(s){return o.updateSelection(s)}),e.\u0275\u0275elementStart(4,"div",1),e.\u0275\u0275element(5,"cd-table-actions",2),e.\u0275\u0275elementEnd()()),2&t&&(e.\u0275\u0275advance(3),e.\u0275\u0275property("data",o.namespaces)("columns",o.namespacesColumns),e.\u0275\u0275advance(2),e.\u0275\u0275property("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[ue.O,j.O,de.j]})}}const p_=["hostTpl"];function u_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",6),e.\u0275\u0275i18n(1,1),e.\u0275\u0275elementEnd())}function g_(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span",6),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().data.value;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t)}}function S_(i,n){if(1&i&&e.\u0275\u0275template(0,u_,2,0,"span",5)(1,g_,2,1,"span",5),2&i){const t=n.data.value;e.\u0275\u0275property("ngIf","*"===t),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","*"!==t)}}class xt{constructor(n,t,o,a,s,_){this.actionLabels=n,this.authStorageService=t,this.nvmeofService=o,this.modalService=a,this.router=s,this.taskWrapper=_,this.selection=new le.y,this.initiators=[],this.permission=this.authStorageService.getPermissions().nvmeof}ngOnInit(){this.initiatorColumns=[{name:$localize`Initiator`,prop:"nqn",cellTemplate:this.hostTpl}],this.tableActions=[{name:this.actionLabels.ADD,permission:"create",icon:F.FI.add,click:()=>this.router.navigate(["block/nvmeof/subsystems",{outlets:{modal:[M.Qp.ADD,this.subsystemNQN,"initiator"]}}],{queryParams:{group:this.group}}),canBePrimary:n=>!n.hasSelection},{name:this.actionLabels.REMOVE,permission:"delete",icon:F.FI.destroy,click:()=>this.removeInitiatorModal(),disable:()=>!this.selection.hasSelection,canBePrimary:n=>n.hasSelection}]}getAllowAllHostIndex(){return this.selection.selected.findIndex(n=>"*"===n.nqn)}updateSelection(n){this.selection=n}listInitiators(){this.nvmeofService.getInitiators(this.subsystemNQN,this.group).subscribe(n=>{this.initiators=n})}getSelectedNQNs(){return this.selection.selected.map(n=>n.nqn)}removeInitiatorModal(){const n=this.getSelectedNQNs(),t=this.getAllowAllHostIndex(),o=n.join(",");let a=n;-1!==t&&(n.splice(t,1),a=[...n,$localize`Allow any host(*)`]),this.modalService.show(re.D,{itemDescription:"Initiator",itemNames:a,actionDescription:"remove",submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new E.O("nvmeof/initiator/remove",{nqn:this.subsystemNQN,plural:a.length>1}),call:this.nvmeofService.removeInitiators(this.subsystemNQN,{host_nqn:o,gw_group:this.group})})})}static{this.\u0275fac=function(t){return new(t||xt)(e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(X.v),e.\u0275\u0275directiveInject(te),e.\u0275\u0275directiveInject(_e.V),e.\u0275\u0275directiveInject(v.Router),e.\u0275\u0275directiveInject($.a))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:xt,selectors:[["cd-nvmeof-initiators-list"]],viewQuery:function(t,o){if(1&t&&e.\u0275\u0275viewQuery(p_,7),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.hostTpl=a.first)}},inputs:{subsystemNQN:"subsystemNQN",group:"group"},decls:8,vars:5,consts:()=>{let n;return n=$localize`:␟7fc2c22652ac470ef4cfd675dd112e602418fe11␟1746724125952823727:Any host allowed (*)`,[["hostTpl",""],n,["columnMode","flex","selectionType","multiClick",3,"fetchData","updateSelection","data","columns"],[1,"table-actions"],[1,"btn-group",3,"permission","selection","tableActions"],["class","font-monospace",4,"ngIf"],[1,"font-monospace"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"legend")(1,"cd-help-text"),e.\u0275\u0275text(2," An initiator (or host) is the client that connects to the NVMe-oF target to access NVMe storage. The NVMe/TCP protocol allows initiators, to send NVMe-oF commands to storage devices, which are known as targets. "),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(3,"cd-table",2),e.\u0275\u0275listener("fetchData",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.listInitiators())})("updateSelection",function(_){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.updateSelection(_))}),e.\u0275\u0275elementStart(4,"div",3),e.\u0275\u0275element(5,"cd-table-actions",4),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(6,S_,2,2,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)}2&t&&(e.\u0275\u0275advance(3),e.\u0275\u0275property("data",o.initiators)("columns",o.initiatorColumns),e.\u0275\u0275advance(2),e.\u0275\u0275property("permission",o.permission)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[l.NgIf,ue.O,j.O,de.j]})}}function E_(i,n){if(1&i&&e.\u0275\u0275element(0,"cd-table-key-value",16),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("data",t.data)}}function C_(i,n){if(1&i&&e.\u0275\u0275element(0,"cd-nvmeof-listeners-list",17),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("subsystemNQN",t.subsystemNQN)("group",t.group)}}function T_(i,n){if(1&i&&e.\u0275\u0275element(0,"cd-nvmeof-namespaces-list",17),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("subsystemNQN",t.subsystemNQN)("group",t.group)}}function F_(i,n){if(1&i&&e.\u0275\u0275element(0,"cd-nvmeof-initiators-list",17),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("subsystemNQN",t.subsystemNQN)("group",t.group)}}function M_(i,n){if(1&i&&e.\u0275\u0275element(0,"cd-grafana",19),2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275propertyInterpolate2("grafanaPath","ceph-nvme-of-gateways-performance?var-group=",t.group,"&var-subsystem=",t.subsystemNQN,""),e.\u0275\u0275property("type","metrics")}}function h_(i,n){1&i&&(e.\u0275\u0275elementContainerStart(0,18),e.\u0275\u0275elementStart(1,"a",9),e.\u0275\u0275i18n(2,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,M_,1,4,"ng-template",10),e.\u0275\u0275elementContainerEnd())}function O_(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"nav",7,0),e.\u0275\u0275elementContainerStart(3,8),e.\u0275\u0275elementStart(4,"a",9),e.\u0275\u0275i18n(5,1),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(6,E_,1,1,"ng-template",10),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(7,11),e.\u0275\u0275elementStart(8,"a",9),e.\u0275\u0275i18n(9,2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(10,C_,1,2,"ng-template",10),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(11,12),e.\u0275\u0275elementStart(12,"a",9),e.\u0275\u0275i18n(13,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(14,T_,1,2,"ng-template",10),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(15,13),e.\u0275\u0275elementStart(16,"a",9),e.\u0275\u0275i18n(17,4),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(18,F_,1,2,"ng-template",10),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275template(19,h_,4,0,"ng-container",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(20,"div",15),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275reference(2),o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(19),e.\u0275\u0275property("ngIf",o.permissions.grafana.read),e.\u0275\u0275advance(),e.\u0275\u0275property("ngbNavOutlet",t)}}class wt{ngOnChanges(){this.selection&&(this.selectedItem=this.selection,this.subsystemNQN=this.selectedItem.nqn,this.data={},this.data[$localize`Serial Number`]=this.selectedItem.serial_number,this.data[$localize`Model Number`]=this.selectedItem.model_number,this.data[$localize`Minimum Controller Identifier`]=this.selectedItem.min_cntlid,this.data[$localize`Maximum Controller Identifier`]=this.selectedItem.max_cntlid,this.data[$localize`Subsystem Type`]=this.selectedItem.subtype)}static{this.\u0275fac=function(t){return new(t||wt)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:wt,selectors:[["cd-nvmeof-subsystems-details"]],inputs:{selection:"selection",group:"group",permissions:"permissions"},features:[e.\u0275\u0275NgOnChangesFeature],decls:1,vars:1,consts:()=>{let n,t,o,a,s,_;return n=$localize`:␟4f8b2bb476981727ab34ed40fde1218361f92c45␟5028777105388019087:Details`,t=$localize`:␟c3de24e2a257acd37f38edd8b27c69c8fac03de5␟8597679997412708406:Listeners`,o=$localize`:␟c3a7e364a88ea4673199dfa98bc73e6dbe09dfac␟7060498773332878646:Namespaces`,a=$localize`:␟f494bd31f095f6dcc656ce87ec2dcf07a2e9b30c␟1458520862046965337:Initiators`,s=$localize`:␟fbbaf5cb02ed419e79a27072478f716a4666a99d␟9041763226911499160:Performance Details`,_=$localize`:␟31570397ce6df323eddf2e0fbc4aabd2640399f5␟7818183122650058469:Subsystem details`,[["nav","ngbNav"],n,t,o,a,s,[4,"ngIf"],["ngbNav","","cdStatefulTab","subsystem-details",1,"nav-tabs"],["ngbNavItem","details"],["ngbNavLink",""],["ngbNavContent",""],["ngbNavItem","listeners"],["ngbNavItem","namespaces"],["ngbNavItem","initiators"],["ngbNavItem","performance-details",4,"ngIf"],[3,"ngbNavOutlet"],[3,"data"],[3,"subsystemNQN","group"],["ngbNavItem","performance-details"],["title",_,"uid","feeuv1dno43r4deed","grafanaStyle","three",3,"grafanaPath","type"]]},template:function(t,o){1&t&&e.\u0275\u0275template(0,O_,21,2,"ng-container",6),2&t&&e.\u0275\u0275property("ngIf",o.selection)},dependencies:[l.NgIf,P.NgbNavContent,P.NgbNav,P.NgbNavItem,P.NgbNavLink,P.NgbNavLinkBase,P.NgbNavOutlet,ht.c,__.i,Wt.B,Bt,Gt,xt]})}}const R_=()=>({md:4});function I_(i,n){if(1&i&&e.\u0275\u0275element(0,"cd-nvmeof-subsystems-details",8),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("selection",t.expandedRow)("permissions",t.permissions)("group",t.group)}}const Cn=$localize`Enter group name`;class Ye extends jt.D{constructor(n,t,o,a,s,_,c){super(),this.nvmeofService=n,this.authStorageService=t,this.actionLabels=o,this.router=a,this.modalService=s,this.taskWrapper=_,this.route=c,this.subsystems=[],this.selection=new le.y,this.gwGroups=[],this.group=null,this.gwGroupsEmpty=!1,this.gwGroupPlaceholder=Cn,this.permissions=this.authStorageService.getPermissions()}ngOnInit(){this.route.queryParams.subscribe(n=>{n?.group&&this.onGroupSelection({content:n?.group})}),this.setGatewayGroups(),this.subsystemsColumns=[{name:$localize`NQN`,prop:"nqn"},{name:$localize`# Namespaces`,prop:"namespace_count"},{name:$localize`# Maximum Allowed Namespaces`,prop:"max_namespaces"}],this.tableActions=[{name:this.actionLabels.CREATE,permission:"create",icon:F.FI.add,click:()=>this.router.navigate(["block/nvmeof/subsystems",{outlets:{modal:[M.Qp.CREATE]}}],{queryParams:{group:this.group}}),canBePrimary:n=>!n.hasSelection,disable:()=>!this.group},{name:this.actionLabels.DELETE,permission:"delete",icon:F.FI.destroy,click:()=>this.deleteSubsystemModal()}]}updateSelection(n){this.selection=n}getSubsystems(){this.group?this.nvmeofService.listSubsystems(this.group).subscribe(n=>{Array.isArray(n)?this.subsystems=n:this.subsystems=[n]}):this.subsystems=[]}deleteSubsystemModal(){const n=this.selection.first();this.modalService.show(re.D,{itemDescription:"Subsystem",itemNames:[n.nqn],actionDescription:"delete",submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new E.O("nvmeof/subsystem/delete",{nqn:n.nqn}),call:this.nvmeofService.deleteSubsystem(n.nqn,this.group)})})}onGroupSelection(n){n.selected=!0,this.group=n.content,this.getSubsystems()}onGroupClear(){this.group=null,this.getSubsystems()}setGatewayGroups(){this.nvmeofService.listGatewayGroups().subscribe(n=>{this.gwGroups=n?.[0]?.length?this.nvmeofService.formatGwGroupsList(n):[],!this.group&&this.gwGroups.length?(this.onGroupSelection(this.gwGroups[0]),this.gwGroupsEmpty=!1,this.gwGroupPlaceholder=Cn):(this.gwGroupsEmpty=!0,this.gwGroupPlaceholder=$localize`No groups available`)})}static{this.\u0275fac=function(t){return new(t||Ye)(e.\u0275\u0275directiveInject(te),e.\u0275\u0275directiveInject(X.v),e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(v.Router),e.\u0275\u0275directiveInject(_e.V),e.\u0275\u0275directiveInject($.a),e.\u0275\u0275directiveInject(v.ActivatedRoute))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Ye,selectors:[["cd-nvmeof-subsystems"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:12,vars:11,consts:()=>{let n,t;return n=$localize`:␟cf378a96424886fda41c2c758e3996513692cd54␟1642060004963745883:Selected Gateway Group`,t=$localize`:␟9c6e378d129a8918462483854bef4a239f906aed␟276048050023874884: Subsystems ${"\ufffd#6\ufffd"}:START_TAG_CD_HELP_TEXT: A subsystem provides access control to which hosts can access the namespaces within the subsystem. ${"\ufffd/#6\ufffd"}:CLOSE_TAG_CD_HELP_TEXT:`,[t,["cdsCol","",1,"pb-3",3,"columnNumbers"],["type","single","label",n,3,"selected","clear","placeholder","items","disabled"],["columnMode","flex","selectionType","single",3,"fetchData","setExpandedRow","updateSelection","data","columns","hasDetails"],[1,"table-actions"],[1,"btn-group",3,"permission","selection","tableActions"],[3,"selection","permissions","group",4,"cdTableDetail"],["name","modal"],[3,"selection","permissions","group"]]},template:function(t,o){1&t&&(e.\u0275\u0275element(0,"cd-nvmeof-tabs"),e.\u0275\u0275elementStart(1,"div",1)(2,"cds-combo-box",2),e.\u0275\u0275listener("selected",function(s){return o.onGroupSelection(s)})("clear",function(){return o.onGroupClear()}),e.\u0275\u0275element(3,"cds-dropdown-list"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"legend"),e.\u0275\u0275i18nStart(5,0),e.\u0275\u0275element(6,"cd-help-text"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"cd-table",3),e.\u0275\u0275listener("fetchData",function(){return o.getSubsystems()})("setExpandedRow",function(s){return o.setExpandedRow(s)})("updateSelection",function(s){return o.updateSelection(s)}),e.\u0275\u0275elementStart(8,"div",4),e.\u0275\u0275element(9,"cd-table-actions",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(10,I_,1,3,"cd-nvmeof-subsystems-details",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(11,"router-outlet",7)),2&t&&(e.\u0275\u0275advance(),e.\u0275\u0275property("columnNumbers",e.\u0275\u0275pureFunction0(10,R_)),e.\u0275\u0275advance(),e.\u0275\u0275property("placeholder",o.gwGroupPlaceholder)("items",o.gwGroups)("disabled",o.gwGroupsEmpty),e.\u0275\u0275advance(5),e.\u0275\u0275property("data",o.subsystems)("columns",o.subsystemsColumns)("hasDetails",!0),e.\u0275\u0275advance(2),e.\u0275\u0275property("permission",o.permissions.nvmeof)("selection",o.selection)("tableActions",o.tableActions))},dependencies:[ue.O,j.O,de.j,Qt.N,v.RouterOutlet,d.ColumnDirective,d.ComboBox,d.DropdownList,wt,Qe]})}}function b_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",28),e.\u0275\u0275i18n(1,5),e.\u0275\u0275elementEnd())}function P_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",28),e.\u0275\u0275i18n(1,6),e.\u0275\u0275elementEnd())}function A_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",28),e.\u0275\u0275i18nStart(1,7),e.\u0275\u0275element(2,"br")(3,"code")(4,"br")(5,"code"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd())}function v_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",28),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd())}function D_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",28),e.\u0275\u0275i18n(1,9),e.\u0275\u0275elementEnd())}function L_(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span",28),e.\u0275\u0275i18n(1,10),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275i18nExp(t.defaultMaxNamespace),e.\u0275\u0275i18nApply(1)}}function y_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",28),e.\u0275\u0275i18n(1,11),e.\u0275\u0275elementEnd())}class Vt{constructor(n,t,o,a,s,_,c){this.authStorageService=n,this.actionLabels=t,this.activeModal=o,this.nvmeofService=a,this.taskWrapperService=s,this.router=_,this.route=c,this.defaultMaxNamespace=4096,this.DEFAULT_NQN="nqn.2001-07.com.ceph:"+Date.now(),this.NQN_REGEX=/^nqn\.(19|20)\d\d-(0[1-9]|1[0-2])\.\D{2,3}(\.[A-Za-z0-9-]+)+(:[A-Za-z0-9-\.]+(:[A-Za-z0-9-\.]+)*)$/,this.NQN_REGEX_UUID=/^nqn\.2014-08\.org\.nvmexpress:uuid:[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/,this.customNQNValidator=b.xQ.custom("pattern",p=>!!p&&!(this.NQN_REGEX.test(p)||this.NQN_REGEX_UUID.test(p))),this.permission=this.authStorageService.getPermissions().nvmeof,this.resource=$localize`Subsystem`,this.pageURL="block/nvmeof/subsystems"}ngOnInit(){this.route.queryParams.subscribe(n=>{this.group=n?.group}),this.createForm(),this.action=this.actionLabels.CREATE}createForm(){this.subsystemForm=new V.$({nqn:new r.UntypedFormControl(this.DEFAULT_NQN,{validators:[this.customNQNValidator,r.Validators.required,this.customNQNValidator,b.xQ.custom("maxLength",n=>(new TextEncoder).encode(n).length>223)],asyncValidators:[b.xQ.unique(this.nvmeofService.isSubsystemPresent,this.nvmeofService,null,null,this.group)]}),max_namespaces:new r.UntypedFormControl(this.defaultMaxNamespace,{validators:[b.xQ.number(!1),r.Validators.max(this.defaultMaxNamespace),r.Validators.min(1)]})})}onSubmit(){const n=this,t=this.subsystemForm.getValue("nqn"),o=Number(this.subsystemForm.getValue("max_namespaces"));let a=`nvmeof/subsystem/${M.Qp.CREATE}`;const s={nqn:t,enable_ha:!0,gw_group:this.group,max_namespaces:o};o||delete s.max_namespaces,this.taskWrapperService.wrapTaskAroundCall({task:new E.O(a,{nqn:t}),call:this.nvmeofService.createSubsystem(s)}).subscribe({error(){n.subsystemForm.setErrors({cdSubmitButton:!0})},complete:()=>{this.router.navigate([this.pageURL,{outlets:{modal:null}}])}})}static{this.\u0275fac=function(t){return new(t||Vt)(e.\u0275\u0275directiveInject(X.v),e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(P.NgbActiveModal),e.\u0275\u0275directiveInject(te),e.\u0275\u0275directiveInject($.a),e.\u0275\u0275directiveInject(v.Router),e.\u0275\u0275directiveInject(v.ActivatedRoute))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Vt,selectors:[["cd-nvmeof-subsystems-form"]],decls:37,vars:23,consts:()=>{let n,t,o,a,s,_,c,p,g,T,C;return n=$localize`:␟fb127ea03835b3230f0ed981c7080e2ccb879621␟3346778808274133574:${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd1\ufffd"}:INTERPOLATION_1:`,t=$localize`:␟a487b902637ee46c2ad16210a5ca4c3c95a58589␟7707701592702091951:NQN`,o=$localize`:␟7faeff0841ac252437a150e1e3e2ab1d125cb2e7␟6713194253282018983:Maximum Namespaces`,a=$localize`:␟fa2a60ef492335d8e65bf24469d8e2fcade182c8␟8720212157807639298:The maximum namespaces per subsystem. Default is ${"\ufffd0\ufffd"}:INTERPOLATION:`,s=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,_=$localize`:␟f73aec71cf48540bfb037ce9b7bd9c43b4e91e39␟294957035304444227:This NQN is already in use.`,c=$localize`:␟5a3e2473c0dfaf17f0b18521fcd32cf279e9d494␟4083930278682550844:Expected NQN format${"[\ufffd#2\ufffd\ufffd/#2\ufffd|\ufffd#4\ufffd\ufffd/#4\ufffd]"}:LINE_BREAK:<${"[\ufffd#3\ufffd|\ufffd#5\ufffd]"}:START_TAG_CODE:nqn.$year-$month.$reverseDomainName:$utf8-string${"[\ufffd/#3\ufffd|\ufffd/#5\ufffd]"}:CLOSE_TAG_CODE:".> or ${"[\ufffd#2\ufffd\ufffd/#2\ufffd|\ufffd#4\ufffd\ufffd/#4\ufffd]"}:LINE_BREAK:<${"[\ufffd#3\ufffd|\ufffd#5\ufffd]"}:START_TAG_CODE:nqn.2014-08.org.nvmexpress:uuid:$UUID-string${"[\ufffd/#3\ufffd|\ufffd/#5\ufffd]"}:CLOSE_TAG_CODE:".>`,c=e.\u0275\u0275i18nPostprocess(c),p=$localize`:␟c9e41250c2daa57271a349eb72b306f1ebb1f78c␟9003112016187204330:An NQN may not be more than 223 bytes in length.`,g=$localize`:␟ee1a29cc658e4fa891be762d7bae96139b57c8f4␟8734993421339261707:The value must be at least 1.`,T=$localize`:␟dbab0bef868a73a509d6254042435ae2061f9ea7␟9058482694854689874:The value cannot be greater than ${"\ufffd0\ufffd"}:INTERPOLATION:.`,C=$localize`:␟a6db24f0a2e2677954f82130fce0eda8f435af9d␟3289223524155329267:The value must be a positive integer.`,[["formDir","ngForm"],n,t,o,a,s,_,c,p,g,T,C,[3,"pageURL","modalRef"],[1,"modal-title"],[1,"modal-content"],["name","subsystemForm","novalidate","",3,"formGroup"],[1,"modal-body"],[1,"form-group","row"],["for","nqn",1,"cd-col-form-label"],[1,"required"],[1,"cd-col-form-input"],["name","nqn","type","text","formControlName","nqn",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","max_namespaces",1,"cd-col-form-label"],["id","max_namespaces","type","text","name","max_namespaces","formControlName","max_namespaces",1,"form-control"],[1,"modal-footer"],[1,"text-right"],[3,"submitActionEvent","form","submitText"],[1,"invalid-feedback"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-modal",12)(1,"span",13),e.\u0275\u0275i18n(2,1),e.\u0275\u0275pipe(3,"titlecase"),e.\u0275\u0275pipe(4,"upperFirst"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerStart(5,14),e.\u0275\u0275elementStart(6,"form",15,0)(8,"div",16)(9,"div",17)(10,"label",18)(11,"span",19),e.\u0275\u0275i18n(12,2),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(13,"div",20),e.\u0275\u0275element(14,"input",21),e.\u0275\u0275elementStart(15,"cd-help-text"),e.\u0275\u0275text(16," A unique and permanent name for the lifetime of the subsystem. "),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(17,b_,2,0,"span",22)(18,P_,2,0,"span",22)(19,A_,6,0,"span",22)(20,v_,2,0,"span",22),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(21,"div",17)(22,"label",23)(23,"span"),e.\u0275\u0275i18n(24,3),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(25,"div",20),e.\u0275\u0275element(26,"input",24),e.\u0275\u0275elementStart(27,"cd-help-text"),e.\u0275\u0275i18n(28,4),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(29,D_,2,0,"span",22)(30,L_,2,1,"span",22)(31,y_,2,0,"span",22),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(32,"div",25)(33,"div",26)(34,"cd-form-button-panel",27),e.\u0275\u0275pipe(35,"titlecase"),e.\u0275\u0275pipe(36,"upperFirst"),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onSubmit())}),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()}if(2&t){const a=e.\u0275\u0275reference(7);e.\u0275\u0275property("pageURL",o.pageURL)("modalRef",o.activeModal),e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(3,15,o.action))(e.\u0275\u0275pipeBind1(4,17,o.resource)),e.\u0275\u0275i18nApply(2),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",o.subsystemForm),e.\u0275\u0275advance(11),e.\u0275\u0275property("ngIf",o.subsystemForm.showError("nqn",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.subsystemForm.showError("nqn",a,"unique")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.subsystemForm.showError("nqn",a,"pattern")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.subsystemForm.showError("nqn",a,"maxLength")),e.\u0275\u0275advance(8),e.\u0275\u0275i18nExp(o.defaultMaxNamespace),e.\u0275\u0275i18nApply(28),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.subsystemForm.showError("max_namespaces",a,"min")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.subsystemForm.showError("max_namespaces",a,"max")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.subsystemForm.showError("max_namespaces",a,"pattern")),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.subsystemForm)("submitText",e.\u0275\u0275pipeBind1(35,19,o.action)+" "+e.\u0275\u0275pipeBind1(36,21,o.resource))}},dependencies:[l.NgIf,r.\u0275NgNoValidate,r.DefaultValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.FormGroupDirective,r.FormControlName,se.z,A.e,ue.O,f.S,u.a,h.C,R.E,l.TitleCasePipe,De.r]})}}var $_=m(7466);function B_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"option",31),e.\u0275\u0275i18n(1,6),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function G_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"option",31),e.\u0275\u0275i18n(1,7),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function x_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"option",31),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function w_(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"option",31),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=n.$implicit;e.\u0275\u0275property("ngValue",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t.hostname)}}function V_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",32),e.\u0275\u0275i18n(1,9),e.\u0275\u0275elementEnd())}function H_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",32),e.\u0275\u0275i18n(1,10),e.\u0275\u0275elementEnd())}function k_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",32),e.\u0275\u0275i18n(1,11),e.\u0275\u0275elementEnd())}function K_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",32),e.\u0275\u0275i18n(1,12),e.\u0275\u0275elementEnd())}class Ht{constructor(n,t,o,a,s,_,c,p,g,T){this.actionLabels=n,this.authStorageService=t,this.taskWrapperService=o,this.nvmeofService=a,this.hostService=s,this.router=_,this.route=c,this.activeModal=p,this.formatterService=g,this.dimlessBinaryPipe=T,this.hosts=null,this.permission=this.authStorageService.getPermissions().nvmeof,this.hostPermission=this.authStorageService.getPermissions().hosts,this.resource=$localize`Listener`,this.pageURL="block/nvmeof/subsystems"}filterHostsByLabel(n,t){return n.filter(o=>{const a=o?.labels;return"string"==typeof t?a.includes(t):a?.length===t?.length&&S().isEqual(a,t)})}filterHostsByHostname(n,t){return n.filter(o=>t.includes(o.hostname))}getGwGroupPlacement(n){return n?.[0]?.find(t=>t?.spec?.group===this.group)?.placement||{hosts:[],label:[]}}setHosts(){(0,K.forkJoin)({gwGroups:this.nvmeofService.listGatewayGroups(),allHosts:this.hostService.getAllHosts()}).pipe((0,Fe.map)(({gwGroups:n,allHosts:t})=>{const{hosts:o,label:a}=this.getGwGroupPlacement(n);return o?.length?this.filterHostsByHostname(t,o):a?.length?this.filterHostsByLabel(t,a):[]})).subscribe(n=>{this.hosts=n.map(t=>({hostname:t.hostname,addr:t.addr}))})}ngOnInit(){this.createForm(),this.action=this.actionLabels.CREATE,this.route.params.subscribe(n=>{this.subsystemNQN=n?.subsystem_nqn}),this.route.queryParams.subscribe(n=>{this.group=n?.group}),this.setHosts()}createForm(){this.listenerForm=new V.$({host:new r.UntypedFormControl(null,{validators:[r.Validators.required]}),trsvcid:new r.UntypedFormControl(4420,[r.Validators.required,b.xQ.number(!1),r.Validators.max(65535)])})}buildRequest(){const n=this.listenerForm.getValue("host");let t=Number(this.listenerForm.getValue("trsvcid"));return t||(t=4420),{gw_group:this.group,host_name:n.hostname,traddr:n.addr,trsvcid:t}}onSubmit(){const n=this,t=`nvmeof/listener/${M.Qp.CREATE}`,o=this.buildRequest();this.taskWrapperService.wrapTaskAroundCall({task:new E.O(t,{nqn:this.subsystemNQN,host_name:o.host_name}),call:this.nvmeofService.createListener(this.subsystemNQN,o)}).subscribe({error(){n.listenerForm.setErrors({cdSubmitButton:!0})},complete:()=>{this.router.navigate([this.pageURL,{outlets:{modal:null}}])}})}static{this.\u0275fac=function(t){return new(t||Ht)(e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(X.v),e.\u0275\u0275directiveInject($.a),e.\u0275\u0275directiveInject(te),e.\u0275\u0275directiveInject($_.I),e.\u0275\u0275directiveInject(v.Router),e.\u0275\u0275directiveInject(v.ActivatedRoute),e.\u0275\u0275directiveInject(P.NgbActiveModal),e.\u0275\u0275directiveInject(en.k),e.\u0275\u0275directiveInject(ye.l))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Ht,selectors:[["cd-nvmeof-listeners-form"]],decls:38,vars:22,consts:()=>{let n,t,o,a,s,_,c,p,g,T,C,I;return n=$localize`:␟fb127ea03835b3230f0ed981c7080e2ccb879621␟3346778808274133574:${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd1\ufffd"}:INTERPOLATION_1:`,t=$localize`:␟9a541ec1a4319fffc16ad3b3ab2c2b6d251a829d␟1605455101862010019:Hostname`,o=$localize`:␟dd488fd28a2fd0e4ca2e516ae6d434494ff49d64␟3745925115924801913: This hostname uniquely identifies the gateway on which the listener is being set up. `,a=$localize`:␟cc60d64a3965bf79f7bc062ae28da88f0e105f16␟4112739846815198125:Transport Service ID`,s=$localize`:␟0f2fab684bf9d800d69ddc30d36c851d503570b9␟3167802845406499902:The IP port to use. Default is 4420.`,_=$localize`:␟94516fa213706c67ce5a5b5765681d7fb032033a␟3894950702316166331:Loading...`,c=$localize`:␟5f5e6acf8c0fd8453c0f341dc3b108be1b76a026␟4319061167250065587:-- No hosts available --`,p=$localize`:␟aa9e5b5c4f5f8a44b8941f5917d2b8fd47a8d6c6␟7121921444929001780:-- Select a host --`,g=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,T=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,C=$localize`:␟01b56ce73f0a46c2f427fca2e174e8e314494717␟2212205561785296270:The value cannot be greated than 65535.`,I=$localize`:␟a6db24f0a2e2677954f82130fce0eda8f435af9d␟3289223524155329267:The value must be a positive integer.`,[["formDir","ngForm"],n,t,o,a,s,_,c,p,g,T,C,I,[3,"pageURL"],[1,"modal-title"],[1,"modal-content"],["name","listenerForm","novalidate","",3,"formGroup"],[1,"modal-body"],[1,"form-group","row"],["for","host",1,"cd-col-form-label"],[1,"required"],[1,"cd-col-form-input"],["id","host","name","host","formControlName","host",1,"form-select"],[3,"ngValue",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],["for","trsvcid",1,"cd-col-form-label"],["id","trsvcid","type","text","name","trsvcid","formControlName","trsvcid",1,"form-control"],[1,"modal-footer"],[1,"text-right"],[3,"submitActionEvent","form","submitText"],[3,"ngValue"],[1,"invalid-feedback"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-modal",13)(1,"span",14),e.\u0275\u0275i18n(2,1),e.\u0275\u0275pipe(3,"titlecase"),e.\u0275\u0275pipe(4,"upperFirst"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerStart(5,15),e.\u0275\u0275elementStart(6,"form",16,0)(8,"div",17)(9,"div",18)(10,"label",19)(11,"span",20),e.\u0275\u0275i18n(12,2),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(13,"div",21)(14,"select",22),e.\u0275\u0275template(15,B_,2,1,"option",23)(16,G_,2,1,"option",23)(17,x_,2,1,"option",23)(18,w_,2,2,"option",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"cd-help-text"),e.\u0275\u0275i18n(20,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(21,V_,2,0,"span",25),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(22,"div",18)(23,"label",26)(24,"span"),e.\u0275\u0275i18n(25,4),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(26,"div",21),e.\u0275\u0275element(27,"input",27),e.\u0275\u0275elementStart(28,"cd-help-text"),e.\u0275\u0275i18n(29,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(30,H_,2,0,"span",25)(31,k_,2,0,"span",25)(32,K_,2,0,"span",25),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(33,"div",28)(34,"div",29)(35,"cd-form-button-panel",30),e.\u0275\u0275pipe(36,"titlecase"),e.\u0275\u0275pipe(37,"upperFirst"),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onSubmit())}),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()}if(2&t){const a=e.\u0275\u0275reference(7);e.\u0275\u0275property("pageURL",o.pageURL),e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(3,14,o.action))(e.\u0275\u0275pipeBind1(4,16,o.resource)),e.\u0275\u0275i18nApply(2),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",o.listenerForm),e.\u0275\u0275advance(9),e.\u0275\u0275property("ngIf",null===o.hosts),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.hosts&&0===o.hosts.length),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.hosts&&o.hosts.length>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",o.hosts),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",o.listenerForm.showError("host",a,"required")),e.\u0275\u0275advance(9),e.\u0275\u0275property("ngIf",o.listenerForm.showError("trsvcid",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.listenerForm.showError("trsvcid",a,"max")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.listenerForm.showError("trsvcid",a,"pattern")),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.listenerForm)("submitText",e.\u0275\u0275pipeBind1(36,18,o.action)+" "+e.\u0275\u0275pipeBind1(37,20,o.resource))}},dependencies:[l.NgForOf,l.NgIf,r.\u0275NgNoValidate,r.NgSelectOption,r.\u0275NgSelectMultipleOption,r.DefaultValueAccessor,r.SelectControlValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.FormGroupDirective,r.FormControlName,se.z,A.e,ue.O,f.S,u.a,h.C,R.E,d.Option,l.TitleCasePipe,De.r]})}}const ln=i=>({required:i});function z_(i,n){1&i&&e.\u0275\u0275element(0,"input",36)}function X_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"option",39),e.\u0275\u0275i18n(1,5),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function U_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"option",39),e.\u0275\u0275i18n(1,6),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function j_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"option",39),e.\u0275\u0275i18n(1,7),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngValue",null)}function q_(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"option",40),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=n.$implicit;e.\u0275\u0275property("value",t.pool_name),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t.pool_name)}}function Q_(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"select",37),e.\u0275\u0275template(1,X_,2,1,"option",38)(2,U_,2,1,"option",38)(3,j_,2,1,"option",38)(4,q_,2,2,"option",31),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null===t.rbdPools),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.rbdPools&&0===t.rbdPools.length),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.rbdPools&&t.rbdPools.length>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",t.rbdPools)}}function Y_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",41),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd())}function W_(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",42)(1,"label",43)(2,"span",21),e.\u0275\u0275i18n(3,9),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"div",22),e.\u0275\u0275element(5,"cds-number",44),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(7);e.\u0275\u0275advance(2),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(5,ln,!t.edit)),e.\u0275\u0275advance(3),e.\u0275\u0275property("min",t.MIN_NAMESPACE_CREATE)("max",t.MAX_NAMESPACE_CREATE)("invalid",t.nsForm.showError("nsCount",o,"max")||t.nsForm.showError("nsCount",o,"min")||t.nsForm.showError("nsCount",o,"required"))("invalidText",t.nsForm.get("nsCount").hasError("required")?t.requiredInvalidText:t.nsCountInvalidText)}}function J_(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"option",40),e.\u0275\u0275i18n(1,10),e.\u0275\u0275elementEnd()),2&i){const t=n.$implicit;e.\u0275\u0275property("value",t),e.\u0275\u0275advance(),e.\u0275\u0275i18nExp(t),e.\u0275\u0275i18nApply(1)}}function Z_(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",41),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18n(2,11),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd())}function ec(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",41),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18n(2,12),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd())}function tc(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",45),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275i18n(2,13),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd())}class We{constructor(n,t,o,a,s,_,c,p,g,T,C){this.actionLabels=n,this.authStorageService=t,this.taskWrapperService=o,this.nvmeofService=a,this.poolService=s,this.rbdService=_,this.router=c,this.route=p,this.activeModal=g,this.formatterService=T,this.dimlessBinaryPipe=C,this.edit=!1,this.rbdPools=null,this.units=["MiB","GiB","TiB"],this.MAX_NAMESPACE_CREATE=5,this.MIN_NAMESPACE_CREATE=1,this.requiredInvalidText=$localize`This field is required`,this.nsCountInvalidText=$localize`The namespace count should be between 1 and 5`,this.permission=this.authStorageService.getPermissions().nvmeof,this.poolPermission=this.authStorageService.getPermissions().pool,this.resource=$localize`Namespace`,this.pageURL="block/nvmeof/subsystems"}init(){this.route.queryParams.subscribe(n=>{this.group=n?.group}),this.createForm(),this.action=this.actionLabels.CREATE,this.route.params.subscribe(n=>{this.subsystemNQN=n.subsystem_nqn,this.nsid=n?.nsid})}initForEdit(){this.edit=!0,this.action=this.actionLabels.EDIT,this.nvmeofService.getNamespace(this.subsystemNQN,this.nsid,this.group).subscribe(n=>{const t=this.dimlessBinaryPipe.transform(n.rbd_image_size).split(" ");this.currentBytes=n.rbd_image_size,this.nsForm.get("pool").setValue(n.rbd_pool_name),this.nsForm.get("unit").setValue(t[1]),this.nsForm.get("image_size").setValue(t[0]),this.nsForm.get("image_size").addValidators(r.Validators.required),this.nsForm.get("pool").disable()})}initForCreate(){this.poolService.getList().subscribe(n=>{this.rbdPools=n.filter(this.rbdService.isRBDPool),this.rbdPools?.length&&this.nsForm.get("pool").setValue(this.rbdPools[0].pool_name)})}ngOnInit(){this.init(),this.router.url.includes("subsystems/(modal:edit")?this.initForEdit():this.initForCreate()}createForm(){this.nsForm=new V.$({pool:new r.UntypedFormControl(null,{validators:[r.Validators.required]}),image_size:new r.UntypedFormControl(1,[b.xQ.number(!1),r.Validators.min(1)]),unit:new r.UntypedFormControl(this.units[1]),nsCount:new r.UntypedFormControl(this.MAX_NAMESPACE_CREATE,[r.Validators.required,r.Validators.max(this.MAX_NAMESPACE_CREATE),r.Validators.min(this.MIN_NAMESPACE_CREATE)])})}buildUpdateRequest(n){const t={gw_group:this.group,rbd_image_size:n};return this.nvmeofService.updateNamespace(this.subsystemNQN,this.nsid,t)}randomString(){return Math.random().toString(36).substring(2)}buildCreateRequest(n,t){const o=this.nsForm.getValue("pool"),a=[];for(let s=1;s<=t;s++){const _={gw_group:this.group,rbd_image_name:`nvme_${o}_${this.group}_${this.randomString()}`,rbd_pool:o,create_image:!0};n&&(_.rbd_image_size=n),a.push(this.nvmeofService.createNamespace(this.subsystemNQN,_))}return a}validateSize(){const n=this.nsForm.getValue("unit"),t=this.nsForm.getValue("image_size");return t&&n?this.formatterService.toBytes(t+n)<=this.currentBytes:null}onSubmit(){if(this.validateSize())this.invalidSizeError=!0,this.nsForm.setErrors({cdSubmitButton:!0});else{this.invalidSizeError=!1;const n=this,t=`nvmeof/namespace/${this.edit?M.Qp.EDIT:M.Qp.CREATE}`,o=this.nsForm.getValue("image_size"),a=this.nsForm.getValue("nsCount");let s,_=null;if(o){const c=this.nsForm.getValue("unit");_=this.formatterService.toBytes(o+c)}s=this.edit?this.taskWrapperService.wrapTaskAroundCall({task:new E.O(t,{nqn:this.subsystemNQN,nsid:this.nsid}),call:this.buildUpdateRequest(_)}):this.taskWrapperService.wrapTaskAroundCall({task:new E.O(t,{nqn:this.subsystemNQN,nsCount:a}),call:(0,K.forkJoin)(this.buildCreateRequest(_,a))}),s.subscribe({error(){n.nsForm.setErrors({cdSubmitButton:!0})},complete:()=>{this.router.navigate([this.pageURL,{outlets:{modal:null}}])}})}}static{this.\u0275fac=function(t){return new(t||We)(e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(X.v),e.\u0275\u0275directiveInject($.a),e.\u0275\u0275directiveInject(te),e.\u0275\u0275directiveInject(Ue.m),e.\u0275\u0275directiveInject(z.U),e.\u0275\u0275directiveInject(v.Router),e.\u0275\u0275directiveInject(v.ActivatedRoute),e.\u0275\u0275directiveInject(P.NgbActiveModal),e.\u0275\u0275directiveInject(en.k),e.\u0275\u0275directiveInject(ye.l))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:We,selectors:[["cd-nvmeof-namespaces-form"]],decls:37,vars:29,consts:()=>{let n,t,o,a,s,_,c,p,g,T,C,I,D,G;return n=$localize`:␟fb127ea03835b3230f0ed981c7080e2ccb879621␟3346778808274133574:${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd1\ufffd"}:INTERPOLATION_1:`,t=$localize`:␟e70fcca5a99575cffef3ff8cbd5e69f06ffd0f1c␟7101197021456818771:Pool`,o=$localize`:␟039b216b052eae644525bf76b7844befb5be7a4f␟3708745531314727819: An RBD application-enabled pool where the image will be created. `,a=$localize`:␟f36d58cbcaee05c4feaa0f143c1a62b423dcd64b␟6509078838412659994:Image Size`,s=$localize`:␟94516fa213706c67ce5a5b5765681d7fb032033a␟3894950702316166331:Loading...`,_=$localize`:␟be7ae8d347aaeb5c3df28d82365bc6b84f576f43␟5376852313208156123:-- No block pools available --`,c=$localize`:␟ef83ec9c304a89d45650e580dcdc2978c37b3a83␟7859304693598053124:-- Select a pool --`,p=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,g=$localize`:␟95c8ca819cb3de20feeda064406716077630e4df␟6069024625163400974:The number of namespaces to create`,T=$localize`:␟a8f8156ce234ecc5804561d0a594bc8ab2135d6e␟1094599248795356853:Namespace Count`,C=$localize`:␟bebea6b612c5bbad2b18d2ea90fb488976777ee1␟8112122075500251377:${"\ufffd0\ufffd"}:INTERPOLATION:`,I=$localize`:␟109dfeab08ca85a7ee40117b12b1e6774230af1e␟8835175026531883897:Enter a positive integer.`,D=$localize`:␟5e6548eb9cbb0467c307b4079bc989cd21f44355␟2501969335659826225:This field is required`,G=$localize`:␟04ebf58534fc9596f429c6790e9f172c8b852197␟7186656199402226894:Enter a value above than previous. A block device image can be expanded but not reduced.`,[["formDir","ngForm"],n,t,o,a,s,_,c,p,T,C,I,D,G,[3,"pageURL","modalRef"],[1,"modal-title"],[1,"modal-content"],["name","nsForm","novalidate","",3,"formGroup"],[1,"modal-body"],[1,"form-group","row"],["for","pool",1,"cd-col-form-label"],[3,"ngClass"],[1,"cd-col-form-input"],["class","form-control","type","text","id","pool-edit","formControlName","pool",4,"ngIf"],["id","pool-create","class","form-select","formControlName","pool",4,"ngIf"],["class","invalid-feedback",4,"ngIf"],["class","form-group row","id","namespace-count",4,"ngIf"],["for","image_size",1,"cd-col-form-label"],[1,"input-group"],["id","size","type","text","formControlName","image_size",1,"form-control"],["id","unit","formControlName","unit",1,"form-input","form-select"],[3,"value",4,"ngFor","ngForOf"],["class","invalid-feedback","id","image-size-invalid",4,"ngIf"],[1,"modal-footer"],[1,"text-right"],[3,"submitActionEvent","form","submitText"],["type","text","id","pool-edit","formControlName","pool",1,"form-control"],["id","pool-create","formControlName","pool",1,"form-select"],[3,"ngValue",4,"ngIf"],[3,"ngValue"],[3,"value"],[1,"invalid-feedback"],["id","namespace-count",1,"form-group","row"],["for","nsCount",1,"cd-col-form-label"],["formControlName","nsCount","helperText",g,"size","sm",3,"min","max","invalid","invalidText"],["id","image-size-invalid",1,"invalid-feedback"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-modal",14)(1,"span",15),e.\u0275\u0275i18n(2,1),e.\u0275\u0275pipe(3,"titlecase"),e.\u0275\u0275pipe(4,"upperFirst"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerStart(5,16),e.\u0275\u0275elementStart(6,"form",17,0)(8,"div",18)(9,"div",19)(10,"label",20)(11,"span",21),e.\u0275\u0275i18n(12,2),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(13,"div",22),e.\u0275\u0275template(14,z_,1,0,"input",23)(15,Q_,5,4,"select",24),e.\u0275\u0275elementStart(16,"cd-help-text"),e.\u0275\u0275i18n(17,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(18,Y_,2,0,"span",25),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(19,W_,6,7,"div",26),e.\u0275\u0275elementStart(20,"div",19)(21,"label",27)(22,"span",21),e.\u0275\u0275i18n(23,4),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(24,"div",22)(25,"div",28),e.\u0275\u0275element(26,"input",29),e.\u0275\u0275elementStart(27,"select",30),e.\u0275\u0275template(28,J_,2,2,"option",31),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(29,Z_,3,0,"span",25)(30,ec,3,0,"span",25)(31,tc,3,0,"span",32),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(32,"div",33)(33,"div",34)(34,"cd-form-button-panel",35),e.\u0275\u0275pipe(35,"titlecase"),e.\u0275\u0275pipe(36,"upperFirst"),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onSubmit())}),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()}if(2&t){const a=e.\u0275\u0275reference(7);e.\u0275\u0275property("pageURL",o.pageURL)("modalRef",o.activeModal),e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(3,17,o.action))(e.\u0275\u0275pipeBind1(4,19,o.resource)),e.\u0275\u0275i18nApply(2),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",o.nsForm),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(25,ln,!o.edit)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",o.edit),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!o.edit),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",o.nsForm.showError("pool",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!o.edit),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(27,ln,o.edit)),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",o.units),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.nsForm.showError("image_size",a,"pattern")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.edit&&o.nsForm.showError("image_size",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.edit&&o.invalidSizeError),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.nsForm)("submitText",e.\u0275\u0275pipeBind1(35,21,o.action)+" "+e.\u0275\u0275pipeBind1(36,23,o.resource))}},dependencies:[l.NgClass,l.NgForOf,l.NgIf,r.\u0275NgNoValidate,r.NgSelectOption,r.\u0275NgSelectMultipleOption,r.DefaultValueAccessor,r.SelectControlValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.FormGroupDirective,r.FormControlName,se.z,A.e,ue.O,f.S,u.a,h.C,R.E,d.Option,d.NumberComponent,l.TitleCasePipe,De.r]})}}function nc(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,6),e.\u0275\u0275elementEnd())}function oc(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18nStart(1,7),e.\u0275\u0275element(2,"br")(3,"code")(4,"br")(5,"code"),e.\u0275\u0275i18nEnd(),e.\u0275\u0275elementEnd())}function ic(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd())}function ac(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,nc,2,0,"span",31)(2,oc,6,0,"span",31)(3,ic,2,0,"span",31),e.\u0275\u0275elementContainerEnd()),2&i){let t,o,a;const s=e.\u0275\u0275nextContext().index,_=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null==(t=_.initiatorForm.get("addHost.addedHosts").controls[s].errors)?null:t.required),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null==(o=_.initiatorForm.get("addHost.addedHosts").controls[s].errors)?null:o.pattern),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null==(a=_.initiatorForm.get("addHost.addedHosts").controls[s].errors)?null:a.maxLength)}}function sc(i,n){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",32),e.\u0275\u0275element(1,"input",33),e.\u0275\u0275elementStart(2,"button",34),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.addHost())}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(3,"svg",35),e.\u0275\u0275elementEnd(),e.\u0275\u0275namespaceHTML(),e.\u0275\u0275elementStart(4,"button",34),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).index,s=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(s.removeHost(a))}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(5,"svg",35),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(6,ac,4,3,"ng-container",36),e.\u0275\u0275elementEnd()}if(2&i){let t;const o=n.index,a=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("required",!a.initiatorForm.getValue("allowAnyHost"))("formControlName",o),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate1("id","add-button-",o,""),e.\u0275\u0275property("disabled",a.initiatorForm.get("addHost.addedHosts").controls[o].invalid||(null==(t=a.initiatorForm.get("addHost.addedHosts").errors)?null:t.duplicate)||32===a.initiatorForm.get("addHost.addedHosts").controls.length||1!==a.initiatorForm.get("addHost.addedHosts").controls.length&&a.initiatorForm.get("addHost.addedHosts").controls.length!==o+1),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",a.icons.add)("size",a.icons.size16),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate1("id","delete-button-",o,""),e.\u0275\u0275property("disabled",1===a.addedHosts.controls.length),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",a.icons.trash)("size",a.icons.size16),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",a.initiatorForm.get("addHost.addedHosts").controls[o].invalid&&(a.initiatorForm.get("addHost.addedHosts").controls[o].dirty||a.initiatorForm.get("addHost.addedHosts").controls[o].touched))}}function rc(i,n){1&i&&(e.\u0275\u0275elementStart(0,"span",37),e.\u0275\u0275i18n(1,9),e.\u0275\u0275elementEnd())}function lc(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",29),e.\u0275\u0275template(1,sc,7,13,"div",30)(2,rc,2,0,"span",31),e.\u0275\u0275elementEnd()),2&i){let t;const o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",o.addedHosts.controls),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",null==(t=o.initiatorForm.get("addHost.addedHosts").errors)?null:t.duplicate)}}function _c(i,n){1&i&&(e.\u0275\u0275elementStart(0,"cd-alert-panel",38),e.\u0275\u0275text(1,"Allowing any host to connect to the NVMe/TCP gateway may pose security risks. "),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("showTitle",!1)}class kt{constructor(n,t,o,a,s,_,c){this.authStorageService=n,this.actionLabels=t,this.nvmeofService=o,this.taskWrapperService=a,this.router=s,this.route=_,this.formBuilder=c,this.remove=!1,this.removeHosts=[],this.NQN_REGEX=/^nqn\.(19|20)\d\d-(0[1-9]|1[0-2])\.\D{2,3}(\.[A-Za-z0-9-]+)+(:[A-Za-z0-9-\.]+(:[A-Za-z0-9-\.]+)*)$/,this.NQN_REGEX_UUID=/^nqn\.2014-08\.org\.nvmexpress:uuid:[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/,this.ALLOW_ALL_HOST="*",this.customNQNValidator=b.xQ.custom("pattern",p=>!!p&&!(this.NQN_REGEX.test(p)||this.NQN_REGEX_UUID.test(p))),this.permission=this.authStorageService.getPermissions().nvmeof,this.resource=$localize`Initiator`,this.pageURL="block/nvmeof/subsystems"}ngOnInit(){this.route.queryParams.subscribe(n=>{this.group=n?.group}),this.createForm(),this.action=this.actionLabels.ADD,this.route.params.subscribe(n=>{this.subsystemNQN=n.subsystem_nqn})}createForm(){this.initiatorForm=new V.$({allowAnyHost:new r.UntypedFormControl(!1),addHost:new V.$({addHostCheck:new r.UntypedFormControl(!1),addedHosts:this.formBuilder.array([],[b.xQ.custom("duplicate",n=>!!n.length&&new Set(n)?.size!==n.length)])})})}get addedHosts(){return this.initiatorForm.get("addHost.addedHosts")}addHost(){let n;n=this.formBuilder.control("",[this.customNQNValidator,r.Validators.required]),this.addedHosts.push(n)}removeHost(n){this.addedHosts.removeAt(n)}setAddHostCheck(){if(this.initiatorForm.get("addHost.addHostCheck").value)this.addHost();else for(;0!==this.addedHosts.length;)this.addedHosts.removeAt(0)}onSubmit(){const n=this,t=this.initiatorForm.getValue("allowAnyHost"),o=this.addedHosts.value;let a=`nvmeof/initiator/${M.Qp.ADD}`;const s={host_nqn:o.join(","),gw_group:this.group};t&&(o.push("*"),s.host_nqn=o.join(",")),this.taskWrapperService.wrapTaskAroundCall({task:new E.O(a,{nqn:this.subsystemNQN}),call:this.nvmeofService.addInitiators(this.subsystemNQN,s)}).subscribe({error(){n.initiatorForm.setErrors({cdSubmitButton:!0})},complete:()=>{this.router.navigate([this.pageURL,{outlets:{modal:null}}])}})}static{this.\u0275fac=function(t){return new(t||kt)(e.\u0275\u0275directiveInject(X.v),e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(te),e.\u0275\u0275directiveInject($.a),e.\u0275\u0275directiveInject(v.Router),e.\u0275\u0275directiveInject(v.ActivatedRoute),e.\u0275\u0275directiveInject(Ft.$))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:kt,selectors:[["cd-nvmeof-initiators-form"]],decls:31,vars:16,consts:()=>{let n,t,o,a,s,_,c,p,g,T;return n=$localize`:␟fb127ea03835b3230f0ed981c7080e2ccb879621␟3346778808274133574:${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd1\ufffd"}:INTERPOLATION_1:`,t=$localize`:␟4f7cdf99e53b74c843abea60b5ca07a6842c9135␟5057509216837769666:Hosts `,o=$localize`:␟4a22a9301c785dfe871e95dd6b3fd5331eb9f75b␟6377543904380590649:Add host`,a=$localize`:␟4ea206ac87d418fd30513619e9edbf2652198431␟952404010486933977:Allow specific hosts to run NVMe/TCP commands to the NVMe subsystem.`,s=$localize`:␟a931566af130afd1e4125308a818f6b061ebd565␟3836966273843263983:Allow any host`,_=$localize`:␟066142fb9dd708098d79ce0c6e2ee61fcaa03bf8␟6084348566346089620:Add host nqn`,c=$localize`:␟7cbdabcece469fab89cfa687ab152bca18b97498␟1417693714872528491:This field is required.`,p=$localize`:␟5a3e2473c0dfaf17f0b18521fcd32cf279e9d494␟4083930278682550844:Expected NQN format${"[\ufffd#2\ufffd\ufffd/#2\ufffd|\ufffd#4\ufffd\ufffd/#4\ufffd]"}:LINE_BREAK:<${"[\ufffd#3\ufffd|\ufffd#5\ufffd]"}:START_TAG_CODE:nqn.$year-$month.$reverseDomainName:$utf8-string${"[\ufffd/#3\ufffd|\ufffd/#5\ufffd]"}:CLOSE_TAG_CODE:".> or ${"[\ufffd#2\ufffd\ufffd/#2\ufffd|\ufffd#4\ufffd\ufffd/#4\ufffd]"}:LINE_BREAK:<${"[\ufffd#3\ufffd|\ufffd#5\ufffd]"}:START_TAG_CODE:nqn.2014-08.org.nvmexpress:uuid:$UUID-string${"[\ufffd/#3\ufffd|\ufffd/#5\ufffd]"}:CLOSE_TAG_CODE:".>`,p=e.\u0275\u0275i18nPostprocess(p),g=$localize`:␟c9e41250c2daa57271a349eb72b306f1ebb1f78c␟9003112016187204330:An NQN may not be more than 223 bytes in length.`,T=$localize`:␟7a2093de32778d3e8d3747e82d2482073203c2d5␟9211064428522594199:Duplicate entry detected. Enter a unique value.`,[["formDir","ngForm"],n,t,o,a,s,c,p,g,T,[3,"pageURL"],[1,"modal-title"],[1,"modal-content"],["name","initiatorForm","novalidate","",3,"formGroup"],[1,"modal-body"],[1,"form-group","row"],[1,"cd-col-form-label","required"],[1,"cd-col-form-input"],["formGroupName","addHost",1,"custom-control","custom-checkbox"],["type","checkbox","id","addHostCheck","name","addHostCheck","formControlName","addHostCheck",1,"custom-control-input",3,"change"],["for","addHostCheck",1,"custom-control-label","mb-0"],["formArrayName","addedHosts",4,"ngIf"],[1,"custom-control","custom-checkbox","pt-0"],["type","checkbox","id","allowAnyHost","name","allowAnyHost","formControlName","allowAnyHost",1,"custom-control-input"],["for","allowAnyHost",1,"custom-control-label"],["type","warning",3,"showTitle",4,"ngIf"],[1,"modal-footer"],[1,"text-right"],[3,"submitActionEvent","form","submitText"],["formArrayName","addedHosts"],["class","input-group cd-mb my-1",4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],[1,"input-group","cd-mb","my-1"],["type","text","placeholder",_,1,"cd-form-control",3,"required","formControlName"],["type","button",1,"btn","btn-light",3,"click","id","disabled"],[3,"cdsIcon","size"],[4,"ngIf"],[1,"invalid-feedback"],["type","warning",3,"showTitle"]]},template:function(t,o){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-modal",10)(1,"span",11),e.\u0275\u0275i18n(2,1),e.\u0275\u0275pipe(3,"titlecase"),e.\u0275\u0275pipe(4,"upperFirst"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerStart(5,12),e.\u0275\u0275elementStart(6,"form",13,0)(8,"div",14)(9,"div",15)(10,"label",16),e.\u0275\u0275i18n(11,2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"div",17)(13,"div",18)(14,"input",19),e.\u0275\u0275listener("change",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.setAddHostCheck())}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"label",20),e.\u0275\u0275i18n(16,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"cd-help-text")(18,"span"),e.\u0275\u0275i18n(19,4),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(20,lc,3,2,"div",21),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"div",22),e.\u0275\u0275element(22,"input",23),e.\u0275\u0275elementStart(23,"label",24),e.\u0275\u0275i18n(24,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(25,_c,2,1,"cd-alert-panel",25),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(26,"div",26)(27,"div",27)(28,"cd-form-button-panel",28),e.\u0275\u0275pipe(29,"titlecase"),e.\u0275\u0275pipe(30,"upperFirst"),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(o.onSubmit())}),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()}2&t&&(e.\u0275\u0275property("pageURL",o.pageURL),e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(3,8,o.action))(e.\u0275\u0275pipeBind1(4,10,o.resource)),e.\u0275\u0275i18nApply(2),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",o.initiatorForm),e.\u0275\u0275advance(14),e.\u0275\u0275property("ngIf",o.initiatorForm.get("addHost.addHostCheck").value),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",o.initiatorForm.getValue("allowAnyHost")),e.\u0275\u0275advance(3),e.\u0275\u0275property("form",o.initiatorForm)("submitText",e.\u0275\u0275pipeBind1(29,12,o.action)+" "+e.\u0275\u0275pipeBind1(30,14,o.resource)))},dependencies:[l.NgForOf,l.NgIf,r.\u0275NgNoValidate,r.DefaultValueAccessor,r.CheckboxControlValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.RequiredValidator,r.FormGroupDirective,r.FormControlName,r.FormGroupName,r.FormArrayName,se.z,we.m,A.e,ue.O,f.S,u.a,h.C,R.E,d.IconDirective,l.TitleCasePipe,De.r]})}}var cc=m(8924),dc=m(8205),mc={elem:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:20,height:20},content:[{elem:"path",attrs:{d:"M16,2A14.1725,14.1725,0,0,0,2,16,14.1725,14.1725,0,0,0,16,30,14.1725,14.1725,0,0,0,30,16,14.1725,14.1725,0,0,0,16,2Zm8,15H17v7H15V17H8V15h7V8h2v7h7Z"}},{elem:"path",attrs:{fill:"none",d:"M24 17L17 17 17 24 15 24 15 17 8 17 8 15 15 15 15 8 17 8 17 15 24 15 24 17z","data-icon-path":"inner-path"}}],name:"add--filled",size:20},pc=m(20527),uc={elem:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:20,height:20},content:[{elem:"path",attrs:{d:"M16,4c6.6,0,12,5.4,12,12s-5.4,12-12,12S4,22.6,4,16S9.4,4,16,4 M16,2C8.3,2,2,8.3,2,16s6.3,14,14,14s14-6.3,14-14\tS23.7,2,16,2z"}},{elem:"path",attrs:{d:"M8 15H24V17H8z"}}],name:"subtract--alt",size:20},gc=m(29376);class Je{constructor(n){this.iconService=n,this.iconService.registerAll([cc.A,dc.A,mc,pc.A,mn.A,gc.A,uc])}static{this.\u0275fac=function(t){return new(t||Je)(e.\u0275\u0275inject(d.IconService))}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Je})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[l.CommonModule,mt,r.FormsModule,r.ReactiveFormsModule,P.NgbNavModule,P.NgbPopoverModule,P.NgbTooltipModule,Ee.Y,J.G,v.RouterModule,d.TreeviewModule,d.UIShellModule,d.InputModule,d.GridModule,d.ButtonModule,d.IconModule,d.CheckboxModule,d.RadioModule,d.SelectModule,d.NumberModule,d.ModalModule,d.DatePickerModule,d.ComboBoxModule,d.TabsModule]})}}const Sc=[{path:"",redirectTo:"rbd",pathMatch:"full"},{path:"rbd",canActivate:[ae.k,W.x],data:{moduleStatusGuardConfig:{uiApiPath:"block/rbd",redirectTo:"error",header:$localize`Block Pool is not configured`,button_name:$localize`Configure Default pool`,button_route:"/pool/create",component:"Default Pool",uiConfig:!0},breadcrumbs:"Images"},children:[{path:"",component:bt},{path:"namespaces",component:At,data:{breadcrumbs:"Namespaces"}},{path:"trash",component:yt,data:{breadcrumbs:"Trash"}},{path:"performance",component:vt,data:{breadcrumbs:"Overall Performance"}},{path:M.Qp.CREATE,component:he,data:{breadcrumbs:M.yY.CREATE}},{path:`${M.Qp.EDIT}/:image_spec`,component:he,data:{breadcrumbs:M.yY.EDIT}},{path:`${M.Qp.CLONE}/:image_spec/:snap`,component:he,data:{breadcrumbs:M.yY.CLONE}},{path:`${M.Qp.COPY}/:image_spec`,component:he,data:{breadcrumbs:M.yY.COPY}},{path:`${M.Qp.COPY}/:image_spec/:snap`,component:he,data:{breadcrumbs:M.yY.COPY}}]},{path:"mirroring",component:Ct,canActivate:[ae.k,W.x],data:{moduleStatusGuardConfig:{uiApiPath:"block/mirroring",redirectTo:"error",header:$localize`Block Mirroring is not configured`,button_name:$localize`Configure Block Mirroring`,button_title:$localize`This will create \"rbd-mirror\" service and a replicated Block pool`,component:"Block Mirroring",uiConfig:!0},breadcrumbs:"Mirroring"},children:[{path:`${M.Qp.EDIT}/:pool_name`,component:Tt,outlet:"modal"}]},{path:"iscsi",canActivate:[ae.k],data:{breadcrumbs:"iSCSI"},children:[{path:"",redirectTo:"overview",pathMatch:"full"},{path:"overview",component:dt,data:{breadcrumbs:"Overview"}},{path:"targets",data:{breadcrumbs:"Targets"},children:[{path:"",component:ct},{path:M.Qp.CREATE,component:Ke,data:{breadcrumbs:M.yY.CREATE}},{path:`${M.Qp.EDIT}/:target_iqn`,component:Ke,data:{breadcrumbs:M.yY.EDIT}}]}]},{path:"nvmeof",canActivate:[W.x],data:{breadcrumbs:!0,text:"NVMe/TCP",path:"nvmeof",disableSplit:!0,moduleStatusGuardConfig:{uiApiPath:"nvmeof",redirectTo:"error",header:$localize`NVMe/TCP Gateway not configured`,button_name:$localize`Configure NVMe/TCP`,button_route:["/services",{outlets:{modal:["create","nvmeof"]}}],uiConfig:!1}},children:[{path:"",redirectTo:"subsystems",pathMatch:"full"},{path:"subsystems",component:Ye,data:{breadcrumbs:"Subsystems"},children:[{path:"",component:Ye},{path:M.Qp.CREATE,component:Vt,outlet:"modal"},{path:`${M.Qp.CREATE}/:subsystem_nqn/listener`,component:Ht,outlet:"modal"},{path:`${M.Qp.CREATE}/:subsystem_nqn/namespace`,component:We,outlet:"modal"},{path:`${M.Qp.EDIT}/:subsystem_nqn/namespace/:nsid`,component:We,outlet:"modal"},{path:`${M.Qp.ADD}/:subsystem_nqn/initiator`,component:kt,outlet:"modal"}]},{path:"gateways",component:$t,data:{breadcrumbs:"Gateways"}}]}];class Kt{static{this.\u0275fac=function(t){return new(t||Kt)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Kt})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[Je,v.RouterModule.forChild(Sc)]})}}},45413:(Ut,fe,m)=>{m.d(fe,{c:()=>se});var l=m(87536),r=m(53648),v=m(29841),P=m.n(v),Ee=m(95631),M=m(46045),ae=m(58384),W=m(6107),J=m(12540),Ce=m(77241),S=m(91974),K=m(19116);class Q{constructor(f,u,h,R){this.elementRef=f,this.control=u,this.dimlessBinaryPerSecondPipe=h,this.formatter=R,this.ngModelChange=new l.EventEmitter,this.el=this.elementRef.nativeElement}ngOnInit(){this.setValue(this.el.value),this.ngDataReady&&this.ngDataReady.subscribe(()=>this.setValue(this.el.value))}setValue(f){/^[\d.]+$/.test(f)&&(f+=this.defaultUnit||"m");const u=this.formatter.toBytes(f,0),h=this.round(u);this.el.value=this.dimlessBinaryPerSecondPipe.transform(h),null!==u?(this.ngModelChange.emit(this.el.value),this.control.control.setValue(this.el.value)):(this.ngModelChange.emit(null),this.control.control.setValue(null))}round(f){if(null!==f&&0!==f){if(!P().isUndefined(this.minBytes)&&f<this.minBytes)return this.minBytes;if(!P().isUndefined(this.maxBytes)&&f>this.maxBytes)return this.maxBytes;if(!P().isUndefined(this.roundPower)){const u=Math.round(Math.log(f)/Math.log(this.roundPower));return Math.pow(this.roundPower,u)}}return f}onBlur(f){this.setValue(f)}static{this.\u0275fac=function(u){return new(u||Q)(l.\u0275\u0275directiveInject(l.ElementRef),l.\u0275\u0275directiveInject(r.NgControl),l.\u0275\u0275directiveInject(K.w),l.\u0275\u0275directiveInject(J.k))}}static{this.\u0275dir=l.\u0275\u0275defineDirective({type:Q,selectors:[["","cdDimlessBinaryPerSecond",""]],hostBindings:function(u,h){1&u&&l.\u0275\u0275listener("blur",function(d){return h.onBlur(d.target.value)})},inputs:{ngDataReady:"ngDataReady",minBytes:"minBytes",maxBytes:"maxBytes",roundPower:"roundPower",defaultUnit:"defaultUnit"},outputs:{ngModelChange:"ngModelChange"}})}}class ce{constructor(f,u){this.control=f,this.formatter=u}setValue(f){const u=this.formatter.toMilliseconds(f);this.control.control.setValue(`${u} ms`)}ngOnInit(){this.setValue(this.control.value),this.ngDataReady&&this.ngDataReady.subscribe(()=>this.setValue(this.control.value))}onUpdate(f){this.setValue(f)}static{this.\u0275fac=function(u){return new(u||ce)(l.\u0275\u0275directiveInject(r.NgControl),l.\u0275\u0275directiveInject(J.k))}}static{this.\u0275dir=l.\u0275\u0275defineDirective({type:ce,selectors:[["","cdMilliseconds",""]],hostBindings:function(u,h){1&u&&l.\u0275\u0275listener("blur",function(d){return h.onUpdate(d.target.value)})},inputs:{ngDataReady:"ngDataReady"}})}}class y{constructor(f,u){this.formatter=f,this.ngControl=u}setValue(f){const u=this.formatter.toIops(f);this.ngControl.control.setValue(`${u} IOPS`)}ngOnInit(){this.setValue(this.ngControl.value),this.ngDataReady&&this.ngDataReady.subscribe(()=>this.setValue(this.ngControl.value))}onUpdate(f){this.setValue(f)}static{this.\u0275fac=function(u){return new(u||y)(l.\u0275\u0275directiveInject(J.k),l.\u0275\u0275directiveInject(r.NgControl))}}static{this.\u0275dir=l.\u0275\u0275defineDirective({type:y,selectors:[["","cdIops",""]],hostBindings:function(u,h){1&u&&l.\u0275\u0275listener("blur",function(d){return h.onUpdate(d.target.value)})},inputs:{ngDataReady:"ngDataReady"}})}}var e=m(90476),U=m(37966),z=m(3600);function Te(A,f){if(1&A&&(l.\u0275\u0275elementContainerStart(0),l.\u0275\u0275element(1,"input",19),l.\u0275\u0275elementContainerEnd()),2&A){const u=l.\u0275\u0275nextContext().$implicit,h=l.\u0275\u0275nextContext(2);l.\u0275\u0275advance(),l.\u0275\u0275property("id",u.name)("name",u.name)("formControlName",u.name)("ngDataReady",h.ngDataReady)("invalid",h.form.get("configuration").controls[u.name].invalid&&h.form.get("configuration").controls[u.name].dirty)}}function Z(A,f){if(1&A&&(l.\u0275\u0275elementContainerStart(0),l.\u0275\u0275element(1,"input",20),l.\u0275\u0275elementContainerEnd()),2&A){const u=l.\u0275\u0275nextContext().$implicit,h=l.\u0275\u0275nextContext(2);l.\u0275\u0275advance(),l.\u0275\u0275property("id",u.name)("name",u.name)("formControlName",u.name)("ngDataReady",h.ngDataReady)("invalid",h.form.get("configuration").controls[u.name].invalid&&h.form.get("configuration").controls[u.name].dirty)}}function F(A,f){if(1&A&&(l.\u0275\u0275elementContainerStart(0),l.\u0275\u0275element(1,"input",21),l.\u0275\u0275elementContainerEnd()),2&A){const u=l.\u0275\u0275nextContext().$implicit,h=l.\u0275\u0275nextContext(2);l.\u0275\u0275advance(),l.\u0275\u0275property("id",u.name)("name",u.name)("formControlName",u.name)("ngDataReady",h.ngDataReady)("invalid",h.form.get("configuration").controls[u.name].invalid&&h.form.get("configuration").controls[u.name].dirty)}}function Ge(A,f){1&A&&(l.\u0275\u0275namespaceSVG(),l.\u0275\u0275element(0,"svg",22))}function V(A,f){1&A&&(l.\u0275\u0275namespaceSVG(),l.\u0275\u0275element(0,"svg",24))}function b(A,f){if(1&A&&l.\u0275\u0275template(0,V,1,0,"svg",23),2&A){const u=l.\u0275\u0275nextContext().$implicit,h=l.\u0275\u0275nextContext(2);l.\u0275\u0275property("ngIf",h.form.get("configuration").get(u.name).disabled)}}function H(A,f){1&A&&(l.\u0275\u0275elementStart(0,"span",26),l.\u0275\u0275i18n(1,4),l.\u0275\u0275elementEnd())}function E(A,f){if(1&A&&l.\u0275\u0275template(0,H,2,0,"span",25),2&A){const u=l.\u0275\u0275nextContext().$implicit,h=l.\u0275\u0275nextContext(2),R=l.\u0275\u0275reference(1);l.\u0275\u0275property("ngIf",h.form.showError("configuration."+u.name,R,"min"))}}function q(A,f){if(1&A){const u=l.\u0275\u0275getCurrentView();l.\u0275\u0275elementStart(0,"div",12)(1,"cds-text-label",13),l.\u0275\u0275text(2),l.\u0275\u0275elementStart(3,"div",14),l.\u0275\u0275elementContainerStart(4,15),l.\u0275\u0275template(5,Te,2,5,"ng-container",16)(6,Z,2,5,"ng-container",16)(7,F,2,5,"ng-container",16),l.\u0275\u0275elementContainerEnd(),l.\u0275\u0275elementStart(8,"cds-icon-button",17),l.\u0275\u0275listener("click",function(){const R=l.\u0275\u0275restoreView(u).$implicit,d=l.\u0275\u0275nextContext(2);return l.\u0275\u0275resetView(d.reset(R.name))}),l.\u0275\u0275template(9,Ge,1,0,"svg",18)(10,b,1,1,"ng-template",null,1,l.\u0275\u0275templateRefExtractor),l.\u0275\u0275elementEnd(),l.\u0275\u0275template(12,E,1,1,"ng-template",null,2,l.\u0275\u0275templateRefExtractor),l.\u0275\u0275elementEnd()()()}if(2&A){const u=f.$implicit,h=l.\u0275\u0275reference(11),R=l.\u0275\u0275reference(13),d=l.\u0275\u0275nextContext(2);l.\u0275\u0275advance(),l.\u0275\u0275property("helperText",u.description)("invalid",d.form.get("configuration").controls[u.name].invalid&&d.form.get("configuration").controls[u.name].dirty)("invalidText",R),l.\u0275\u0275advance(),l.\u0275\u0275textInterpolate1(" ",u.displayName," "),l.\u0275\u0275advance(2),l.\u0275\u0275property("ngSwitch",u.type),l.\u0275\u0275advance(),l.\u0275\u0275property("ngSwitchCase",d.configurationType.milliseconds),l.\u0275\u0275advance(),l.\u0275\u0275property("ngSwitchCase",d.configurationType.bps),l.\u0275\u0275advance(),l.\u0275\u0275property("ngSwitchCase",d.configurationType.iops),l.\u0275\u0275advance(2),l.\u0275\u0275property("ngIf",!d.form.get("configuration").get(u.name).disabled)("ngIfElse",h)}}function $(A,f){if(1&A){const u=l.\u0275\u0275getCurrentView();l.\u0275\u0275elementStart(0,"div")(1,"h5",7)(2,"legend",8),l.\u0275\u0275listener("click",function(){const R=l.\u0275\u0275restoreView(u).$implicit,d=l.\u0275\u0275nextContext();return l.\u0275\u0275resetView(d.toggleSectionVisibility(R.class))}),l.\u0275\u0275text(3),l.\u0275\u0275namespaceSVG(),l.\u0275\u0275element(4,"svg",9),l.\u0275\u0275elementEnd()(),l.\u0275\u0275namespaceHTML(),l.\u0275\u0275elementStart(5,"div",10),l.\u0275\u0275template(6,q,14,10,"div",11),l.\u0275\u0275elementEnd()()}if(2&A){const u=f.$implicit,h=l.\u0275\u0275nextContext();l.\u0275\u0275advance(3),l.\u0275\u0275textInterpolate1(" ",u.heading,"\xa0 "),l.\u0275\u0275advance(),l.\u0275\u0275property("cdsIcon",h.sectionVisibility[u.class]?h.icons.minusCircle:h.icons.addCircle)("size",h.icons.size20),l.\u0275\u0275advance(),l.\u0275\u0275classMap(u.class),l.\u0275\u0275property("hidden",!h.sectionVisibility[u.class]),l.\u0275\u0275advance(),l.\u0275\u0275property("ngForOf",u.options)}}class se{constructor(f,u){this.formatterService=f,this.rbdConfigurationService=u,this.initializeData=new Ee.ReplaySubject(1),this.changes=new l.EventEmitter,this.icons=M.FI,this.ngDataReady=new l.EventEmitter,this.configurationType=W.T,this.sectionVisibility={}}ngOnInit(){const f=this.createConfigurationFormGroup();this.form.addControl("configuration",f),f.valueChanges.subscribe(()=>{this.changes.emit(this.getDirtyValues.bind(this))}),this.initializeData&&this.initializeData.subscribe(u=>{this.initialData=u.initialData;const h=u.sourceType;this.rbdConfigurationService.getWritableOptionFields().forEach(R=>{const d=u.initialData.filter(He=>He.name===R.name).pop();d&&d.source===h&&this.form.get(`configuration.${R.name}`).setValue(d.value)}),this.ngDataReady.emit()}),this.rbdConfigurationService.getWritableSections().forEach(u=>this.sectionVisibility[u.class]=!0)}getDirtyValues(f=!1,u){if(f&&!u){throw new Error("ProgrammingError: If local values shall be included, a proper localFieldType argument has to be provided, too")}const h={};return this.rbdConfigurationService.getWritableOptionFields().forEach(R=>{const d=this.form.get("configuration").get(R.name),He=d.dirty;this.initialData&&this.initialData[R.name]===d.value||(He||f&&d.source===u)&&(null===d.value?h[R.name]=d.value:R.type===W.T.bps?h[R.name]=this.formatterService.toBytes(d.value):R.type===W.T.milliseconds?h[R.name]=this.formatterService.toMilliseconds(d.value):R.type===W.T.iops?h[R.name]=this.formatterService.toIops(d.value):h[R.name]=d.value)}),h}createConfigurationFormGroup(){const f=new ae.$({});return this.rbdConfigurationService.getWritableOptionFields().forEach(u=>{let h;if(u.type!==W.T.milliseconds&&u.type!==W.T.iops&&u.type!==W.T.bps)throw new Error(`Type ${u.type} is unknown, you may need to add it to RbdConfiguration class`);{let R=0;P().forEach(this.initialData,d=>{d.name===u.name&&(R=d.value)}),h=new r.UntypedFormControl(R,r.Validators.min(0))}f.addControl(u.name,h)}),f}reset(f){const u=this.form.get("configuration").get(f);u.disabled?(u.setValue(u.previousValue||0),u.enable(),u.previousValue||u.markAsPristine()):(u.previousValue=u.value,u.setValue(null),u.markAsDirty(),u.disable())}isDisabled(f){return this.form.get("configuration").get(f).disabled}toggleSectionVisibility(f){this.sectionVisibility[f]=!this.sectionVisibility[f]}static{this.\u0275fac=function(u){return new(u||se)(l.\u0275\u0275directiveInject(J.k),l.\u0275\u0275directiveInject(Ce.Q))}}static{this.\u0275cmp=l.\u0275\u0275defineComponent({type:se,selectors:[["cd-rbd-configuration-form"]],inputs:{form:"form",initializeData:"initializeData"},outputs:{changes:"changes"},decls:5,vars:2,consts:()=>{let f,u;return f=$localize`:␟ff92fbdec9fdd5054493eeda0d7ee8b450f83e72␟1662293395030598962:RBD Configuration`,u=$localize`:␟45ce38b7581ffc9b5249c3982c483fcd12e3ff68␟8130619503749751170:The minimum value is 0.`,[["cfgFormGroup",""],["resetIcon",""],["formError",""],f,u,[3,"formGroup"],[4,"ngFor","ngForOf"],[1,"cd-header"],[1,"collapsible",3,"click"],[3,"cdsIcon","size"],[3,"hidden"],["class","form-item",4,"ngFor","ngForOf"],[1,"form-item"],[3,"helperText","invalid","invalidText"],[1,"cds-input-group"],[3,"ngSwitch"],[4,"ngSwitchCase"],["kind","ghost","size","md","data-toggle","button",3,"click"],["cdsIcon","close","size","32","class","cds--btn__icon",4,"ngIf","ngIfElse"],["type","text","cdsText","","cdMilliseconds","",3,"id","name","formControlName","ngDataReady","invalid"],["type","text","cdsText","","defaultUnit","b","cdDimlessBinaryPerSecond","",3,"id","name","formControlName","ngDataReady","invalid"],["type","text","cdsText","","cdIops","",3,"id","name","formControlName","ngDataReady","invalid"],["cdsIcon","close","size","32",1,"cds--btn__icon"],["cdsIcon","reset","size","32",4,"ngIf"],["cdsIcon","reset","size","32"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"]]},template:function(u,h){1&u&&(l.\u0275\u0275elementStart(0,"fieldset",5,0)(2,"legend"),l.\u0275\u0275i18n(3,3),l.\u0275\u0275elementEnd(),l.\u0275\u0275template(4,$,7,8,"div",6),l.\u0275\u0275elementEnd()),2&u&&(l.\u0275\u0275property("formGroup",h.form.get("configuration")),l.\u0275\u0275advance(4),l.\u0275\u0275property("ngForOf",h.rbdConfigurationService.sections))},dependencies:[S.NgForOf,S.NgIf,S.NgSwitch,S.NgSwitchCase,r.DefaultValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.FormGroupDirective,r.FormControlName,Q,ce,y,e.S,U.E,z.TextInputLabelComponent,z.TextInput,z.IconButton,z.IconDirective],styles:[".collapsible[_ngcontent-%COMP%]{cursor:pointer;user-select:none}"]})}}},15224:(Ut,fe,m)=>{m.d(fe,{k:()=>V});var l=m(87536),r=m(62847),v=m(6107);class P{transform(H){return{0:"global",1:"pool",2:"image"}[H]}static{this.\u0275fac=function(E){return new(E||P)}}static{this.\u0275pipe=l.\u0275\u0275definePipe({name:"rbdConfigurationSource",type:P,pure:!0})}}var Ee=m(12540),M=m(77241),ae=m(91974),W=m(19116),J=m(7752),Ce=m(25081);const S=["configurationSourceTpl"],K=["configurationValueTpl"],Q=["poolConfTable"];function ce(b,H){1&b&&(l.\u0275\u0275elementStart(0,"span"),l.\u0275\u0275i18n(1,3),l.\u0275\u0275elementEnd())}function y(b,H){1&b&&(l.\u0275\u0275elementStart(0,"strong"),l.\u0275\u0275i18n(1,4),l.\u0275\u0275elementEnd())}function e(b,H){1&b&&(l.\u0275\u0275elementStart(0,"strong"),l.\u0275\u0275i18n(1,5),l.\u0275\u0275elementEnd())}function U(b,H){if(1&b&&(l.\u0275\u0275elementStart(0,"div",7),l.\u0275\u0275template(1,ce,2,0,"span",8)(2,y,2,0,"strong",8)(3,e,2,0,"strong",8),l.\u0275\u0275elementEnd()),2&b){const E=H.data.value;l.\u0275\u0275property("ngSwitch",E),l.\u0275\u0275advance(),l.\u0275\u0275property("ngSwitchCase","global"),l.\u0275\u0275advance(),l.\u0275\u0275property("ngSwitchCase","image"),l.\u0275\u0275advance(),l.\u0275\u0275property("ngSwitchCase","pool")}}function z(b,H){if(1&b&&(l.\u0275\u0275elementStart(0,"span"),l.\u0275\u0275text(1),l.\u0275\u0275pipe(2,"dimlessBinaryPerSecond"),l.\u0275\u0275elementEnd()),2&b){const E=l.\u0275\u0275nextContext().data.value;l.\u0275\u0275advance(),l.\u0275\u0275textInterpolate(l.\u0275\u0275pipeBind1(2,1,E))}}function Te(b,H){if(1&b&&(l.\u0275\u0275elementStart(0,"span"),l.\u0275\u0275text(1),l.\u0275\u0275pipe(2,"milliseconds"),l.\u0275\u0275elementEnd()),2&b){const E=l.\u0275\u0275nextContext().data.value;l.\u0275\u0275advance(),l.\u0275\u0275textInterpolate(l.\u0275\u0275pipeBind1(2,1,E))}}function Z(b,H){if(1&b&&(l.\u0275\u0275elementStart(0,"span"),l.\u0275\u0275text(1),l.\u0275\u0275pipe(2,"iops"),l.\u0275\u0275elementEnd()),2&b){const E=l.\u0275\u0275nextContext().data.value;l.\u0275\u0275advance(),l.\u0275\u0275textInterpolate(l.\u0275\u0275pipeBind1(2,1,E))}}function F(b,H){if(1&b&&(l.\u0275\u0275elementStart(0,"span"),l.\u0275\u0275text(1),l.\u0275\u0275elementEnd()),2&b){const E=l.\u0275\u0275nextContext().data.value;l.\u0275\u0275advance(),l.\u0275\u0275textInterpolate(E)}}function Ge(b,H){if(1&b&&(l.\u0275\u0275elementStart(0,"div",7),l.\u0275\u0275template(1,z,3,3,"span",8)(2,Te,3,3,"span",8)(3,Z,3,3,"span",8)(4,F,2,1,"span",9),l.\u0275\u0275elementEnd()),2&b){const E=H.data.row,q=l.\u0275\u0275nextContext();l.\u0275\u0275property("ngSwitch",E.type),l.\u0275\u0275advance(),l.\u0275\u0275property("ngSwitchCase",q.typeField.bps),l.\u0275\u0275advance(),l.\u0275\u0275property("ngSwitchCase",q.typeField.milliseconds),l.\u0275\u0275advance(),l.\u0275\u0275property("ngSwitchCase",q.typeField.iops)}}class V{constructor(H,E){this.formatterService=H,this.rbdConfigurationService=E,this.sourceField=v.M,this.typeField=v.T}ngOnInit(){this.poolConfigurationColumns=[{prop:"displayName",name:$localize`Name`},{prop:"description",name:$localize`Description`},{prop:"name",name:$localize`Key`},{prop:"source",name:$localize`Source`,cellTemplate:this.configurationSourceTpl,pipe:new P},{prop:"value",name:$localize`Value`,cellTemplate:this.configurationValueTpl}]}ngOnChanges(){this.data&&(this.data=this.data.filter(H=>this.rbdConfigurationService.getOptionFields().map(E=>E.name).includes(H.name)))}static{this.\u0275fac=function(E){return new(E||V)(l.\u0275\u0275directiveInject(Ee.k),l.\u0275\u0275directiveInject(M.Q))}}static{this.\u0275cmp=l.\u0275\u0275defineComponent({type:V,selectors:[["cd-rbd-configuration-table"]],viewQuery:function(E,q){if(1&E&&(l.\u0275\u0275viewQuery(S,7),l.\u0275\u0275viewQuery(K,7),l.\u0275\u0275viewQuery(Q,7)),2&E){let $;l.\u0275\u0275queryRefresh($=l.\u0275\u0275loadQuery())&&(q.configurationSourceTpl=$.first),l.\u0275\u0275queryRefresh($=l.\u0275\u0275loadQuery())&&(q.configurationValueTpl=$.first),l.\u0275\u0275queryRefresh($=l.\u0275\u0275loadQuery())&&(q.poolConfTable=$.first)}},inputs:{data:"data"},features:[l.\u0275\u0275NgOnChangesFeature],decls:6,vars:2,consts:()=>{let H,E,q;return H=$localize`:␟5decb3917d46a9ac6e5813699801becb7c3c1455␟3437679369074503203:Global`,E=$localize`:␟a5f9ba9bb9faa8284bcadb1cdbc6aaf969e9c4bb␟3012906865384504293:Image`,q=$localize`:␟e70fcca5a99575cffef3ff8cbd5e69f06ffd0f1c␟7101197021456818771:Pool`,[["poolConfTable",""],["configurationSourceTpl",""],["configurationValueTpl",""],H,E,q,["identifier","name",3,"data","columns"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"]]},template:function(E,q){1&E&&(l.\u0275\u0275element(0,"cd-table",6,0),l.\u0275\u0275template(2,U,4,4,"ng-template",null,1,l.\u0275\u0275templateRefExtractor)(4,Ge,5,4,"ng-template",null,2,l.\u0275\u0275templateRefExtractor)),2&E&&l.\u0275\u0275property("data",q.data)("columns",q.poolConfigurationColumns)},dependencies:[ae.NgSwitch,ae.NgSwitchCase,ae.NgSwitchDefault,r.O,W.w,J.f,Ce.U]})}}},6872:(Ut,fe,m)=>{m.d(fe,{B:()=>Q});var l=m(84857),v=m(36618),Ee=m(95631),ae=m(50619),J=m(80697),Ce=m(15643),S=m(87536);let Q=class Xt{constructor(y,e){this.http=y,this.timerService=e,this.REFRESH_INTERVAL=3e4,this.summaryDataSource=new Ee.BehaviorSubject(null),this.summaryData$=this.summaryDataSource.asObservable()}startPolling(){return this.timerService.get(()=>this.retrieveSummaryObservable(),this.REFRESH_INTERVAL).subscribe(this.retrieveSummaryObserver())}refresh(){return this.retrieveSummaryObservable().subscribe(this.retrieveSummaryObserver())}retrieveSummaryObservable(){return this.http.get("api/block/mirroring/summary")}retrieveSummaryObserver(){return y=>{this.summaryDataSource.next(y)}}subscribeSummary(y,e){return this.summaryData$.pipe((0,ae.filter)(U=>!!U)).subscribe(y,e)}getPool(y){return this.http.get(`api/block/mirroring/pool/${y}`)}updatePool(y,e){return this.http.put(`api/block/mirroring/pool/${y}`,e,{observe:"response"})}getSiteName(){return this.http.get("api/block/mirroring/site_name")}setSiteName(y){return this.http.put("api/block/mirroring/site_name",{site_name:y},{observe:"response"})}createBootstrapToken(y){return this.http.post(`api/block/mirroring/pool/${y}/bootstrap/token`,{})}importBootstrapToken(y,e,U){const z={direction:e,token:U};return this.http.post(`api/block/mirroring/pool/${y}/bootstrap/peer`,z,{observe:"response"})}getPeer(y,e){return this.http.get(`api/block/mirroring/pool/${y}/peer/${e}`)}getPeerForPool(y){return this.http.get(`api/block/mirroring/pool/${y}/peer`)}addPeer(y,e){return this.http.post(`api/block/mirroring/pool/${y}/peer`,e,{observe:"response"})}updatePeer(y,e,U){return this.http.put(`api/block/mirroring/pool/${y}/peer/${e}`,U,{observe:"response"})}deletePeer(y,e){return this.http.delete(`api/block/mirroring/pool/${y}/peer/${e}`,{observe:"response"})}static{this.\u0275fac=function(e){return new(e||Xt)(S.\u0275\u0275inject(v.HttpClient),S.\u0275\u0275inject(Ce.H))}}static{this.\u0275prov=S.\u0275\u0275defineInjectable({token:Xt,factory:Xt.\u0275fac,providedIn:"root"})}};(0,l.__decorate)([(0,l.__param)(0,J.R),(0,l.__metadata)("design:type",Function),(0,l.__metadata)("design:paramtypes",[String]),(0,l.__metadata)("design:returntype",void 0)],Q.prototype,"setSiteName",null),(0,l.__decorate)([(0,l.__param)(1,J.R),(0,l.__param)(2,J.R),(0,l.__metadata)("design:type",Function),(0,l.__metadata)("design:paramtypes",[String,String,String]),(0,l.__metadata)("design:returntype",void 0)],Q.prototype,"importBootstrapToken",null),Q=(0,l.__decorate)([J.G,(0,l.__metadata)("design:paramtypes",[v.HttpClient,Ce.H])],Q)}}]);
//# sourceMappingURL=default-src_app_ceph_block_block_module_ts.js.map
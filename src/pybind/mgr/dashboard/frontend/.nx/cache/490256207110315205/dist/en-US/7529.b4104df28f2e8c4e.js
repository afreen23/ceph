(self.webpackChunkceph_dashboard=self.webpackChunkceph_dashboard||[]).push([[7529],{77529:(r_,Ue,s)=>{s.r(Ue),s.d(Ue,{PoolModule:()=>We,RoutedPoolModule:()=>l_});var L=s(91974),r=s(53648),Pe=s(76218),E=s(77317),M=s(54372),St=s(93887),ht=s(25598),Lt=s(26481),e=s(87536),Ft=s(29841),f=s.n(Ft),Tt=s(95631),Nt=s(5155),Ge=s(17612),At=s(36618);let Me=(()=>{class n{constructor(t){this.http=t,this.apiPath="api/erasure_code_profile",this.formTooltips={k:"Each object is split in data-chunks parts, each stored on a different OSD.",m:"Compute coding chunks for each object and store them on different OSDs.\n      The number of coding chunks is also the number of OSDs that can be down without losing data.",plugins:{jerasure:{description:"The jerasure plugin is the most generic and flexible plugin,\n          it is also the default for Ceph erasure coded pools.",technique:"The more flexible technique is reed_sol_van : it is enough to set k\n          and m. The cauchy_good technique can be faster but you need to chose the packetsize\n          carefully. All of reed_sol_r6_op, liberation, blaum_roth, liber8tion are RAID6 equivalents\n          in the sense that they can only be configured with m=2.",packetSize:"The encoding will be done on packets of bytes size at a time.\n          Choosing the right packet size is difficult.\n          The jerasure documentation contains extensive information on this topic."},lrc:{description:"With the jerasure plugin, when an erasure coded object is stored on\n          multiple OSDs, recovering from the loss of one OSD requires reading from all the others.\n          For instance if jerasure is configured with k=8 and m=4, losing one OSD requires reading\n          from the eleven others to repair.\n\n          The lrc erasure code plugin creates local parity chunks to be able to recover using\n          less OSDs. For instance if lrc is configured with k=8, m=4 and l=4, it will create\n          an additional parity chunk for every four OSDs. When a single OSD is lost, it can be\n          recovered with only four OSDs instead of eleven.",l:"Group the coding and data chunks into sets of size locality. For instance,\n          for k=4 and m=2, when locality=3 two groups of three are created. Each set can\n          be recovered without reading chunks from another set.",crushLocality:"The type of the crush bucket in which each set of chunks defined\n          by l will be stored. For instance, if it is set to rack, each group of l chunks will be\n          placed in a different rack. It is used to create a CRUSH rule step such as step choose\n          rack. If it is not set, no such grouping is done."},isa:{description:"The isa plugin encapsulates the ISA library. It only runs on Intel processors.",technique:"The ISA plugin comes in two Reed Solomon forms.\n          If reed_sol_van is set, it is Vandermonde, if cauchy is set, it is Cauchy."},shec:{description:"The shec plugin encapsulates the multiple SHEC library.\n          It allows ceph to recover data more efficiently than Reed Solomon codes.",c:"The number of parity chunks each of which includes each data chunk in its\n          calculation range. The number is used as a durability estimator. For instance, if c=2,\n          2 OSDs can be down without losing data."},clay:{description:"CLAY (short for coupled-layer) codes are erasure codes designed to\n          bring about significant savings in terms of network bandwidth and disk IO when a failed\n          node/OSD/rack is being repaired.",d:"Number of OSDs requested to send data during recovery of a single chunk.\n          d needs to be chosen such that k+1 <= d <= k+m-1. The larger the d, the better\n          the savings.",scalar_mds:"scalar_mds specifies the plugin that is used as a building block\n          in the layered construction. It can be one of jerasure, isa, shec.",technique:"technique specifies the technique that will be picked\n          within the 'scalar_mds' plugin specified. Supported techniques\n          are 'reed_sol_van', 'reed_sol_r6_op', 'cauchy_orig',\n          'cauchy_good', 'liber8tion' for jerasure, 'reed_sol_van',\n          'cauchy' for isa and 'single', 'multiple' for shec."}},crushRoot:"The name of the crush bucket used for the first step of the CRUSH rule.\n      For instance step take default.",crushFailureDomain:"Ensure that no two chunks are in a bucket with the same failure\n      domain. For instance, if the failure domain is host no two chunks will be stored on the same\n      host. It is used to create a CRUSH rule step such as step chooseleaf host.",crushNumFailureDomains:" Number of failure domains to map. Results in a CRUSH MSR rule being created.\n    Must be specified if crush-osds-per-failure-domain is specified.",crushOsdsPerFailureDomain:"Maximum number of OSDs to place in each failure domain --\n     defaults to 1. Using a value greater than one will cause a CRUSH MSR rule to be created.\n      Must be specified if crush-num-failure-domains is specified.",crushDeviceClass:"The device class on which to place data.",directory:"Set the directory name from which the erasure code plugin is loaded."}}list(){return this.http.get(this.apiPath)}create(t){return this.http.post(this.apiPath,t,{observe:"response"})}delete(t){return this.http.delete(`${this.apiPath}/${t}`,{observe:"response"})}getInfo(){return this.http.get(`ui-${this.apiPath}/info`)}static{this.\u0275fac=function(o){return new(o||n)(e.\u0275\u0275inject(At.HttpClient))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Se=s(59870);class vt{}var Ce=function(n){return n.Osd="osd",n.Host="host",n}(Ce||{});class T{constructor(){this.nodes=[],this.idTree={},this.allDevices=[],this.buckets=[],this.failureDomains={},this.failureDomainKeys=[],this.devices=[],this.deviceCount=0,this.autoDeviceUpdate=!0}static searchFailureDomains(_,t){return this.getFailureDomains(this.search(_,t))}static search(_,t){const[o,i]=t.split("~"),a=_.find(d=>["name","id","type"].some(O=>d[O]===o));return a?(_=this.getSubNodes(a,this.createIdTreeFromNodes(_)),i&&(_=this.filterNodesByDeviceType(_,i)),_):[]}static createIdTreeFromNodes(_){const t={};return _.forEach(o=>{t[o.id]=o}),t}static getSubNodes(_,t){let o=[_];return _.children&&_.children.forEach(i=>{o=o.concat(this.getSubNodes(t[i],t))}),o}static filterNodesByDeviceType(_,t){let i,o=_.filter(d=>d.device_class&&d.device_class!==t).map(d=>d.id),a=o;do{i=!1,_=_.filter(O=>!o.includes(O.id));const d=[];_.forEach(O=>{O.children&&O.children.every(m=>o.includes(m))&&(d.push(O.id),i=!0)}),i&&(o=d,a=a.concat(d))}while(i);return(_=f().cloneDeep(_)).map(d=>(d.children&&(d.children=d.children.filter(O=>!a.includes(O))),d))}static getFailureDomains(_){const t={};return _.forEach(o=>{const i=o.type;t[i]||(t[i]=[]),t[i].push(o)}),t}initCrushNodeSelection(_,t,o,i,a=!0){this.autoDeviceUpdate=a,this.nodes=_,this.idTree=T.createIdTreeFromNodes(_),_.forEach(d=>{this.idTree[d.id]=d}),this.buckets=f().sortBy(_.filter(d=>d.children),"name"),this.controls={root:t,failure:o,device:i},this.preSelectRoot(),this.controls.root.valueChanges.subscribe(()=>this.onRootChange()),this.controls.failure.valueChanges.subscribe(()=>this.onFailureDomainChange()),this.controls.device.valueChanges.subscribe(()=>this.onDeviceChange())}preSelectRoot(){const _=this.nodes.find(t=>"root"===t.type);this.silentSet(this.controls.root,_),this.onRootChange()}silentSet(_,t){_.setValue(t,{emitEvent:!1})}onRootChange(){const _=T.getSubNodes(this.controls.root.value,this.idTree),t=T.getFailureDomains(_);Object.keys(t).forEach(o=>{t[o].length<=1&&delete t[o]}),this.failureDomains=t,this.failureDomainKeys=Object.keys(t).sort(),this.updateFailureDomain()}updateFailureDomain(){let _=this.getIncludedCustomValue(this.controls.failure,Object.keys(this.failureDomains));""===_&&(_=this.setMostCommonDomain(this.controls.failure)),this.updateDevices(_)}getIncludedCustomValue(_,t){return _.dirty&&t.includes(_.value)?_.value:""}setMostCommonDomain(_){let t={n:0,type:""};return Object.keys(this.failureDomains).forEach(o=>{const i=this.failureDomains[o].length;t.n<i&&(t={n:i,type:o})}),this.silentSet(_,t.type),t.type}onFailureDomainChange(){this.updateDevices()}updateDevices(_=this.controls.failure.value){if(_===Ce.Host)this.allDevices=this.failureDomains[_].filter(t=>t.type).map(t=>t.type),this.onDeviceChange("");else{const t=f().flatten(this.failureDomains[_].map(i=>T.getSubNodes(i,this.idTree)));this.allDevices=t.filter(i=>i.device_class).map(i=>i.device_class),this.devices=f().uniq(this.allDevices).sort();const o=1===this.devices.length?this.devices[0]:this.getIncludedCustomValue(this.controls.device,this.devices);this.autoDeviceUpdate&&this.silentSet(this.controls.device,o),this.onDeviceChange(o)}}onDeviceChange(_=this.controls.device.value){this.deviceCount=""===_?this.allDevices.length:this.allDevices.filter(t=>t===_).length}}var ze=s(84821),bt=s(31345),b=s(46045),It=s(74902),He=s(58384),u=s(3687),$t=s(6107),I=s(85481),Dt=s(73651),Xe=s(82254),yt=s(12540),xt=s(77867),Re=s(50813),Ve=s(43808),he=s(55472),we=s(69081),Le=s(59781),Fe=s(64333),Te=s(23603),Ne=s(90476),Ae=s(10142),ve=s(78708),be=s(37966),Ie=s(37353);function Ut(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",38),e.\u0275\u0275i18n(1,8),e.\u0275\u0275elementEnd())}function Gt(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",38),e.\u0275\u0275i18n(1,9),e.\u0275\u0275elementEnd())}function zt(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",38),e.\u0275\u0275i18n(1,10),e.\u0275\u0275elementEnd())}function Ht(n,_){1&n&&(e.\u0275\u0275elementStart(0,"option",35),e.\u0275\u0275i18n(1,11),e.\u0275\u0275elementEnd())}function Xt(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"option",39),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit;e.\u0275\u0275property("ngValue",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t.name," ")}}function Vt(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",38),e.\u0275\u0275i18n(1,12),e.\u0275\u0275elementEnd())}function wt(n,_){1&n&&(e.\u0275\u0275elementStart(0,"option",35),e.\u0275\u0275i18n(1,13),e.\u0275\u0275elementEnd())}function kt(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"option",39),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit,o=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngValue",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate2(" ",t," ( ",o.failureDomains[t].length," ) ")}}function Bt(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",38),e.\u0275\u0275i18n(1,14),e.\u0275\u0275elementEnd())}function jt(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"option",39),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit;e.\u0275\u0275property("ngValue",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t," ")}}let qt=(()=>{class n extends T{constructor(t,o,i,a,d){super(),this.formBuilder=t,this.activeModal=o,this.taskWrapper=i,this.crushRuleService=a,this.actionLabels=d,this.submitAction=new e.EventEmitter,this.action=this.actionLabels.CREATE,this.resource="Crush Rule",this.createForm()}createForm(){this.form=this.formBuilder.group({name:["",[r.Validators.required,r.Validators.pattern("[A-Za-z0-9_-]+"),u.xQ.custom("uniqueName",t=>this.names&&-1!==this.names.indexOf(t))]],root:null,failure_domain:"",device_class:""})}ngOnInit(){this.tooltips=this.crushRuleService.formTooltips,this.crushRuleService.getInfo().subscribe(({names:t,nodes:o})=>{this.initCrushNodeSelection(o,this.form.get("root"),this.form.get("failure_domain"),this.form.get("device_class"),!1),this.names=t})}onSubmit(){if(this.form.invalid)return void this.form.setErrors({cdSubmitButton:!0});const t=f().cloneDeep(this.form.value);t.root=t.root.name,""===t.device_class&&delete t.device_class,this.taskWrapper.wrapTaskAroundCall({task:new I.O("crushRule/create",t),call:this.crushRuleService.create(t)}).subscribe({error:()=>{this.form.setErrors({cdSubmitButton:!0})},complete:()=>{this.activeModal.close(),this.submitAction.emit(t)}})}static{this.\u0275fac=function(o){return new(o||n)(e.\u0275\u0275directiveInject(Ve.$),e.\u0275\u0275directiveInject(E.NgbActiveModal),e.\u0275\u0275directiveInject(Re.a),e.\u0275\u0275directiveInject(Ge.j),e.\u0275\u0275directiveInject(M.Ss))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["cd-crush-rule-form-modal"]],outputs:{submitAction:"submitAction"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:57,vars:27,consts:()=>{let t,o,i,a,d,O,m,p,C,S,h,R,g,F;return t="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",o="Name",i="Root",a="Failure domain type",d="Device class",O="All devices",m="" + "\ufffd0\ufffd" + "",p="This field is required!",C="The name can only consist of alphanumeric characters, dashes and underscores.",S="The chosen erasure code profile name is already in use.",h="Loading...",R="This field is required!",g="Loading...",F="This field is required!",[["frm","ngForm"],t,o,i,a,d,O,m,p,C,S,h,R,g,F,[3,"modalRef"],[1,"modal-title"],[1,"modal-content"],["novalidate","",3,"formGroup"],[1,"modal-body"],[1,"form-group","row"],["for","name",1,"cd-col-form-label"],[1,"required"],[1,"cd-col-form-input"],["type","text","id","name","name","name","placeholder","Name...","formControlName","name","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","root",1,"cd-col-form-label"],[3,"html"],["id","root","name","root","formControlName","root",1,"form-select"],["ngValue","",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],["for","failure_domain",1,"cd-col-form-label"],["id","failure_domain","name","failure_domain","formControlName","failure_domain",1,"form-select"],["for","device_class",1,"cd-col-form-label"],["id","device_class","name","device_class","formControlName","device_class",1,"form-select"],["ngValue",""],[1,"modal-footer"],[3,"submitActionEvent","form","submitText"],[1,"invalid-feedback"],[3,"ngValue"]]},template:function(o,i){if(1&o){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-modal",15),e.\u0275\u0275elementContainerStart(1,16),e.\u0275\u0275i18n(2,1),e.\u0275\u0275pipe(3,"titlecase"),e.\u0275\u0275pipe(4,"upperFirst"),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(5,17),e.\u0275\u0275elementStart(6,"form",18,0)(8,"div",19)(9,"div",20)(10,"label",21),e.\u0275\u0275elementContainerStart(11),e.\u0275\u0275i18n(12,2),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275element(13,"span",22),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"div",23),e.\u0275\u0275element(15,"input",24),e.\u0275\u0275template(16,Ut,2,0,"span",25)(17,Gt,2,0,"span",25)(18,zt,2,0,"span",25),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(19,"div",20)(20,"label",26),e.\u0275\u0275elementContainerStart(21),e.\u0275\u0275i18n(22,3),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275element(23,"cd-helper",27)(24,"span",22),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(25,"div",23)(26,"select",28),e.\u0275\u0275template(27,Ht,2,0,"option",29)(28,Xt,2,2,"option",30),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(29,Vt,2,0,"span",25),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(30,"div",20)(31,"label",31),e.\u0275\u0275elementContainerStart(32),e.\u0275\u0275i18n(33,4),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275element(34,"cd-helper",27)(35,"span",22),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(36,"div",23)(37,"select",32),e.\u0275\u0275template(38,wt,2,0,"option",29)(39,kt,2,3,"option",30),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(40,Bt,2,0,"span",25),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(41,"div",20)(42,"label",33),e.\u0275\u0275elementContainerStart(43),e.\u0275\u0275i18n(44,5),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(45,"div",23)(46,"select",34)(47,"option",35),e.\u0275\u0275i18n(48,6),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(49,jt,2,2,"option",30),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(50,"cd-help-text")(51,"span"),e.\u0275\u0275i18n(52,7),e.\u0275\u0275elementEnd()()()()(),e.\u0275\u0275elementStart(53,"div",36)(54,"cd-form-button-panel",37),e.\u0275\u0275pipe(55,"titlecase"),e.\u0275\u0275pipe(56,"upperFirst"),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(i.onSubmit())}),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()}if(2&o){const a=e.\u0275\u0275reference(7);e.\u0275\u0275property("modalRef",i.activeModal),e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(3,19,i.action))(e.\u0275\u0275pipeBind1(4,21,i.resource)),e.\u0275\u0275i18nApply(2),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",i.form),e.\u0275\u0275advance(10),e.\u0275\u0275property("ngIf",i.form.showError("name",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.form.showError("name",a,"pattern")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.form.showError("name",a,"uniqueName")),e.\u0275\u0275advance(5),e.\u0275\u0275property("html",i.tooltips.root),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",!i.buckets),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",i.buckets),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.form.showError("root",a,"required")),e.\u0275\u0275advance(5),e.\u0275\u0275property("html",i.tooltips.failure_domain),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",!i.failureDomains),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",i.failureDomainKeys),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.form.showError("failure_domain",a,"required")),e.\u0275\u0275advance(9),e.\u0275\u0275property("ngForOf",i.devices),e.\u0275\u0275advance(3),e.\u0275\u0275i18nExp(i.tooltips.device_class),e.\u0275\u0275i18nApply(52),e.\u0275\u0275advance(2),e.\u0275\u0275property("form",i.form)("submitText",e.\u0275\u0275pipeBind1(55,23,i.action)+" "+e.\u0275\u0275pipeBind1(56,25,i.resource))}},dependencies:[L.NgForOf,L.NgIf,he.m,we.z,Le.e,Fe.O,Te.B,Ne.S,Ae.a,ve.C,be.E,r.\u0275NgNoValidate,r.NgSelectOption,r.\u0275NgSelectMultipleOption,r.DefaultValueAccessor,r.SelectControlValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.FormGroupDirective,r.FormControlName,L.TitleCasePipe,Ie.r]})}}return n})();var ge=s(3600);const ke=(n,_,t)=>[n,_,t];function Qt(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,15),e.\u0275\u0275elementEnd())}function Jt(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,16),e.\u0275\u0275elementEnd())}function Kt(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,17),e.\u0275\u0275elementEnd())}function Wt(n,_){1&n&&(e.\u0275\u0275elementStart(0,"option",88),e.\u0275\u0275i18n(1,18),e.\u0275\u0275elementEnd())}function Yt(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"option",95),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit;e.\u0275\u0275property("ngValue",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t," ")}}function Zt(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,19),e.\u0275\u0275elementEnd())}function en(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,20),e.\u0275\u0275elementEnd())}function tn(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,21),e.\u0275\u0275elementEnd())}function nn(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,22),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275i18nExp(t.deviceCount),e.\u0275\u0275i18nApply(1)}}function on(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,23),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275i18nExp(t.deviceCount),e.\u0275\u0275i18nApply(1)}}function _n(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,24),e.\u0275\u0275elementEnd())}function an(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,25),e.\u0275\u0275elementEnd())}function ln(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"span",89),e.\u0275\u0275i18n(1,26),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275i18nExp(t.lrcMultiK),e.\u0275\u0275i18nApply(1)}}function rn(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,27),e.\u0275\u0275elementEnd())}function sn(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,28),e.\u0275\u0275elementEnd())}function dn(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,29),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275i18nExp(t.deviceCount),e.\u0275\u0275i18nApply(1)}}function cn(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,30),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275i18nExp(t.deviceCount),e.\u0275\u0275i18nApply(1)}}function On(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,32),e.\u0275\u0275elementEnd())}function mn(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,33),e.\u0275\u0275elementEnd())}function un(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"div",61)(1,"label",96)(2,"span",67),e.\u0275\u0275i18n(3,31),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"cd-helper",68),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",63),e.\u0275\u0275element(6,"input",97),e.\u0275\u0275template(7,On,2,0,"span",65)(8,mn,2,0,"span",65),e.\u0275\u0275elementEnd()()),2&n){const t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(7);e.\u0275\u0275advance(4),e.\u0275\u0275property("html",t.tooltips.plugins.shec.c),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",t.form.showError("c",o,"min")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.form.showError("c",o,"cGreaterM"))}}function En(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",89),e.\u0275\u0275i18n(1,35),e.\u0275\u0275elementEnd())}function pn(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"span",89),e.\u0275\u0275i18n(1,36),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(),e.\u0275\u0275i18nExp(t.getDMin())(t.getDMax()),e.\u0275\u0275i18nApply(1)}}function fn(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"span",89),e.\u0275\u0275i18n(1,37),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(),e.\u0275\u0275i18nExp(t.getDMax()),e.\u0275\u0275i18nApply(1)}}function Pn(n,_){if(1&n&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,pn,2,2,"span",74)(2,fn,2,1,"span",74),e.\u0275\u0275elementContainerEnd()),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.getDMin()<t.getDMax()),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.getDMin()===t.getDMax())}}function Cn(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,38),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275i18nExp(t.getDMin()),e.\u0275\u0275i18nApply(1)}}function Rn(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,39),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275i18nExp(t.getDMax()),e.\u0275\u0275i18nApply(1)}}function gn(n,_){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",61)(1,"label",98)(2,"span",67),e.\u0275\u0275i18n(3,34),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"cd-helper",68),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",63)(6,"div",99),e.\u0275\u0275element(7,"input",100),e.\u0275\u0275elementStart(8,"button",101),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(i.toggleDCalc())}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(9,"svg",102),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(10,En,2,0,"span",74)(11,Pn,3,2,"ng-container",103)(12,Cn,2,1,"span",65)(13,Rn,2,1,"span",65),e.\u0275\u0275elementEnd()()}if(2&n){const t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(7);e.\u0275\u0275advance(4),e.\u0275\u0275property("html",t.tooltips.plugins.clay.d),e.\u0275\u0275advance(5),e.\u0275\u0275property("cdsIcon",t.dCalc?t.icons.unlock:t.icons.lock)("size",t.icons.size16),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.dCalc),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!t.dCalc),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.form.showError("d",o,"dMin")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.form.showError("d",o,"dMax"))}}function Mn(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,42),e.\u0275\u0275elementEnd())}function Sn(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,43),e.\u0275\u0275elementEnd())}function hn(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,44),e.\u0275\u0275elementEnd())}function Ln(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"div",61)(1,"label",104)(2,"span",67),e.\u0275\u0275i18n(3,40),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"cd-helper",68),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",63),e.\u0275\u0275element(6,"input",105),e.\u0275\u0275template(7,Mn,2,0,"span",65)(8,Sn,2,0,"span",65)(9,hn,2,0,"span",65),e.\u0275\u0275elementStart(10,"span",89),e.\u0275\u0275i18n(11,41),e.\u0275\u0275elementEnd()()()),2&n){const t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(7);e.\u0275\u0275advance(4),e.\u0275\u0275property("html",t.tooltips.plugins.lrc.l),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",t.form.showError("l",o,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.form.showError("l",o,"min")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.form.showError("l",o,"unequal")),e.\u0275\u0275advance(2),e.\u0275\u0275i18nExp(t.lrcGroups),e.\u0275\u0275i18nApply(11)}}function Fn(n,_){1&n&&(e.\u0275\u0275elementStart(0,"option",88),e.\u0275\u0275i18n(1,45),e.\u0275\u0275elementEnd())}function Tn(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"option",95),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit,o=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngValue",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate2(" ",t," ( ",o.failureDomains[t].length," ) ")}}function Nn(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,46),e.\u0275\u0275elementEnd())}function An(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,47),e.\u0275\u0275elementEnd())}function vn(n,_){1&n&&(e.\u0275\u0275elementStart(0,"option",88),e.\u0275\u0275i18n(1,49),e.\u0275\u0275elementEnd())}function bn(n,_){1&n&&(e.\u0275\u0275elementStart(0,"option",88),e.\u0275\u0275i18n(1,50),e.\u0275\u0275elementEnd())}function In(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"option",95),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit,o=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("ngValue",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate2(" ",t," ( ",o.failureDomains[t].length," ) ")}}function $n(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"div",61)(1,"label",106),e.\u0275\u0275elementContainerStart(2),e.\u0275\u0275i18n(3,48),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275element(4,"cd-helper",68),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",63)(6,"select",107),e.\u0275\u0275template(7,vn,2,0,"option",70)(8,bn,2,0,"option",70)(9,In,2,3,"option",71),e.\u0275\u0275elementEnd()()()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275property("html",t.tooltips.plugins.lrc.crushLocality),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!t.failureDomains),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.failureDomainKeys.length>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",t.failureDomainKeys)}}function Dn(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"option",95),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit;e.\u0275\u0275property("ngValue",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t," ")}}function yn(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"div",61)(1,"label",108),e.\u0275\u0275elementContainerStart(2),e.\u0275\u0275i18n(3,51),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275element(4,"cd-helper",68),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",63)(6,"select",109),e.\u0275\u0275template(7,Dn,2,2,"option",71),e.\u0275\u0275elementEnd()()()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275property("html",t.tooltips.plugins.clay.scalar_mds),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pureFunction3(2,ke,t.PLUGIN.JERASURE,t.PLUGIN.ISA,t.PLUGIN.SHEC))}}function xn(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"option",95),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit;e.\u0275\u0275property("ngValue",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t," ")}}function Un(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"div",61)(1,"label",110),e.\u0275\u0275elementContainerStart(2),e.\u0275\u0275i18n(3,52),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275element(4,"cd-helper",68),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",63)(6,"select",111),e.\u0275\u0275template(7,xn,2,2,"option",71),e.\u0275\u0275elementEnd()()()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275property("html",t.tooltips.plugins[t.plugin].technique),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.techniques)}}function Gn(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",94),e.\u0275\u0275i18n(1,54),e.\u0275\u0275elementEnd())}function zn(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"div",61)(1,"label",112),e.\u0275\u0275elementContainerStart(2),e.\u0275\u0275i18n(3,53),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275element(4,"cd-helper",68),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",63),e.\u0275\u0275element(6,"input",113),e.\u0275\u0275template(7,Gn,2,0,"span",65),e.\u0275\u0275elementEnd()()),2&n){const t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(7);e.\u0275\u0275advance(4),e.\u0275\u0275property("html",t.tooltips.plugins.jerasure.packetSize),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",t.form.showError("packetSize",o,"min"))}}function Hn(n,_){1&n&&(e.\u0275\u0275elementStart(0,"option",88),e.\u0275\u0275i18n(1,55),e.\u0275\u0275elementEnd())}function Xn(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"option",95),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit;e.\u0275\u0275property("ngValue",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t.name," ")}}function Vn(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"option",95),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit;e.\u0275\u0275property("ngValue",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t," ")}}let wn=(()=>{class n extends T{constructor(t,o,i,a,d){super(),this.formBuilder=t,this.activeModal=o,this.taskWrapper=i,this.ecpService=a,this.actionLabels=d,this.submitAction=new e.EventEmitter,this.PLUGIN={LRC:"lrc",SHEC:"shec",CLAY:"clay",JERASURE:"jerasure",ISA:"isa"},this.plugin=this.PLUGIN.JERASURE,this.icons=b.FI,this.CrushFailureDomains=Ce,this.action=this.actionLabels.CREATE,this.resource="EC Profile",this.createForm(),this.setJerasureDefaults()}createForm(){this.form=this.formBuilder.group({name:[null,[r.Validators.required,r.Validators.pattern("[A-Za-z0-9_-]+"),u.xQ.custom("uniqueName",t=>this.names&&-1!==this.names.indexOf(t))]],plugin:[this.PLUGIN.JERASURE,[r.Validators.required]],k:[4,[r.Validators.required,u.xQ.custom("max",()=>this.baseValueValidation(!0)),u.xQ.custom("unequal",t=>this.lrcDataValidation(t)),u.xQ.custom("kLowerM",t=>this.shecDataValidation(t))]],m:[2,[r.Validators.required,u.xQ.custom("max",()=>this.baseValueValidation())]],crushFailureDomain:"",crushNumFailureDomains:[0,u.xQ.requiredIf({crushOsdsPerFailureDomain:{op:"minValue",arg1:1}})],crushOsdsPerFailureDomain:[0,u.xQ.requiredIf({crushNumFailureDomains:{op:"minValue",arg1:1}})],crushRoot:null,crushDeviceClass:"",directory:"",technique:"reed_sol_van",packetSize:[2048],l:[3,[r.Validators.required,u.xQ.custom("unequal",t=>this.lrcLocalityValidation(t))]],crushLocality:"",c:[2,[r.Validators.required,u.xQ.custom("cGreaterM",t=>this.shecDurabilityValidation(t))]],d:[5,[r.Validators.required,u.xQ.custom("dMin",t=>this.dMinValidation(t)),u.xQ.custom("dMax",t=>this.dMaxValidation(t))]],scalar_mds:[this.PLUGIN.JERASURE,[r.Validators.required]]}),this.toggleDCalc(),this.form.get("k").valueChanges.subscribe(()=>this.updateValidityOnChange(["m","l","d"])),this.form.get("m").valueChanges.subscribe(()=>this.updateValidityOnChange(["k","l","c","d"])),this.form.get("l").valueChanges.subscribe(()=>this.updateValidityOnChange(["k","m"])),this.form.get("plugin").valueChanges.subscribe(t=>this.onPluginChange(t)),this.form.get("scalar_mds").valueChanges.subscribe(()=>this.setClayDefaultsForScalar())}baseValueValidation(t=!1){return this.validValidation(()=>(this.form.get("crushFailureDomain").value===Ce.Host?this.getKMSum()+1:this.getKMSum())>this.deviceCount&&this.form.getValue("k")>this.form.getValue("m")===t)}validValidation(t,o){return!((!this.form||o)&&this.plugin!==o)&&t()}getKMSum(){return this.form.getValue("k")+this.form.getValue("m")}lrcDataValidation(t){return this.validValidation(()=>{const o=this.form.getValue("m"),i=this.form.getValue("l"),a=t+o;return this.lrcMultiK=t/(a/i),t%(a/i)!=0},"lrc")}shecDataValidation(t){return this.validValidation(()=>this.form.getValue("m")>t,"shec")}lrcLocalityValidation(t){return this.validValidation(()=>{const o=this.getKMSum();return this.lrcGroups=t>0?o/t:0,t>0&&o%t!=0},"lrc")}shecDurabilityValidation(t){return this.validValidation(()=>{const o=this.form.getValue("m");return t>o},"shec")}dMinValidation(t){return this.validValidation(()=>this.getDMin()>t,"clay")}getDMin(){return this.form.getValue("k")+1}dMaxValidation(t){return this.validValidation(()=>t>this.getDMax(),"clay")}getDMax(){const t=this.form.getValue("m");return this.form.getValue("k")+t-1}toggleDCalc(){this.dCalc=!this.dCalc,this.form.get("d")[this.dCalc?"disable":"enable"](),this.calculateD()}calculateD(){this.plugin!==this.PLUGIN.CLAY||!this.dCalc||this.form.silentSet("d",this.getDMax())}updateValidityOnChange(t){t.forEach(o=>{"d"===o&&this.calculateD(),this.form.get(o).updateValueAndValidity({emitEvent:!1})})}onPluginChange(t){this.plugin=t,t===this.PLUGIN.JERASURE?this.setJerasureDefaults():t===this.PLUGIN.LRC?this.setLrcDefaults():t===this.PLUGIN.ISA?this.setIsaDefaults():t===this.PLUGIN.SHEC?this.setShecDefaults():t===this.PLUGIN.CLAY&&this.setClayDefaults(),this.updateValidityOnChange(["m"])}setJerasureDefaults(){this.techniques=["reed_sol_van","reed_sol_r6_op","cauchy_orig","cauchy_good","liberation","blaum_roth","liber8tion"],this.setDefaults({k:4,m:2,technique:"reed_sol_van"})}setLrcDefaults(){this.setDefaults({k:4,m:2,l:3})}setIsaDefaults(){this.techniques=["reed_sol_van","cauchy"],this.setDefaults({k:7,m:3,technique:"reed_sol_van"})}setShecDefaults(){this.setDefaults({k:4,m:3,c:2})}setClayDefaults(){this.setDefaults({k:4,m:2,scalar_mds:this.PLUGIN.JERASURE}),this.setClayDefaultsForScalar()}setClayDefaultsForScalar(){const t=this.form.getValue("scalar_mds");let o="reed_sol_van";t===this.PLUGIN.JERASURE?this.techniques=["reed_sol_van","reed_sol_r6_op","cauchy_orig","cauchy_good","liber8tion"]:t===this.PLUGIN.ISA?this.techniques=["reed_sol_van","cauchy"]:(o="single",this.techniques=["single","multiple"]),this.setDefaults({technique:o})}setDefaults(t){Object.keys(t).forEach(o=>{const i=this.form.get(o),a=i.value;i.pristine||"technique"===o&&!this.techniques.includes(a)||"k"===o&&[4,7].includes(a)||"m"===o&&[2,3].includes(a)?i.setValue(t[o]):i.updateValueAndValidity()})}ngOnInit(){this.tooltips=this.ecpService.formTooltips,this.ecpService.getInfo().subscribe(({plugins:t,names:o,directory:i,nodes:a})=>{this.initCrushNodeSelection(a,this.form.get("crushRoot"),this.form.get("crushFailureDomain"),this.form.get("crushDeviceClass"),!1),this.plugins=t,this.names=o,this.form.silentSet("directory",i),this.preValidateNumericInputFields()})}preValidateNumericInputFields(){const t=["k","m","l","c","d"].map(o=>this.form.get(o));t.forEach(o=>{o.markAsTouched(),o.markAsDirty()}),t[1].updateValueAndValidity()}onSubmit(){if(this.form.invalid)return void this.form.setErrors({cdSubmitButton:!0});const t=this.createJson();this.taskWrapper.wrapTaskAroundCall({task:new I.O("ecp/create",{name:t.name}),call:this.ecpService.create(t)}).subscribe({error:()=>{this.form.setErrors({cdSubmitButton:!0})},complete:()=>{this.activeModal.close(),this.submitAction.emit(t)}})}createJson(){const t={technique:[this.PLUGIN.ISA,this.PLUGIN.JERASURE,this.PLUGIN.CLAY],packetSize:[this.PLUGIN.JERASURE],l:[this.PLUGIN.LRC],crushLocality:[this.PLUGIN.LRC],c:[this.PLUGIN.SHEC],d:[this.PLUGIN.CLAY],scalar_mds:[this.PLUGIN.CLAY]},o=new vt,i=this.form.getValue("plugin");return Object.keys(this.form.controls).filter(a=>{const d=t[a],O=this.form.getValue(a);return(d&&d.includes(i)||!d)&&O&&""!==O}).forEach(a=>{this.extendJson(a,o)}),o}extendJson(t,o){const a=this.form.getValue(t);o[{crushFailureDomain:"crush-failure-domain",crushNumFailureDomains:"crush-num-failure-domains",crushOsdsPerFailureDomain:"crush-osds-per-failure-domain",crushRoot:"crush-root",crushDeviceClass:"crush-device-class",packetSize:"packetsize",crushLocality:"crush-locality"}[t]||t]="crushRoot"===t?a.name:a}onCrushFailureDomainChane(){this.form.get("k").updateValueAndValidity(),this.form.get("m").updateValueAndValidity()}static{this.\u0275fac=function(o){return new(o||n)(e.\u0275\u0275directiveInject(Ve.$),e.\u0275\u0275directiveInject(E.NgbActiveModal),e.\u0275\u0275directiveInject(Re.a),e.\u0275\u0275directiveInject(Me),e.\u0275\u0275directiveInject(M.Ss))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["cd-erasure-code-profile-form-modal"]],outputs:{submitAction:"submitAction"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:118,vars:59,consts:()=>{let t,o,i,a,d,O,m,p,C,S,h,R,g,F,P,$,D,y,x,U,G,z,H,X,V,w,k,B,j,q,Q,J,K,W,Y,Z,ee,te,A,ne,oe,ie,_e,ae,le,re,se,de,ce,Oe,me,ue,v,Ee,pe,fe;return t="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",o="Name",i="Plugin",a="Data chunks (k)",d="Coding chunks (m)",O="Crush failure domain",m="Crush num failure domain",p="Crush osds per failure domain",C="Crush root",S="Crush device class",h="All devices",R="" + "\ufffd0\ufffd" + "",g="Available OSDs: " + "\ufffd0\ufffd" + "",F="Directory",P="This field is required!",$="The name can only consist of alphanumeric characters, dashes and underscores.",D="The chosen erasure code profile name is already in use.",y="Loading...",x="This field is required!",U="This field is required!",G="Must be equal to or greater than 2.",z="Chunks (k+m) have exceeded the available OSDs of " + "\ufffd0\ufffd" + ".",H="Chunks (k+m+1) have exceeded the available hosts of " + "\ufffd0\ufffd" + ".",X="For an equal distribution k has to be a multiple of (k+m)/l.",V="K has to be equal to or greater than m in order to recover data correctly through c.",w="Distribution factor: " + "\ufffd0\ufffd" + "",k="This field is required!",B="Must be equal to or greater than 1.",j="Chunks (k+m) have exceeded the available OSDs of " + "\ufffd0\ufffd" + ".",q="Chunks (k+m+1) have exceeded the available hosts of " + "\ufffd0\ufffd" + ".",Q="Durability estimator (c)",J="Must be equal to or greater than 1.",K="C has to be equal to or lower than m as m defines the amount of chunks that can be used.",W="Set d manually or use the plugin's default calculation that maximizes d.",Y="Helper chunks (d)",Z="D is automatically updated on k and m changes",ee="D can be set from " + "\ufffd0\ufffd" + " to " + "\ufffd1\ufffd" + "",te="D can only be set to " + "\ufffd0\ufffd" + "",A="D has to be greater than k (" + "\ufffd0\ufffd" + ").",ne="D has to be lower than k + m (" + "\ufffd0\ufffd" + ").",oe="Locality (l)",ie="Locality groups: " + "\ufffd0\ufffd" + "",_e="This field is required!",ae="Must be equal to or greater than 1.",le="Can't split up chunks (k+m) correctly with the current locality.",re="Loading...",se="This field is required when crush osds per failure domain is set!",de="This field is required when crush num failure domain is set!",ce="Crush Locality",Oe="Loading...",me="None",ue="Scalar mds",v="Technique",Ee="Packetsize",pe="Must be equal to or greater than 1.",fe="Loading...",[["frm","ngForm"],t,o,i,a,d,O,m,p,C,S,h,R,g,F,P,$,D,y,x,U,G,z,H,X,V,w,k,B,j,q,Q,J,K,Y,Z,ee,te,A,ne,oe,ie,_e,ae,le,re,se,de,ce,Oe,me,ue,v,Ee,pe,fe,[3,"modalRef"],[1,"modal-title"],[1,"modal-content"],["novalidate","",3,"formGroup"],[1,"modal-body"],[1,"form-group","row"],["for","name",1,"cd-col-form-label"],[1,"cd-col-form-input"],["type","text","id","name","name","name","placeholder","Name...","formControlName","name","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","plugin",1,"cd-col-form-label"],[1,"required"],[3,"html"],["id","plugin","name","plugin","formControlName","plugin",1,"form-select"],["ngValue","",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],["for","k",1,"cd-col-form-label"],["type","number","id","k","name","k","ng-model","$ctrl.erasureCodeProfile.k","placeholder","Data chunks...","formControlName","k","min","2",1,"form-control"],["class","form-text text-muted",4,"ngIf"],["for","m",1,"cd-col-form-label"],["type","number","id","m","name","m","placeholder","Coding chunks...","formControlName","m","min","1",1,"form-control"],["class","form-group row",4,"ngIf"],["for","crushFailureDomain",1,"cd-col-form-label"],["id","crushFailureDomain","name","crushFailureDomain","formControlName","crushFailureDomain",1,"form-select",3,"change"],["for","crushNumFailureDomains",1,"cd-col-form-label"],["type","number","id","crushNumFailureDomains","name","crushNumFailureDomains","formControlName","crushNumFailureDomains","min","0",1,"form-control"],["for","crushOsdsPerFailureDomain",1,"cd-col-form-label"],["type","number","id","crushOsdsPerFailureDomain","name","crushOsdsPerFailureDomain","formControlName","crushOsdsPerFailureDomain","min","0",1,"form-control"],["for","crushRoot",1,"cd-col-form-label"],["id","crushRoot","name","crushRoot","formControlName","crushRoot",1,"form-select"],["for","crushDeviceClass",1,"cd-col-form-label"],["id","crushDeviceClass","name","crushDeviceClass","formControlName","crushDeviceClass",1,"form-select"],["ngValue",""],[1,"form-text","text-muted"],["for","directory",1,"cd-col-form-label"],["type","text","id","directory","name","directory","placeholder","Path...","formControlName","directory",1,"form-control"],[1,"modal-footer"],[3,"submitActionEvent","form","submitText"],[1,"invalid-feedback"],[3,"ngValue"],["for","c",1,"cd-col-form-label"],["type","number","id","c","name","c","placeholder","Coding chunks...","formControlName","c","min","1",1,"form-control"],["for","d",1,"cd-col-form-label"],[1,"input-group"],["type","number","id","d","name","d","placeholder","Helper chunks...","formControlName","d",1,"form-control"],["id","d-calc-btn","ngbTooltip",W,"type","button",1,"btn","btn-light",3,"click"],[1,"cds-info-color",3,"cdsIcon","size"],[4,"ngIf"],["for","l",1,"cd-col-form-label"],["type","number","id","l","name","l","placeholder","Coding chunks...","formControlName","l","min","1",1,"form-control"],["for","crushLocality",1,"cd-col-form-label"],["id","crushLocality","name","crushLocality","formControlName","crushLocality",1,"form-select"],["for","scalar_mds",1,"cd-col-form-label"],["id","scalar_mds","name","scalar_mds","formControlName","scalar_mds",1,"form-select"],["for","technique",1,"cd-col-form-label"],["id","technique","name","technique","formControlName","technique",1,"form-select"],["for","packetSize",1,"cd-col-form-label"],["type","number","id","packetSize","name","packetSize","placeholder","Packetsize...","formControlName","packetSize","min","1",1,"form-control"]]},template:function(o,i){if(1&o){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-modal",56),e.\u0275\u0275elementContainerStart(1,57),e.\u0275\u0275i18n(2,1),e.\u0275\u0275pipe(3,"titlecase"),e.\u0275\u0275pipe(4,"upperFirst"),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(5,58),e.\u0275\u0275elementStart(6,"form",59,0)(8,"div",60)(9,"div",61)(10,"label",62),e.\u0275\u0275i18n(11,2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"div",63),e.\u0275\u0275element(13,"input",64),e.\u0275\u0275template(14,Qt,2,0,"span",65)(15,Jt,2,0,"span",65)(16,Kt,2,0,"span",65),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(17,"div",61)(18,"label",66)(19,"span",67),e.\u0275\u0275i18n(20,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(21,"cd-helper",68),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(22,"div",63)(23,"select",69),e.\u0275\u0275template(24,Wt,2,0,"option",70)(25,Yt,2,2,"option",71),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(26,Zt,2,0,"span",65),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(27,"div",61)(28,"label",72)(29,"span",67),e.\u0275\u0275i18n(30,4),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(31,"cd-helper",68),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(32,"div",63),e.\u0275\u0275element(33,"input",73),e.\u0275\u0275template(34,en,2,0,"span",65)(35,tn,2,0,"span",65)(36,nn,2,1,"span",65)(37,on,2,1,"span",65)(38,_n,2,0,"span",65)(39,an,2,0,"span",65)(40,ln,2,1,"span",74),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(41,"div",61)(42,"label",75)(43,"span",67),e.\u0275\u0275i18n(44,5),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(45,"cd-helper",68),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(46,"div",63),e.\u0275\u0275element(47,"input",76),e.\u0275\u0275template(48,rn,2,0,"span",65)(49,sn,2,0,"span",65)(50,dn,2,1,"span",65)(51,cn,2,1,"span",65),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(52,un,9,3,"div",77)(53,gn,14,7,"div",77)(54,Ln,12,5,"div",77),e.\u0275\u0275elementStart(55,"div",61)(56,"label",78),e.\u0275\u0275elementContainerStart(57),e.\u0275\u0275i18n(58,6),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275element(59,"cd-helper",68),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(60,"div",63)(61,"select",79),e.\u0275\u0275listener("change",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(i.onCrushFailureDomainChane())}),e.\u0275\u0275template(62,Fn,2,0,"option",70)(63,Tn,2,3,"option",71),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(64,"div",61)(65,"label",80),e.\u0275\u0275elementContainerStart(66),e.\u0275\u0275i18n(67,7),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275element(68,"cd-helper",68),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(69,"div",63),e.\u0275\u0275element(70,"input",81),e.\u0275\u0275template(71,Nn,2,0,"span",65),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(72,"div",61)(73,"label",82),e.\u0275\u0275elementContainerStart(74),e.\u0275\u0275i18n(75,8),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275element(76,"cd-helper",68),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(77,"div",63),e.\u0275\u0275element(78,"input",83),e.\u0275\u0275template(79,An,2,0,"span",65),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(80,$n,10,4,"div",77)(81,yn,8,6,"div",77)(82,Un,8,2,"div",77)(83,zn,8,2,"div",77),e.\u0275\u0275elementStart(84,"div",61)(85,"label",84),e.\u0275\u0275elementContainerStart(86),e.\u0275\u0275i18n(87,9),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275element(88,"cd-helper",68),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(89,"div",63)(90,"select",85),e.\u0275\u0275template(91,Hn,2,0,"option",70)(92,Xn,2,2,"option",71),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(93,"div",61)(94,"label",86),e.\u0275\u0275elementContainerStart(95),e.\u0275\u0275i18n(96,10),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(97,"div",63)(98,"select",87)(99,"option",88),e.\u0275\u0275i18n(100,11),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(101,Vn,2,2,"option",71),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(102,"cd-help-text")(103,"span"),e.\u0275\u0275i18n(104,12),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(105,"span",89),e.\u0275\u0275i18n(106,13),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(107,"div",61)(108,"label",90),e.\u0275\u0275elementContainerStart(109),e.\u0275\u0275i18n(110,14),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275element(111,"cd-helper",68),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(112,"div",63),e.\u0275\u0275element(113,"input",91),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(114,"div",92)(115,"cd-form-button-panel",93),e.\u0275\u0275pipe(116,"titlecase"),e.\u0275\u0275pipe(117,"upperFirst"),e.\u0275\u0275listener("submitActionEvent",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275resetView(i.onSubmit())}),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()}if(2&o){const a=e.\u0275\u0275reference(7);e.\u0275\u0275property("modalRef",i.activeModal),e.\u0275\u0275advance(4),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(3,47,i.action))(e.\u0275\u0275pipeBind1(4,49,i.resource)),e.\u0275\u0275i18nApply(2),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",i.form),e.\u0275\u0275advance(8),e.\u0275\u0275property("ngIf",i.form.showError("name",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.form.showError("name",a,"pattern")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.form.showError("name",a,"uniqueName")),e.\u0275\u0275advance(5),e.\u0275\u0275property("html",i.tooltips.plugins[i.plugin].description),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!i.plugins),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",i.plugins),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.form.showError("name",a,"required")),e.\u0275\u0275advance(5),e.\u0275\u0275property("html",i.tooltips.k),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",i.form.showError("k",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.form.showError("k",a,"min")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.form.showError("k",a,"max")&&i.form.getValue("crushFailureDomain")===i.CrushFailureDomains.Osd),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.form.showError("k",a,"max")&&i.form.getValue("crushFailureDomain")===i.CrushFailureDomains.Host),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.form.showError("k",a,"unequal")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.form.showError("k",a,"kLowerM")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","lrc"===i.plugin),e.\u0275\u0275advance(5),e.\u0275\u0275property("html",i.tooltips.m),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",i.form.showError("m",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.form.showError("m",a,"min")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.form.showError("m",a,"max")&&i.form.getValue("crushFailureDomain")===i.CrushFailureDomains.Osd),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.form.showError("m",a,"max")&&i.form.getValue("crushFailureDomain")===i.CrushFailureDomains.Host),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","shec"===i.plugin),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","clay"===i.plugin),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.plugin===i.PLUGIN.LRC),e.\u0275\u0275advance(5),e.\u0275\u0275property("html",i.tooltips.crushFailureDomain),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!i.failureDomains),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",i.failureDomainKeys),e.\u0275\u0275advance(5),e.\u0275\u0275property("html",i.tooltips.crushNumFailureDomains),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",i.form.showError("crushNumFailureDomains",a,"required")),e.\u0275\u0275advance(5),e.\u0275\u0275property("html",i.tooltips.crushOsdsPerFailureDomain),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",i.form.showError("crushOsdsPerFailureDomain",a,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.plugin===i.PLUGIN.LRC),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.PLUGIN.CLAY===i.plugin),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",e.\u0275\u0275pureFunction3(55,ke,i.PLUGIN.JERASURE,i.PLUGIN.ISA,i.PLUGIN.CLAY).includes(i.plugin)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.plugin===i.PLUGIN.JERASURE),e.\u0275\u0275advance(5),e.\u0275\u0275property("html",i.tooltips.crushRoot),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!i.buckets),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",i.buckets),e.\u0275\u0275advance(9),e.\u0275\u0275property("ngForOf",i.devices),e.\u0275\u0275advance(3),e.\u0275\u0275i18nExp(i.tooltips.crushDeviceClass),e.\u0275\u0275i18nApply(104),e.\u0275\u0275advance(2),e.\u0275\u0275i18nExp(i.deviceCount),e.\u0275\u0275i18nApply(106),e.\u0275\u0275advance(5),e.\u0275\u0275property("html",i.tooltips.directory),e.\u0275\u0275advance(4),e.\u0275\u0275property("form",i.form)("submitText",e.\u0275\u0275pipeBind1(116,51,i.action)+" "+e.\u0275\u0275pipeBind1(117,53,i.resource))}},dependencies:[L.NgForOf,L.NgIf,he.m,we.z,Le.e,Fe.O,Te.B,Ne.S,Ae.a,ve.C,be.E,r.\u0275NgNoValidate,r.NgSelectOption,r.\u0275NgSelectMultipleOption,r.DefaultValueAccessor,r.NumberValueAccessor,r.SelectControlValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.MinValidator,r.FormGroupDirective,r.FormControlName,E.NgbTooltip,ge.IconDirective,L.TitleCasePipe,Ie.r]})}}return n})();var kn=s(66668);class Bn{constructor(){this.erasureInfo=!1,this.crushInfo=!1,this.APP_LABELS={cephfs:"Filesystem",rbd:"Block",rgw:"Object"},this.pgs=1,this.poolTypes=["erasure","replicated"],this.applications={selected:[],default:["cephfs","rbd","rgw"],available:[],validators:[r.Validators.pattern("[A-Za-z0-9_]+"),r.Validators.maxLength(128)],messages:new kn.z({empty:"No applications added",selectionLimit:{text:"Applications limit reached",tooltip:"A pool can only have up to four applications definitions."},customValidations:{pattern:"Allowed characters '_a-zA-Z0-9'",maxlength:"Maximum length is 128 characters"},filter:"Filter or add applications",add:"Add application"})}}}var jn=s(6872),qn=s(48693),Qn=s(87837),Be=s(37823),Jn=s(56677),Kn=s(45413);const Wn=["crushInfoTabs"],Yn=["crushDeletionBtn"],Zn=["ecpInfoTabs"],eo=["ecpDeletionBtn"],je=n=>({active:n}),to=()=>["name"],no=()=>["steps","type","rule_name"];function oo(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,22),e.\u0275\u0275elementEnd())}function io(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,23),e.\u0275\u0275elementEnd())}function _o(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,24),e.\u0275\u0275elementEnd())}function ao(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,25),e.\u0275\u0275elementEnd())}function lo(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"option",116),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit;e.\u0275\u0275property("value",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t," ")}}function ro(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,26),e.\u0275\u0275elementEnd())}function so(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"option",116),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit;e.\u0275\u0275property("value",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t," ")}}function co(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,29),e.\u0275\u0275elementEnd())}function Oo(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,30),e.\u0275\u0275elementEnd())}function mo(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,31),e.\u0275\u0275elementEnd())}function uo(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",121),e.\u0275\u0275i18n(1,32),e.\u0275\u0275elementEnd())}function Eo(n,_){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",90)(1,"label",119),e.\u0275\u0275i18n(2,28),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",92)(4,"input",120),e.\u0275\u0275listener("focus",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(i.externalPgChange=!1)})("blur",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(i.alignPgs())}),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,co,2,0,"span",94)(6,Oo,2,0,"span",94)(7,mo,2,0,"span",94),e.\u0275\u0275elementStart(8,"span",121),e.\u0275\u0275element(9,"cd-doc",122),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(10,uo,2,0,"span",123),e.\u0275\u0275elementEnd()()}if(2&n){e.\u0275\u0275nextContext(2);const t=e.\u0275\u0275reference(2),o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",o.form.showError("pgNum",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.form.showError("pgNum",t,"min")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.form.showError("pgNum",t,"34")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",o.externalPgChange)}}function po(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"span",115)(1,"ul",127)(2,"li"),e.\u0275\u0275i18n(3,34),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"li"),e.\u0275\u0275i18n(5,35),e.\u0275\u0275elementEnd()()()),2&n){const t=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(3),e.\u0275\u0275i18nExp(t.getMinSize()),e.\u0275\u0275i18nApply(3),e.\u0275\u0275advance(2),e.\u0275\u0275i18nExp(t.getMaxSize()),e.\u0275\u0275i18nApply(5)}}function fo(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,36),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(),e.\u0275\u0275i18nExp(t.getMinSize())(t.getMaxSize()),e.\u0275\u0275i18nApply(1)}}function Po(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",128),e.\u0275\u0275i18n(1,37),e.\u0275\u0275elementEnd())}function Co(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"div",90)(1,"label",124),e.\u0275\u0275i18n(2,33),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",92),e.\u0275\u0275element(4,"input",125),e.\u0275\u0275template(5,po,6,2,"span",94)(6,fo,2,2,"span",94)(7,Po,2,0,"span",126),e.\u0275\u0275elementEnd()()),2&n){e.\u0275\u0275nextContext(2);const t=e.\u0275\u0275reference(2),o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275property("max",o.getMaxSize())("min",o.getMinSize()),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.form.showError("size",t)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.form.showError("size",t)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",1===o.form.getValue("size"))}}function Ro(n,_){1&n&&(e.\u0275\u0275elementStart(0,"div",90)(1,"label",129),e.\u0275\u0275i18n(2,38),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",92)(4,"div",130),e.\u0275\u0275element(5,"input",131),e.\u0275\u0275elementStart(6,"label",132),e.\u0275\u0275i18n(7,39),e.\u0275\u0275elementEnd()()()())}function go(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"div")(1,"div",90)(2,"label",117),e.\u0275\u0275i18n(3,27),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",92)(5,"select",118),e.\u0275\u0275template(6,so,2,2,"option",98),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(7,Eo,11,4,"div",103)(8,Co,8,5,"div",103)(9,Ro,8,0,"div",103),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",t.pgAutoscaleModes),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","on"!==t.form.getValue("pgAutoscaleMode")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.isReplicated),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.info.is_all_bluestore&&t.isErasure)}}function Mo(n,_){if(1&n&&(e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(0,"svg",133)),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("cdsIcon",t.icons.warning)("size",t.icons.size20)}}function So(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,40),e.\u0275\u0275elementEnd())}function ho(n,_){1&n&&(e.\u0275\u0275elementStart(0,"div",90)(1,"div",134)(2,"div",130),e.\u0275\u0275element(3,"input",135),e.\u0275\u0275elementStart(4,"label",136),e.\u0275\u0275i18n(5,41),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"cd-help-text")(7,"span"),e.\u0275\u0275i18n(8,42),e.\u0275\u0275elementEnd()()()()())}function Lo(n,_){1&n&&(e.\u0275\u0275elementStart(0,"option",97),e.\u0275\u0275i18n(1,45),e.\u0275\u0275elementEnd())}function Fo(n,_){1&n&&(e.\u0275\u0275elementStart(0,"option",147),e.\u0275\u0275i18n(1,46),e.\u0275\u0275elementEnd()),2&n&&e.\u0275\u0275property("ngValue",null)}function To(n,_){1&n&&(e.\u0275\u0275elementStart(0,"option",147),e.\u0275\u0275i18n(1,47),e.\u0275\u0275elementEnd()),2&n&&e.\u0275\u0275property("ngValue",null)}function No(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"option",147),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit;e.\u0275\u0275property("ngValue",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t.name," ")}}function Ao(n,_){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",148),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(i.addErasureCodeProfile())}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(1,"svg",143),e.\u0275\u0275elementEnd()}if(2&n){const t=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",t.icons.add)("size",t.icons.size20)}}function vo(n,_){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",149,1),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(i.deleteErasureCodeProfile())}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(2,"svg",143),e.\u0275\u0275elementEnd()}if(2&n){const t=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",t.icons.trash)("size",t.icons.size16)}}function bo(n,_){if(1&n&&e.\u0275\u0275element(0,"cd-table-key-value",157),2&n){const t=e.\u0275\u0275nextContext(5);e.\u0275\u0275property("renderObjects",!0)("hideKeys",e.\u0275\u0275pureFunction0(4,to))("data",t.form.getValue("erasureProfile"))("autoReload",!1)}}function Io(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275i18n(1,50),e.\u0275\u0275elementEnd())}function $o(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"li"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t," ")}}function Do(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"ul"),e.\u0275\u0275template(1,$o,2,1,"li",159),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(6);e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",t.ecpUsage)}}function yo(n,_){if(1&n&&e.\u0275\u0275template(0,Io,2,0,"ng-template",null,3,e.\u0275\u0275templateRefExtractor)(2,Do,2,1,"ul",158),2&n){const t=e.\u0275\u0275reference(1),o=e.\u0275\u0275nextContext(5);e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",o.ecpUsage)("ngIfElse",t)}}function xo(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"span",150)(1,"nav",151,2),e.\u0275\u0275elementContainerStart(3,152),e.\u0275\u0275elementStart(4,"a",153),e.\u0275\u0275i18n(5,48),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(6,bo,1,5,"ng-template",154),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(7,155),e.\u0275\u0275elementStart(8,"a",153),e.\u0275\u0275i18n(9,49),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(10,yo,3,2,"ng-template",154),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(11,"div",156),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275reference(2);e.\u0275\u0275advance(11),e.\u0275\u0275property("ngbNavOutlet",t)}}function Uo(n,_){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",90)(1,"label",137),e.\u0275\u0275i18n(2,44),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",92)(4,"div",106)(5,"select",138),e.\u0275\u0275listener("change",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(i.erasureProfileChange())}),e.\u0275\u0275template(6,Lo,2,0,"option",139)(7,Fo,2,1,"option",140)(8,To,2,1,"option",140)(9,No,2,2,"option",141),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"button",142),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(i.data.erasureInfo=!i.data.erasureInfo)}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(11,"svg",143),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(12,Ao,2,2,"button",144)(13,vo,3,2,"button",145),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(14,xo,12,1,"span",146),e.\u0275\u0275elementEnd()()}if(2&n){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",!t.ecProfiles),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.ecProfiles&&0===t.ecProfiles.length),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.ecProfiles&&t.ecProfiles.length>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",t.ecProfiles),e.\u0275\u0275advance(),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(10,je,t.data.erasureInfo)),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",t.icons.questionCircle)("size",t.icons.size20),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!t.editing),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!t.editing),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.data.erasureInfo&&t.form.getValue("erasureProfile"))}}function Go(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",121),e.\u0275\u0275i18n(1,52),e.\u0275\u0275elementEnd())}function zo(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",121),e.\u0275\u0275i18n(1,53),e.\u0275\u0275elementEnd())}function Ho(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"div",90)(1,"label",160),e.\u0275\u0275i18n(2,51),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",92),e.\u0275\u0275template(4,Go,2,0,"span",161)(5,zo,2,0,"ng-template",null,4,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()),2&n){const t=e.\u0275\u0275reference(6),o=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",!o.msrCrush)("ngIfElse",t)}}function Xo(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",121)(1,"span"),e.\u0275\u0275i18n(2,55),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(3,"\xa0 "),e.\u0275\u0275elementEnd())}function Vo(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"option",147),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit;e.\u0275\u0275property("ngValue",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t.rule_name," ")}}function wo(n,_){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",148),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(5);return e.\u0275\u0275resetView(i.addCrushRule())}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(1,"svg",143),e.\u0275\u0275elementEnd()}if(2&n){const t=e.\u0275\u0275nextContext(5);e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",t.icons.add)("size",t.icons.size16)}}function ko(n,_){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",167,6),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(5);return e.\u0275\u0275resetView(i.deleteCrushRule())}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(2,"svg",143),e.\u0275\u0275elementEnd()}if(2&n){const t=e.\u0275\u0275nextContext(5);e.\u0275\u0275advance(2),e.\u0275\u0275property("cdsIcon",t.icons.trash)("size",t.icons.size16)}}function Bo(n,_){if(1&n&&e.\u0275\u0275element(0,"cd-table-key-value",157),2&n){const t=e.\u0275\u0275nextContext(6);e.\u0275\u0275property("renderObjects",!1)("hideKeys",e.\u0275\u0275pureFunction0(4,no))("data",t.form.getValue("crushRule"))("autoReload",!1)}}function jo(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"li"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit,o=e.\u0275\u0275nextContext(7);e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",o.describeCrushStep(t)," ")}}function qo(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"ol"),e.\u0275\u0275template(1,jo,2,1,"li",159),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(6);e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",t.form.get("crushRule").value.steps)}}function Qo(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275i18n(1,60),e.\u0275\u0275elementEnd())}function Jo(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"li"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t," ")}}function Ko(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"ul"),e.\u0275\u0275template(1,Jo,2,1,"li",159),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(7);e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",t.crushUsage)}}function Wo(n,_){if(1&n&&e.\u0275\u0275template(0,Qo,2,0,"ng-template",null,8,e.\u0275\u0275templateRefExtractor)(2,Ko,2,1,"ul",158),2&n){const t=e.\u0275\u0275reference(1),o=e.\u0275\u0275nextContext(6);e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",o.crushUsage)("ngIfElse",t)}}function Yo(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"div",168)(1,"nav",151,7),e.\u0275\u0275elementContainerStart(3,169),e.\u0275\u0275elementStart(4,"a",153),e.\u0275\u0275i18n(5,57),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(6,Bo,1,5,"ng-template",154),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(7,170),e.\u0275\u0275elementStart(8,"a",153),e.\u0275\u0275i18n(9,58),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(10,qo,2,1,"ng-template",154),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(11,155),e.\u0275\u0275elementStart(12,"a",153),e.\u0275\u0275i18n(13,59),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(14,Wo,3,2,"ng-template",154),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(15,"div",156),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275reference(2);e.\u0275\u0275advance(15),e.\u0275\u0275property("ngbNavOutlet",t)}}function Zo(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,61),e.\u0275\u0275elementEnd())}function ei(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,62),e.\u0275\u0275elementEnd())}function ti(n,_){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"div",162)(2,"select",163)(3,"option",147),e.\u0275\u0275i18n(4,56),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,Vo,2,2,"option",141),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"button",164),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(i.data.crushInfo=!i.data.crushInfo)}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275element(7,"svg",143),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,wo,2,2,"button",144)(9,ko,3,2,"button",165),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(10,Yo,16,1,"div",166)(11,Zo,2,0,"span",94)(12,ei,2,0,"span",94),e.\u0275\u0275elementEnd()}if(2&n){e.\u0275\u0275nextContext(3);const t=e.\u0275\u0275reference(2),o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275property("ngValue",null),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",o.current.rules),e.\u0275\u0275advance(),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(10,je,o.data.crushInfo)),e.\u0275\u0275advance(),e.\u0275\u0275property("cdsIcon",o.icons.questionCircle)("size",o.icons.size20),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.isReplicated&&!o.editing),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.isReplicated&&!o.editing),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.data.crushInfo&&o.form.getValue("crushRule")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.form.showError("crushRule",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.form.showError("crushRule",t,"tooFewOsds"))}}function ni(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"div",90)(1,"label",160),e.\u0275\u0275i18n(2,54),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",92),e.\u0275\u0275template(4,Xo,4,0,"ng-template",null,5,e.\u0275\u0275templateRefExtractor)(6,ti,13,12,"div",158),e.\u0275\u0275elementEnd()()),2&n){const t=e.\u0275\u0275reference(5),o=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",o.current.rules.length>0)("ngIfElse",t)}}function oi(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"div")(1,"legend"),e.\u0275\u0275i18n(2,43),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,Uo,15,12,"div",103)(4,Ho,7,2,"div",103)(5,ni,7,2,"div",103),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",t.isErasure),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.isErasure&&!t.editing),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",t.isReplicated||t.editing)}}function ii(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"option",116),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit;e.\u0275\u0275property("value",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t," ")}}function _i(n,_){1&n&&(e.\u0275\u0275elementStart(0,"option",97),e.\u0275\u0275i18n(1,73),e.\u0275\u0275elementEnd())}function ai(n,_){1&n&&(e.\u0275\u0275elementStart(0,"option",97),e.\u0275\u0275i18n(1,74),e.\u0275\u0275elementEnd())}function li(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"option",116),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit;e.\u0275\u0275property("value",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t," ")}}function ri(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"option",116),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit;e.\u0275\u0275property("value",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t," ")}}function si(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,75),e.\u0275\u0275elementEnd())}function di(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,76),e.\u0275\u0275elementEnd())}function ci(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,77),e.\u0275\u0275elementEnd())}function Oi(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"option",116),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit;e.\u0275\u0275property("value",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t," ")}}function mi(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,78),e.\u0275\u0275elementEnd())}function ui(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,79),e.\u0275\u0275elementEnd())}function Ei(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,80),e.\u0275\u0275elementEnd())}function pi(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,81),e.\u0275\u0275elementEnd())}function fi(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"div")(1,"div",90)(2,"label",174),e.\u0275\u0275elementContainerStart(3),e.\u0275\u0275i18n(4,65),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",92)(6,"select",175),e.\u0275\u0275template(7,_i,2,0,"option",139)(8,ai,2,0,"option",139)(9,li,2,2,"option",98),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"cd-help-text")(11,"span"),e.\u0275\u0275i18n(12,66),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(13,"div",90)(14,"label",176),e.\u0275\u0275elementContainerStart(15),e.\u0275\u0275i18n(16,67),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"div",92)(18,"div",106),e.\u0275\u0275element(19,"input",177),e.\u0275\u0275elementStart(20,"select",178),e.\u0275\u0275template(21,ri,2,2,"option",98),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(22,"cd-help-text")(23,"span"),e.\u0275\u0275i18n(24,68),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(25,si,2,0,"span",94)(26,di,2,0,"span",94)(27,ci,2,0,"span",94),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(28,"div",90)(29,"label",179),e.\u0275\u0275elementContainerStart(30),e.\u0275\u0275i18n(31,69),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(32,"div",92)(33,"div",106),e.\u0275\u0275element(34,"input",180),e.\u0275\u0275elementStart(35,"select",181),e.\u0275\u0275template(36,Oi,2,2,"option",98),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(37,"cd-help-text")(38,"span"),e.\u0275\u0275i18n(39,70),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(40,mi,2,0,"span",94)(41,ui,2,0,"span",94)(42,Ei,2,0,"span",94),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(43,"div",90)(44,"label",182),e.\u0275\u0275elementContainerStart(45),e.\u0275\u0275i18n(46,71),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(47,"div",92),e.\u0275\u0275element(48,"input",183),e.\u0275\u0275elementStart(49,"cd-help-text")(50,"span"),e.\u0275\u0275i18n(51,72),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(52,pi,2,0,"span",94),e.\u0275\u0275elementEnd()()()),2&n){e.\u0275\u0275nextContext(2);const t=e.\u0275\u0275reference(2),o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",!o.info.compression_algorithms),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.info.compression_algorithms&&0===o.info.compression_algorithms.length),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",o.info.compression_algorithms),e.\u0275\u0275advance(12),e.\u0275\u0275property("ngForOf",o.blobUnits),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",o.form.showError("minBlobSize",t,"min")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.form.showError("minBlobSize",t,"maximum")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.form.showError("minBlobSize",t,"pattern")),e.\u0275\u0275advance(9),e.\u0275\u0275property("ngForOf",o.blobUnits),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",o.form.showError("maxBlobSize",t,"min")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.form.showError("maxBlobSize",t,"minimum")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.form.showError("maxBlobSize",t,"pattern")),e.\u0275\u0275advance(10),e.\u0275\u0275property("ngIf",o.form.showError("ratio",t,"min")||o.form.showError("ratio",t,"max"))}}function Pi(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"div",171)(1,"legend"),e.\u0275\u0275i18n(2,63),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",90)(4,"label",172),e.\u0275\u0275i18n(5,64),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",92)(7,"select",173),e.\u0275\u0275template(8,ii,2,2,"option",98),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"cd-help-text"),e.\u0275\u0275text(10,"Policy used for compression algorithm"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(11,fi,53,12,"div",99),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(8),e.\u0275\u0275property("ngForOf",t.info.compression_modes),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",t.hasCompressionEnabled())}}function Ci(n,_){if(1&n&&(e.\u0275\u0275elementStart(0,"option",116),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=_.$implicit;e.\u0275\u0275property("value",t),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t," ")}}function Ri(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,82),e.\u0275\u0275elementEnd())}function gi(n,_){1&n&&(e.\u0275\u0275elementStart(0,"span",115),e.\u0275\u0275i18n(1,83),e.\u0275\u0275elementEnd())}function Mi(n,_){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",85)(1,"form",86,0)(3,"div",87)(4,"div",88),e.\u0275\u0275i18n(5,9),e.\u0275\u0275pipe(6,"titlecase"),e.\u0275\u0275pipe(7,"upperFirst"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"div",89)(9,"div",90)(10,"label",91),e.\u0275\u0275i18n(11,10),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"div",92),e.\u0275\u0275element(13,"input",93),e.\u0275\u0275template(14,oo,2,0,"span",94)(15,io,2,0,"span",94)(16,_o,2,0,"span",94)(17,ao,2,0,"span",94),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(18,"div",90)(19,"label",95),e.\u0275\u0275i18n(20,11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"div",92)(22,"select",96)(23,"option",97),e.\u0275\u0275i18n(24,12),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(25,lo,2,2,"option",98),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(26,ro,2,0,"span",94),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(27,go,10,4,"div",99),e.\u0275\u0275elementStart(28,"div",90)(29,"label",100),e.\u0275\u0275elementContainerStart(30),e.\u0275\u0275i18n(31,13),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementStart(32,"cd-helper")(33,"span"),e.\u0275\u0275i18n(34,14),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(35,"div",92)(36,"cd-select-badges",101),e.\u0275\u0275listener("selection",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(i.appSelection())}),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(37,Mo,1,2,"svg",102)(38,So,2,0,"span",94),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(39,ho,9,0,"div",103)(40,oi,6,3,"div",99)(41,Pi,12,2,"div",104),e.\u0275\u0275elementStart(42,"div")(43,"legend"),e.\u0275\u0275i18n(44,15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(45,"div",90)(46,"label",105),e.\u0275\u0275elementContainerStart(47),e.\u0275\u0275i18n(48,16),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(49,"div",92)(50,"div",106),e.\u0275\u0275element(51,"input",107),e.\u0275\u0275elementStart(52,"select",108),e.\u0275\u0275template(53,Ci,2,2,"option",98),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(54,"cd-help-text")(55,"span"),e.\u0275\u0275i18n(56,17),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(57,"br"),e.\u0275\u0275elementStart(58,"span"),e.\u0275\u0275i18n(59,18),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(60,Ri,2,0,"span",94),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(61,"div",90)(62,"label",109),e.\u0275\u0275elementContainerStart(63),e.\u0275\u0275i18n(64,19),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(65,"div",92),e.\u0275\u0275element(66,"input",110),e.\u0275\u0275elementStart(67,"cd-help-text")(68,"span"),e.\u0275\u0275i18n(69,20),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(70,"br"),e.\u0275\u0275elementStart(71,"span"),e.\u0275\u0275i18n(72,21),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(73,gi,2,0,"span",94),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(74,"div",111)(75,"cd-rbd-configuration-form",112),e.\u0275\u0275listener("changes",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.currentConfigurationValues=i())}),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(76,"div",113)(77,"cd-form-button-panel",114),e.\u0275\u0275pipe(78,"titlecase"),e.\u0275\u0275pipe(79,"upperFirst"),e.\u0275\u0275listener("submitActionEvent",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(i.submit())}),e.\u0275\u0275elementEnd()()()()()}if(2&n){const t=e.\u0275\u0275reference(2),o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("formGroup",o.form),e.\u0275\u0275advance(6),e.\u0275\u0275i18nExp(e.\u0275\u0275pipeBind1(6,29,o.action))(e.\u0275\u0275pipeBind1(7,31,o.resource)),e.\u0275\u0275i18nApply(5),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",o.form.showError("name",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.form.showError("name",t,"uniqueName")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.form.showError("name",t,"rbdPool")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.form.showError("name",t,"pattern")),e.\u0275\u0275advance(8),e.\u0275\u0275property("ngForOf",o.data.poolTypes),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.form.showError("poolType",t,"required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.isReplicated||o.isErasure),e.\u0275\u0275advance(9),e.\u0275\u0275property("customBadges",!0)("customBadgeValidators",o.data.applications.validators)("messages",o.data.applications.messages)("data",o.data.applications.selected)("options",o.data.applications.available)("selectionLimit",4),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.data.applications.selected<=0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!o.isApplicationsSelected&&o.data.applications.selected<=0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.data.applications.selected.includes("rbd")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.isErasure||o.isReplicated),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.info.is_all_bluestore),e.\u0275\u0275advance(12),e.\u0275\u0275property("ngForOf",o.maxBytesUnits),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",o.form.showError("max_bytes",t,"pattern")),e.\u0275\u0275advance(13),e.\u0275\u0275property("ngIf",o.form.showError("max_objects",t,"min")),e.\u0275\u0275advance(),e.\u0275\u0275property("hidden",o.isErasure||-1===o.data.applications.selected.indexOf("rbd")),e.\u0275\u0275advance(),e.\u0275\u0275property("form",o.form)("initializeData",o.initializeConfigData),e.\u0275\u0275advance(2),e.\u0275\u0275property("form",o.form)("submitText",e.\u0275\u0275pipeBind1(78,33,o.action)+" "+e.\u0275\u0275pipeBind1(79,35,o.resource))}}let qe=(()=>{class n extends It.g{constructor(t,o,i,a,d,O,m,p,C,S,h,R){super(),this.dimlessBinaryPipe=t,this.route=o,this.router=i,this.modalService=a,this.poolService=d,this.authStorageService=O,this.formatter=m,this.taskWrapper=p,this.ecpService=C,this.crushRuleService=S,this.actionLabels=h,this.rbdMirroringService=R,this.editing=!1,this.isReplicated=!1,this.isErasure=!1,this.blobUnits=["B","KiB","MiB","GiB","TiB"],this.maxBytesUnits=["KiB","MiB","GiB","TiB"],this.data=new Bn,this.externalPgChange=!1,this.current={rules:[]},this.initializeConfigData=new Tt.ReplaySubject(1),this.currentConfigurationValues={},this.icons=b.FI,this.crushUsage=void 0,this.ecpUsage=void 0,this.crushRuleMaxSize=10,this.DEFAULT_RATIO=.875,this.isApplicationsSelected=!0,this.msrCrush=!1,this.editing=this.router.url.startsWith(`/pool/${M.Qp.EDIT}`),this.action=this.editing?this.actionLabels.EDIT:this.actionLabels.CREATE,this.resource="pool",this.authenticate(),this.createForm()}authenticate(){if(this.permission=this.authStorageService.getPermissions().pool,!this.permission.read||!this.permission.update&&this.editing||!this.permission.create&&!this.editing)throw new Nt.YW}createForm(){const t=new He.$({mode:new r.UntypedFormControl("none"),algorithm:new r.UntypedFormControl(""),minBlobSize:new r.UntypedFormControl("",{updateOn:"blur"}),minBlobSizeUnit:new r.UntypedFormControl(this.blobUnits[0],{updateOn:"blur"}),maxBlobSize:new r.UntypedFormControl("",{updateOn:"blur"}),maxBlobSizeUnit:new r.UntypedFormControl(this.blobUnits[2],{updateOn:"blur"}),ratio:new r.UntypedFormControl(this.DEFAULT_RATIO,{updateOn:"blur"})});this.form=new He.$({name:new r.UntypedFormControl("",{validators:[r.Validators.pattern(/^[.A-Za-z0-9_/-]+$/),r.Validators.required,u.xQ.custom("rbdPool",()=>this.form&&this.form.getValue("name").includes("/")&&this.data&&-1!==this.data.applications.selected.indexOf("rbd"))]}),poolType:new r.UntypedFormControl("",{validators:[r.Validators.required]}),crushRule:new r.UntypedFormControl(null,{validators:[u.xQ.custom("tooFewOsds",o=>this.info&&o&&this.info.osd_count<1),u.xQ.custom("required",o=>this.isReplicated&&this.info?.crush_rules_replicated?.length>0&&!o)]}),size:new r.UntypedFormControl("",{updateOn:"blur"}),erasureProfile:new r.UntypedFormControl(null),pgNum:new r.UntypedFormControl("",{validators:[r.Validators.required]}),pgAutoscaleMode:new r.UntypedFormControl(null),ecOverwrites:new r.UntypedFormControl(!1),compression:t,max_bytes:new r.UntypedFormControl(""),maxBytesUnit:new r.UntypedFormControl(this.maxBytesUnits[2]),max_objects:new r.UntypedFormControl(0),rbdMirroring:new r.UntypedFormControl(!1)},[u.xQ.custom("form",()=>null)])}ngOnInit(){this.poolService.getInfo().subscribe(t=>{this.initInfo(t),this.editing?this.initEditMode():(this.setAvailableApps(),this.loadingReady()),this.listenToChanges(),this.setComplexValidators()}),this.erasureProfileChange()}initInfo(t){this.pgAutoscaleModes=t.pg_autoscale_modes,this.form.silentSet("pgAutoscaleMode",t.pg_autoscale_default_mode),this.form.silentSet("algorithm",t.bluestore_compression_algorithm),this.info=t,this.initEcp(t.erasure_code_profiles)}initEcp(t){this.setListControlStatus("erasureProfile",t),this.ecProfiles=t}setListControlStatus(t,o){const i=this.form.get(t),a=i.value;1!==o.length||a&&f().isEqual(a,o[0])?0===o.length&&a&&i.setValue(null):i.setValue(o[0]),o.length<=1?i.enabled&&i.disable():i.disabled&&i.enable()}initEditMode(){this.disableForEdit(),this.routeParamsSubscribe=this.route.params.subscribe(t=>this.poolService.get(t.name).subscribe(o=>{this.data.pool=o,this.initEditFormData(o),this.loadingReady()}))}disableForEdit(){["poolType","crushRule","size","erasureProfile","ecOverwrites"].forEach(t=>this.form.get(t).disable())}initEditFormData(t){this.initializeConfigData.next({initialData:t.configuration,sourceType:$t.M.pool});const o=this.dimlessBinaryPipe.transform(t.quota_max_bytes).split(" "),i=this.dimlessBinaryPipe.transform(t.options.compression_min_blob_size).split(" "),a=this.dimlessBinaryPipe.transform(t.options.compression_max_blob_size).split(" ");this.poolTypeChange(t.type);const d=this.info.crush_rules_replicated.concat(this.info.crush_rules_erasure),O={name:t.pool_name,poolType:t.type,crushRule:d.find(m=>m.rule_name===t.crush_rule),size:t.size,erasureProfile:this.ecProfiles.find(m=>m.name===t.erasure_code_profile),pgAutoscaleMode:t.pg_autoscale_mode,pgNum:t.pg_num,ecOverwrites:t.flags_names.includes("ec_overwrites"),mode:t.options.compression_mode,algorithm:t.options.compression_algorithm,minBlobSize:i[0],minBlobSizeUnit:i[1],maxBlobSize:a[0],maxBlobSizeUnit:a[1],ratio:t.options.compression_required_ratio,max_bytes:o[0],maxBytesUnit:o[1],max_objects:t.quota_max_objects};Object.keys(O).forEach(m=>{const p=O[m];!f().isUndefined(p)&&""!==p&&this.form.silentSet(m,p)}),this.data.pgs=this.form.getValue("pgNum"),this.setAvailableApps(this.data.applications.default.concat(t.application_metadata)),this.data.applications.selected=t.application_metadata,this.rbdMirroringService.getPool(t.pool_name).subscribe(m=>{this.form.get("rbdMirroring").setValue("pool"===m.mirror_mode)})}setAvailableApps(t=this.data.applications.default){this.data.applications.available=f().uniq(t.sort()).map(o=>new bt.O(!1,o,this.data.APP_LABELS[o]||o))}listenToChanges(){this.listenToChangesDuringAddEdit(),this.editing||this.listenToChangesDuringAdd()}listenToChangesDuringAddEdit(){this.form.get("pgNum").valueChanges.subscribe(t=>{const o=t-this.data.pgs;1===Math.abs(o)&&2!==t?this.doPgPowerJump(o):this.data.pgs=t})}doPgPowerJump(t){const o=this.calculatePgPower()+t;this.setPgs(-1===t?Math.round(o):Math.floor(o))}calculatePgPower(t=this.form.getValue("pgNum")){return Math.log(t)/Math.log(2)}setPgs(t){const o=Math.pow(2,t<0?0:t);this.data.pgs=o,this.form.silentSet("pgNum",o)}listenToChangesDuringAdd(){this.form.get("poolType").valueChanges.subscribe(t=>{this.poolTypeChange(t)}),this.form.get("crushRule").valueChanges.subscribe(t=>{this.crushDeletionBtn&&this.crushDeletionBtn.isOpen()&&this.crushDeletionBtn.close(),t&&(this.setCorrectMaxSize(t),this.crushRuleIsUsedBy(t.rule_name),this.replicatedRuleChange(),this.pgCalc())}),this.form.get("size").valueChanges.subscribe(()=>{this.pgCalc()}),this.form.get("erasureProfile").valueChanges.subscribe(t=>{this.ecpDeletionBtn&&this.ecpDeletionBtn.isOpen()&&this.ecpDeletionBtn.close(),t&&(this.ecpIsUsedBy(t.name),this.pgCalc())}),this.form.get("mode").valueChanges.subscribe(()=>{["minBlobSize","maxBlobSize","ratio"].forEach(t=>{this.form.get(t).updateValueAndValidity({emitEvent:!1})})}),this.form.get("minBlobSize").valueChanges.subscribe(()=>{this.form.get("maxBlobSize").updateValueAndValidity({emitEvent:!1})}),this.form.get("minBlobSizeUnit").valueChanges.subscribe(()=>{this.form.get("maxBlobSize").updateValueAndValidity({emitEvent:!1})}),this.form.get("maxBlobSize").valueChanges.subscribe(()=>{this.form.get("minBlobSize").updateValueAndValidity({emitEvent:!1})}),this.form.get("maxBlobSizeUnit").valueChanges.subscribe(()=>{this.form.get("minBlobSize").updateValueAndValidity({emitEvent:!1})})}poolTypeChange(t){if("replicated"===t?this.setTypeBooleans(!0,!1):this.setTypeBooleans(!1,"erasure"===t),!t||!this.info)return void(this.current.rules=[]);const o=this.info["crush_rules_"+t]||[];this.current.rules=o,!this.editing&&(this.isReplicated&&this.setListControlStatus("crushRule",o),this.replicatedRuleChange(),this.pgCalc())}setTypeBooleans(t,o){this.isReplicated=t,this.isErasure=o}replicatedRuleChange(){if(!this.isReplicated)return;const t=this.form.get("size");let o=this.form.getValue("size")||3;const i=this.getMinSize(),a=this.getMaxSize();o<i?o=i:o>a&&(o=a),o!==t.value&&this.form.silentSet("size",o)}getMinSize(){return!this.info||this.info.osd_count<1?0:1}getMaxSize(){const t=this.form.getValue("crushRule");return this.info?t?t.usable_size:Math.min(this.info.osd_count,3):0}pgCalc(){const t=this.form.getValue("poolType");if(!this.info||this.form.get("pgNum").dirty||!t)return;const o=100*this.info.osd_count,i=this.isReplicated?this.replicatedPgCalc(o):this.erasurePgCalc(o);if(!i)return;const a=this.data.pgs;this.alignPgs(i),this.externalPgChange||(this.externalPgChange=a!==this.data.pgs)}setCorrectMaxSize(t=this.form.getValue("crushRule")){if(!t)return;const i=T.searchFailureDomains(this.info.nodes,t.steps[0].item_name)[t.steps[1].type];t.usable_size=Math.min(i?i.length:this.crushRuleMaxSize,this.crushRuleMaxSize)}replicatedPgCalc(t){const o=this.form.get("size"),i=o.value;return o.valid&&i>0?t/i:0}erasurePgCalc(t){const o=this.form.get("erasureProfile"),i=o.value;return(o.valid||o.disabled)&&i?t/(i.k+i.m):0}alignPgs(t=this.form.getValue("pgNum")){this.setPgs(Math.round(this.calculatePgPower(t<1?1:t)))}setComplexValidators(){this.editing?this.form.get("name").setValidators([this.form.get("name").validator,u.xQ.custom("uniqueName",t=>this.data.pool&&this.info&&-1!==this.info.pool_names.indexOf(t)&&this.info.pool_names.indexOf(t)!==this.info.pool_names.indexOf(this.data.pool.pool_name))]):(u.xQ.validateIf(this.form.get("size"),()=>this.isReplicated,[u.xQ.custom("min",t=>this.form.getValue("size")&&t<this.getMinSize()),u.xQ.custom("max",t=>this.form.getValue("size")&&this.getMaxSize()<t)]),this.form.get("name").setValidators([this.form.get("name").validator,u.xQ.custom("uniqueName",t=>this.info&&-1!==this.info.pool_names.indexOf(t))])),this.setCompressionValidators()}setCompressionValidators(){u.xQ.validateIf(this.form.get("minBlobSize"),()=>this.hasCompressionEnabled(),[r.Validators.min(0),u.xQ.custom("maximum",t=>this.oddBlobSize(t,this.form.getValue("minBlobSizeUnit"),this.form.getValue("maxBlobSize"),this.form.getValue("maxBlobSizeUnit")))]),u.xQ.validateIf(this.form.get("maxBlobSize"),()=>this.hasCompressionEnabled(),[r.Validators.min(0),u.xQ.custom("minimum",t=>this.oddBlobSize(this.form.getValue("minBlobSize"),this.form.getValue("minBlobSizeUnit"),t,this.form.getValue("maxBlobSizeUnit")))]),u.xQ.validateIf(this.form.get("ratio"),()=>this.hasCompressionEnabled(),[r.Validators.min(0),r.Validators.max(1)])}oddBlobSize(t,o,i,a){const d=this.formatter.toBytes(t+o),O=this.formatter.toBytes(i+a);return!!(d&&O&&d>=O)}hasCompressionEnabled(){return this.form.getValue("mode")&&"none"!==this.form.get("mode").value.toLowerCase()}describeCrushStep(t){return[t.op.replace("_"," "),t.item_name||"",t.type?t.num+" type "+t.type:""].join(" ")}addErasureCodeProfile(){this.addModal(wn,t=>this.reloadECPs(t))}addModal(t,o){this.hideOpenTooltips(),this.modalService.show(t).componentInstance.submitAction.subscribe(a=>{o(a.name)})}hideOpenTooltips(){const t=o=>o&&o.isOpen()&&o.close();t(this.ecpDeletionBtn),t(this.crushDeletionBtn)}reloadECPs(t){this.reloadList({newItemName:t,getInfo:()=>this.ecpService.list(),initInfo:o=>this.initEcp(o),findNewItem:()=>this.ecProfiles.find(o=>o.name===t),controlName:"erasureProfile"})}reloadList({newItemName:t,getInfo:o,initInfo:i,findNewItem:a,controlName:d}){this.modalSubscription&&this.modalSubscription.unsubscribe(),o().subscribe(O=>{if(i(O),!t)return;const m=a();m&&this.form.get(d).setValue(m)})}deleteErasureCodeProfile(){this.deletionModal({value:this.form.getValue("erasureProfile"),usage:this.ecpUsage,deletionBtn:this.ecpDeletionBtn,dataName:"erasureInfo",getTabs:()=>this.ecpInfoTabs,tabPosition:"used-by-pools",nameAttribute:"name",itemDescription:"erasure code profile",reloadFn:()=>this.reloadECPs(),deleteFn:t=>this.ecpService.delete(t),taskName:"ecp/delete"})}deletionModal({value:t,usage:o,deletionBtn:i,dataName:a,getTabs:d,tabPosition:O,nameAttribute:m,itemDescription:p,reloadFn:C,deleteFn:S,taskName:h}){if(!t)return;if(o)return i.animation=!1,i.toggle(),this.data[a]=!0,void setTimeout(()=>{const g=d();g&&g.select(O)},50);const R=t[m];this.modalService.show(ze.D,{itemDescription:p,itemNames:[R],submitActionObservable:()=>{const g=S(R);return g.subscribe(()=>C()),this.taskWrapper.wrapTaskAroundCall({task:new I.O(h,{name:R}),call:g})}})}addCrushRule(){this.addModal(qt,t=>this.reloadCrushRules(t))}reloadCrushRules(t){this.reloadList({newItemName:t,getInfo:()=>this.poolService.getInfo(),initInfo:o=>{this.initInfo(o),this.poolTypeChange("replicated")},findNewItem:()=>this.info.crush_rules_replicated.find(o=>o.rule_name===t),controlName:"crushRule"})}deleteCrushRule(){this.deletionModal({value:this.form.getValue("crushRule"),usage:this.crushUsage,deletionBtn:this.crushDeletionBtn,dataName:"crushInfo",getTabs:()=>this.crushInfoTabs,tabPosition:"used-by-pools",nameAttribute:"rule_name",itemDescription:"crush rule",reloadFn:()=>this.reloadCrushRules(),deleteFn:t=>this.crushRuleService.delete(t),taskName:"crushRule/delete"})}crushRuleIsUsedBy(t){this.crushUsage=t?this.info.used_rules[t]:void 0}ecpIsUsedBy(t){this.ecpUsage=t?this.info.used_profiles[t]:void 0}submit(){if(this.form.invalid)return void this.form.setErrors({cdSubmitButton:!0});const t={pool:this.form.getValue("name")};this.assignFormFields(t,[{externalFieldName:"pool_type",formControlName:"poolType"},{externalFieldName:"pg_autoscale_mode",formControlName:"pgAutoscaleMode",editable:!0},{externalFieldName:"pg_num",formControlName:"pgNum",replaceFn:i=>"on"===this.form.getValue("pgAutoscaleMode")?1:i,editable:!0},this.isReplicated?{externalFieldName:"size",formControlName:"size"}:{externalFieldName:"erasure_code_profile",formControlName:"erasureProfile",attr:"name"},{externalFieldName:"rule_name",formControlName:"crushRule",replaceFn:i=>this.isReplicated?i&&i.rule_name:void 0},{externalFieldName:"quota_max_bytes",formControlName:"max_bytes",replaceFn:i=>{const a=this.form.getValue("maxBytesUnit");return this.formatter.toBytes(i+a)},editable:!0,resetValue:this.editing?0:void 0},{externalFieldName:"quota_max_objects",formControlName:"max_objects",editable:!0,resetValue:this.editing?0:void 0},this.data.applications.selected.includes("rbd")?{externalFieldName:"rbd_mirroring",formControlName:"rbdMirroring"}:{externalFieldName:"rbd_mirroring",formControlName:"rbdMirroring",resetValue:void 0}]),this.info.is_all_bluestore&&(this.assignFormField(t,{externalFieldName:"flags",formControlName:"ecOverwrites",replaceFn:()=>this.isErasure?["ec_overwrites"]:void 0}),"none"!==this.form.getValue("mode")?this.assignFormFields(t,[{externalFieldName:"compression_mode",formControlName:"mode",editable:!0,replaceFn:i=>this.hasCompressionEnabled()&&i},{externalFieldName:"compression_algorithm",formControlName:"algorithm",editable:!0},{externalFieldName:"compression_min_blob_size",formControlName:"minBlobSize",replaceFn:i=>{const a=this.form.getValue("minBlobSizeUnit");return this.formatter.toBytes(i+a)},editable:!0,resetValue:0},{externalFieldName:"compression_max_blob_size",formControlName:"maxBlobSize",replaceFn:i=>{const a=this.form.getValue("maxBlobSizeUnit");return this.formatter.toBytes(i+a)},editable:!0,resetValue:0},{externalFieldName:"compression_required_ratio",formControlName:"ratio",editable:!0,resetValue:0}]):this.editing&&this.assignFormFields(t,[{externalFieldName:"compression_mode",formControlName:"mode",editable:!0,replaceFn:()=>"unset"},{externalFieldName:"srcpool",formControlName:"name",editable:!0,replaceFn:()=>this.data.pool.pool_name}]));const o=this.data.applications.selected;o.length>0||this.editing?(t.application_metadata=o,o.includes("rbd")&&(t.rbd_mirroring=this.form.getValue("rbdMirroring")),this.isApplicationsSelected=!0):this.isApplicationsSelected=!1,this.isReplicated&&!f().isEmpty(this.currentConfigurationValues)&&(t.configuration=this.currentConfigurationValues),this.isApplicationsSelected?this.triggerApiTask(t):this.form.setErrors({cdSubmitButton:!0})}assignFormFields(t,o){o.forEach(i=>this.assignFormField(t,i))}assignFormField(t,{externalFieldName:o,formControlName:i,attr:a,replaceFn:d,editable:O,resetValue:m}){if(this.editing&&(!O||this.form.get(i).pristine))return;const p=this.form.getValue(i);let C=d?d(p):a?f().get(p,a):p;if(!p||!C){if(!O||f().isUndefined(m))return;C=m}t[o]=C}triggerApiTask(t){const o=t.hasOwnProperty("srcpool")?t.srcpool:t.pool;this.taskWrapper.wrapTaskAroundCall({task:new I.O("pool/"+(this.editing?M.Qp.EDIT:M.Qp.CREATE),{pool_name:o}),call:this.poolService[this.editing?M.Qp.UPDATE:M.Qp.CREATE](t)}).subscribe({error:i=>{f().isObject(i.error)&&"34"===i.error.code&&this.form.get("pgNum").setErrors({34:!0}),this.form.setErrors({cdSubmitButton:!0})},complete:()=>this.router.navigate(["/pool"])})}appSelection(){this.form.get("name").updateValueAndValidity({emitEvent:!1,onlySelf:!0})}erasureProfileChange(){const t=this.form.get("erasureProfile").value;t&&(this.msrCrush=t["crush-num-failure-domains"]>0||t["crush-osds-per-failure-domain"]>0)}static{this.\u0275fac=function(o){return new(o||n)(e.\u0275\u0275directiveInject(Dt.l),e.\u0275\u0275directiveInject(Pe.ActivatedRoute),e.\u0275\u0275directiveInject(Pe.Router),e.\u0275\u0275directiveInject(xt.B),e.\u0275\u0275directiveInject(Se.m),e.\u0275\u0275directiveInject(Xe.v),e.\u0275\u0275directiveInject(yt.k),e.\u0275\u0275directiveInject(Re.a),e.\u0275\u0275directiveInject(Me),e.\u0275\u0275directiveInject(Ge.j),e.\u0275\u0275directiveInject(M.Ss),e.\u0275\u0275directiveInject(jn.B))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["cd-pool-form"]],viewQuery:function(o,i){if(1&o&&(e.\u0275\u0275viewQuery(Wn,5),e.\u0275\u0275viewQuery(Yn,5),e.\u0275\u0275viewQuery(Zn,5),e.\u0275\u0275viewQuery(eo,5)),2&o){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(i.crushInfoTabs=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(i.crushDeletionBtn=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(i.ecpInfoTabs=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(i.ecpDeletionBtn=a.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:()=>{let t,o,i,a,d,O,m,p,C,S,h,R,g,F,P,$,D,y,x,U,G,z,H,X,V,w,k,B,j,q,Q,J,K,W,Y,Z,ee,te,A,ne,oe,ie,_e,ae,le,re,se,de,ce,Oe,me,ue,v,Ee,pe,fe,c,Ye,Ze,et,tt,nt,ot,it,_t,at,lt,rt,st,dt,ct,Ot,mt,ut,Et,pt,ft,Pt,Ct,Rt,gt,Mt;return t="Name...",o="Pools should be associated with an application tag",i="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",a="Name",d="Pool type",O="-- Select a pool type --",m="Applications",p="Pools need to be associated with an application before use",C="Quotas",S="Max bytes",h="Leave it blank or specify 0 to disable this quota.",R="A valid quota should be greater than 0.",g="Max objects",F="Leave it blank or specify 0 to disable this quota.",P="A valid quota should be greater than 0.",$="This field is required!",D="The chosen Ceph pool name is already in use.",y="It's not possible to create an RBD pool with '/' in the name. Please change the name or remove 'rbd' from the applications list.",x="Pool name can only contain letters, numbers, '.', '-', '_' or '/'.",U="This field is required!",G="PG Autoscale",z="Calculation help",H="Placement groups",X="This field is required!",V="At least one placement group is needed!",w="Your cluster can't handle this many PGs. Please recalculate the PG amount needed.",k="The current PGs settings were calculated for you, you should make sure the values suit your needs before submit.",B="Replicated size",j="Minimum: " + "\ufffd0\ufffd" + "",q="Maximum: " + "\ufffd0\ufffd" + "",Q="The size specified is out of range. A value from " + "\ufffd0\ufffd" + " to " + "\ufffd1\ufffd" + " is usable.",J="A size of 1 will not create a replication of the object. The 'Replicated size' includes the object itself.",K="Flags",W="EC Overwrites",Y="Application selection is required!",Z="Mirroring",ee="Check this option to enable Pool based mirroring on a Block(RBD) pool.",te="CRUSH",A="This profile can't be deleted as it is in use.",ne="Erasure code profile",oe="Loading...",ie="-- No erasure code profile available --",_e="-- Select an erasure code profile --",ae="Profile",le="Used by pools",re="Profile is not in use.",se="Crush ruleset",de="A new crush ruleset will be implicitly created.",ce="A new crush MSR ruleset will be implicitly created. When crush-osds-per-failure-domain or crush-num-failure-domains is specified",Oe="Crush ruleset",me="There are no rules.",ue="Placement and\n                          replication strategies or distribution policies that allow to\n                          specify how CRUSH places data replicas.",v="This rule can't be deleted as it is in use.",Ee="-- Select a crush rule --",pe="Crush rule",fe="Crush steps",c="Used by pools",Ye="Rule is not in use.",Ze="This field is required!",et="The rule can't be used in the current cluster as it has too few OSDs to meet the minimum required OSD by this rule.",tt="Compression",nt="Mode ",ot="e.g., 128",it="Algorithm",_t="Compression algorithm used",at="Minimum blob size",lt="Chunks smaller than Minimum blob size are never compressed",rt="Maximum blob size",st="Chunks larger than `Maximum Blob Size` are broken into smaller blobs of size mentioned before being compressed.",dt="Ratio",ct="The ratio of the size of the data chunk after compression relative to the original size must be at least this small in order to store the compressed version",Ot="Loading...",mt="-- No erasure compression algorithm available --",ut="Value should be greater than 0",Et="Value should be less than the maximum blob size",pt="Size must be a number or in a valid format. eg: 5 GiB",ft="Value should be greater than 0",Pt="Value should be greater than the minimum blob size",Ct="Size must be a number or in a valid format. eg: 5 GiB",Rt="Value should be between 0.0 and 1.0",gt="Size must be a number or in a valid format. eg: 5 GiB",Mt="The value should be greater or equal to 0",[["formDir","ngForm"],["ecpDeletionBtn","ngbTooltip"],["ecpInfoTabs","ngbNav"],["ecpIsNotUsed",""],["msrCrushText",""],["noRules",""],["crushDeletionBtn","ngbTooltip"],["crushInfoTabs","ngbNav"],["ruleIsNotUsed",""],i,a,d,O,m,p,C,S,h,R,g,F,P,$,D,y,x,U,G,H,X,V,w,k,B,j,q,Q,J,K,W,Y,Z,ee,te,ne,oe,ie,_e,ae,le,re,se,de,ce,Oe,me,Ee,pe,fe,c,Ye,Ze,et,tt,nt,it,_t,at,lt,rt,st,dt,ct,Ot,mt,ut,Et,pt,ft,Pt,Ct,Rt,gt,Mt,["class","cd-col-form",4,"cdFormLoading"],[1,"cd-col-form"],["name","form","novalidate","",3,"formGroup"],[1,"card"],[1,"card-header"],[1,"card-body"],[1,"form-group","row"],["for","name",1,"cd-col-form-label","required"],[1,"cd-col-form-input"],["data-testid","pool-name","id","name","type","text","placeholder",t,"formControlName","name","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","poolType",1,"cd-col-form-label","required"],["data-testid","pool-type-select","id","poolType","formControlName","poolType",1,"form-select"],["ngValue",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["for","applications",1,"cd-col-form-label","required"],["id","applications",3,"selection","customBadges","customBadgeValidators","messages","data","options","selectionLimit"],["title",o,"class","cds-warning-color",3,"cdsIcon","size",4,"ngIf"],["class","form-group row",4,"ngIf"],["formGroupName","compression",4,"ngIf"],["for","max_bytes",1,"cd-col-form-label"],[1,"input-group","mb-1"],["id","max_bytes","type","text","formControlName","max_bytes",1,"form-control"],["id","unit","formControlName","maxBytesUnit",1,"form-input","form-select"],["for","max_objects",1,"cd-col-form-label"],["id","max_objects","min","0","type","number","formControlName","max_objects",1,"form-control"],[3,"hidden"],[3,"changes","form","initializeData"],[1,"card-footer"],["wrappingClass","text-right",3,"submitActionEvent","form","submitText"],[1,"invalid-feedback"],[3,"value"],["for","pgAutoscaleMode",1,"cd-col-form-label"],["id","pgAutoscaleMode","formControlName","pgAutoscaleMode",1,"form-select"],["for","pgNum",1,"cd-col-form-label","required"],["id","pgNum","data-testid","pgNum","formControlName","pgNum","min","1","type","number","required","",1,"form-control",3,"focus","blur"],[1,"form-text","text-muted"],["section","pgs","docText",z],["class","form-text text-muted",4,"ngIf"],["for","size",1,"cd-col-form-label","required"],["id","size","type","number","formControlName","size",1,"form-control",3,"max","min"],["class","text-warning-dark",4,"ngIf"],[1,"list-inline"],[1,"text-warning-dark"],[1,"cd-col-form-label"],[1,"custom-control","custom-checkbox"],["type","checkbox","id","ec-overwrites","formControlName","ecOverwrites",1,"custom-control-input"],["for","ec-overwrites",1,"custom-control-label"],["title",o,1,"cds-warning-color",3,"cdsIcon","size"],[1,"cd-col-form-offset"],["id","rbdMirroring","data-testid","rbd-mirroring-check","type","checkbox","formControlName","rbdMirroring",1,"custom-control-input"],["for","rbdMirroring",1,"custom-control-label"],["for","erasureProfile",1,"cd-col-form-label"],["id","erasureProfile","formControlName","erasureProfile",1,"form-select",3,"change"],["ngValue","",4,"ngIf"],[3,"ngValue",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],["id","ecp-info-button","type","button",1,"btn","btn-light",3,"click","ngClass"],[1,"cds-info-color",3,"cdsIcon","size"],["class","btn btn-light","type","button",3,"click",4,"ngIf"],["class","btn btn-light","type","button","ngbTooltip",A,"triggers","manual",3,"click",4,"ngIf"],["class","form-text text-muted","id","ecp-info-block",4,"ngIf"],[3,"ngValue"],["type","button",1,"btn","btn-light",3,"click"],["type","button","ngbTooltip",A,"triggers","manual",1,"btn","btn-light",3,"click"],["id","ecp-info-block",1,"form-text","text-muted"],["ngbNav","",1,"nav-tabs"],["ngbNavItem","ecp-info"],["ngbNavLink",""],["ngbNavContent",""],["ngbNavItem","used-by-pools"],[3,"ngbNavOutlet"],[3,"renderObjects","hideKeys","data","autoReload"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],["for","crushRule",1,"cd-col-form-label"],["class","form-text text-muted",4,"ngIf","ngIfElse"],[1,"input-group"],["id","crushRule","formControlName","crushRule",1,"form-select"],["id","crush-info-button","type","button","ngbTooltip",ue,1,"btn","btn-light",3,"click","ngClass"],["class","btn btn-light","type","button","ngbTooltip",v,"triggers","manual",3,"click",4,"ngIf"],["class","form-text text-muted","id","crush-info-block",4,"ngIf"],["type","button","ngbTooltip",v,"triggers","manual",1,"btn","btn-light",3,"click"],["id","crush-info-block",1,"form-text","text-muted"],["ngbNavItem","crush-rule-info"],["ngbNavItem","crush-rule-steps"],["formGroupName","compression"],["for","mode",1,"cd-col-form-label"],["id","mode","formControlName","mode",1,"form-select"],["for","algorithm",1,"cd-col-form-label"],["id","algorithm","formControlName","algorithm",1,"form-select"],["for","minBlobSize",1,"cd-col-form-label"],["id","minBlobSize","formControlName","minBlobSize","type","text","min","0","placeholder",ot,1,"form-control"],["id","minUnit","formControlName","minBlobSizeUnit",1,"form-input","form-select"],["for","maxBlobSize",1,"cd-col-form-label"],["id","maxBlobSize","type","text","min","0","formControlName","maxBlobSize",1,"form-control"],["id","minUnit","formControlName","maxBlobSizeUnit",1,"form-input","form-select"],["for","ratio",1,"cd-col-form-label"],["id","ratio","formControlName","ratio","type","number","min","0","max","1","step","0.1",1,"form-control"]]},template:function(o,i){1&o&&e.\u0275\u0275template(0,Mi,80,37,"div",84),2&o&&e.\u0275\u0275property("cdFormLoading",i.loading)},dependencies:[L.NgClass,L.NgForOf,L.NgIf,E.NgbNavContent,E.NgbNav,E.NgbNavItem,E.NgbNavLink,E.NgbNavLinkBase,E.NgbNavOutlet,he.m,qn.U,Qn.C,Le.e,Fe.O,Be.i,Te.B,Jn.G,Ne.S,Ae.a,ve.C,be.E,r.\u0275NgNoValidate,r.NgSelectOption,r.\u0275NgSelectMultipleOption,r.DefaultValueAccessor,r.NumberValueAccessor,r.CheckboxControlValueAccessor,r.SelectControlValueAccessor,r.NgControlStatus,r.NgControlStatusGroup,r.RequiredValidator,r.MinValidator,r.MaxValidator,r.FormGroupDirective,r.FormControlName,r.FormGroupName,E.NgbTooltip,Kn.c,ge.IconDirective,L.TitleCasePipe,Ie.r],styles:[".icon-warning-color[_ngcontent-%COMP%]{margin-left:3px}"]})}}return n})();var Si=s(50619),hi=s(97421),Li=s(10978),Fi=s(25947),$e=s(2243),De=s(62847),N=s(2148),Ti=s(29130),Ni=s(19380),Ai=s(18457),Qe=s(58510),ye=s(2361);class vi{constructor(_){this.pool_name=_}}var bi=s(94254),Ii=s(22453),$i=s(68316),Je=s(1505),Di=s(32295),yi=s(45843),xi=s(71656),Ke=s(32609),Ui=s(62988),Gi=s(15224);function zi(n,_){if(1&n&&e.\u0275\u0275element(0,"cd-table-key-value",14),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("renderObjects",!0)("data",t.poolDetails)("autoReload",!1)}}function Hi(n,_){if(1&n&&e.\u0275\u0275element(0,"cd-grafana",16),2&n){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275propertyInterpolate1("grafanaPath","ceph-pool-detail?var-pool_name=",t.selection.pool_name,""),e.\u0275\u0275property("type","metrics")}}function Xi(n,_){1&n&&(e.\u0275\u0275elementContainerStart(0,15),e.\u0275\u0275elementStart(1,"a",8),e.\u0275\u0275i18n(2,2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,Hi,1,3,"ng-template",9),e.\u0275\u0275elementContainerEnd())}function Vi(n,_){if(1&n&&e.\u0275\u0275element(0,"cd-rbd-configuration-table",18),2&n){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("data",t.selectedPoolConfiguration)}}function wi(n,_){1&n&&(e.\u0275\u0275elementContainerStart(0,17),e.\u0275\u0275elementStart(1,"a",8),e.\u0275\u0275i18n(2,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,Vi,1,1,"ng-template",9),e.\u0275\u0275elementContainerEnd())}function ki(n,_){if(1&n&&e.\u0275\u0275element(0,"cd-table",20),2&n){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("data",t.cacheTiers)("columns",t.cacheTierColumns)("autoSave",!1)}}function Bi(n,_){1&n&&(e.\u0275\u0275elementContainerStart(0,19),e.\u0275\u0275elementStart(1,"a",8),e.\u0275\u0275i18n(2,4),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,ki,1,3,"ng-template",9),e.\u0275\u0275elementContainerEnd())}function ji(n,_){if(1&n&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"nav",6,0),e.\u0275\u0275elementContainerStart(3,7),e.\u0275\u0275elementStart(4,"a",8),e.\u0275\u0275i18n(5,1),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(6,zi,1,3,"ng-template",9),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275template(7,Xi,4,0,"ng-container",10)(8,wi,4,0,"ng-container",11)(9,Bi,4,0,"ng-container",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(10,"div",13),e.\u0275\u0275elementContainerEnd()),2&n){const t=e.\u0275\u0275reference(2),o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",o.permissions.grafana.read),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","replicated"===o.selection.type),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",(null==o.selection.tiers?null:o.selection.tiers.length)>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngbNavOutlet",t)}}let qi=(()=>{class n{constructor(t){this.poolService=t,this.cacheTierColumns=[],this.omittedPoolAttributes=["cdExecuting","cdIsBinary","stats"],this.cacheTierColumns=[{prop:"pool_name",name:"Name",flexGrow:3},{prop:"cache_mode",name:"Cache Mode",flexGrow:2},{prop:"cache_min_evict_age",name:"Min Evict Age",flexGrow:2},{prop:"cache_min_flush_age",name:"Min Flush Age",flexGrow:2},{prop:"target_max_bytes",name:"Target Max Bytes",flexGrow:2},{prop:"target_max_objects",name:"Target Max Objects",flexGrow:2}]}ngOnChanges(){this.selection&&(this.poolService.getConfiguration(this.selection.pool_name).subscribe(t=>{Ke.c.updateChanged(this,{selectedPoolConfiguration:t})}),Ke.c.updateChanged(this,{poolDetails:f().omit(this.selection,this.omittedPoolAttributes)}))}static{this.\u0275fac=function(o){return new(o||n)(e.\u0275\u0275directiveInject(Se.m))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["cd-pool-details"]],inputs:{cacheTiers:"cacheTiers",permissions:"permissions",selection:"selection"},features:[e.\u0275\u0275NgOnChangesFeature],decls:1,vars:1,consts:()=>{let t,o,i,a,d;return t="Details",o="Performance Details",i="Pool details",a="Configuration",d="Cache Tiers Details",[["nav","ngbNav"],t,o,a,d,[4,"ngIf"],["ngbNav","","cdStatefulTab","pool-details",1,"nav-tabs"],["ngbNavItem","details"],["ngbNavLink",""],["ngbNavContent",""],["ngbNavItem","performance-details",4,"ngIf"],["ngbNavItem","configuration",4,"ngIf"],["ngbNavItem","cache-tiers-details",4,"ngIf"],[3,"ngbNavOutlet"],[3,"renderObjects","data","autoReload"],["ngbNavItem","performance-details"],["title",i,"uid","-xyV8KCiz","grafanaStyle","three",3,"grafanaPath","type"],["ngbNavItem","configuration"],[3,"data"],["ngbNavItem","cache-tiers-details"],["columnMode","flex",3,"data","columns","autoSave"]]},template:function(o,i){1&o&&e.\u0275\u0275template(0,ji,11,4,"ng-container",5),2&o&&e.\u0275\u0275property("ngIf",i.selection)},dependencies:[L.NgIf,E.NgbNavContent,E.NgbNav,E.NgbNavItem,E.NgbNavLink,E.NgbNavLinkBase,E.NgbNavOutlet,Je.c,De.O,Be.i,Ui.B,Gi.k],changeDetection:0})}}return n})();const Qi=["poolUsageTpl"],Ji=["poolConfigurationSourceTpl"];function Ki(n,_){if(1&n&&e.\u0275\u0275element(0,"cd-pool-details",14),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("selection",t.expandedRow)("permissions",t.permissions)("cacheTiers",t.cacheTiers)}}function Wi(n,_){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"cd-table",11,2),e.\u0275\u0275listener("fetchData",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(i.taskListService.fetch())})("setExpandedRow",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.setExpandedRow(i))})("updateSelection",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.updateSelection(i))}),e.\u0275\u0275element(2,"cd-table-actions",12),e.\u0275\u0275template(3,Ki,1,3,"cd-pool-details",13),e.\u0275\u0275elementEnd()}if(2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("data",t.pools)("columns",t.columns)("hasDetails",!0)("status",t.tableStatus)("autoReload",-1),e.\u0275\u0275advance(2),e.\u0275\u0275property("permission",t.permissions.pool)("selection",t.selection)("tableActions",t.tableActions)}}function Yi(n,_){1&n&&e.\u0275\u0275element(0,"cd-grafana",15),2&n&&e.\u0275\u0275property("grafanaPath","ceph-pools-overview?")("type","metrics")}function Zi(n,_){1&n&&(e.\u0275\u0275elementContainerStart(0,6),e.\u0275\u0275elementStart(1,"a",7),e.\u0275\u0275i18n(2,4),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,Yi,1,2,"ng-template",8),e.\u0275\u0275elementContainerEnd())}function e_(n,_){if(1&n&&e.\u0275\u0275element(0,"cd-usage-bar",17),2&n){const t=e.\u0275\u0275nextContext().data.row;e.\u0275\u0275property("total",t.stats.bytes_used.latest+t.stats.avail_raw.latest)("used",t.stats.bytes_used.latest)("title",t.pool_name)}}function t_(n,_){if(1&n&&e.\u0275\u0275template(0,e_,1,3,"cd-usage-bar",16),2&n){const t=_.data.row;e.\u0275\u0275property("ngIf",null==t.stats||null==t.stats.avail_raw?null:t.stats.avail_raw.latest)}}const xe="pool";let n_=(()=>{class n extends Fi.D{constructor(t,o,i,a,d,O,m,p,C,S,h){super(),this.poolService=t,this.taskWrapper=o,this.ecpService=i,this.authStorageService=a,this.taskListService=d,this.modalService=O,this.pgCategoryService=m,this.dimlessPipe=p,this.urlBuilder=C,this.configurationService=S,this.actionLabels=h,this.selection=new Ni.y,this.executingTasks=[],this.tableStatus=new $e.m,this.cacheTiers=[],this.monAllowPoolDelete=!1,this.permissions=this.authStorageService.getPermissions(),this.tableActions=[{permission:"create",icon:b.FI.add,routerLink:()=>this.urlBuilder.getCreate(),name:this.actionLabels.CREATE},{permission:"update",icon:b.FI.edit,routerLink:()=>this.urlBuilder.getEdit(encodeURIComponent(this.selection.first().pool_name)),name:this.actionLabels.EDIT},{permission:"delete",icon:b.FI.destroy,click:()=>this.deletePoolModal(),name:this.actionLabels.DELETE,disable:this.getDisableDesc.bind(this)}],this.permissions.configOpt.read&&this.configurationService.get("mon_allow_pool_delete").subscribe(R=>{if(f().has(R,"value")){const g=f().find(R.value,F=>"mon"===F.section)||{value:!1};this.monAllowPoolDelete="true"===g.value}})}ngOnInit(){const t=(o,i,a)=>f().get(i,o)>f().get(a,o)?1:-1;this.columns=[{prop:"pool_name",name:"Name",flexGrow:2,cellTransformation:N.x.executing},{prop:"data_protection",name:"Data Protection",cellTransformation:N.x.badge,customTemplateConfig:{class:"badge-background-gray"},flexGrow:1.3},{prop:"application_metadata",name:"Applications",cellTransformation:N.x.badge,customTemplateConfig:{class:"badge-background-primary"},flexGrow:1.5},{prop:"pg_status",name:"PG Status",flexGrow:1.2,cellClass:({row:o,column:i,value:a})=>this.getPgStatusCellClass(o,i,a)},{prop:"crush_rule",name:"Crush Ruleset",isHidden:!0,flexGrow:2},{name:"Usage",prop:"usage",cellTemplate:this.poolUsageTpl,flexGrow:1.2},{prop:"stats.rd_bytes.rates",name:"Read bytes",comparator:(o,i,a,d)=>t("stats.rd_bytes.latest",a,d),cellTransformation:N.x.sparkline,flexGrow:1.5},{prop:"stats.wr_bytes.rates",name:"Write bytes",comparator:(o,i,a,d)=>t("stats.wr_bytes.latest",a,d),cellTransformation:N.x.sparkline,flexGrow:1.5},{prop:"stats.rd.rate",name:"Read ops",flexGrow:1,pipe:this.dimlessPipe,cellTransformation:N.x.perSecond},{prop:"stats.wr.rate",name:"Write ops",flexGrow:1,pipe:this.dimlessPipe,cellTransformation:N.x.perSecond}],this.taskListService.init(()=>this.ecpService.list().pipe((0,Si.mergeMap)(o=>(this.ecProfileList=o,this.poolService.getList()))),void 0,o=>{this.pools=this.transformPoolsData(o),this.tableStatus=new $e.m},()=>{this.table.reset(),this.tableStatus=new $e.m(Ti.k.ValueException)},o=>o.name.startsWith(`${xe}/`),(o,i)=>i.metadata.pool_name===o.pool_name,{default:o=>new vi(o.pool_name)})}updateSelection(t){this.selection=t}deletePoolModal(){const t=this.selection.first().pool_name;this.modalService.show(ze.D,{impact:Ii.r.high,itemDescription:"Pool",itemNames:[t],submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new I.O(`${xe}/${M.Qp.DELETE}`,{pool_name:t}),call:this.poolService.delete(t)})})}getPgStatusCellClass(t,o,i){return{"text-right":!0,[`pg-${this.pgCategoryService.getTypeByStates(i)}`]:!0}}getErasureCodeProfile(t){let o="";return f().forEach(this.ecProfileList,i=>{i.name===t&&(o=`EC: ${i.k}+${i.m}`)}),o}transformPoolsData(t){const o=["bytes_used","max_avail","avail_raw","percent_used","rd_bytes","wr_bytes","rd","wr"],i={latest:0,rate:0,rates:[]};return f().forEach(t,a=>{a.pg_status=this.transformPgStatus(a.pg_status);const d={};f().forEach(o,O=>{d[O]=a.stats&&a.stats[O]?a.stats[O]:i}),a.stats=d,a.usage=d.percent_used.latest,!a.cdExecuting&&a.pg_num+a.pg_placement_num!==a.pg_num_target+a.pg_placement_num_target&&(a.cdExecuting="Updating"),["rd_bytes","wr_bytes"].forEach(O=>{a.stats[O].rates=a.stats[O].rates.map(m=>m[1])}),a.cdIsBinary=!0,"erasure"===a.type&&(a.data_protection=this.getErasureCodeProfile(a.erasure_code_profile)),"replicated"===a.type&&(a.data_protection=`replica: \xd7${a.size}`)}),t}transformPgStatus(t){const o=[];return f().forEach(t,(i,a)=>{o.push(`${i} ${a}`)}),o.join(", ")}getSelectionTiers(){if(typeof this.expandedRow<"u"){const t=this.expandedRow.tiers;this.cacheTiers=this.pools.filter(o=>t.includes(o.pool))}}getDisableDesc(){return!this.selection?.hasSelection||!this.monAllowPoolDelete&&"Pool deletion is disabled by the mon_allow_pool_delete configuration setting."}setExpandedRow(t){super.setExpandedRow(t),this.getSelectionTiers()}static{this.\u0275fac=function(o){return new(o||n)(e.\u0275\u0275directiveInject(Se.m),e.\u0275\u0275directiveInject(Re.a),e.\u0275\u0275directiveInject(Me),e.\u0275\u0275directiveInject(Xe.v),e.\u0275\u0275directiveInject(Qe.D),e.\u0275\u0275directiveInject(bi.V),e.\u0275\u0275directiveInject(hi.v),e.\u0275\u0275directiveInject(Ai.u),e.\u0275\u0275directiveInject(ye.E),e.\u0275\u0275directiveInject(Li.s),e.\u0275\u0275directiveInject(M.Ss))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["cd-pool-list"]],viewQuery:function(o,i){if(1&o&&(e.\u0275\u0275viewQuery(De.O,5),e.\u0275\u0275viewQuery(Qi,7),e.\u0275\u0275viewQuery(Ji,5)),2&o){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(i.table=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(i.poolUsageTpl=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(i.poolConfigurationSourceTpl=a.first)}},features:[e.\u0275\u0275ProvidersFeature([Qe.D,{provide:ye.E,useValue:new ye.E(xe)}]),e.\u0275\u0275InheritDefinitionFeature],decls:10,vars:2,consts:()=>{let t,o,i;return t="Pools List",o="Overall Performance",i="Ceph pools overview",[["nav","ngbNav"],["poolUsageTpl",""],["table",""],t,o,["ngbNav","",1,"nav-tabs"],["ngbNavItem",""],["ngbNavLink",""],["ngbNavContent",""],["ngbNavItem","",4,"cdScope"],[3,"ngbNavOutlet"],["id","pool-list","selectionType","single",3,"fetchData","setExpandedRow","updateSelection","data","columns","hasDetails","status","autoReload"],["id","pool-list-actions",1,"table-actions",3,"permission","selection","tableActions"],["id","pool-list-details",3,"selection","permissions","cacheTiers",4,"cdTableDetail"],["id","pool-list-details",3,"selection","permissions","cacheTiers"],["title",i,"uid","z99hzWtmk","grafanaStyle","two",3,"grafanaPath","type"],["decimals","2",3,"total","used","title",4,"ngIf"],["decimals","2",3,"total","used","title"]]},template:function(o,i){if(1&o&&(e.\u0275\u0275elementStart(0,"nav",5,0),e.\u0275\u0275elementContainerStart(2,6),e.\u0275\u0275elementStart(3,"a",7),e.\u0275\u0275i18n(4,3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,Wi,4,8,"ng-template",8),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275template(6,Zi,4,0,"ng-container",9),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(7,"div",10),e.\u0275\u0275template(8,t_,1,1,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)),2&o){const a=e.\u0275\u0275reference(1);e.\u0275\u0275advance(6),e.\u0275\u0275property("cdScope","grafana"),e.\u0275\u0275advance(),e.\u0275\u0275property("ngbNavOutlet",a)}},dependencies:[L.NgIf,E.NgbNavContent,E.NgbNav,E.NgbNavItem,E.NgbNavLink,E.NgbNavLinkBase,E.NgbNavOutlet,$i.o,Je.c,De.O,Di.j,yi.N,xi.V,qi],styles:["cd-pool-list .pg-clean{color:#008a00}  cd-pool-list .pg-working{color:#25828e}  cd-pool-list .pg-warning{color:#d48200}  cd-pool-list .pg-unknown{color:#dc3545}"]})}}return n})();var o_={elem:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",width:16,height:16},content:[{elem:"path",attrs:{d:"M8,1C4.1,1,1,4.1,1,8s3.1,7,7,7s7-3.1,7-7S11.9,1,8,1z M8,14c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S11.3,14,8,14z"}},{elem:"circle",attrs:{cx:"8",cy:"11.8",r:".8"}},{elem:"path",attrs:{d:"M8.5,4H7.8C6.5,4,5.5,5,5.5,6.2c0,0,0,0,0,0v0.2h1V6.2C6.5,5.6,7.1,5,7.8,5h0.8c0.7,0,1.2,0.6,1.2,1.2S9.2,7.5,8.5,7.5h-1\tv2.2h1V8.5c1.2,0,2.2-1,2.2-2.2S9.7,4,8.5,4z"}}],name:"help",size:16},i_={elem:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",width:16,height:16},content:[{elem:"path",attrs:{d:"M12,7H6V4c0-1.1,0.9-2,2-2s2,0.9,2,2h1c0-1.7-1.3-3-3-3S5,2.3,5,4v3H4C3.4,7,3,7.4,3,8v6c0,0.6,0.4,1,1,1h8c0.6,0,1-0.4,1-1\tV8C13,7.4,12.6,7,12,7z M12,14H4V8h8V14z"}}],name:"unlocked",size:16},__=s(22056);let We=(()=>{class n{constructor(t){this.iconService=t,this.iconService.registerAll([o_,i_,__.A])}static{this.\u0275fac=function(o){return new(o||n)(e.\u0275\u0275inject(ge.IconService))}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:n})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[Lt._,L.CommonModule,E.NgbNavModule,St.G,Pe.RouterModule,r.ReactiveFormsModule,E.NgbTooltipModule,ht.BlockModule,ge.IconModule]})}}return n})();const a_=[{path:"",component:n_},{path:M.Qp.CREATE,component:qe,data:{breadcrumbs:M.yY.CREATE}},{path:`${M.Qp.EDIT}/:name`,component:qe,data:{breadcrumbs:M.yY.EDIT}}];let l_=(()=>{class n{static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:n})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[We,Pe.RouterModule.forChild(a_)]})}}return n})()}}]);